import{r as s,T as E,j as e,e as w,a as F,I as P,U as $}from"./index-B88h2kYZ.js";import{L as T}from"./Layout-BzzV81EK.js";import{T as G}from"./Table-BvY52Fag.js";const A=({detail:l,setDetail:i})=>{const[m,p]=s.useState(""),[u,x]=s.useState(""),[N,f]=s.useState(null),c=s.useRef(null),[b,{isSuccess:j,isLoading:v,isError:n,reset:S}]=E(),g=r=>{if(r.preventDefault(),!u)return w.error("Lengkapi data");const h=new FormData;h.append("id",m||""),h.append("name",u),h.append("cover",N),w.promise(b(h).unwrap().then(d=>d.message),{loading:"Meyimpan data...",success:d=>d,error:d=>d.data.message})},y=()=>{i({}),p(""),x(""),c.current&&(c.current.value=null)};return s.useEffect(()=>{l&&(p(l.id),x(l.name))},[l]),s.useEffect(()=>{(j||n)&&(S(),i({}),p(""),x(""),c.current&&(c.current.value=null))},[j,n]),e.jsxs("form",{onSubmit:g,className:"rounded border p-2 bg-white d-flex flex-column gap-2",children:[e.jsx("p",{className:"m-0 h6",children:"Mata Pelajaran"}),e.jsx("input",{type:"text",name:"name",id:"name",className:"form-control",placeholder:"Nama Mata Pelajaran",value:u||"",onChange:r=>x(r.target.value)}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"file",className:"form-control",id:"inputGroupFile02",ref:c,onChange:r=>f(r.target.files[0])}),e.jsx("label",{className:"input-group-text",htmlFor:"inputGroupFile02",children:"Cover"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:y,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:v,children:"Simpan"})]})]})},R=({setDetail:l})=>{const i=F(),[m,p]=s.useState(1),[u,x]=s.useState(10),[N,f]=s.useState(""),{data:c={},isLoading:b}=P({page:m,limit:u,search:N}),{totalData:j,totalPages:v,subjects:n=[]}=c,[S,{isSuccess:g,isLoading:y,isError:r,reset:h}]=$(),d=a=>{w.promise(S(a).unwrap().then(t=>t.message),{loading:"Memproses...",success:t=>t,error:t=>t.data.message})},M=(a,t)=>{const o=a.replace(/\s+/g,"-");i(`/pelajaran/${o}/${t}`)};return s.useEffect(()=>{(g||r)&&h()},[g,r]),e.jsx(G,{page:m,setPage:p,setLimit:x,setSearch:f,totalData:j,totalPages:v,isLoading:b,children:e.jsxs("table",{className:"table table-bordered table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Cover"}),e.jsx("th",{className:"text-center",children:"Mata Pelajaran"}),e.jsx("th",{className:"text-center",children:"Guru Pengampu"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(n==null?void 0:n.length)>0?n==null?void 0:n.map((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(m-1)*u+t+1}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("img",{src:a.cover?`${window.location.origin}${a.cover}`:"/logo.png",alt:`cover-${a.name}`,width:65,height:80,className:"overflow-hidden rounded",style:{objectFit:"cover"}})}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"align-middle d-flex flex-column gap-2",children:a.teachers.map((o,k)=>{var L,C;return e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("p",{className:"m-0",children:[o.name," ",e.jsx("span",{className:"text-secondary",children:`(${((L=o.class)==null?void 0:L.length)>0?(C=o.class)==null?void 0:C.map(D=>D.name).join(", "):"Data belum tersedia"})`})]}),e.jsxs("div",{className:"d-flex gap-2 text-secondary",children:[e.jsxs("p",{className:"m-0",children:[o.chapters," Chapter"]}),e.jsxs("p",{className:"m-0",children:[o.contents," Materi"]})]})]},k)})}),e.jsx("td",{className:"text-cente align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>M(a.name,a.id),children:e.jsx("i",{className:"bi bi-three-dots-vertical"})}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>l(a),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:y,onClick:()=>d(a.id),children:e.jsx("i",{className:"bi bi-folder-minus"})})]})})]},t)):e.jsx("tr",{children:e.jsx("td",{colSpan:5,children:"Data tidak tersedia"})})})]})})},B=()=>{const[l,i]=s.useState({});return e.jsx(T,{title:"Mata Pelajaran",levels:["admin"],children:e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx(A,{detail:l,setDetail:i})}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsx(R,{setDetail:i})})]})})};export{B as default};
