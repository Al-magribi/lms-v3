import{a as e,aa as a,ab as t,j as s,d as n,ac as i}from"./index-Co1WScRM.js";import{b as l}from"./vendor-CpHG0K6b.js";import{L as r}from"./Layout-PxPEb2Rf.js";import{T as d}from"./Table-BwrxRiOQ.js";const c=({exam:i,setExam:r})=>{const[d,c]=l.useState(""),o=l.useRef(null),{user:m}=e((e=>e.auth)),{data:u,isLoading:h}=a({exam:i.id,student:m.user_id},{skip:!i.id||!m.user_id}),[x,{isLoading:b}]=t();l.useEffect((()=>{o.current&&(o.current.addEventListener("shown.bs.modal",(()=>{o.current.removeAttribute("aria-hidden")})),o.current.addEventListener("hidden.bs.modal",(()=>{o.current.setAttribute("aria-hidden","true")})))}),[]);const j=()=>{r({}),c("")};return s.jsx("div",{ref:o,className:"modal fade",id:"token",tabIndex:"-1",role:"dialog","aria-labelledby":"token-label","aria-modal":"true",children:s.jsx("div",{className:"modal-dialog",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h5",{className:"modal-title",id:"token-label",children:["Token ",i.name]}),s.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:j})]}),s.jsx("div",{className:"modal-body",children:s.jsx("input",{type:"text",name:"token",id:"token",className:"form-control",placeholder:"Masukkan Token",value:d,onChange:e=>c(e.target.value),"aria-label":"Token input"})}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-danger","data-bs-dismiss":"modal",onClick:j,children:"Tutup"}),s.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{if(d!==i.token)return n.error("Token Salah"),void c("");if(u&&u.ispenalty)return n.error("Anda melanggar ketentuan"),void c("");if(u&&u.isactive)return n.error("Anda sedang mengikuti ujian"),void c("");if(u&&u.isdone)return n.error("Anda sudah mengikuti ujian"),void c("");const e={exam:i.id,student:m.user_id,action:"start",start_time:(new Date).toISOString()};n.promise(x(e).unwrap(),{loading:"Memuat...",success:e=>{r({}),c("");const a=document.getElementById("token");if(a){const e=a.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}localStorage.removeItem("questions");const t=i.name.replace(/\s+/g,"-");return window.location.href=`/siswa-cbt/${t}/${i.id}/${i.token}`,e.message||"Berhasil memulai ujian"},error:e=>{var a;return(null==(a=e.data)?void 0:a.message)||"Gagal memulai ujian"}})},disabled:h||b,children:"Konfirmasi"})]})]})})})},o=({classid:e})=>{const[a,t]=l.useState(1),[n,r]=l.useState(10),[o,m]=l.useState(""),{data:u={},isLoading:h}=i({classid:e,page:a,limit:n,search:o},{skip:!e}),{exams:x=[],totalData:b,totalPages:j}=u,[g,N]=l.useState({});return s.jsxs(d,{isLoading:h,page:a,setPage:t,limit:n,setLimit:r,totalPages:j,setSearch:m,totalData:b,children:[s.jsxs("table",{className:"mb-0 table table-hover table-striped table-bordered",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-center",children:"No"}),s.jsx("th",{className:"text-center",children:"Guru"}),s.jsx("th",{className:"text-center",children:"Nama Ujian"}),s.jsx("th",{className:"text-center",children:"Durasi"}),s.jsx("th",{className:"text-center",children:"Status"}),s.jsx("th",{className:"text-center",children:"Aksi"})]})}),s.jsx("tbody",{children:(null==x?void 0:x.length)>0?null==x?void 0:x.map(((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"text-center align-middle",children:a+1}),s.jsx("td",{className:"align-middle",children:e.teacher_name}),s.jsx("td",{className:"align-middle",children:e.name}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("p",{className:"m-0 badge bg-primary",children:`${e.duration} Menit`})}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("p",{className:"m-0",children:e.isactive?s.jsx("span",{className:"badge bg-success",children:"Aktif"}):s.jsx("span",{className:"badge bg-danger",children:"nonaktif"})})}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("button",{className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#token",disabled:!e.isactive,onClick:()=>N(e),children:s.jsx("i",{className:"bi bi-eye"})})})]},e.id))):s.jsx("tr",{children:s.jsx("td",{colSpan:6,children:"Data Belum Tersedia"})})})]}),s.jsx(c,{exam:g,setExam:N})]})},m=()=>{const{user:a}=e((e=>e.auth));return s.jsx(r,{title:"Daftar Ujian",levels:["student"],children:s.jsx(o,{classid:a.class_id})})};export{m as default};
//# sourceMappingURL=StudentCbt-tW8GVx9B.js.map
