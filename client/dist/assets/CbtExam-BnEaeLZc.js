import{b as e,aD as a,aH as s,aI as l,j as i,e as n,aJ as t,aK as r,aL as o}from"./index-KxNRCzKX.js";import{b as d}from"./vendor-DfXzdC0j.js";import{S as c}from"./react-select.esm-DUeLA41h.js";import{T as m}from"./Table-Ci0XjNxT.js";const u={menuPortal:e=>({...e,zIndex:9999})},b=({detail:t,setDetail:r,onSuccess:o})=>{var m;const{user:b}=e((e=>e.auth)),h={examid:"",teacher:(null==b?void 0:b.id)||"",bank:[],name:"",duration:"",classes:[],token:"",isshuffle:"",mc_score:"",essay_score:""},[p,x]=d.useState(h),{data:g}=a(),{data:v}=s(),[j,{isSuccess:f,isLoading:y,isError:k,reset:N}]=l(),w=null==g?void 0:g.map((e=>({value:e.id,label:e.name,bank:e.bank}))),C="teacher"===(null==b?void 0:b.level)?null==g?void 0:g.find((e=>e.id===b.id)):null==g?void 0:g.find((e=>e.id===p.teacher)),S=null==(m=null==C?void 0:C.bank)?void 0:m.map((e=>({value:e.id,label:e.name,type:e.type}))),_=null==v?void 0:v.map((e=>({value:e.id,label:e.name})));d.useEffect((()=>{(null==t?void 0:t.id)?x({examid:t.id,teacher:t.teacher,name:t.name,duration:t.duration,token:t.token,isshuffle:t.isshuffle,mc_score:t.mc_score,essay_score:t.essay_score,bank:t.banks.map((e=>({bankid:e.id,type:e.type,pg:e.pg,essay:e.essay}))),classes:t.classes.map((e=>({value:e.id,label:e.name})))}):"teacher"===(null==b?void 0:b.level)&&x((e=>({...e,teacher:b.id})))}),[t,b]);const E=(e,a,s)=>{const{value:l}=e.target;x((e=>({...e,bank:e.bank.map((e=>e.bankid===a?{...e,[s]:l}:e))})))},P=()=>{x({...h,teacher:(null==b?void 0:b.id)||""}),r(null)};return d.useEffect((()=>{if(f){P(),N(),null==o||o();const e=document.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}k&&N()}),[f,k,o]),d.useEffect((()=>()=>{document.body.style.overflow="unset"}),[]),i.jsx("div",{className:"modal fade",id:"addexam","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:i.jsx("div",{className:"modal-dialog",children:i.jsxs("form",{onSubmit:e=>{e.preventDefault(),p.name.includes("/")?n.error("Karakter / tidak diizinkan"):n.promise(j(p).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:(null==t?void 0:t.id)?"Edit Ujian":"Tambah Ujian"}),i.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),i.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[i.jsx(c,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(null==w?void 0:w.find((e=>e.value===p.teacher)))||null,options:w,onChange:e=>{x((a=>({...a,teacher:(null==e?void 0:e.value)||null,bank:[]})))},isDisabled:!!(null==t?void 0:t.id),menuPortalTarget:document.body,styles:u}),i.jsx(c,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Pilih Bank Soal",value:null==S?void 0:S.filter((e=>p.bank.some((a=>a.bankid===e.value)))),options:S,onChange:e=>{const a=(null==e?void 0:e.map((e=>({bankid:e.value,type:e.type,pg:"",essay:""}))))||[];x((e=>({...e,bank:a})))},isDisabled:!p.teacher||!!(null==t?void 0:t.id),menuPortalTarget:document.body,styles:u}),p.bank.filter((e=>"bank"===e.type)).map((e=>{var a,s,l;return i.jsxs("div",{className:"border p-2 rounded",children:[i.jsx("p",{className:"m-0",children:(null==(a=null==S?void 0:S.find((a=>a.value===e.bankid)))?void 0:a.label)||(null==(l=null==(s=null==t?void 0:t.banks)?void 0:s.find((a=>a.id===e.bankid)))?void 0:l.name)}),i.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal PG ",value:e.pg,onChange:a=>E(a,e.bankid,"pg")}),i.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal Essay ",value:e.essay,onChange:a=>E(a,e.bankid,"essay")})]},e.bankid)})),i.jsx(c,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Untuk Kelas",value:p.classes,options:_,onChange:e=>{x((a=>({...a,classes:e||[]})))},menuPortalTarget:document.body,styles:u}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Ujian",value:p.name||"",onChange:e=>x({...p,name:e.target.value})}),i.jsx("label",{htmlFor:"name",children:"Nama Ujian"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"duration",className:"form-control",placeholder:"Durasi",value:p.duration||"",onChange:e=>x({...p,duration:e.target.value})}),i.jsx("label",{htmlFor:"duration",children:"Durasi"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"mc_score",id:"mc_score",className:"form-control",placeholder:"Persentase Nilai PG",value:p.mc_score,onChange:e=>x({...p,mc_score:e.target.value})}),i.jsx("label",{htmlFor:"mc_score",children:"Persentase Nilai PG"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"essay_score",id:"essay_score",className:"form-control",placeholder:"Persentase Nilai Essay",value:p.essay_score,onChange:e=>x({...p,essay_score:e.target.value})}),i.jsx("label",{htmlFor:"essay_score",children:"Persentase Nilai Essay"})]}),i.jsxs("select",{name:"isshuffle",className:"form-control",value:p.isshuffle,onChange:e=>x({...p,isshuffle:e.target.value}),children:[i.jsx("option",{value:"",hidden:!0,children:"Acak Soal"}),i.jsx("option",{value:!0,children:"Ya"}),i.jsx("option",{value:!1,children:"Tidak"})]})]}),i.jsxs("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-warning","data-bs-dismiss":"modal",onClick:()=>{P(),null==o||o()},children:"Batal"}),i.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:y,children:(null==t?void 0:t.id)?"Update":"Simpan"})]})]})})})},h=({setDetail:e})=>{const[a,s]=d.useState(1),[l,c]=d.useState(10),[u,b]=d.useState(""),{data:h={},isLoading:p}=t({page:a,limit:l,search:u}),{exams:x=[],totalData:g,totalPages:v}=h,[j,{isSuccess:f,isLoading:y,isError:k,reset:N}]=r(),[w,{isSuccess:C,isError:S,reset:_}]=o();return d.useEffect((()=>{(f||k)&&N()}),[f,k]),d.useEffect((()=>{(C||S)&&_()}),[C,S]),i.jsx("div",{style:{overflow:"visible",position:"relative"},children:i.jsx(m,{page:a,setPage:s,setLimit:c,setSearch:b,totalData:g,totalPages:v,isLoading:p,children:i.jsx("div",{className:"table-responsive",style:{overflow:"visible",position:"relative"},children:i.jsxs("table",{className:"table table-hover table-striped",style:{position:"relative",overflow:"visible"},children:[i.jsx("thead",{className:"table-dark",children:i.jsxs("tr",{children:[i.jsx("th",{scope:"col",children:"No"}),i.jsx("th",{scope:"col",children:"Data Ujian"}),i.jsx("th",{scope:"col",children:"Token"}),i.jsx("th",{scope:"col",children:"Kelas"}),i.jsx("th",{scope:"col",children:"Bank Soal"}),i.jsx("th",{scope:"col",children:"Skor PG"}),i.jsx("th",{scope:"col",children:"Skor Essay"}),i.jsx("th",{scope:"col",children:"Durasi"}),i.jsx("th",{scope:"col",children:"Status"}),i.jsx("th",{scope:"col",children:"Aksi"})]})}),i.jsx("tbody",{style:{position:"relative",overflow:"visible"},children:(null==x?void 0:x.length)>0?null==x?void 0:x.map(((s,t)=>{var r;return i.jsxs("tr",{style:{position:"relative",overflow:"visible"},children:[i.jsx("td",{className:"align-middle",children:(a-1)*l+t+1}),i.jsx("td",{className:"align-middle",children:i.jsxs("div",{className:"d-flex flex-column",children:[i.jsxs("div",{children:[i.jsxs("div",{className:"text-primary",children:["Ujian: ",s.name]}),i.jsx("small",{children:s.teacher_name})]}),i.jsx("small",{className:"text-muted",children:s.isshuffle?i.jsx("span",{className:"badge bg-success me-1",children:"Teracak"}):i.jsx("span",{className:"badge bg-secondary me-1",children:"Terurut"})})]})}),i.jsx("td",{className:"align-middle",children:i.jsxs("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>{return e=s.token,navigator.clipboard.writeText(e),void n.success("Token berhasil disalin");var e},title:"Copy Token",children:[i.jsx("i",{className:"bi bi-clipboard me-1"}),s.token]})}),i.jsx("td",{className:"align-middle",children:i.jsx("div",{className:"d-flex flex-wrap gap-1",children:null==(r=s.classes)?void 0:r.map(((e,a)=>i.jsx("span",{className:"badge bg-primary",style:{fontSize:"0.7rem"},children:e.name},a)))})}),i.jsx("td",{className:"align-middle",children:i.jsx("div",{className:"d-flex flex-column gap-1",children:s.banks.map(((e,a)=>i.jsxs("div",{className:"small",children:[i.jsx("div",{className:"fw-bold",children:e.name}),"paket"!==e.type&&i.jsxs("small",{className:"text-muted",children:["PG: ",e.pg," | Essay: ",e.essay]})]},a)))})}),i.jsx("td",{className:"align-middle",children:i.jsxs("span",{className:"badge bg-success",children:[s.mc_score,"%"]})}),i.jsx("td",{className:"align-middle",children:i.jsxs("span",{className:"badge bg-info",children:[s.essay_score,"%"]})}),i.jsx("td",{className:"align-middle",children:i.jsxs("span",{className:"badge bg-warning text-dark",children:[s.duration," menit"]})}),i.jsx("td",{className:"align-middle",children:i.jsx("button",{className:"btn btn-sm "+(s.isactive?"btn-success":"btn-danger"),onClick:()=>{return e=s.id,void n.promise(w(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},disabled:y,children:s.isactive?"Aktif":"Tidak Aktif"})}),i.jsx("td",{className:"align-middle",style:{position:"relative",overflow:"visible"},children:i.jsxs("div",{className:"dropdown",style:{position:"relative"},children:[i.jsxs("button",{className:"btn btn-sm btn-outline-primary dropdown-toggle d-flex align-items-center gap-1",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",style:{minWidth:"120px",justifyContent:"space-between",fontSize:"0.875rem",padding:"0.375rem 0.75rem",border:"1px solid #0d6efd",borderRadius:"0.375rem",transition:"all 0.2s ease-in-out"},children:[i.jsx("span",{children:"Pilihan Aksi"}),i.jsx("i",{className:"bi bi-chevron-down",style:{fontSize:"0.75rem"}})]}),i.jsxs("ul",{className:"dropdown-menu dropdown-menu-end shadow-lg border-0",style:{minWidth:"200px",padding:"0.5rem 0",borderRadius:"0.5rem",border:"1px solid rgba(0,0,0,0.1)",backgroundColor:"#fff",zIndex:99999,position:"absolute",top:"100%",right:0,marginTop:"0.25rem",boxShadow:"0 0.5rem 1rem rgba(0, 0, 0, 0.15)",transform:"translateY(0)",opacity:1,visibility:"visible",maxHeight:"none",overflow:"visible",pointerEvents:"auto"},children:[i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center py-2 px-3",onClick:()=>((e,a,s)=>{const l=e.toUpperCase().replace(/ /g,"-");window.open(`/laporan-ujian/${l}/${a}/${s}`,"_blank")})(s.name,s.id,s.token),style:{fontSize:"0.875rem",color:"#495057",transition:"all 0.15s ease-in-out",border:"none",backgroundColor:"transparent",width:"100%",textAlign:"left"},onMouseEnter:e=>{e.target.style.backgroundColor="#f8f9fa",e.target.style.color="#0d6efd"},onMouseLeave:e=>{e.target.style.backgroundColor="transparent",e.target.style.color="#495057"},children:[i.jsx("i",{className:"bi bi-eye me-3",style:{fontSize:"1rem",color:"#0d6efd"}}),i.jsx("span",{children:"Lihat"})]})}),i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center py-2 px-3","data-bs-toggle":"modal","data-bs-target":"#addexam",onClick:()=>e(s),style:{fontSize:"0.875rem",color:"#495057",transition:"all 0.15s ease-in-out",border:"none",backgroundColor:"transparent",width:"100%",textAlign:"left"},onMouseEnter:e=>{e.target.style.backgroundColor="#f8f9fa",e.target.style.color="#0d6efd"},onMouseLeave:e=>{e.target.style.backgroundColor="transparent",e.target.style.color="#495057"},children:[i.jsx("i",{className:"bi bi-pencil me-3",style:{fontSize:"1rem",color:"#ffc107"}}),i.jsx("span",{children:"Edit"})]})}),i.jsx("li",{children:i.jsx("hr",{className:"dropdown-divider my-2",style:{borderColor:"#e9ecef",margin:"0.5rem 0"}})}),i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center py-2 px-3",disabled:y,onClick:()=>{return e=s.id,void(window.confirm("Apakah anda yakin ingin menghapus ujian ini dan semua data yang terkait dengan ujian ini?")&&n.promise(j(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},style:{fontSize:"0.875rem",color:"#dc3545",transition:"all 0.15s ease-in-out",border:"none",backgroundColor:"transparent",width:"100%",textAlign:"left",opacity:y?.6:1},onMouseEnter:e=>{y||(e.target.style.backgroundColor="#fff5f5",e.target.style.color="#dc3545")},onMouseLeave:e=>{y||(e.target.style.backgroundColor="transparent",e.target.style.color="#dc3545")},children:[i.jsx("i",{className:"bi bi-trash me-3",style:{fontSize:"1rem"}}),i.jsx("span",{children:y?"Memproses...":"Hapus"})]})})]})]})})]},t)})):i.jsx("tr",{children:i.jsx("td",{colSpan:"11",className:"text-center py-4",children:i.jsxs("div",{className:"alert alert-info mb-0",children:[i.jsx("i",{className:"bi bi-info-circle me-2"}),"Data belum tersedia"]})})})})]})})})})},p=()=>{const[e,a]=d.useState(null);return i.jsxs("div",{className:"row g-2",children:[i.jsx("div",{className:"col-12",children:i.jsx(h,{setDetail:e=>{a(e)}})}),i.jsx(b,{detail:e,setDetail:a})]})};export{p as C};
//# sourceMappingURL=CbtExam-BnEaeLZc.js.map
