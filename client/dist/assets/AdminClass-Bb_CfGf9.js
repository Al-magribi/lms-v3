import{G as e,z as s,S as a,j as t,d as l,T as n,U as i,W as d,X as r,V as c,M as o,Y as m}from"./index-BspV1biE.js";import{b as h}from"./vendor-CpHG0K6b.js";import{L as u}from"./Layout-ORp93zo3.js";import{T as x}from"./Table-Ci5KcqkY.js";import{r as j,u as b}from"./xlsx-B4fPQ8kA.js";const g=({detail:n,setDetail:i})=>{const[d,r]=h.useState(""),[c,o]=h.useState(""),[m,u]=h.useState(""),[x,j]=h.useState(""),{data:b}=e({page:"",limit:"",search:""}),{data:g}=s({page:"",limit:"",search:""}),[p,{isSuccess:N,isLoading:f,error:v,reset:S}]=a();return h.useEffect((()=>{N&&(S(),o(""),r(""),u(""),j("")),v&&S()}),[N,v]),h.useEffect((()=>{n&&(r(n.id),o(n.name),u(n.grade),j(n.major))}),[n]),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={id:d,name:c,gradeId:m,majorId:x};l.promise(p(s).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},className:"bg-white rounded border d-flex flex-column gap-2 p-2",children:[t.jsx("p",{className:"m-0 h6",children:"Kelas"}),(null==g?void 0:g.length)>0&&t.jsxs("select",{className:"form-select",value:x||"",onChange:e=>j(e.target.value),children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Jurusan"}),null==g?void 0:g.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsxs("select",{className:"form-select",value:m||"",onChange:e=>u(e.target.value),required:!0,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Tingkat"}),null==b?void 0:b.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsx("input",{type:"text",name:"class",id:"class",className:"form-control",placeholder:"Nama Kelas",value:c||"",onChange:e=>o(e.target.value),required:!0}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{i({}),r(""),o(""),u("")},children:"Batal"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:f,children:"Simpan"})]})]})},p=({classid:e})=>{const[s,a]=h.useState(""),[i,{isSuccess:d,isLoading:r,isError:c,reset:o}]=n();return h.useEffect((()=>{d&&(o(),a("")),c&&(o(),a(""))}),[d,c]),t.jsxs("form",{onSubmit:a=>{a.preventDefault();const t={nis:s,classid:e};l.promise(i(t).unwrap().then((e=>e.message)),{loading:"Meyimpan data...",success:e=>e,error:e=>e.data.message})},className:"d-flex gap-2",children:[t.jsx("input",{type:"text",name:"nis",id:"nis",className:"form-control shadow",placeholder:"NIS",required:!0,value:s||"",onChange:e=>a(e.target.value)}),t.jsx("button",{type:"submit",className:"btn btn-success shadow",disabled:r,children:"Simpan"})]})},N=({classid:e})=>{const[s,a]=h.useState(null),n=h.useRef(null),[d,{isSuccess:r,isLoading:c,isError:o,reset:m}]=i();return h.useEffect((()=>{r&&(m(),n.current.value=null),o&&(m(),n.current.value=null)}),[r,o]),t.jsxs("div",{className:"d-flex gap-2",children:[t.jsx("input",{ref:n,type:"file",name:"file",id:"file",className:"form-control shadow",onChange:e=>a(e.target.files[0])}),t.jsx("button",{className:"btn btn-sm btn-success shadow",disabled:c,onClick:a=>{if(a.preventDefault(),s){const a=new FileReader;a.onload=s=>{const a=new Uint8Array(s.target.result),t=j(a,{type:"array"}),n=t.SheetNames[0],i=t.Sheets[n],r={students:b.sheet_to_json(i,{header:1,range:1}).map((e=>{const[s,a]=e;return[s,a]})).filter((e=>e.every((e=>null!=e)))),classid:e};l.promise(d(r).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},a.readAsArrayBuffer(s)}},children:"Upload"})]})},f=({detail:e})=>{const[s,a]=h.useState(1),[l,n]=h.useState(10),[i,o]=h.useState(""),m=e.id,{data:u={},refetch:j}=d({page:s,limit:l,search:i,classid:m},{skip:!m}),{totalData:b,totalPages:g,students:f=[]}=u,[v,{isSuccess:S,isLoading:y,isError:k,reset:w}]=r();return h.useEffect((()=>{(S||k)&&w()}),[S,k]),t.jsx("div",{className:"modal fade",id:"modal-add","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:["Kelas ",t.jsx("span",{children:null==e?void 0:e.name})]}),t.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body bg-light d-flex flex-column gap-2",children:[t.jsxs("div",{className:"row g-2",children:[t.jsx("div",{className:"col-lg-6 col-12",children:t.jsx(p,{classid:e.id})}),t.jsx("div",{className:"col-lg-6 col-12",children:t.jsx(N,{classid:e.id})})]}),t.jsx(x,{page:s,setPage:a,setLimit:n,setSearch:o,totalData:b,totalPages:g,children:t.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Jurusan"}),t.jsx("th",{className:"text-center",children:"Tingkat"}),t.jsx("th",{className:"text-center",children:"NIS"}),t.jsx("th",{className:"text-center",children:"Nama"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:(null==f?void 0:f.length)>0?null==f?void 0:f.map(((e,a)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(s-1)*l+a+1}),t.jsx("td",{className:"text-center align-middle",children:e.major_name}),t.jsx("td",{className:"text-center align-middle",children:e.grade_name}),t.jsx("td",{className:"text-center align-middle",children:e.nis}),t.jsx("td",{className:"align-middle",children:e.student_name}),t.jsx("td",{className:"text-center align-middle",children:t.jsx("button",{className:"btn btn-danger",disabled:y,onClick:()=>{return s=e.id,void c.promise(v(s).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var s},children:t.jsx("i",{className:"bi bi-person-dash"})})})]},a))):t.jsx("tr",{children:t.jsx("td",{colSpan:6,children:"Data tidak tersedia"})})})]})})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_kelas_siswa.xlsx","_blank")},children:"Template"}),t.jsx("button",{className:"btn btn-sm btn-warning",onClick:j,children:"SYNC"})]})]})})})},v=({setDetail:e})=>{const[s,a]=h.useState(1),[n,i]=h.useState(10),[d,r]=h.useState(""),[c,u]=h.useState({}),{data:j={},isLoading:b}=o({page:s,limit:n,search:d}),{classes:g=[],totalData:p,totalPages:N}=j,[v,{isSuccess:S,isLoading:y,error:k,reset:w}]=m();return h.useEffect((()=>{S&&w(),k&&w()}),[S,k]),t.jsxs(x,{page:s,setPage:a,setLimit:i,setSearch:r,totalData:p,totalPages:N,isLoading:b,children:[t.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Jurusan"}),t.jsx("th",{className:"text-center",children:"Tingkat"}),t.jsx("th",{className:"text-center",children:"Nama Kelas"}),t.jsx("th",{className:"text-center",children:"Siswa"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:null==g?void 0:g.map(((a,i)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(s-1)*n+i+1}),t.jsx("td",{className:"align-middle",children:a.major_name}),t.jsx("td",{className:"text-center align-middle",children:a.grade_name}),t.jsx("td",{className:"text-center align-middle",children:a.name}),t.jsx("td",{className:"text-center align-middle",children:a.students}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#modal-add",onClick:()=>u(a),children:t.jsx("i",{className:"bi bi-folder-plus"})}),t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(a),children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",disabled:y,onClick:()=>{return e=a.id,void l.promise(v(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:t.jsx("i",{className:"bi bi-folder-minus"})})]})})]},i)))})]}),t.jsx(f,{detail:c})]})},S=()=>{const[e,s]=h.useState("");return t.jsx(u,{title:"Kelas",levels:["admin"],children:t.jsxs("div",{className:"row g-2",children:[t.jsx("div",{className:"col-lg-3 col-12",children:t.jsx(g,{detail:e,setDetail:s})}),t.jsx("div",{className:"col-lg-9 col-12",children:t.jsx(v,{setDetail:s})})]})})};export{S as default};
//# sourceMappingURL=AdminClass-Bb_CfGf9.js.map
