import{a7 as e,ai as s,j as a,e as n,aa as t,aj as i,ak as l,X as r,al as d,V as c,am as m}from"./index-DFhdulld.js";import{b as o}from"./vendor-CnnDPxwB.js";import{L as h}from"./Layout-GZnRoUIy.js";import{T as u}from"./Table-CpyGbvYh.js";import{r as x,u as j}from"./xlsx-B4fPQ8kA.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const p=[{id:"nis",name:"nis",placeholder:"NIS"},{id:"name",name:"name",placeholder:"Name"}],g=({detail:t,setDetail:i})=>{const[l,r]=o.useState({id:"",entry:"",nis:"",name:"",gender:""}),{data:d}=e({page:"",limit:"",search:""}),[c,{isSuccess:m,isLoading:h,isError:u,reset:x}]=s(),j=e=>{const{name:s,value:a}=e.target;r((e=>({...e,[s]:a})))};return o.useEffect((()=>{m&&(x(),i({}),r({id:"",entry:"",nis:"",name:"",gender:""})),u&&x()}),[m,u]),o.useEffect((()=>{t&&r({id:t.id,entry:t.entry_id,name:t.name,nis:t.nis,gender:t.gender})}),[t]),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),n.promise(c(l).unwrap().then((e=>e.message)),{loading:"Menyimpan Data...",success:e=>e,error:e=>e.data.message})},className:"p-2 bg-white rounded border d-flex flex-column gap-2",children:[a.jsx("p",{className:"m-0 h6",children:"Siswa"}),a.jsxs("select",{name:"entry",id:"entry",className:"form-select",value:l.entry,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Tahun Masuk"}),null==d?void 0:d.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),null==p?void 0:p.map(((e,s)=>a.jsx("input",{type:"text",className:"form-control",placeholder:e.placeholder,name:e.name,id:e.name,value:l[e.name],onChange:j},s))),a.jsxs("select",{name:"gender",id:"gender",className:"form-select",value:l.gender,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),a.jsx("option",{value:"L",children:"Laki Laki"}),a.jsx("option",{value:"P",children:"Perempuan"})]}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{i({}),r({id:"",entry:"",nis:"",name:"",gender:""})},children:"Batal"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:h,children:"Simpan"})]})]})},b=({setDetail:e})=>{const[s,n]=o.useState(1),[m,h]=o.useState(10),[x,j]=o.useState(""),[p,g]=o.useState(""),{data:b={},isLoading:f,refetch:N}=t({page:s,limit:m,search:x}),{students:y=[],totalData:v,totalPages:w}=b,{data:S}=i(),[k,{isSuccess:C,isLoading:L,isError:D,reset:A}]=l(),[E]=r(),[P,{isLoading:M}]=d();return o.useEffect((()=>{C&&A(),D&&A()}),[C,D]),a.jsx(u,{page:s,setPage:n,setLimit:h,setSearch:j,totalData:v,totalPages:w,isLoading:f,children:a.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-center",children:"No"}),a.jsx("th",{className:"text-center",children:"Tahun Ajaran"}),a.jsx("th",{className:"text-center",children:"Satuan"}),a.jsx("th",{className:"text-center",children:"Tahun Masuk"}),a.jsx("th",{className:"text-center",children:"NIS"}),a.jsx("th",{className:"text-center",children:"Nama"}),a.jsx("th",{className:"text-center",children:"L/P"}),a.jsx("th",{className:"text-center",children:"Status"}),a.jsx("th",{className:"text-center",children:"Aksi"})]})}),a.jsx("tbody",{children:null==y?void 0:y.map(((n,t)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:(s-1)*m+t+1}),a.jsx("td",{className:"text-center align-middle",children:n.periode_name}),a.jsx("td",{className:"text-center align-middle",children:n.homebase}),a.jsx("td",{className:"text-center align-middle",children:n.entry}),a.jsx("td",{className:"text-center align-middle",children:n.nis}),a.jsx("td",{className:"align-middle",children:n.name}),a.jsx("td",{className:"text-center align-middle",children:n.gender}),a.jsx("td",{className:"text-center align-middle",children:a.jsx("div",{className:"form-check form-switch d-flex justify-content-center",onClick:()=>{return e=n.id,void c.promise(E(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:a.jsx("input",{className:"form-check-input pointer",type:"checkbox",role:"switch",id:"flexSwitchCheckChecked",checked:n.isactive,readOnly:!0})})}),a.jsx("td",{className:"text-cente align-middle",children:a.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[a.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(n),children:a.jsx("i",{className:"bi bi-pencil-square"})}),a.jsx("button",{className:"btn btn-sm btn-danger",disabled:L,onClick:()=>{return e=n.id,void(window.confirm("Apakah anda yakin ingin menghapus siswa ini dan semua data yang terkait dengan siswa ini?")&&c.promise(k(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:a.jsx("i",{className:"bi bi-person-x-fill"})})]})})]},t)))}),a.jsx("tfoot",{children:a.jsx("tr",{children:a.jsx("td",{colSpan:9,children:a.jsxs("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[a.jsxs("select",{style:{width:"20%"},className:"form-select",value:p,onChange:e=>{const s=e.target.value;g(s)},children:[a.jsx("option",{value:"",hidden:!0,children:"Ganti Tahun Ajaran"}),null==S?void 0:S.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),a.jsxs("button",{className:"btn btn-sm btn-success",onClick:async()=>{if(p)try{const e=y.map((e=>P({userid:e.id,periodeid:p})));await Promise.all(e),c.success("Berhasil mengganti tahun ajaran"),g(""),N()}catch(e){console.error("Error updating periods:",e),c.error("Gagal mengganti tahun ajaran")}else c.error("Pilih tahun ajaran terlebih dahulu")},disabled:M||!p,children:[a.jsx("i",{className:"bi bi-save"}),a.jsx("span",{className:"ms-2",children:M?"Menyimpan...":"Simpan"})]})]})})})})]})})},f=()=>{const[e,s]=o.useState(null),t=o.useRef(null),[i,{isSuccess:l,isLoading:r,isError:d,reset:c}]=m();return o.useEffect((()=>{l&&(t.current.value=null,c()),d&&(c(),t.current.value=null)}),[l,d]),a.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=x(s,{type:"array"}),t=a.SheetNames[0],l=a.Sheets[t],r=j.sheet_to_json(l,{header:1,range:1}).map((e=>{const[s,a,n,t]=e;return[s,a,n,t]})).filter((e=>e.every((e=>null!=e)))),d=Array.isArray(r)?r:[r];n.promise(i(d).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border  d-flex flex-column gap-2 mt-2",children:[a.jsx("p",{className:"m-0 h6",children:"Upload Siswa"}),a.jsx("input",{ref:t,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0])}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_siswa.xlsx","_blank")},children:"Template"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:r,children:"Upload Data"})]})]})},N=()=>{const[e,s]=o.useState("");return a.jsx(h,{title:"Siswa",levels:["admin"],children:a.jsxs("div",{className:"row g-2",children:[a.jsxs("div",{className:"col-lg-3 col-12",children:[a.jsx(g,{detail:e,setDetail:s}),a.jsx(f,{})]}),a.jsx("div",{className:"col-lg-9 col-12",children:a.jsx(b,{setDetail:s})})]})})};export{N as default};
//# sourceMappingURL=AdminStudents-Cj7IUZQO.js.map
