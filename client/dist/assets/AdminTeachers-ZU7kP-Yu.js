import{ab as e,an as s,ao as a,j as l,V as n,ap as i,e as t,aq as r,ar as c}from"./index-D_xLDGgb.js";import{b as m}from"./vendor-CnnDPxwB.js";import{L as d}from"./Layout-CeXxh9dB.js";import{S as o}from"./react-select.esm-C351JJ6e.js";import{r as u,u as h}from"./xlsx-B4fPQ8kA.js";import{T as x}from"./Table-0OluQQdG.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const j=({detail:i,setDetail:t})=>{const[r,c]=m.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:d}=e({page:"",limit:"",search:""}),{data:u}=s({page:"",limit:"",search:""}),[h,{isSuccess:x,isLoading:j,isError:p,reset:b}]=a(),g=e=>{const{name:s,value:a,type:l,checked:n}=e.target;c((e=>({...e,[s]:"checkbox"===l?n:a})))},N=()=>{t({}),c({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};m.useEffect((()=>{x&&(b(),N()),p&&b()}),[x,p]),m.useEffect((()=>{var e;i&&c({id:i.id||"",username:i.username||"",name:i.name||"",homeroom:i.homeroom||!1,classid:i.class||"",gender:i.gender||"",subjects:(null==(e=i.subjects)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})}),[i]);const f=(null==u?void 0:u.map((e=>({value:e.id,label:e.name}))))||[];return l.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!r.name||!r.username)return n.error("Lengkapi data");n.promise(h(r).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"rounded bg-white p-2 border d-flex flex-column gap-2",children:[l.jsx("p",{className:"m-0 h6",children:"Guru"}),l.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:r.username,onChange:g}),l.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:r.name,onChange:g}),l.jsxs("select",{name:"gender",className:"form-select",value:r.gender,onChange:g,children:[l.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),l.jsx("option",{value:"L",children:"Laki Laki"}),l.jsx("option",{value:"P",children:"Perempuan"})]}),l.jsx(o,{isMulti:!0,options:f,value:r.subjects,onChange:e=>{c((s=>({...s,subjects:e||[]})))},className:"mb-2",placeholder:"Mata Pelajaran"}),l.jsxs("div",{className:"form-check",children:[l.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:r.homeroom,onChange:g}),l.jsx("label",{className:"form-check-label",children:"Wali Kelas"})]}),r.homeroom&&l.jsxs("select",{name:"classid",className:"form-select",value:r.classid,onChange:g,children:[l.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),null==d?void 0:d.map((e=>l.jsx("option",{value:e.id,children:e.name},e.id)))]}),l.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[l.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:N,children:"Batal"}),l.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:j,children:"Simpan"})]})]})},p=()=>{const[e,s]=m.useState(null),a=m.useRef(null),[n,{isSuccess:r,isLoading:c,isError:d,reset:o}]=i();return m.useEffect((()=>{r&&(a.current.value=null,o()),d&&(o(),a.current.value=null)}),[r,d]),l.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=u(s,{type:"array"}),l=a.SheetNames[0],i=a.Sheets[l],r=h.sheet_to_json(i,{header:1,range:1}).map((e=>{const[s,a,l]=e;return[s,a,l]})).filter((e=>e.every((e=>null!=e)))),c=Array.isArray(r)?r:[r];t.promise(n(c).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[l.jsx("p",{className:"m-0 h6",children:"Upload Guru"}),l.jsx("input",{ref:a,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0])}),l.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[l.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_guru.xlsx","_blank")},children:"Template"}),l.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:c,children:"Upload Data"})]})]})},b=({setDetail:e})=>{const[s,a]=m.useState(1),[i,t]=m.useState(10),[d,o]=m.useState(""),{data:u={},isLoading:h}=r({page:s,limit:i,search:d}),{teachers:j=[],totalData:p,totalPages:b}=u,[g,{isSuccess:N,isLoading:f,isError:v,reset:y}]=c();return m.useEffect((()=>{N&&y(),v&&y()}),[N,v]),l.jsx(x,{page:s,setPage:a,setLimit:t,setSearch:o,totalData:p,totalPages:b,isLoading:h,children:l.jsx("div",{className:"row g-4",children:(null==j?void 0:j.length)>0?null==j?void 0:j.map(((a,t)=>{var r;return l.jsx("div",{className:"col-12 col-md-6",children:l.jsx("div",{className:"card shadow-sm h-100",children:l.jsxs("div",{className:"card-body",children:[l.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("span",{className:"badge bg-primary me-3",children:(s-1)*i+t+1}),l.jsxs("div",{children:[l.jsx("h5",{className:"card-title mb-1",children:a.name}),l.jsxs("p",{className:"text-muted small mb-0",children:["@",a.username]})]})]}),l.jsxs("div",{className:"d-flex gap-2",children:[l.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(a),children:l.jsx("i",{className:"bi bi-pencil-square"})}),l.jsx("button",{className:"btn btn-sm btn-danger",disabled:f,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus data guru ini dan semua data yang terkait dengan guru ini?")&&n.promise(g(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:l.jsx("i",{className:"bi bi-folder-minus"})})]})]}),l.jsxs("div",{className:"row g-3",children:[l.jsx("div",{className:"col-6",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-building me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Satuan"}),l.jsx("span",{className:"fw-medium",children:a.homebase})]})]})}),l.jsx("div",{className:"col-6",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-gender-ambiguous me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Jenis Kelamin"}),l.jsx("span",{className:"fw-medium",children:"L"===a.gender?"Laki-laki":"Perempuan"})]})]})}),l.jsx("div",{className:"col-12",children:l.jsxs("div",{className:"d-flex align-items-start",children:[l.jsx("i",{className:"bi bi-book me-2 text-primary mt-1"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Mata Pelajaran"}),l.jsx("div",{className:"d-flex flex-wrap gap-2",children:null==(r=a.subjects)?void 0:r.map((e=>l.jsx("span",{className:"badge bg-light text-dark",children:e.name},e.id)))})]})]})}),l.jsx("div",{className:"col-12",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-mortarboard me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Wali Kelas"}),l.jsx("span",{className:"fw-medium",children:a.homeroom?a.class_name:"-"})]})]})})]})]})})},t)})):l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"alert alert-info mb-0",children:"Data Belum tersedia"})})})})},g=()=>{const[e,s]=m.useState({});return l.jsx(d,{title:"Guru",levels:["admin"],children:l.jsxs("div",{className:"row g-2",children:[l.jsxs("div",{className:"col-lg-3 col-12",children:[l.jsx(j,{detail:e,setDetail:s}),l.jsx(p,{})]}),l.jsx("div",{className:"col-lg-9 col-12",children:l.jsx(b,{setDetail:s})})]})})};export{g as default};
//# sourceMappingURL=AdminTeachers-ZU7kP-Yu.js.map
