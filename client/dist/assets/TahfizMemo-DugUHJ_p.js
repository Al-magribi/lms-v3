import{a1 as e,a2 as a,dj as i,dk as t,j as l,F as s,R as n,C as r,I as d,r as o,$ as c,dl as h,cX as u,dm as m,dn as x,a as j,m as p,B as g,n as y,s as f,cU as S,cO as v,dp as k,dq as w,aH as C,c9 as b,D as I,h as z,x as A}from"./index-DgKTJYPj.js";import{c as T,k as L,m as P}from"./vendor-DTs43g_X.js";import{S as $,E as _}from"./Pagination-DupnkXEC.js";import{F as D,D as H}from"./Table-ClF3X7K8.js";import{R as Y}from"./ContainerOutlined-CU_ayJ7h.js";import{d as M}from"./dayjs.min-Cd2uXBeR.js";import"./id-Ck3wpXja.js";import{M as B}from"./index-CX7GIQLb.js";import{R as E}from"./DeleteOutlined-BDamtBNP.js";import{L as N}from"./index-B91tKEhO.js";import{S as O}from"./index-B1LVMQTc.js";import{R as F}from"./SaveOutlined-CpLetC6j.js";import{T as K}from"./index-Frx2mTqc.js";import{H as R}from"./History-vy31l8Tp.js";import"./index-BPQDC5Zx.js";import"./progress-DGImVRZc.js";import"./index-Z0keh-rU.js";import"./Collapse-CuIh0JhV.js";import"./BookOutlined-WSaFMy8q.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},q=function(i,t){return T.createElement(e,a({},i,{ref:t,icon:J}))},G=T.forwardRef(q);const Q=()=>{const[e,a]=L(),[u,m]=T.useState(""),[x,j]=T.useState(""),[p,g]=T.useState(""),[y,f]=T.useState(1),[S,v]=T.useState(10),[k,w]=T.useState(""),[C,b]=T.useState(""),{data:I}=i(),z=I?.homebases.map(e=>({value:e.id,label:e.name})),A=I?.grades.map(e=>({value:e.id,label:e.name})),P=I?.classes.map(e=>({value:e.id,label:e.name})),{data:_}=t({page:y,limit:S,search:C,homebaseId:u,gradeId:x,classId:p});T.useEffect(()=>{const e=setTimeout(()=>{b(k)},500);return()=>{clearTimeout(e)}},[k]);const M=[{title:"No",dataIndex:"index",key:"index",render:(e,a,i)=>(y-1)*S+i+1},{title:"Satuan",dataIndex:"homebase",key:"homebase"},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Data Siswa",dataIndex:"name",key:"name",render:(e,a)=>l.jsxs(s,{vertical:!0,align:"start",children:[l.jsx(o.Text,{strong:!0,children:e}),l.jsxs(c,{color:"blue",children:["Tingkat ",a.grade," - Kelas ",a.class]})]})},{title:"Aksi",key:"action",render:e=>l.jsx(H.Button,{menu:{items:[{key:"detail",label:"Detail Hafalan",icon:l.jsx(Y,{})},{key:"add",label:"Tambah Hafalan",icon:l.jsx(h,{})}],onClick:({key:i})=>((e,{key:i})=>{switch(i){case"detail":a({view:"detail",studentid:e.userid,name:e.name.replace(/\s+/g,"-")});break;case"add":a({view:"form",studentid:e.userid,name:e.name.replace(/\s+/g,"-")})}})(e,{key:i})},children:"Pilihan Aksi"})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(n,{gutter:[10,10],children:[l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(d.Search,{style:{minWidth:100},placeholder:"Cari Siswa ...",value:k,onChange:e=>w(e.target.value),allowClear:!0})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx($,{style:{width:"100%"},placeholder:"Pilih Satuan",options:z,virtual:!1,allowClear:!0,onChange:e=>m(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx($,{style:{width:"100%"},placeholder:"Pilih Tingkat",options:A,virtual:!1,allowClear:!0,onChange:e=>j(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx($,{style:{width:"100%"},placeholder:"Pilih Kelas",options:P,virtual:!1,allowClear:!0,onChange:e=>g(e)})})]}),l.jsx(D,{rowKey:"userid",columns:M,dataSource:_?.students,pagination:{size:"small",current:y,pageSize:S,total:_?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,a)=>{f(e),v(a)}},scroll:{x:"max-content"}})]})};M.locale("id");const{Text:U}=o,W=({record:e})=>e.juzs&&0!==e.juzs.length?l.jsx(s,{vertical:!0,gap:"middle",children:e.juzs.map(e=>l.jsx(j,{type:"inner",title:`Hafalan ${e.name}`,children:l.jsx(N,{dataSource:e.verses,renderItem:e=>l.jsx(N.Item,{children:l.jsx(N.Item.Meta,{title:e.name,description:`Ayat ${e.from_ayat} - ${e.to_ayat} | Baris ${e.from_line} - ${e.to_line}`})})})},e.id))}):l.jsx(_,{description:"Tidak ada detail hafalan untuk ditampilkan"}),X=()=>{const[e,a]=T.useState(1),[i,t]=T.useState(10),[o,h]=T.useState(""),[S,v]=T.useState(null),[k,w]=T.useState(!1),[C,b]=T.useState(null),{data:I}=u({page:"",limit:"",search:""}),{data:z,isLoading:A,isFetching:L}=m({page:e,limit:i,search:o,type:S}),[P,{isLoading:_}]=x(),Y=[{title:"Nama Siswa",key:"student",render:(e,a)=>l.jsxs("div",{children:[l.jsx(U,{strong:!0,children:a.name}),l.jsx("br",{}),l.jsxs(U,{type:"secondary",children:["NIS: ",a.nis]})]})},{title:"Kelas",key:"class",render:(e,a)=>`${a.grade} - ${a.classname}`},{title:"Tanggal Penilaian",dataIndex:"date",key:"date",render:e=>M(e).format("DD MMMM YYYY")},{title:"Tipe & Penguji",key:"type",render:(e,a)=>l.jsxs("div",{children:[l.jsx(c,{color:"cyan",children:a.type}),l.jsx("br",{}),l.jsx(U,{type:"secondary",children:a.examiner||"N/A"})]})},{title:"Aksi",key:"action",align:"center",render:(e,a)=>l.jsx(H,{menu:{items:[{key:"1",label:"Edit",icon:l.jsx(y,{}),onClick:()=>(e=>{b(e),w(!0)})(a)},{key:"2",label:"Hapus",icon:l.jsx(E,{}),danger:!0,onClick:()=>B.confirm({title:"Anda yakin?",content:`Hapus laporan ${a.name} pada ${M(a.date).format("DD MMM YYYY")}?`,onOk:()=>(async e=>{try{const a=M(e.date).format("M/D/YYYY");await P({userid:e.userid,typeId:e.type_id,createdat:a}).unwrap(),f.success("Laporan berhasil dihapus")}catch(a){console.error("Gagal menghapus laporan:",a),f.error(a.data?.message||"Gagal menghapus laporan")}})(a),okText:"Ya, Hapus",cancelText:"Batal",confirmLoading:_})}]},children:l.jsx(g,{icon:l.jsx(G,{}),type:"text"})})}];return l.jsxs(s,{vertical:!0,gap:"large",children:[l.jsx(j,{children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx(d.Search,{placeholder:"Cari nama atau NIS siswa...",onSearch:e=>{h(e),a(1)},allowClear:!0})}),l.jsx(r,{xs:24,md:12,children:l.jsx($,{placeholder:"Filter berdasarkan tipe",style:{width:"100%"},onChange:e=>{v(e),a(1)},allowClear:!0,options:I?.map(e=>({value:e.id,label:e.name})),virtual:!1})})]})}),l.jsx(p,{spinning:A||L||_,children:l.jsx(j,{children:l.jsx(D,{columns:Y,dataSource:z?.report,loading:A||L,rowKey:"id",pagination:{current:e,pageSize:i,total:z?.totalData,onChange:(e,i)=>{a(e),t(i)},showSizeChanger:!0},expandable:{expandedRowRender:e=>l.jsx(W,{record:e}),rowExpandable:e=>e.juzs&&e.juzs.length>0},scroll:{x:"max-content"}})})}),C&&l.jsx(B,{title:`Edit Hafalan - ${C.name}`,open:k,onCancel:()=>w(!1),footer:null,width:1e3,destroyOnClose:!0,children:l.jsx("p",{children:"Komponen FormMemo akan ditampilkan di sini."})})]})},{Title:V,Text:Z}=o,{Option:ee}=$,ae=({name:e,userid:a,onBack:i})=>{const{periodeId:t}=P(),d=e?e.replace(/-/g," "):"Student",[o,c]=T.useState(null),[h,m]=T.useState(null),[x,p]=T.useState([]),[y,z]=T.useState(null),[A,L]=T.useState(null),[_,H]=T.useState([]),[Y,M]=T.useState(null),[B,N]=T.useState(null),[R,J]=T.useState(null),[q,G]=T.useState(null),[Q,U]=T.useState([]),[W,X]=T.useState({}),{data:ae,isLoading:ie}=u({page:"",limit:"",search:""}),{data:te,isLoading:le}=S({page:"",limit:"",search:""}),{data:se,isLoading:ne}=v({page:"",limit:"",search:""}),{data:re,isLoading:de}=k(),[oe,{isLoading:ce,isSuccess:he,isError:ue}]=w(),me=_.find(e=>e.id===A),xe=(e,a,i,t)=>{X(l=>{const s={...l};return s[a]||(s[a]={category_id:a,indicators:{}}),"category"===e?s[a].poin=t:"indicator"===e&&(s[a].indicators[i]={indicator_id:i,poin:t}),s})};T.useEffect(()=>{he&&(c(null),m(null),p([]),z(null),L(null),H([]),M(null),N(null),J(null),G(null),U([]),X({}))},[he]);const je=[{title:"Surah",dataIndex:"fromSurahName",key:"surah",align:"center"},{title:"From Ayat",dataIndex:"fromAyat",key:"fromAyat",align:"center"},{title:"To Ayat",dataIndex:"toAyat",key:"toAyat",align:"center"},{title:"From Line",dataIndex:"fromLine",key:"fromLine",align:"center"},{title:"To Line",dataIndex:"toLine",key:"toLine",align:"center"},{title:"Action",key:"action",align:"center",render:(e,a)=>l.jsx(g,{type:"primary",danger:!0,icon:l.jsx(E,{}),onClick:()=>{return e=a.key,U(a=>a.filter(a=>a.key!==e)),void f.info("Surah removed.");var e}})}],pe=[{title:"Category",dataIndex:"name",key:"category",width:"20%"},{title:"Indicator",key:"indicator",width:"60%",render:(e,a)=>l.jsx(O,{direction:"vertical",style:{width:"100%"},children:a.indicators&&a.indicators.filter(e=>null!==e).length>0?a.indicators.filter(e=>null!==e).map(e=>l.jsxs(n,{align:"middle",justify:"space-between",style:{width:"100%"},children:[l.jsx(r,{children:l.jsx(Z,{children:e.name})}),l.jsx(r,{children:l.jsx(K,{placeholder:"Score",min:0,max:100,onChange:i=>xe("indicator",a.id,e.id,i),style:{width:120}})})]},e.id)):l.jsx(Z,{type:"secondary",children:"No indicators for this category."})})},{title:"Final Score",key:"score",width:"20%",align:"center",render:(e,a)=>l.jsx(K,{placeholder:"Total",min:0,max:100,onChange:e=>xe("category",a.id,null,e),style:{width:100}})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(O,{children:[l.jsx(g,{shape:"circle",icon:l.jsx(C,{}),onClick:i}),l.jsxs(V,{style:{margin:0},level:5,children:["Penilaian Tahfiz: ",d]})]}),l.jsxs(n,{gutter:[24,24],children:[l.jsx(r,{xs:24,lg:12,children:l.jsxs(O,{direction:"vertical",size:"large",style:{width:"100%"},children:[l.jsx(j,{title:"Pilihan Hafalan",children:l.jsxs(O,{direction:"vertical",style:{width:"100%"},children:[l.jsx(Z,{strong:!0,children:"Tambah Juz (Bulk)"}),l.jsxs(n,{gutter:8,children:[l.jsx(r,{flex:"auto",children:l.jsx($,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Pilih 1 atau lebih Juz",loading:ne,value:x,onChange:p,virtual:!1,children:se?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{children:l.jsx(g,{type:"primary",icon:l.jsx(b,{}),onClick:()=>{if(0===x.length)return void f.warning("Please select at least one Juz to add.");const e=[];x.forEach(a=>{const i=se?.find(e=>e.id===a);i&&i.surah&&i.surah.forEach(a=>{Q.some(e=>e.fromSurahName===a.surah)||e.push({key:`${i.id}-${a.surah_id}`,juzId:i.id,fromSurah:a.surah_id,fromSurahName:a.surah,fromAyat:a.from_ayat,toAyat:a.to_ayat,fromLine:1,toLine:a.lines})})}),U(a=>[...a,...e]),p([]),f.success(`${e.length} surah(s) added successfully.`)}})})]}),l.jsx(I,{}),l.jsx(Z,{strong:!0,children:"Tambah Surah (Spesifik)"}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"1. Pilih Juz",loading:ne,onChange:e=>{const a=se?.find(a=>a.id===e);z(a),H(a?.surah||[]),L(null),M(null),N(null),J(null),G(null)},virtual:!1,allowClear:!0,children:se?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"2. Pilih Surah",disabled:!y,value:A,onChange:L,virtual:!1,allowClear:!0,children:_.map(e=>l.jsx(ee,{value:e.id,children:e.surah},e.id))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"3. Dari Ayat",disabled:!me,value:Y,onChange:M,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.to_ayat-me.from_ayat+1},(e,a)=>me.from_ayat+a).map(e=>l.jsx(ee,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"4. Sampai Ayat",disabled:!Y,value:B,onChange:N,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.to_ayat-Y+1},(e,a)=>Y+a).map(e=>l.jsx(ee,{value:e,children:e},e))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"5. Dari Baris",disabled:!B,value:R,onChange:J,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.lines},(e,a)=>a+1).map(e=>l.jsx(ee,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx($,{style:{width:"100%"},placeholder:"6. Sampai Baris",disabled:!R,value:q,onChange:G,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.lines-R+1},(e,a)=>R+a).map(e=>l.jsx(ee,{value:e,children:e},e))})})]}),l.jsx(g,{type:"primary",onClick:()=>{U(e=>[...e,{key:`${y.id}-${me.surah_id}-${Y}`,juzId:y.id,fromSurah:me.surah_id,fromSurahName:me.surah,fromAyat:Y,toAyat:B,fromLine:R,toLine:q}]),L(null),M(null),N(null),J(null),G(null)},disabled:!q,block:!0,children:"Simpan Surah"})]})}),l.jsx(j,{title:"Detail Penilaian",children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx($,{placeholder:"Pilih Jenis Penilaian",style:{width:"100%"},loading:ie,value:o,onChange:c,virtual:!1,children:ae?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,md:12,children:l.jsx($,{placeholder:"Pilih Penguji",style:{width:"100%"},loading:le,value:h,onChange:m,virtual:!1,children:te?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})})]})})]})}),l.jsx(r,{xs:24,lg:12,children:l.jsx(j,{title:"Indikator Penilaian",children:l.jsx(D,{bordered:!0,size:"small",pagination:!1,dataSource:re,columns:pe,loading:de,rowKey:"id",scroll:{x:"max-content"}})})})]}),l.jsx(I,{}),l.jsx(V,{level:5,children:"Daftar Surah"}),l.jsx(D,{bordered:!0,dataSource:Q,columns:je,pagination:{pageSize:5},locale:{emptyText:"No surahs have been added yet."},scroll:{x:"max-content"}}),l.jsx(n,{justify:"end",style:{marginTop:"24px"},children:l.jsx(r,{children:l.jsx(g,{type:"primary",icon:l.jsx(F,{}),loading:ce,disabled:0===Q.length,onClick:async()=>{if(!o||!h||0===Q.length)return void f.error("Assessment Type, Examiner, and at least one Surah are required.");const e=Object.values(W).map(e=>({category_id:e.category_id,poin:e.poin??0,indicators:Object.values(e.indicators).map(e=>({...e,poin:e.poin??0}))}));if(0===e.length)return void f.error("Please fill in the assessment scores.");const i={userid:parseInt(a),periodeId:parseInt(t),surahs:Q.map(({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})=>({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})),examiner:parseInt(h),poin:{type_id:parseInt(o),categories:e}};try{const e=await oe(i).unwrap();f.success(e.message||"Scores saved successfully!")}catch(l){f.error(l.data?.message||"Failed to save scores.")}},children:"Simpan"})})})]})},ie=()=>{const[e,a]=L(),i=e.get("view"),t=e.get("studentid"),s=e.get("name"),n=[{label:"Setor Hafalan",key:"1",children:l.jsx(Q,{})},{label:"Laporan",key:"2",children:l.jsx(X,{})}],r=()=>{a({})};return"form"===i?l.jsx(z,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(ae,{name:s,userid:t,onBack:r})}):"detail"===i?l.jsx(z,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(R,{name:s,userid:t,onBack:r})}):l.jsx(z,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(A,{defaultActiveKey:"1",centered:!0,items:n})})};export{ie as default};
//# sourceMappingURL=TahfizMemo-DugUHJ_p.js.map
