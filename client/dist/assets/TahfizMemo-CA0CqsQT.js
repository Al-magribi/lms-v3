import{a4 as e,a5 as a,dw as i,dx as t,j as l,F as s,R as n,C as r,I as d,t as o,a3 as c,dy as h,d7 as u,dz as m,dA as x,a as j,n as p,m as g,B as y,r as f,s as S,d4 as v,cZ as k,dB as w,dC as C,aG as b,cj as I,D as z,h as A,A as T}from"./index-C_fjL4gy.js";import{c as L,i as _}from"./vendor-DnNJsrFE.js";import{S as P,E as $}from"./Pagination-CMQXbkBX.js";import{F as D,D as H}from"./Table-BbEuep4o.js";import{R as B}from"./ContainerOutlined-Bcd85lGs.js";import{d as Y}from"./dayjs.min-NR93IlBy.js";import"./id-BaT3o_TC.js";import{R as E}from"./DeleteOutlined-CMpH7wTG.js";import{L as N}from"./index-CfY2emQW.js";import{S as M}from"./index-DQ1VdCmT.js";import{R as O}from"./SaveOutlined-Cw3vN6eG.js";import{T as F}from"./index-J9KTRj3u.js";import{H as K}from"./History-DVVC3cVG.js";import"./index-5Ayn0F0y.js";import"./progress-DzsMKEpj.js";import"./index-Dku8M4yY.js";import"./Collapse-D_9Dm1Cm.js";import"./BookOutlined-C8XUUov6.js";var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},J=function(i,t){return L.createElement(e,a({},i,{ref:t,icon:R}))},G=L.forwardRef(J);const q=()=>{const[e,a]=_(),[u,m]=L.useState(""),[x,j]=L.useState(""),[p,g]=L.useState(""),[y,f]=L.useState(1),[S,v]=L.useState(10),[k,w]=L.useState(""),[C,b]=L.useState(""),{data:I}=i(),z=I?.homebases.map(e=>({value:e.id,label:e.name})),A=I?.grades.map(e=>({value:e.id,label:e.name})),T=I?.classes.map(e=>({value:e.id,label:e.name})),{data:$}=t({page:y,limit:S,search:C,homebaseId:u,gradeId:x,classId:p});L.useEffect(()=>{const e=setTimeout(()=>{b(k)},500);return()=>{clearTimeout(e)}},[k]);const Y=[{title:"No",dataIndex:"index",key:"index",render:(e,a,i)=>(y-1)*S+i+1},{title:"Satuan",dataIndex:"homebase",key:"homebase"},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Data Siswa",dataIndex:"name",key:"name",render:(e,a)=>l.jsxs(s,{vertical:!0,align:"start",children:[l.jsx(o.Text,{strong:!0,children:e}),l.jsxs(c,{color:"blue",children:["Tingkat ",a.grade," - Kelas ",a.class]})]})},{title:"Aksi",key:"action",render:e=>l.jsx(H.Button,{menu:{items:[{key:"detail",label:"Detail Hafalan",icon:l.jsx(B,{})},{key:"add",label:"Tambah Hafalan",icon:l.jsx(h,{})}],onClick:({key:i})=>((e,{key:i})=>{switch(i){case"detail":a({view:"detail",studentid:e.userid,name:e.name.replace(/\s+/g,"-")});break;case"add":a({view:"form",periodeId:e.periode_id,studentid:e.userid,name:e.name.replace(/\s+/g,"-")})}})(e,{key:i})},children:"Pilihan Aksi"})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(n,{gutter:[10,10],children:[l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(d.Search,{style:{minWidth:100},placeholder:"Cari Siswa ...",value:k,onChange:e=>w(e.target.value),allowClear:!0})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(P,{style:{width:"100%"},placeholder:"Pilih Satuan",options:z,virtual:!1,allowClear:!0,onChange:e=>m(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(P,{style:{width:"100%"},placeholder:"Pilih Tingkat",options:A,virtual:!1,allowClear:!0,onChange:e=>j(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(P,{style:{width:"100%"},placeholder:"Pilih Kelas",options:T,virtual:!1,allowClear:!0,onChange:e=>g(e)})})]}),l.jsx(D,{rowKey:"userid",columns:Y,dataSource:$?.students,pagination:{size:"small",current:y,pageSize:S,total:$?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,a)=>{f(e),v(a)}},scroll:{x:"max-content"}})]})};Y.locale("id");const{Text:W}=o,X=({record:e})=>e.juzs&&0!==e.juzs.length?l.jsx(s,{vertical:!0,gap:"middle",children:e.juzs.map(e=>l.jsx(j,{type:"inner",title:`Hafalan ${e.name}`,children:l.jsx(N,{dataSource:e.verses,renderItem:e=>l.jsx(N.Item,{children:l.jsx(N.Item.Meta,{title:e.name,description:`Ayat ${e.from_ayat} - ${e.to_ayat} | Baris ${e.from_line} - ${e.to_line}`})})})},e.id))}):l.jsx($,{description:"Tidak ada detail hafalan untuk ditampilkan"}),Z=()=>{const[e,a]=L.useState(1),[i,t]=L.useState(10),[o,h]=L.useState(""),[v,k]=L.useState(null),[w,C]=L.useState(!1),[b,I]=L.useState(null),{data:z}=u({page:"",limit:"",search:""}),{data:A,isLoading:T,isFetching:_}=m({page:e,limit:i,search:o,type:v}),[$,{isLoading:B}]=x(),N=[{title:"Nama Siswa",key:"student",render:(e,a)=>l.jsxs("div",{children:[l.jsx(W,{strong:!0,children:a.name}),l.jsx("br",{}),l.jsxs(W,{type:"secondary",children:["NIS: ",a.nis]})]})},{title:"Kelas",key:"class",render:(e,a)=>`${a.grade} - ${a.classname}`},{title:"Tanggal Penilaian",dataIndex:"date",key:"date",render:e=>Y(e).format("DD MMMM YYYY")},{title:"Tipe & Penguji",key:"type",render:(e,a)=>l.jsxs("div",{children:[l.jsx(c,{color:"cyan",children:a.type}),l.jsx("br",{}),l.jsx(W,{type:"secondary",children:a.examiner||"N/A"})]})},{title:"Aksi",key:"action",align:"center",render:(e,a)=>l.jsx(H,{menu:{items:[{key:"1",label:"Edit",icon:l.jsx(f,{}),onClick:()=>(e=>{I(e),C(!0)})(a)},{key:"2",label:"Hapus",icon:l.jsx(E,{}),danger:!0,onClick:()=>g.confirm({title:"Anda yakin?",content:`Hapus laporan ${a.name} pada ${Y(a.date).format("DD MMM YYYY")}?`,onOk:()=>(async e=>{try{const a=Y(e.date).format("M/D/YYYY");await $({userid:e.userid,typeId:e.type_id,createdat:a}).unwrap(),S.success("Laporan berhasil dihapus")}catch(a){S.error(a.data?.message||"Gagal menghapus laporan")}})(a),okText:"Ya, Hapus",cancelText:"Batal",confirmLoading:B})}]},children:l.jsx(y,{icon:l.jsx(G,{}),type:"text"})})}];return l.jsxs(s,{vertical:!0,gap:"large",children:[l.jsx(j,{children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx(d.Search,{placeholder:"Cari nama atau NIS siswa...",onSearch:e=>{h(e),a(1)},allowClear:!0})}),l.jsx(r,{xs:24,md:12,children:l.jsx(P,{placeholder:"Filter berdasarkan tipe",style:{width:"100%"},onChange:e=>{k(e),a(1)},allowClear:!0,options:z?.map(e=>({value:e.id,label:e.name})),virtual:!1})})]})}),l.jsx(p,{spinning:T||_||B,children:l.jsx(j,{children:l.jsx(D,{columns:N,dataSource:A?.report,loading:T||_,rowKey:"id",pagination:{current:e,pageSize:i,total:A?.totalData,onChange:(e,i)=>{a(e),t(i)},showSizeChanger:!0},expandable:{expandedRowRender:e=>l.jsx(X,{record:e}),rowExpandable:e=>e.juzs&&e.juzs.length>0},scroll:{x:"max-content"}})})}),b&&l.jsx(g,{title:`Edit Hafalan - ${b.name}`,open:w,onCancel:()=>C(!1),footer:null,width:1e3,destroyOnClose:!0,children:l.jsx("p",{children:"Komponen FormMemo akan ditampilkan di sini."})})]})},{Title:Q,Text:U}=o,{Option:V}=P,ee=({name:e,userid:a,onBack:i})=>{const[t]=_(),d=t.get("periodeId"),o=e?e.replace(/-/g," "):"Student",[c,h]=L.useState(null),[m,x]=L.useState(null),[p,g]=L.useState([]),[f,A]=L.useState(null),[T,$]=L.useState(null),[H,B]=L.useState([]),[Y,N]=L.useState(null),[K,R]=L.useState(null),[J,G]=L.useState(null),[q,W]=L.useState(null),[X,Z]=L.useState([]),[ee,ae]=L.useState({}),{data:ie,isLoading:te}=u({page:"",limit:"",search:""}),{data:le,isLoading:se}=v({page:"",limit:"",search:""}),{data:ne,isLoading:re}=k({page:"",limit:"",search:""}),{data:de,isLoading:oe}=w(),[ce,{isLoading:he,isSuccess:ue,isError:me}]=C(),xe=H.find(e=>e.id===T),je=(e,a,i,t)=>{ae(l=>{const s={...l};return s[a]||(s[a]={category_id:a,indicators:{}}),"category"===e?s[a].poin=t:"indicator"===e&&(s[a].indicators[i]={indicator_id:i,poin:t}),s})};L.useEffect(()=>{ue&&(h(null),x(null),g([]),A(null),$(null),B([]),N(null),R(null),G(null),W(null),Z([]),ae({}))},[ue]);const pe=[{title:"Surah",dataIndex:"fromSurahName",key:"surah",align:"center"},{title:"From Ayat",dataIndex:"fromAyat",key:"fromAyat",align:"center"},{title:"To Ayat",dataIndex:"toAyat",key:"toAyat",align:"center"},{title:"From Line",dataIndex:"fromLine",key:"fromLine",align:"center"},{title:"To Line",dataIndex:"toLine",key:"toLine",align:"center"},{title:"Action",key:"action",align:"center",render:(e,a)=>l.jsx(y,{type:"primary",danger:!0,icon:l.jsx(E,{}),onClick:()=>{return e=a.key,Z(a=>a.filter(a=>a.key!==e)),void S.info("Surah removed.");var e}})}],ge=[{title:"Category",dataIndex:"name",key:"category",width:"20%"},{title:"Indicator",key:"indicator",width:"60%",render:(e,a)=>l.jsx(M,{direction:"vertical",style:{width:"100%"},children:a.indicators&&a.indicators.filter(e=>null!==e).length>0?a.indicators.filter(e=>null!==e).map(e=>l.jsxs(n,{align:"middle",justify:"space-between",style:{width:"100%"},children:[l.jsx(r,{children:l.jsx(U,{children:e.name})}),l.jsx(r,{children:l.jsx(F,{placeholder:"Score",min:0,max:100,onChange:i=>je("indicator",a.id,e.id,i),style:{width:120}})})]},e.id)):l.jsx(U,{type:"secondary",children:"No indicators for this category."})})},{title:"Final Score",key:"score",width:"20%",align:"center",render:(e,a)=>l.jsx(F,{placeholder:"Total",min:0,max:100,onChange:e=>je("category",a.id,null,e),style:{width:100}})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(M,{children:[l.jsx(y,{shape:"circle",icon:l.jsx(b,{}),onClick:i}),l.jsxs(Q,{style:{margin:0},level:5,children:["Penilaian Tahfiz: ",o]})]}),l.jsxs(n,{gutter:[24,24],children:[l.jsx(r,{xs:24,lg:12,children:l.jsxs(M,{direction:"vertical",size:"large",style:{width:"100%"},children:[l.jsx(j,{title:"Pilihan Hafalan",children:l.jsxs(M,{direction:"vertical",style:{width:"100%"},children:[l.jsx(U,{strong:!0,children:"Tambah Juz (Bulk)"}),l.jsxs(n,{gutter:8,children:[l.jsx(r,{flex:"auto",children:l.jsx(P,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Pilih 1 atau lebih Juz",loading:re,value:p,onChange:g,virtual:!1,children:ne?.map(e=>l.jsx(V,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{children:l.jsx(y,{type:"primary",icon:l.jsx(I,{}),onClick:()=>{if(0===p.length)return void S.warning("Please select at least one Juz to add.");const e=[];p.forEach(a=>{const i=ne?.find(e=>e.id===a);i&&i.surah&&i.surah.forEach(a=>{X.some(e=>e.fromSurahName===a.surah)||e.push({key:`${i.id}-${a.surah_id}`,juzId:i.id,fromSurah:a.surah_id,fromSurahName:a.surah,fromAyat:a.from_ayat,toAyat:a.to_ayat,fromLine:1,toLine:a.lines})})}),Z(a=>[...a,...e]),g([]),S.success(`${e.length} surah(s) added successfully.`)}})})]}),l.jsx(z,{}),l.jsx(U,{strong:!0,children:"Tambah Surah (Spesifik)"}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"1. Pilih Juz",loading:re,onChange:e=>{const a=ne?.find(a=>a.id===e);A(a),B(a?.surah||[]),$(null),N(null),R(null),G(null),W(null)},virtual:!1,allowClear:!0,children:ne?.map(e=>l.jsx(V,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"2. Pilih Surah",disabled:!f,value:T,onChange:$,virtual:!1,allowClear:!0,children:H.map(e=>l.jsx(V,{value:e.id,children:e.surah},e.id))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"3. Dari Ayat",disabled:!xe,value:Y,onChange:N,virtual:!1,allowClear:!0,children:xe&&Array.from({length:xe.to_ayat-xe.from_ayat+1},(e,a)=>xe.from_ayat+a).map(e=>l.jsx(V,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"4. Sampai Ayat",disabled:!Y,value:K,onChange:R,virtual:!1,allowClear:!0,children:xe&&Array.from({length:xe.to_ayat-Y+1},(e,a)=>Y+a).map(e=>l.jsx(V,{value:e,children:e},e))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"5. Dari Baris",disabled:!K,value:J,onChange:G,virtual:!1,allowClear:!0,children:xe&&Array.from({length:xe.lines},(e,a)=>a+1).map(e=>l.jsx(V,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(P,{style:{width:"100%"},placeholder:"6. Sampai Baris",disabled:!J,value:q,onChange:W,virtual:!1,allowClear:!0,children:xe&&Array.from({length:xe.lines-J+1},(e,a)=>J+a).map(e=>l.jsx(V,{value:e,children:e},e))})})]}),l.jsx(y,{type:"primary",onClick:()=>{Z(e=>[...e,{key:`${f.id}-${xe.surah_id}-${Y}`,juzId:f.id,fromSurah:xe.surah_id,fromSurahName:xe.surah,fromAyat:Y,toAyat:K,fromLine:J,toLine:q}]),$(null),N(null),R(null),G(null),W(null)},disabled:!q,block:!0,children:"Simpan Surah"})]})}),l.jsx(j,{title:"Detail Penilaian",children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx(P,{placeholder:"Pilih Jenis Penilaian",style:{width:"100%"},loading:te,value:c,onChange:h,virtual:!1,children:ie?.map(e=>l.jsx(V,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,md:12,children:l.jsx(P,{placeholder:"Pilih Penguji",style:{width:"100%"},loading:se,value:m,onChange:x,virtual:!1,children:le?.map(e=>l.jsx(V,{value:e.id,children:e.name},e.id))})})]})})]})}),l.jsx(r,{xs:24,lg:12,children:l.jsx(j,{title:"Indikator Penilaian",children:l.jsx(D,{bordered:!0,size:"small",pagination:!1,dataSource:de,columns:ge,loading:oe,rowKey:"id",scroll:{x:"max-content"}})})})]}),l.jsx(z,{}),l.jsx(Q,{level:5,children:"Daftar Surah"}),l.jsx(D,{bordered:!0,dataSource:X,columns:pe,pagination:{pageSize:5},locale:{emptyText:"No surahs have been added yet."},scroll:{x:"max-content"}}),l.jsx(n,{justify:"end",style:{marginTop:"24px"},children:l.jsx(r,{children:l.jsx(y,{type:"primary",icon:l.jsx(O,{}),loading:he,disabled:0===X.length,onClick:async()=>{if(!c||!m||0===X.length)return void S.error("Assessment Type, Examiner, and at least one Surah are required.");const e=Object.values(ee).map(e=>({category_id:e.category_id,poin:e.poin??0,indicators:Object.values(e.indicators).map(e=>({...e,poin:e.poin??0}))})),i={userid:parseInt(a),periodeId:parseInt(d),surahs:X.map(({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})=>({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})),examiner:parseInt(m),poin:{type_id:parseInt(c),categories:e}};try{const e=await ce(i).unwrap();S.success(e.message||"Scores saved successfully!")}catch(t){S.error(t.data?.message||"Failed to save scores.")}},children:"Simpan"})})})]})},ae=()=>{const[e,a]=_(),i=e.get("view"),t=e.get("studentid"),s=e.get("name"),n=[{label:"Setor Hafalan",key:"1",children:l.jsx(q,{})},{label:"Laporan",key:"2",children:l.jsx(Z,{})}],r=()=>{a({})};return"form"===i?l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(ee,{name:s,userid:t,onBack:r})}):"detail"===i?l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(K,{name:s,userid:t,onBack:r})}):l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(T,{defaultActiveKey:"1",centered:!0,items:n})})};export{ae as default};
