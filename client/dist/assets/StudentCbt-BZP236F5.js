import{a as e,az as a,aA as t,j as s,d as i,aB as n}from"./index-CNbAajcm.js";import{b as r}from"./vendor-BYWiIb5-.js";import{L as d}from"./Layout-_SAc74nU.js";import{T as l}from"./Table-BSwODE4h.js";import"./index-C-OX0RB-.js";import"./index-DLmIb9aI.js";const o=({exam:n,setExam:d})=>{const[l,o]=r.useState(""),c=r.useRef(null),{user:m}=e((e=>e.auth)),{data:u,isLoading:x}=a({exam:n.id,student:m.user_id},{skip:!n.id||!m.user_id}),[h,{isLoading:b}]=t();r.useEffect((()=>{c.current&&(c.current.addEventListener("shown.bs.modal",(()=>{c.current.removeAttribute("aria-hidden")})),c.current.addEventListener("hidden.bs.modal",(()=>{c.current.setAttribute("aria-hidden","true")})))}),[]);const j=()=>{d({}),o("")};return s.jsx("div",{ref:c,className:"modal fade",id:"token",tabIndex:"-1",role:"dialog","aria-labelledby":"token-label","aria-modal":"true",children:s.jsx("div",{className:"modal-dialog",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsxs("h5",{className:"modal-title",id:"token-label",children:["Token ",n.name]}),s.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:j})]}),s.jsx("div",{className:"modal-body",children:s.jsx("input",{type:"text",name:"token",id:"token",className:"form-control",placeholder:"Masukkan Token",value:l,onChange:e=>o(e.target.value),"aria-label":"Token input"})}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-sm btn-danger","data-bs-dismiss":"modal",onClick:j,children:"Tutup"}),s.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{if(!n.id)return void i.error("Ujian tidak ditemukan");if(l!==n.token)return i.error("Token Salah"),void o("");if(u&&u.ispenalty)return i.error("Anda melanggar ketentuan"),void o("");if(u&&u.isactive)return i.error("Anda sedang mengikuti ujian"),void o("");if(u&&u.isdone)return i.error("Anda sudah mengikuti ujian"),void o("");const e={exam:n.id,student:m.user_id,action:"start",start_time:(new Date).toISOString()};i.promise(h(e).unwrap(),{loading:"Memuat...",success:e=>{d({}),o("");const a=document.getElementById("token");if(a){const e=a.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}localStorage.removeItem("questions");const t=n.name.replace(/\s+/g,"-");window.location.href=`/siswa-cbt/${t}/${n.id}/${n.token}`},error:e=>{var a;return console.log("Error starting exam:",e),(null==(a=e.data)?void 0:a.message)||"Gagal memulai ujian"}})},disabled:x||b,children:"Konfirmasi"})]})]})})})},c=({classid:e})=>{const[a,t]=r.useState(1),[i,d]=r.useState(10),[c,m]=r.useState(""),{data:u={},isLoading:x}=n({classid:e,page:a,limit:i,search:c},{skip:!e}),{exams:h=[],totalData:b,totalPages:j}=u,[g,p]=r.useState({});return s.jsxs(l,{isLoading:x,page:a,setPage:t,limit:i,setLimit:d,totalPages:j,setSearch:m,totalData:b,children:[s.jsxs("table",{className:"mb-0 table table-hover table-striped table-bordered",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{className:"text-center",children:"No"}),s.jsx("th",{className:"text-center",children:"Guru"}),s.jsx("th",{className:"text-center",children:"Nama Ujian"}),s.jsx("th",{className:"text-center",children:"Durasi"}),s.jsx("th",{className:"text-center",children:"Status"}),s.jsx("th",{className:"text-center",children:"Aksi"})]})}),s.jsx("tbody",{children:(null==h?void 0:h.length)>0?null==h?void 0:h.map(((e,a)=>s.jsxs("tr",{children:[s.jsx("td",{className:"text-center align-middle",children:a+1}),s.jsx("td",{className:"align-middle",children:e.teacher_name}),s.jsx("td",{className:"align-middle",children:e.name}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("p",{className:"m-0 badge bg-primary",children:`${e.duration} Menit`})}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("p",{className:"m-0",children:e.isactive?s.jsx("span",{className:"badge bg-success",children:"Aktif"}):s.jsx("span",{className:"badge bg-danger",children:"nonaktif"})})}),s.jsx("td",{className:"text-center align-middle",children:s.jsx("button",{className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#token",disabled:!e.isactive,onClick:()=>p(e),children:s.jsx("i",{className:"bi bi-eye"})})})]},e.id))):s.jsx("tr",{children:s.jsx("td",{colSpan:6,children:"Data Belum Tersedia"})})})]}),s.jsx(o,{exam:g,setExam:p})]})},m=()=>{const{user:a}=e((e=>e.auth));return s.jsx(d,{title:"Daftar Ujian",levels:["student"],children:s.jsx(c,{classid:a.class_id})})};export{m as default};
//# sourceMappingURL=StudentCbt-BZP236F5.js.map
