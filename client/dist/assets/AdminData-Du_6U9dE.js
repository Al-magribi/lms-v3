import{j as e,B as a,E as s,G as t,H as i,J as n,K as l,N as r,s as d,l as o,O as c,m as u,n as m,I as p,F as g,t as h,P as x,Q as j,U as k,V as y,W as f,X as S,Y as b,Z as C,_ as w,$ as T,a0 as v,a1 as F,a2 as E,a3 as I,h as A,A as L}from"./index-B0c3W_5t.js";import{c as D}from"./vendor-DnNJsrFE.js";import{A as N}from"./Add-DopxF80z.js";import{T as O}from"./TableLayout-Ci3QPEVA.js";import{S as K}from"./index-C63_5tue.js";import{D as P,F as H}from"./Table-x0yCeKUk.js";import{R as z}from"./SaveOutlined-6CZfENpQ.js";import{S as M}from"./Pagination-WHZFXTMR.js";import{S as J}from"./index-DdknNc5d.js";import{R as _}from"./DeleteOutlined-B6iY7KtB.js";import{U}from"./Upload-D44XkdB6.js";import{r as B,u as R}from"./xlsx-C5xT2hrF.js";import{A as V}from"./index-DNhhOToF.js";import{U as G,R as q}from"./InboxOutlined-DFIXlufQ.js";import{R as Y}from"./FileExcelOutlined-Cv95lv2f.js";import{R as $}from"./CloseCircleOutlined-BhL0yC3e.js";import"./DownloadOutlined-CY0ejyjx.js";import"./progress-C-9ZUo7L.js";const W=({onClick:s,disabled:t})=>e.jsx(a,{style:{backgroundColor:"#52c41a",color:"#fff"},onClick:s,disabled:t,icon:e.jsx(z,{}),children:"Simpan"}),Q=({disabled:t,onClick:i})=>e.jsx(a,{icon:e.jsx(s,{}),color:"danger",variant:"solid",onClick:i,disabled:t,children:"Cancel"}),X=({onEdit:a})=>{const[s,o]=D.useState(1),[c,u]=D.useState(10),[m,p]=D.useState(""),{data:g,isLoading:h}=t({page:s,limit:c,search:m}),[x,{data:j,isLoading:k,isSuccess:y,error:f}]=i(),[S,{data:b,isLoading:C,isSuccess:w,error:T}]=n(),{refetch:v}=l({page:s,limit:c,search:m}),{refetch:F}=r({page:s,limit:c,search:m}),E=(e,{key:s})=>{switch(s){case"edit":(e=>{a(e)})(e);break;case"delete":t=e.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?S(t):d.warning("Aksi dibatalkan")}var t};D.useEffect(()=>{w&&d.success(b.message),T&&d.error(T.data.message)},[b,w,T]),D.useEffect(()=>{y&&(v(),F(),d.success(j.message)),f&&d.error(f.data.message)},[y,f,j]);const I=[{title:"_id",dataIndex:"id",key:"id"},{title:"Periode",dataIndex:"name",key:"name"},{title:"Status",dataIndex:"isactive",key:"isactive",render:(a,s)=>e.jsx(K,{checked:a,checkedChildren:"Aktif",unCheckedChildren:"Non-aktif",onChange:()=>{return e=s.id,void x(e);var e}})},{title:"Aksi",key:"action",render:a=>e.jsx(P.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:e})=>E(a,{key:e})},children:"Pilihan Aksi"})}];return e.jsx(O,{onSearch:e=>{p(e),o(1)},isLoading:h||k||C,columns:I,source:g?.periodes,rowKey:"id",page:s,limit:c,totalData:g?.totalData,onChange:e=>{o(e.current),u(e.pageSize)},children:"TableData"})},Z=({title:a,open:s,setOpen:t,periode:i,setPeriode:n})=>{const[l]=o.useForm(),[r,{isLoading:g,data:h,isSuccess:x,error:j}]=c(),k=()=>{t(!1),n(),l.resetFields()};return D.useEffect(()=>{s&&(l.resetFields(),i?l.setFieldsValue({name:i.name}):l.resetFields())},[i,s]),D.useEffect(()=>{x&&(d.success(h.message),k()),j&&d.error(j.data.message)},[h,x,j]),e.jsx(u,{open:s,title:a,destroyOnHidden:!0,onCancel:k,style:{top:20},footer:[e.jsx(Q,{onClick:k},"cancel"),e.jsx(W,{onClick:()=>l.submit()},"add")],children:e.jsx(m,{spinning:g,tip:"Memuat data...",children:e.jsx(o,{form:l,onFinish:e=>{if(i){const a={...e,id:i.id};r(a)}else l.resetFields()},layout:"vertical",children:e.jsx(o.Item,{name:"name",label:"Nama Periode",rules:[{required:!0,message:"Kolom wajib diisi"}],children:e.jsx(p,{placeholder:"Nama Periode"})})})})})},{Title:ee}=h,ae=()=>{const[a,s]=D.useState(!1),[t,i]=D.useState(!1),[n,l]=D.useState({});return e.jsxs(g,{vertical:!0,gap:"middle",children:[e.jsxs(g,{align:"center",justify:"space-between",children:[e.jsx(ee,{style:{margin:0},level:5,children:"Mangement Periode"}),e.jsx(N,{onClick:()=>s(!0)})]}),e.jsx(X,{onEdit:e=>{l(e),s(!0),i(!0)}}),e.jsx(Z,{open:a,title:t?"Edit Periode":"Tambah Periode",periode:n,setPeriode:()=>l({}),setOpen:()=>s(!1)})]})},se=({onEdit:a})=>{const[s,t]=D.useState(1),[i,n]=D.useState(10),[l,r]=D.useState(""),{data:o,isLoading:c}=x({page:s,limit:i,search:l}),[u,{data:m,isLoading:p,isSuccess:g,error:h,reset:k}]=j(),y=(e,{key:s})=>{switch(s){case"edit":(e=>{a(e)})(e);break;case"delete":t=e.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?u(t):d.warning("Aksi dibatalkan")}var t};D.useEffect(()=>{g&&(d.success(m.message),k()),h&&(d.error(h.data.message),k())},[m,g,h]);const f=[{title:"No",key:"no",render:(e,a,t)=>(s-1)*i+t+1},{title:"Jurusan",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:a=>e.jsx(P.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:e})=>y(a,{key:e})},children:"Pilihan Aksi"})}];return e.jsx(O,{onSearch:e=>{r(e),t(1)},isLoading:c||p,columns:f,source:o?.majors,rowKey:"id",page:s,limit:i,totalData:o?.totalData,onChange:e=>{t(e.current),n(e.pageSize)},children:"TableData"})},te=({title:a,open:s,setOpen:t,major:i,setMajor:n})=>{const[l]=o.useForm(),[r,{isLoading:c,isSuccess:g,error:h,data:x}]=k(),j=()=>{t(!1),n(),l.resetFields()};return D.useEffect(()=>{s&&(l.resetFields(),i?l.setFieldsValue({name:i.name}):l.resetFields())},[i,s]),D.useEffect(()=>{g&&(d.success(x.message),j()),h&&d.error(h.data.message)},[x,g,h]),e.jsx(u,{open:s,title:a,destroyOnHidden:!0,onCancel:j,style:{top:20},footer:[e.jsx(Q,{onClick:j},"cancel"),e.jsx(W,{onClick:()=>l.submit()},"add")],children:e.jsx(m,{spinning:c,tip:"Memuat data...",children:e.jsx(o,{form:l,onFinish:e=>{if(i){const a={...e,id:i.id};r(a)}else l.resetFields()},layout:"vertical",children:e.jsx(o.Item,{name:"name",label:"Nama Jurusan",rules:[{required:!0,message:"Kolom wajib diisi"}],children:e.jsx(p,{placeholder:"Nama Jurusan"})})})})})},{Title:ie}=h,ne=()=>{const[a,s]=D.useState(!1),[t,i]=D.useState(!1),[n,l]=D.useState({});return e.jsxs(g,{vertical:!0,gap:"middle",children:[e.jsxs(g,{align:"center",justify:"space-between",children:[e.jsx(ie,{style:{margin:0},level:5,children:"Management Jurusan"}),e.jsx(N,{onClick:()=>s(!0)})]}),e.jsx(se,{onEdit:e=>{l(e),i(!0),s(!0)}}),e.jsx(te,{title:t?"Edit Jurusan":"Tambah Jurusan",open:a,setOpen:()=>s(!1),major:n,setMajor:()=>l({})})]})},le=({title:a,open:s,setOpen:t,grade:i,setGrade:n})=>{const[l]=o.useForm(),[r,{isLoading:c,isSuccess:g,error:h,data:x}]=y(),j=()=>{t(!1),n(),l.resetFields()};return D.useEffect(()=>{s&&(l.resetFields(),i?l.setFieldsValue({name:i.name}):l.resetFields())},[i,s]),D.useEffect(()=>{g&&(d.success(x.message),j()),h&&d.error(h.data.message)},[x,g,h]),e.jsx(u,{open:s,title:a,destroyOnHidden:!0,onCancel:j,style:{top:20},footer:[e.jsx(Q,{onClick:j},"cancel"),e.jsx(W,{onClick:()=>l.submit()},"add")],children:e.jsx(m,{spinning:c,tip:"Memuat data...",children:e.jsx(o,{form:l,onFinish:e=>{if(i){const a={...e,id:i.id};r(a)}else l.resetFields()},layout:"vertical",children:e.jsx(o.Item,{name:"name",label:"Nama Tingkat",rules:[{required:!0,message:"Kolom wajib diisi"}],children:e.jsx(p,{type:"number",placeholder:"Nama Tingkat"})})})})})},re=({onEdit:a})=>{const[s,t]=D.useState(1),[i,n]=D.useState(10),[l,r]=D.useState(""),{data:o,isLoading:c}=f({page:s,limit:i,search:l}),[u,{data:m,isLoading:p,isSuccess:g,error:h}]=S(),x=(e,{key:s})=>{switch(s){case"edit":(e=>{a(e)})(e);break;case"delete":t=e.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?u(t):d.warning("Aksi dibatalkan")}var t};D.useEffect(()=>{g&&d.success(m.message),h&&d.error(h.data.message)},[m,g,h]);const j=[{title:"No",key:"no",render:(e,a,t)=>(s-1)*i+t+1},{title:"Tingkat",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:a=>e.jsx(P.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:e})=>x(a,{key:e})},children:"Pilihan Aksi"})}];return e.jsx(O,{onSearch:e=>{r(e),t(1)},isLoading:c||p,columns:j,source:o?.grades,rowKey:"id",page:s,limit:i,totalData:o?.totalData,onChange:e=>{t(e.current),n(e.pageSize)},children:"TableData"})},{Title:de}=h,oe=()=>{const[a,s]=D.useState(!1),[t,i]=D.useState(!1),[n,l]=D.useState({});return e.jsxs(g,{vertical:!0,gap:"middle",children:[e.jsxs(g,{align:"center",justify:"space-between",children:[e.jsx(de,{style:{margin:0},level:5,children:"Management Tingkat"}),e.jsx(N,{onClick:()=>s(!0)})]}),e.jsx(re,{onEdit:e=>{l(e),i(!0),s(!0)}}),e.jsx(le,{title:t?"Edit Tingkat":"Tambah Tingkat",open:a,setOpen:()=>s(!1),grade:n,setGrade:()=>l({})})]})},ce=({title:a,open:s,setOpen:t,classData:i,setClassData:n})=>{const[l]=o.useForm(),{data:r}=f({page:"",limit:"",search:""}),{data:c}=x({page:"",limit:"",search:""}),g=r?.map(e=>({value:e.id,label:e.name})),h=c?.map(e=>({value:e.id,label:e.name})),[j,{isLoading:k,isSuccess:y,error:S,data:C}]=b(),w=()=>{t(!1),n(),l.resetFields()};return D.useEffect(()=>{s&&(l.resetFields(),i?l.setFieldsValue({name:i.name,gradeId:i.grade,majorId:i.major}):l.resetFields())},[i,s]),D.useEffect(()=>{y&&(d.success(C.message),w()),S&&d.error(S.data.message)},[C,y,S]),e.jsx(u,{open:s,title:a,destroyOnHidden:!0,onCancel:w,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:()=>l.submit(),confirmLoading:k,loading:k,children:e.jsx(m,{spinning:k,tip:"Memuat data...",children:e.jsxs(o,{form:l,onFinish:e=>{if(i){const a={...e,id:i.id};j(a)}else l.resetFields()},layout:"vertical",children:[e.jsx(o.Item,{name:"gradeId",label:"Pilih Tingkat",rules:[{required:!0,message:"Wajid diisi"}],children:e.jsx(M,{placeholder:"Pilih Tingkat",options:g,onChange:e=>{l.setFieldsValue({gradeId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),e.jsx(o.Item,{name:"majorId",label:"Pilih Jurusan",children:e.jsx(M,{placeholder:"Pilih Jurusan",options:h,onChange:e=>{l.setFieldsValue({majorId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),e.jsx(o.Item,{name:"name",label:"Nama Kelas",rules:[{required:!0,message:"Kolom wajib diisi"}],children:e.jsx(p,{placeholder:"Nama Kelas"})})]})})})},{Text:ue}=h,me=({open:s,onClose:t,classname:i,classid:n})=>{const[l,r]=D.useState(1),[o,c]=D.useState(10),[m,h]=D.useState(""),[x,j]=D.useState(""),{data:k,isLoading:y,refetch:f}=C({page:l,limit:o,search:m,classid:n},{skip:!n}),[S,{isLoading:b,isSuccess:F,data:E,error:I}]=w(),[A,{data:L,isLoading:N,isSuccess:K,error:P}]=T(),H=a=>{u.confirm({title:"Yakin ingin menghapus siswa ini?",icon:e.jsx(v,{}),content:e.jsxs(ue,{strong:!0,children:[a.student_name," (",a.nis,")"]}),okText:"Hapus",okButtonProps:{danger:!0},cancelText:"Batal",onOk(){var e;e=a.student,A(e)},onCancel(){d.info("Aksi dibatalkan")}})};D.useEffect(()=>{F&&(d.success(E.message),j("")),I&&d.error(I.data.message)},[F,I,E]),D.useEffect(()=>{K&&(d.success(L?.message),f()),P&&d.error(P?.data?.message)},[K,P,L,f]);const M=[{title:"No",key:"no",render:(e,a,s)=>(l-1)*o+s+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(a,s)=>e.jsxs(J,{direction:"vertical",size:0,children:[e.jsx(ue,{children:s.student_name}),e.jsxs(ue,{type:"secondary",style:{fontSize:"12px"},children:["NIS: ",s.nis]})]})},{title:"Aksi",key:"action",render:s=>e.jsx(a,{danger:!0,icon:e.jsx(_,{}),onClick:()=>H(s),loading:N,children:"Hapus"})}];return e.jsx(u,{open:s,title:`Daftar Siswa Kelas ${i}`,onCancel:t,footer:[e.jsx(a,{onClick:t,children:"Tutup"},"close")],width:800,style:{top:20},children:e.jsxs(g,{vertical:!0,gap:"middle",children:[e.jsxs(J.Compact,{children:[e.jsx(p,{placeholder:"Masukan NIS",onChange:e=>j(e.target.value)}),e.jsx(a,{type:"primary",icon:e.jsx(z,{}),onClick:()=>{S({nis:x,classid:n})},disabled:b})]}),e.jsx(O,{onSearch:e=>{h(e),r(1)},isLoading:y||N,columns:M,source:k?.students,rowKey:"student",page:l,limit:o,totalData:k?.totalData,onChange:e=>{r(e.current),c(e.pageSize)}})]})})},{Text:pe}=h,{confirm:ge}=u,he=({onEdit:a})=>{const[s,t]=D.useState(1),[i,n]=D.useState(10),[l,o]=D.useState(""),[c,u]=D.useState(!1),[m,p]=D.useState(""),{data:h,isLoading:x}=r({page:s,limit:i,search:l}),[j,{data:k,isLoading:y,isSuccess:f,error:S}]=F(),b=(e,{key:s})=>{switch(s){case"edit":(e=>{a(e)})(e);break;case"detail":(e=>{p(e),u(!0)})(e);break;case"delete":t=e.id,ge({title:"Konfirmasi Hapus Data",content:"Apakah anda yakin akan menghapus data ini?!",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){j(t)},onCancel(){d.warning("Aksi dibatalkan")}})}var t};D.useEffect(()=>{f&&d.success(k.message),S&&d.error(S.data.message)},[k,f,S]);const C=[{title:"No",key:"no",render:(e,a,t)=>(s-1)*i+t+1},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Jurusan",dataIndex:"major_name",key:"major_name"},{title:"Kelas",dataIndex:"name",key:"name",render:(a,s)=>e.jsxs(g,{vertical:!0,gap:"small",children:[e.jsx(pe,{children:a}),e.jsxs("small",{children:["id : ",s.id]})]})},{title:"Jumlah Siswa",dataIndex:"students",key:"students"},{title:"Aksi",key:"action",render:a=>e.jsx(P.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"detail",label:"Detail"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:e})=>b(a,{key:e})},children:"Pilihan Aksi"})}];return e.jsxs(e.Fragment,{children:[e.jsx(O,{onSearch:e=>{o(e),t(1)},isLoading:x||y,columns:C,source:h?.classes,rowKey:"id",page:s,limit:i,totalData:h?.totalData,onChange:e=>{t(e.current),n(e.pageSize)}}),e.jsx(me,{open:c,onClose:()=>(p({}),void u(!1)),classname:m?.name,classid:m?.id})]})},{Dragger:xe}=G,{Text:je,Title:ke}=h,ye=({open:s,onClose:t})=>{const[i,n]=D.useState(null),[l,r]=D.useState([]),[o,{isLoading:c,isSuccess:m,error:p,data:h}]=E();return D.useEffect(()=>{i?(()=>{if(i){const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target.result),s=B(a,{type:"array"}),t=s.SheetNames[0],i=s.Sheets[t],l=R.sheet_to_json(i,{header:1,range:1}).map(e=>e.slice(0,5)).filter(e=>e.some(e=>null!=e&&""!==e));if(0===l.length)return d.error("Tidak ada data dalam file atau template salah."),void n(null);r(l),d.success(`Jumlah data terbaca ${l.length} siswa.`)}catch(a){d.error("Gagal memproses data. Pastikan template yang digunakan benar")}},e.readAsArrayBuffer(i)}})():r([])},[i]),D.useEffect(()=>{m&&(d.success(h.message),n(null),r([]),t()),p&&d.error(p.data.message)},[m,h,p]),e.jsx(u,{title:"Bulk Upload Students",open:s,onCancel:()=>{n(null),r([]),t()},destroyOnHidden:!0,width:700,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:async()=>{0!==l.length?o(l):d.warning("Tidak ada data yang diupload, pastikan template sesuai")},confirmLoading:c,loading:c,children:e.jsxs(J,{direction:"vertical",style:{width:"100%"},size:"large",children:[e.jsx(V,{message:"Follow these steps",description:e.jsxs(J,{direction:"vertical",size:2,children:[e.jsx(je,{children:"1. Unduh template excel yang sudah disediakan."}),e.jsx(je,{children:"2. Isikan data siswa berdasarkan kolom yang tersedia."}),e.jsx(je,{children:"3. Upload kembali file yang sudah diisi."}),e.jsx(a,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_siswa.xlsx","_blank")},children:"Download Template"})]}),type:"info",showIcon:!0}),i?e.jsxs(J,{direction:"vertical",style:{width:"100%"},children:[e.jsxs(g,{align:"center",justify:"space-between",style:{background:"#f0f0f0",padding:"8px 12px",borderRadius:"6px"},children:[e.jsxs(g,{align:"center",gap:"small",children:[e.jsx(Y,{style:{color:"#217346",fontSize:20}}),e.jsx(je,{strong:!0,children:i.name}),e.jsxs(I,{color:"green",children:[l.length," records found"]})]}),e.jsx(a,{type:"text",danger:!0,icon:e.jsx($,{}),onClick:()=>n(null),children:"Change File"})]}),l.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(ke,{level:5,style:{marginTop:16},children:"Data Preview"}),e.jsx(H,{columns:[{title:"TAHUN MASUK",dataIndex:0,key:"tahunMasuk"},{title:"NIS",dataIndex:1,key:"nis"},{title:"NAMA LENGKAP",dataIndex:2,key:"nama"},{title:"Kelamin",dataIndex:3,key:"kelamin"},{title:"Kelas",dataIndex:4,key:"kelas"}],dataSource:l.map((e,a)=>({key:a,...e})),size:"small",pagination:{pageSize:5,showSizeChanger:!1},scroll:{y:240}})]})]}):e.jsxs(xe,{name:"file",accept:".xlsx, .xls, .csv",beforeUpload:e=>(n(e),!1),children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(q,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),e.jsx("p",{className:"ant-upload-hint",children:"Ensure the file matches the template format."})]})]})})},{Title:fe}=h,Se=()=>{const[a,s]=D.useState(!1),[t,i]=D.useState(!1),[n,l]=D.useState({}),[r,d]=D.useState(!1);return e.jsxs(g,{vertical:!0,gap:"middle",children:[e.jsxs(g,{align:"center",justify:"space-between",children:[e.jsx(fe,{style:{margin:0},level:5,children:"Management Kelas"}),e.jsxs(J,{children:[e.jsx(N,{onClick:()=>s(!0)}),e.jsx(U,{onClick:()=>d(!0)})]})]}),e.jsx(he,{onEdit:e=>{l(e),i(!0),s(!0)}}),e.jsx(ce,{title:t?"Edit Kelas":"Tambah Kelas",open:a,setOpen:()=>s(!1),classData:n,setClassData:()=>l({})}),e.jsx(ye,{open:r,onClose:()=>d(!1)})]})},be=()=>{const a=[{label:"Periode",key:"1",children:e.jsx(ae,{})},{label:"Jurusan",key:"2",children:e.jsx(ne,{})},{label:"Tingkat",key:"3",children:e.jsx(oe,{})},{label:"Kelas",key:"4",children:e.jsx(Se,{})}];return e.jsx(A,{title:"Management Data pokok",levels:["admin"],children:e.jsx(L,{defaultActiveKey:"1",centered:!0,items:a})})};export{be as default};
