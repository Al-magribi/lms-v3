import{b3 as O,b0 as V,aO as F,r as c,j as e,V as S,bc as K,f as R,bd as U}from"./index-_V-Hszfs.js";import{L as W}from"./Layout-BOPYSC9s.js";import{S as X}from"./react-select.esm-BK9OElNt.js";const Y=({typeId:n,setTypeId:u,examiner:o,setExaminer:i,surah:N,setSelectedSurah:_,setSelectedJuz:f,countAyat:B,fromAyat:A,setFromAyat:C,toAyat:h,setToAyat:L,countLine:D,fromLine:I,setFromLine:v,toLine:k,setToLine:y,addToTable:z,setTableData:J})=>{const{data:j}=O({page:"",limit:"",search:""}),{data:b}=V({page:"",limit:"",search:""}),{data:l}=F({page:"",limit:"",search:""}),[x,p]=c.useState([]),[g,w]=c.useState([]),[r,P]=c.useState(null),E=a=>{p(a||[])},G=a=>{const s=parseInt(a.target.value),t=l==null?void 0:l.find(d=>d.id===s);!t||t.surah.length===0?(S.error("Data tidak tersedia"),w([])):(f(t),w(t.surah))},H=a=>{const s=parseInt(a.target.value),t=g.find(d=>d.id===s);t?(_(t),P(t),C(""),L(""),v(""),y("")):S.error("Surah tidak ditemukan!")},M=()=>{if(x.length===0){S.error("Pilih Juz terlebih dahulu");return}const a=[];x.forEach(s=>{const t=l==null?void 0:l.find(d=>d.id===s.value);!t||t.surah.length===0?S.error(`Data tidak tersedia untuk Juz ${s.label}`):(f(t),a.push(...t.surah.map(d=>({juzId:t.id,fromSurah:d.surah_id,fromSurahName:d.surah,fromAyat:d.from_ayat,toAyat:d.to_ayat,fromLine:1,toLine:d.lines}))))}),a.length>0&&(J(s=>[...s,...a]),p([]))};return e.jsx("div",{className:"row g-2",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-12",children:e.jsx("p",{className:"m-0",children:"Hafalan Berdasarkan Juz"})}),e.jsx("div",{className:"col-6",children:e.jsx(X,{isMulti:!0,options:l==null?void 0:l.map(a=>({value:a.id,label:a.name})),value:x,onChange:E,placeholder:"Pilih Juz"})}),e.jsx("div",{className:"col-6 d-flex align-items-center",children:e.jsx("button",{className:"btn btn-sm btn-primary",onClick:M,children:e.jsx("i",{className:"bi bi-floppy"})})}),e.jsx("div",{className:"col-12",children:e.jsx("p",{className:"m-0",children:"Hafalan Berdasarkan Surah"})}),e.jsx("div",{className:" col-6",children:e.jsxs("select",{name:"juz2",id:"jus2",className:"form-select",onChange:G,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Juz"}),l==null?void 0:l.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:" col-6",children:e.jsxs("select",{name:"surah",id:"surah",className:"form-select",onChange:H,disabled:g.length===0,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Surah"}),g==null?void 0:g.map(a=>e.jsx("option",{value:a.id,children:a.surah},a.id))]})}),e.jsx("div",{className:" col-6",children:e.jsxs("select",{name:"fromAyat",id:"fromAyat",className:"form-select",disabled:!r,value:A,onChange:a=>C(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Dari Ayat"}),r&&Array.from({length:r.to_ayat-r.from_ayat+1},(a,s)=>r.from_ayat+s).map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:" col-6",children:e.jsxs("select",{name:"toAyat",id:"toAyat",className:"form-select",disabled:!A,value:h,onChange:a=>L(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Sampai Ayat"}),r&&Array.from({length:r.to_ayat-r.from_ayat+1},(a,s)=>r.from_ayat+s).map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-lg-4 col-6",children:e.jsxs("select",{name:"fromLine",id:"fromLine",className:"form-select",disabled:!h,value:I,onChange:a=>v(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Dari Baris"}),r&&Array.from({length:r.lines},(a,s)=>s+1).map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-lg-4 col-6",children:e.jsxs("select",{name:"toLine",id:"toLine",className:"form-select",disabled:!I,value:k,onChange:a=>y(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Sampai Baris"}),r&&Array.from({length:r.lines},(a,s)=>s+1).map(a=>e.jsx("option",{value:a,children:a},a))]})}),e.jsx("div",{className:"col-lg-4 col-12 d-flex align-items-center justify-content-lg-start justify-content-end",children:e.jsx("button",{className:"btn btn-sm btn-primary",disabled:!k,onClick:z,children:e.jsx("i",{className:"bi bi-floppy"})})}),e.jsx("div",{className:"col-6",children:e.jsxs("select",{name:"type",id:"type",className:"form-select",value:n||"",onChange:a=>u(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Jenis Penilaian"}),j==null?void 0:j.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})}),e.jsx("div",{className:"col-6",children:e.jsxs("select",{name:"examiner",id:"examiner",className:"form-select",value:o||"",onChange:a=>i(a.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Penguji"}),b==null?void 0:b.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})})]})})})},Z=()=>{const{data:n}=K();return e.jsx("div",{className:"mt-2 table-responsive rounded-3 border mb-2",children:e.jsxs("table",{className:"table table-striped table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Kategori"}),e.jsx("th",{children:"Indikator"}),e.jsx("th",{children:"Poin"})]})}),e.jsx("tbody",{children:n==null?void 0:n.map((u,o)=>e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:u.name}),e.jsx("td",{className:"align-middle",children:e.jsx("div",{className:"d-flex flex-column gap-2",children:u.indicators.filter(i=>i!==null).length>0?u.indicators.filter(i=>i!==null).map((i,N)=>e.jsxs("div",{className:"d-flex align-items-center justify-content-between p-2 gap-2 rounded border bg-white",children:[e.jsx("p",{className:"m-0",children:i.name}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Penilaian",style:{width:150},"data-indicator-id":i.id,"data-category-id":u.id})]},N)):e.jsx("p",{className:"m-0 text-muted",children:"Tidak ada indikator untuk kategori ini"})})}),e.jsx("td",{className:"align-middle",children:e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx("input",{type:"text",name:"category-score",className:"form-control",placeholder:"Nilai","data-category-id":u.id})})})]},o))})]})})},ee=({data:n,deleteSurah:u})=>e.jsx("div",{style:{maxHeight:500,overflow:"auto"},className:"table-responsive rounded-3 border",children:e.jsxs("table",{className:"table mb-0 table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"Nama Surat"}),e.jsx("th",{className:"text-center",children:"Dari Ayat"}),e.jsx("th",{className:"text-center",children:"Sampai Ayat"}),e.jsx("th",{className:"text-center",children:"Dari Baris"}),e.jsx("th",{className:"text-center",children:"Sampai Baris"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(n==null?void 0:n.length)>0?n==null?void 0:n.map((o,i)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:o.fromSurahName}),e.jsx("td",{className:"text-center align-middle",children:o.fromAyat}),e.jsx("td",{className:"text-center align-middle",children:o.toAyat}),e.jsx("td",{className:"text-center align-middle",children:o.fromLine}),e.jsx("td",{className:"text-center align-middle",children:o.toLine}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>u(o.fromSurahName),children:e.jsx("i",{className:"bi bi-trash"})})})]},i)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Data belum tersedia"})})})]})}),le=()=>{const{name:n,userid:u,periodeId:o}=R(),i=n.replace(/-/g," "),[N,_]=c.useState(""),[f,B]=c.useState(""),[A,C]=c.useState({}),[h,L]=c.useState({});let D=h==null?void 0:h.to_ayat;const[I,v]=c.useState(""),[k,y]=c.useState("");let z=h==null?void 0:h.to_line;const[J,j]=c.useState(""),[b,l]=c.useState(""),[x,p]=c.useState([]),g=()=>{p(a=>[...a,{juzId:A.id,fromSurah:h.surah_id,fromSurahName:h.surah,fromAyat:I,toAyat:k,fromLine:J,toLine:b}]),D=0,v(""),y(""),z=0,j(""),l("")},[w,{isLoading:r,isSuccess:P,isError:E,reset:G}]=U(),H=a=>{const s=x.filter(t=>t.fromSurahName!==a);p(s)},M=()=>{const a=document.querySelectorAll("[name='category-score']"),s=document.querySelectorAll("input[data-indicator-id]"),t=Array.from(a).map(m=>{const Q=m.dataset.categoryId,$=m.value,q=Array.from(s).filter(T=>T.dataset.categoryId===Q).map(T=>({indicator_id:parseInt(T.dataset.indicatorId),poin:T.value}));return{category_id:parseInt(Q),poin:$,indicators:q}}),d={userid:parseInt(u),periodeId:parseInt(o),juzId:A.id,surahs:x,examiner:parseInt(f),poin:{type_id:parseInt(N),categories:t}};if(!N||!f||!x||!t)return S.warning("Lengkapi data");S.promise(w(d).unwrap().then(m=>m.message),{loading:"Memuat data...",success:m=>m,error:m=>m.data.message}),a.forEach(m=>m.value=""),s.forEach(m=>m.value="")};return c.useEffect(()=>{(P||E)&&(G(),_(""),B(""),v(""),y(""),j(""),l(""),p([]))},[P,E]),e.jsx(W,{title:`Hafalan ${i}`,levels:["tahfiz"],children:e.jsx("div",{className:"container-fluid p-3",children:e.jsxs("div",{className:"card shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-bottom",children:e.jsx("h5",{className:"card-title mb-0",children:i})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-lg-6",children:e.jsx("div",{className:"d-flex flex-column gap-4",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx(Y,{typeId:N,setTypeId:_,examiner:f,setExaminer:B,surah:h,setSelectedSurah:L,setSelectedJuz:C,countAyat:D,fromAyat:I,setFromAyat:v,toAyat:k,setToAyat:y,countLine:z,fromLine:J,setFromLine:j,toLine:b,setToLine:l,addToTable:g,setTableData:p})})})})}),e.jsx("div",{className:"col-lg-6",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx(Z,{})})})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx(ee,{data:x,deleteSurah:H})})})})]}),e.jsx("div",{className:"text-end mt-2",children:e.jsxs("button",{className:"btn btn-primary",disabled:(x==null?void 0:x.length)===0||r,onClick:M,children:[r?e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}):null,"Simpan"]})})]})]})})})};export{le as default};
