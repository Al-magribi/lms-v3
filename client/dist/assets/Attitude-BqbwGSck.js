import{B as e,_ as a,aA as t,O as i,aj as l,bQ as s,j as n,t as r,F as c,E as d,n as o,a as h,aC as m,s as u,bR as p,bS as x,bT as f}from"./index-DiV9Z5wO.js";import{c as g}from"./vendor-DnNJsrFE.js";import{u as w,w as j}from"./xlsx-bihEw32H.js";import{S as b}from"./index-CUntdCv2.js";import{S as y}from"./Pagination-DOHi8IQ1.js";import{R as k}from"./DownloadOutlined-NgH04WF9.js";import{A as v}from"./index-CZswllBU.js";import{F as S}from"./Table-CzBZyoK4.js";import{h as _}from"./moment-CBOc1lqT.js";var C={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M952 474H829.8C812.5 327.6 696.4 211.5 550 194.2V72c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v122.2C327.6 211.5 211.5 327.6 194.2 474H72c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h122.2C211.5 696.4 327.6 812.5 474 829.8V952c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V829.8C696.4 812.5 812.5 696.4 829.8 550H952c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM512 756c-134.8 0-244-109.2-244-244s109.2-244 244-244 244 109.2 244 244-109.2 244-244 244z"}},{tag:"path",attrs:{d:"M512 392c-32.1 0-62.1 12.4-84.8 35.2-22.7 22.7-35.2 52.7-35.2 84.8s12.5 62.1 35.2 84.8C449.9 619.4 480 632 512 632s62.1-12.5 84.8-35.2C619.4 574.1 632 544 632 512s-12.5-62.1-35.2-84.8A118.57 118.57 0 00512 392z"}}]},name:"aim",theme:"outlined"},I=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:C}))},z=g.forwardRef(I),P={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 184H712v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H384v-64c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v64H144c-17.7 0-32 14.3-32 32v664c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V216c0-17.7-14.3-32-32-32zm-40 656H184V256h128v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h256v48c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8v-48h128v584zM688 420h-55.2c-5.1 0-10 2.5-13 6.6L468.9 634.4l-64.7-89c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0026 0l212.6-292.7c3.8-5.4 0-12.8-6.5-12.8z"}}]},name:"carry-out",theme:"outlined"},A=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:P}))},N=g.forwardRef(A),H={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM544 472c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v108H372c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h108v108c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h108c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H544V472z"}}]},name:"file-add",theme:"outlined"},M=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:H}))},K=g.forwardRef(M),R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M688 312v-48c0-4.4-3.6-8-8-8H296c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8zm-392 88c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H296zm376 116c-119.3 0-216 96.7-216 216s96.7 216 216 216 216-96.7 216-216-96.7-216-216-216zm107.5 323.5C750.8 868.2 712.6 884 672 884s-78.8-15.8-107.5-44.5C535.8 810.8 520 772.6 520 732s15.8-78.8 44.5-107.5C593.2 595.8 631.4 580 672 580s78.8 15.8 107.5 44.5C808.2 653.2 824 691.4 824 732s-15.8 78.8-44.5 107.5zM761 656h-44.3c-2.6 0-5 1.2-6.5 3.3l-63.5 87.8-23.1-31.9a7.92 7.92 0 00-6.5-3.3H573c-6.5 0-10.3 7.4-6.5 12.7l73.8 102.1c3.2 4.4 9.7 4.4 12.9 0l114.2-158c3.9-5.3.1-12.7-6.4-12.7zM440 852H208V148h560v344c0 4.4 3.6 8 8 8h56c4.4 0 8-3.6 8-8V108c0-17.7-14.3-32-32-32H168c-17.7 0-32 14.3-32 32v784c0 17.7 14.3 32 32 32h272c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8z"}}]},name:"file-done",theme:"outlined"},L=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:R}))},F=g.forwardRef(L),$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M855.7 210.8l-42.4-42.4a8.03 8.03 0 00-11.3 0L168.3 801.9a8.03 8.03 0 000 11.3l42.4 42.4c3.1 3.1 8.2 3.1 11.3 0L855.6 222c3.2-3 3.2-8.1.1-11.2zM304 448c79.4 0 144-64.6 144-144s-64.6-144-144-144-144 64.6-144 144 64.6 144 144 144zm0-216c39.7 0 72 32.3 72 72s-32.3 72-72 72-72-32.3-72-72 32.3-72 72-72zm416 344c-79.4 0-144 64.6-144 144s64.6 144 144 144 144-64.6 144-144-64.6-144-144-144zm0 216c-39.7 0-72-32.3-72-72s32.3-72 72-72 72 32.3 72 72-32.3 72-72 72z"}}]},name:"percentage",theme:"outlined"},E=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:$}))},D=g.forwardRef(E),O={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M924.8 625.7l-65.5-56c3.1-19 4.7-38.4 4.7-57.8s-1.6-38.8-4.7-57.8l65.5-56a32.03 32.03 0 009.3-35.2l-.9-2.6a443.74 443.74 0 00-79.7-137.9l-1.8-2.1a32.12 32.12 0 00-35.1-9.5l-81.3 28.9c-30-24.6-63.5-44-99.7-57.6l-15.7-85a32.05 32.05 0 00-25.8-25.7l-2.7-.5c-52.1-9.4-106.9-9.4-159 0l-2.7.5a32.05 32.05 0 00-25.8 25.7l-15.8 85.4a351.86 351.86 0 00-99 57.4l-81.9-29.1a32 32 0 00-35.1 9.5l-1.8 2.1a446.02 446.02 0 00-79.7 137.9l-.9 2.6c-4.5 12.5-.8 26.5 9.3 35.2l66.3 56.6c-3.1 18.8-4.6 38-4.6 57.1 0 19.2 1.5 38.4 4.6 57.1L99 625.5a32.03 32.03 0 00-9.3 35.2l.9 2.6c18.1 50.4 44.9 96.9 79.7 137.9l1.8 2.1a32.12 32.12 0 0035.1 9.5l81.9-29.1c29.8 24.5 63.1 43.9 99 57.4l15.8 85.4a32.05 32.05 0 0025.8 25.7l2.7.5a449.4 449.4 0 00159 0l2.7-.5a32.05 32.05 0 0025.8-25.7l15.7-85a350 350 0 0099.7-57.6l81.3 28.9a32 32 0 0035.1-9.5l1.8-2.1c34.8-41.1 61.6-87.5 79.7-137.9l.9-2.6c4.5-12.3.8-26.3-9.3-35zM788.3 465.9c2.5 15.1 3.8 30.6 3.8 46.1s-1.3 31-3.8 46.1l-6.6 40.1 74.7 63.9a370.03 370.03 0 01-42.6 73.6L721 702.8l-31.4 25.8c-23.9 19.6-50.5 35-79.3 45.8l-38.1 14.3-17.9 97a377.5 377.5 0 01-85 0l-17.9-97.2-37.8-14.5c-28.5-10.8-55-26.2-78.7-45.7l-31.4-25.9-93.4 33.2c-17-22.9-31.2-47.6-42.6-73.6l75.5-64.5-6.5-40c-2.4-14.9-3.7-30.3-3.7-45.5 0-15.3 1.2-30.6 3.7-45.5l6.5-40-75.5-64.5c11.3-26.1 25.6-50.7 42.6-73.6l93.4 33.2 31.4-25.9c23.7-19.5 50.2-34.9 78.7-45.7l37.9-14.3 17.9-97.2c28.1-3.2 56.8-3.2 85 0l17.9 97 38.1 14.3c28.7 10.8 55.4 26.2 79.3 45.8l31.4 25.8 92.8-32.9c17 22.9 31.2 47.6 42.6 73.6L781.8 426l6.5 39.9zM512 326c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm79.2 255.2A111.6 111.6 0 01512 614c-29.9 0-58-11.7-79.2-32.8A111.6 111.6 0 01400 502c0-29.9 11.7-58 32.8-79.2C454 401.6 482.1 390 512 390c29.9 0 58 11.6 79.2 32.8A111.6 111.6 0 01624 502c0 29.9-11.7 58-32.8 79.2z"}}]},name:"setting",theme:"outlined"},B=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:O}))},T=g.forwardRef(B),V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},U=function(t,i){return g.createElement(e,a({},t,{ref:i,icon:V}))},G=g.forwardRef(U);const{Title:Q,Text:W}=r,X=()=>{const e=t(e=>e.auth.user),[a,r]=g.useState(null),[p,x]=g.useState(null),[f,_]=g.useState(null),{data:C}=i({page:"",limit:"",search:""}),{data:I}=l({page:"",limit:"",search:""}),{data:z,isLoading:P,isFetching:A}=s({semester:a,classid:p,subjectid:f},{skip:!a||!p||!f}),N=C?.map(e=>({label:e.name,value:e.id})),H=I?.map(e=>({label:e.name,value:e.id})),M=e?.subjects?.map(e=>({label:e.name,value:e.id})),K="admin"===e?.level?H:M,R=(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),L=()=>C?.find(e=>e.id===p)?.name||"-",F=()=>I?.find(e=>e.id===f)?.name||"-",$=[{title:"No",dataIndex:"no",key:"no",width:50,align:"center",fixed:"left"},{title:"NIS",dataIndex:"nis",key:"nis",width:100,fixed:"left"},{title:"Nama Siswa",dataIndex:"nama_siswa",key:"nama_siswa",width:200,fixed:"left"},{title:n.jsxs("div",{style:{textAlign:"center"},children:["Kehadiran ",n.jsx("br",{}),n.jsxs(W,{type:"secondary",style:{fontSize:"0.8em"},children:[z?.weights?.presensi||0,"%"]})]}),dataIndex:"kehadiran",key:"kehadiran",align:"center",width:100},{title:n.jsxs("div",{style:{textAlign:"center"},children:["Sikap ",n.jsx("br",{}),n.jsxs(W,{type:"secondary",style:{fontSize:"0.8em"},children:[z?.weights?.attitude||0,"%"]})]}),dataIndex:"sikap",key:"sikap",align:"center",width:100},{title:"Sumatif",dataIndex:"sumatif",key:"sumatif",align:"center",width:100},{title:"Ujian Akhir",dataIndex:"ujian_akhir",key:"ujian_akhir",align:"center",width:100},{title:n.jsxs("div",{style:{textAlign:"center"},children:["Rerata (S+U) ",n.jsx("br",{}),n.jsxs(W,{type:"secondary",style:{fontSize:"0.8em"},children:[z?.weights?.final||0,"%"]})]}),dataIndex:"rerata_gabungan",key:"rerata_gabungan",align:"center",width:120,render:e=>n.jsx(W,{strong:!0,children:e})},{title:"Nilai Akhir",dataIndex:"nilai_akhir",key:"nilai_akhir",align:"center",fixed:"right",width:100,render:e=>n.jsx("div",{style:{backgroundColor:"#f6ffed",border:"1px solid #b7eb8f",padding:"4px",borderRadius:"4px",fontWeight:"bold",color:"#389e0d"},children:e})}];return n.jsxs(c,{vertical:!0,gap:"middle",children:[n.jsxs(c,{align:"center",justify:"space-between",children:[n.jsx(Q,{level:5,style:{margin:0},children:"Rekapitulasi Nilai Akhir"}),n.jsxs(b,{children:[n.jsx(y,{style:{width:150},placeholder:"Pilih Semester ...",allowClear:!0,options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],onChange:e=>r(e),virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih kelas ...",allowClear:!0,options:N,onChange:e=>x(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih Pelajaran ...",allowClear:!0,options:K,onChange:e=>_(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(d,{icon:n.jsx(k,{}),onClick:()=>{if(!z||!z.data||0===z.data.length)return void u.warning("Tidak ada data untuk diunduh");const e=z.weights||{presensi:0,attitude:0,final:0},t=L(),i=F(),l=[...[["Semester",a,"Kelas",t,"Pelajaran",i],[]],["No","NIS","Nama Siswa",`Kehadiran (${e.presensi}%)`,`Sikap (${e.attitude}%)`,"Sumatif","Ujian Akhir",`Rerata Gabungan (${e.final}%)`,"Nilai Akhir"],...z.data.map(e=>[e.no,e.nis,e.nama_siswa,parseFloat(e.kehadiran),parseFloat(e.sikap),parseFloat(e.sumatif),parseFloat(e.ujian_akhir),parseFloat(e.rerata_gabungan),parseFloat(e.nilai_akhir)])],s=w.aoa_to_sheet(l);s["!cols"]=[{wch:5},{wch:15},{wch:30},{wch:15},{wch:15},{wch:10},{wch:10},{wch:20},{wch:15}];const n=w.book_new();w.book_append_sheet(n,s,"Nilai Akhir");const r=`Nilai_Akhir_${t}_${i}_Semester_${a}.xlsx`.replace(/\s+/g,"_");j(n,r)},disabled:!z||P||A,children:"Download"})]})]}),p&&f&&a?P||A?n.jsx(c,{justify:"center",style:{padding:50},children:n.jsx(o,{size:"large"})}):n.jsxs(h,{variant:"borderless",size:"small",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[n.jsxs(m,{bordered:!0,size:"small",layout:"vertical",column:3,style:{marginBottom:16},children:[n.jsx(m.Item,{label:"Semester",children:a}),n.jsx(m.Item,{label:"Kelas",children:L()}),n.jsx(m.Item,{label:"Pelajaran",children:F()})]}),n.jsx(S,{dataSource:z?.data||[],columns:$,rowKey:"no",pagination:!1,bordered:!0,size:"middle",scroll:{x:1e3}})]}):n.jsx(v,{showIcon:!0,type:"info",description:"Pilih Semester, Kelas, dan Pelajaran untuk menampilkan nilai akhir"})]})},{Title:q,Text:J}=r,Y=()=>{const e=t(e=>e.auth.user),[a,s]=g.useState(null),[r,x]=g.useState(null),[f,_]=g.useState(null),{data:C}=i({page:"",limit:"",search:""}),{data:I}=l({page:"",limit:"",search:""}),{data:z,isLoading:P,isFetching:A}=p({semester:a,classid:r,subjectid:f},{skip:!a||!r||!f}),N=C?.map(e=>({label:e.name,value:e.id})),H=I?.map(e=>({label:e.name,value:e.id})),M=e?.subjects?.map(e=>({label:e.name,value:e.id})),K="admin"===e?.level?H:M,R=(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),L=()=>C?.find(e=>e.id===r)?.name||"-",F=()=>I?.find(e=>e.id===f)?.name||"-",$=g.useMemo(()=>{if(!z||!z.months)return[];return[{title:"No",dataIndex:"no",key:"no",width:50,fixed:"left",align:"center"},{title:"NIS",dataIndex:"nis",key:"nis",width:100,fixed:"left"},{title:"Nama Siswa",dataIndex:"nama_siswa",key:"nama_siswa",width:200,fixed:"left"},...z.months.map(e=>({title:e,children:[...Array.from({length:8},(a,t)=>({title:`f_${t+1}`,key:`${e}_f_${t+1}`,width:50,align:"center",render:a=>n.jsx(J,{type:"secondary",style:{fontSize:"0.8em"},children:a.scores[e]?.["f_"+(t+1)]??"-"})})),{title:"Lisan",width:60,align:"center",render:a=>a.scores[e]?.oral??"-"},{title:"Tulis",width:60,align:"center",render:a=>a.scores[e]?.written??"-"},{title:"Projek",width:60,align:"center",render:a=>a.scores[e]?.project??"-"},{title:"Keterampilan",width:120,align:"center",render:a=>a.scores[e]?.performance??"-"}]})),...[{title:"Rata - rata",dataIndex:"rata_rata",key:"rata_rata",width:100,fixed:"right",align:"center",render:e=>n.jsx("strong",{children:e})}]]},[z]);return n.jsxs(c,{vertical:!0,gap:"middle",children:[n.jsxs(c,{align:"center",justify:"space-between",children:[n.jsx(q,{level:5,style:{margin:0},children:"Rekapitulasi Nilai Harian"}),n.jsxs(b,{children:[n.jsx(y,{style:{width:150},placeholder:"Pilih Semester ...",allowClear:!0,options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],onChange:e=>s(e),virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih kelas ...",allowClear:!0,options:N,onChange:e=>x(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih Pelajaran ...",allowClear:!0,options:K,onChange:e=>_(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(d,{icon:n.jsx(k,{}),onClick:()=>{if(!z||!z.data||0===z.data.length)return void u.warning("Data belum tersedia");const e=L(),t=F(),i=z.months||[],l=["No","NIS","Nama Siswa"],s=[];let n=3;i.forEach(e=>{l.push(e);for(let a=0;a<11;a++)l.push("");s.push({s:{r:3,c:n},e:{r:3,c:n+11}}),n+=12}),l.push("Rata - rata");const r=["","",""],c=["f_1","f_2","f_3","f_4","f_5","f_6","f_7","f_8","Lisan","Tulis","Projek","Ket."];i.forEach(()=>{r.push(...c)}),r.push("");const d=z.data.map(e=>{const a=[e.no,e.nis,e.nama_siswa];return i.forEach(t=>{const i=e.scores[t]||{};for(let e=1;e<=8;e++)a.push(i[`f_${e}`]?parseFloat(i[`f_${e}`]):"");a.push(i.oral?parseFloat(i.oral):""),a.push(i.written?parseFloat(i.written):""),a.push(i.project?parseFloat(i.project):""),a.push(i.performance?parseFloat(i.performance):"")}),a.push(parseFloat(e.rata_rata)),a}),o=[...[["Laporan Nilai Harian"],["Kelas",e],["Pelajaran",t],["Semester",a],[]],l,r,...d],h=w.aoa_to_sheet(o);h["!merges"]=s;const m=w.book_new();w.book_append_sheet(m,h,"Rekap Harian"),j(m,`Rekap_Harian_${e}_${t}.xlsx`)},disabled:!z||P||A,children:"Download"})]})]}),r&&f&&a?P||A?n.jsx(c,{justify:"center",style:{padding:50},children:n.jsx(o,{size:"large"})}):n.jsxs(h,{variant:"borderless",size:"small",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[n.jsxs(m,{bordered:!0,size:"small",layout:"vertical",column:3,style:{marginBottom:16},children:[n.jsx(m.Item,{label:"Semester",children:a}),n.jsx(m.Item,{label:"Kelas",children:L()}),n.jsx(m.Item,{label:"Pelajaran",children:F()})]}),n.jsx(S,{dataSource:z?.data||[],columns:$,rowKey:"no",pagination:!1,bordered:!0,size:"small",scroll:{x:"max-content"},sticky:!0})]}):n.jsx(v,{showIcon:!0,type:"info",description:"Pilih Semester, Kelas, dan Pelajaran untuk menampilkan rekap nilai harian"})]})},{Title:Z,Text:ee}=r,ae=()=>{const e=t(e=>e.auth.user),[a,s]=g.useState(null),[r,p]=g.useState(null),[f,C]=g.useState(null),{data:I}=i({page:"",limit:"",search:""}),{data:z}=l({page:"",limit:"",search:""}),{data:P,isLoading:A,isFetching:N}=x({semester:a,classid:r,subjectid:f},{skip:!a||!r||!f}),H=I?.map(e=>({label:e.name,value:e.id})),M=z?.map(e=>({label:e.name,value:e.id})),K=e?.subjects?.map(e=>({label:e.name,value:e.id})),R="admin"===e?.level?M:K,L=(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),F=()=>I?.find(e=>e.id===r)?.name||"-",$=()=>z?.find(e=>e.id===f)?.name||"-",E=g.useMemo(()=>P&&P.dateMapping?Object.values(P.dateMapping).flat().length:0,[P]),D=g.useMemo(()=>{if(!P||!P.dateMapping)return[];return[...[{title:"No",dataIndex:"no",key:"no",width:50,fixed:"left",align:"center"},{title:"NIS",dataIndex:"nis",key:"nis",width:100,fixed:"left"},{title:"Nama Siswa",dataIndex:"name",key:"name",width:200,fixed:"left",render:e=>n.jsx(ee,{ellipsis:!0,children:e})}],...Object.keys(P.dateMapping).map(e=>({title:e,children:P.dateMapping[e].map(e=>({title:_(e).format("DD"),key:e,width:40,align:"center",render:a=>(e=>{switch(e){case"Hadir":return n.jsx("span",{style:{color:"green"},children:"H"});case"Sakit":return n.jsx("span",{style:{color:"orange"},children:"S"});case"Izin":return n.jsx("span",{style:{color:"blue"},children:"I"});case"Alpa":return n.jsx("span",{style:{color:"red"},children:"A"});default:return"-"}})(a.attendance[e])}))})),{title:"Ringkasan",children:[{title:"H",width:45,align:"center",render:e=>e.summary?.H||0},{title:"S",width:45,align:"center",render:e=>e.summary?.S||0},{title:"I",width:45,align:"center",render:e=>e.summary?.I||0},{title:"A",width:45,align:"center",render:e=>e.summary?.A||0}]},...[{title:"Presentase (%)",children:["H","S","I","A"].map(e=>({title:e,width:55,align:"center",render:a=>{const t=a.summary?.[e]||0;return`${(E>0?t/E*100:0).toFixed(0)}%`}}))}]]},[P,E]);return n.jsxs(c,{vertical:!0,gap:"middle",children:[n.jsxs(c,{align:"center",justify:"space-between",children:[n.jsx(Z,{level:5,style:{margin:0},children:"Laporan Kehadiran"}),n.jsxs(b,{children:[n.jsx(y,{style:{width:150},placeholder:"Pilih Semester ...",allowClear:!0,options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],onChange:e=>s(e),virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih kelas ...",allowClear:!0,options:H,onChange:e=>p(e),showSearch:!0,filterOption:L,virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih Pelajaran ...",allowClear:!0,options:R,onChange:e=>C(e),showSearch:!0,filterOption:L,virtual:!1}),n.jsx(d,{icon:n.jsx(k,{}),onClick:()=>{if(!P||!P.data||0===P.data.length)return void u.warning("Data belum tersedia");const e=F(),t=$(),i=P.dateMapping,l=[["Laporan Kehadiran"],["Kelas",e],["Pelajaran",t],["Semester",a],[]],s=["No","NIS","Nama Siswa"],n=["","",""],r=[];let c=3;Object.keys(i).forEach(e=>{const a=i[e],t=a.length;s.push(e);for(let i=0;i<t-1;i++)s.push("");r.push({s:{r:5,c:c},e:{r:5,c:c+t-1}}),a.forEach(e=>{n.push(_(e).format("DD/MM"))}),c+=t}),s.push("Ringkasan");for(let a=0;a<3;a++)s.push("");r.push({s:{r:5,c:c},e:{r:5,c:c+3}}),n.push("H","S","I","A"),c+=4,s.push("Presentase (%)");for(let a=0;a<3;a++)s.push("");r.push({s:{r:5,c:c},e:{r:5,c:c+3}}),n.push("H","S","I","A");const d=Object.values(i).flat(),o=d.length,h=P.data.map(e=>{const a=[e.no,e.nis,e.name];d.forEach(t=>{const i=e.attendance[t]?e.attendance[t].charAt(0):"-";a.push(i)});const t=e.summary.H||0,i=e.summary.S||0,l=e.summary.I||0,s=e.summary.A||0;a.push(t,i,l,s);const n=e=>o>0?(e/o*100).toFixed(2)+"%":"0%";return a.push(n(t),n(i),n(l),n(s)),a}),m=[...l,s,n,...h],p=w.aoa_to_sheet(m);p["!merges"]=r,p["!cols"]=[{wch:5},{wch:15},{wch:30}];const x=w.book_new();w.book_append_sheet(x,p,"Absensi"),j(x,`Rekap_Absensi_${e}_${t}.xlsx`)},disabled:!P||A||N,children:"Download"})]})]}),r&&f&&a?A||N?n.jsx(c,{justify:"center",style:{padding:50},children:n.jsx(o,{size:"large"})}):n.jsxs(h,{size:"small",variant:"borderless",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[n.jsxs(m,{bordered:!0,size:"small",layout:"vertical",column:3,style:{marginBottom:16},children:[n.jsx(m.Item,{label:"Semester",children:a}),n.jsx(m.Item,{label:"Kelas",children:F()}),n.jsx(m.Item,{label:"Pelajaran",children:$()})]}),n.jsx(S,{dataSource:P?.data||[],columns:D,rowKey:"no",pagination:!1,bordered:!0,size:"small",scroll:{x:"max-content"},sticky:!0})]}):n.jsx(v,{showIcon:!0,type:"info",description:"Pilih Semester, Kelas, dan Pelajaran untuk menampilkan data absensi"})]})},{Title:te}=r,ie=()=>{const e=t(e=>e.auth.user),[a,s]=g.useState(null),[r,p]=g.useState(null),[x,_]=g.useState(null),{data:C}=i({page:"",limit:"",search:""}),{data:I}=l({page:"",limit:"",search:""}),{data:z,isLoading:P,isFetching:A}=f({semester:a,classid:r,subjectid:x},{skip:!a||!r||!x}),N=C?.map(e=>({label:e.name,value:e.id})),H=I?.map(e=>({label:e.name,value:e.id})),M=e?.subjects?.map(e=>({label:e.name,value:e.id})),K="admin"===e?.level?H:M,R=(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),L=()=>C?.find(e=>e.id===r)?.name||"-",F=()=>I?.find(e=>e.id===x)?.name||"-",$=g.useMemo(()=>{if(!z||!z.months)return[];return[{title:"No",dataIndex:"no",key:"no",width:50,fixed:"left",align:"center"},{title:"NIS",dataIndex:"nis",key:"nis",width:100,fixed:"left"},{title:"Nama Siswa",dataIndex:"name",key:"name",width:200,fixed:"left"},...z.months.map(e=>({title:e,children:[{title:"Kinerja",width:80,align:"center",render:a=>a.scores[e]?.kinerja??"-"},{title:"Kedisiplinan",width:100,align:"center",render:a=>a.scores[e]?.kedisiplinan??"-"},{title:"Keaktifan",width:80,align:"center",render:a=>a.scores[e]?.keaktifan??"-"},{title:"Percaya Diri",width:100,align:"center",render:a=>a.scores[e]?.percaya_diri??"-"}]})),...[{title:"Rata - Rata",dataIndex:"final_score",key:"final_score",width:100,fixed:"right",align:"center",render:e=>n.jsx("strong",{children:e})}]]},[z]);return n.jsxs(c,{vertical:!0,gap:"middle",children:[n.jsxs(c,{align:"center",justify:"space-between",children:[n.jsx(te,{level:5,style:{margin:0},children:"Rekapitulasi Nilai Sikap"}),n.jsxs(b,{children:[n.jsx(y,{style:{width:150},placeholder:"Pilih Semester ...",allowClear:!0,options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],onChange:e=>s(e),virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih kelas ...",allowClear:!0,options:N,onChange:e=>p(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(y,{style:{width:150},placeholder:"Pilih Pelajaran ...",allowClear:!0,options:K,onChange:e=>_(e),showSearch:!0,filterOption:R,virtual:!1}),n.jsx(d,{icon:n.jsx(k,{}),onClick:()=>{if(!z||!z.data||0===z.data.length)return void u.warning("Data belum tersedia");const e=L(),t=F(),i=z.months,l=[["Rekapitulasi Nilai Sikap"],["Kelas",e],["Pelajaran",t],["Semester",a],[]],s=["No","NIS","Nama Siswa"],n=["","",""],r=[];let c=3;i.forEach(e=>{s.push(e),s.push("","",""),n.push("Kinerja","Kedisiplinan","Keaktifan","Percaya Diri"),r.push({s:{r:5,c:c},e:{r:5,c:c+3}}),c+=4}),s.push("Rata - Rata"),n.push(""),r.push({s:{r:5,c:c},e:{r:6,c:c}}),r.push({s:{r:5,c:0},e:{r:6,c:0}}),r.push({s:{r:5,c:1},e:{r:6,c:1}}),r.push({s:{r:5,c:2},e:{r:6,c:2}});const d=z.data.map(e=>{const a=[e.no,e.nis,e.name];return i.forEach(t=>{const i=e.scores[t];i?a.push(i.kinerja,i.kedisiplinan,i.keaktifan,i.percaya_diri):a.push("-","-","-","-")}),a.push(e.final_score),a}),o=[...l,s,n,...d],h=w.aoa_to_sheet(o);h["!merges"]=r,h["!cols"]=[{wch:5},{wch:15},{wch:30}];const m=w.book_new();w.book_append_sheet(m,h,"Nilai Sikap"),j(m,`Sikap_${e}_${t}.xlsx`)},disabled:!z||P||A,children:"Download"})]})]}),r&&x&&a?P||A?n.jsx(c,{justify:"center",style:{padding:50},children:n.jsx(o,{size:"large"})}):n.jsxs(h,{size:"small",variant:"borderless",style:{boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[n.jsxs(m,{bordered:!0,size:"small",layout:"vertical",column:3,style:{marginBottom:16},children:[n.jsx(m.Item,{label:"Semester",children:a}),n.jsx(m.Item,{label:"Kelas",children:L()}),n.jsx(m.Item,{label:"Pelajaran",children:F()})]}),n.jsx(S,{dataSource:z?.data||[],columns:$,rowKey:"no",pagination:!1,bordered:!0,size:"small",scroll:{x:"max-content"},sticky:!0})]}):n.jsx(v,{showIcon:!0,type:"info",description:"Pilih Semester, Kelas, dan Pelajaran untuk menampilkan data nilai sikap."})]})};export{ie as A,Y as D,X as F,ae as P,D as R,G as a,T as b,K as c,N as d,F as e,z as f};
