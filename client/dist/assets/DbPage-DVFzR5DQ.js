import{r as u,bh as M,bi as $,bj as G,bk as Q,bl as B,bm as O,bn as H,j as e,V as T,bo as J,bp as V,bq as U,a as q,f as Y,br as R}from"./index-Bkq01jzn.js";import{L as I}from"./Layout-uGiKgFPI.js";const z=({studentData:i,onRefetch:N})=>{var S;console.log(i);const[a,o]=u.useState({userid:(i==null?void 0:i.userid)||"",entryid:(i==null?void 0:i.entryid)||"",entry_name:(i==null?void 0:i.entry_name)||"",homebaseid:(i==null?void 0:i.homebaseid)||"",homebase_name:(i==null?void 0:i.homebase_name)||"",academic_year:(i==null?void 0:i.academic_year)||"",gender:(i==null?void 0:i.gender)||"",name:(i==null?void 0:i.name)||"",nisn:(i==null?void 0:i.nisn)||"",nis:(i==null?void 0:i.nis)||"",birth_place:(i==null?void 0:i.birth_place)||"",birth_date:i!=null&&i.birth_date?new Date(i.birth_date).toISOString().split("T")[0]:"",order_number:(i==null?void 0:i.order_number)||"",height:(i==null?void 0:i.height)||"",weight:(i==null?void 0:i.weight)||"",head:(i==null?void 0:i.head)||"",provinceid:(i==null?void 0:i.provinceid)||"",province_name:(i==null?void 0:i.province_name)||"",cityid:(i==null?void 0:i.cityid)||"",city_name:(i==null?void 0:i.city_name)||"",districtid:(i==null?void 0:i.districtid)||"",district_name:(i==null?void 0:i.district_name)||"",villageid:((S=i==null?void 0:i.villageid)==null?void 0:S.trim())||"",village_name:(i==null?void 0:i.village_name)||"",postal_code:(i==null?void 0:i.postal_code)||"",address:(i==null?void 0:i.address)||""}),{data:d}=M(),{data:h}=$(),{data:k}=G(),{data:v}=Q(a.provinceid,{skip:!a.provinceid}),{data:m}=B(a.cityid,{skip:!a.cityid}),{data:t}=O(a.districtid,{skip:!a.districtid}),[x,{isLoading:p,isSuccess:f,isError:g,reset:_}]=H(),c=s=>{const{name:j,value:w}=s.target;o(L=>{const r={...L,[j]:w};if(j==="entryid"){const n=d==null?void 0:d.find(y=>y.id===parseInt(w));n&&(r.entryid=n.id,r.entry_name=n.name)}else if(j==="homebaseid"){const n=h==null?void 0:h.find(y=>y.id===w);n&&(r.homebaseid=n.id,r.homebase_name=n.name)}else if(j==="provinceid"){const n=k==null?void 0:k.find(y=>y.id===w);n&&(r.provinceid=n.id,r.province_name=n.name,r.cityid="",r.city_name="",r.districtid="",r.district_name="",r.villageid="",r.village_name="")}else if(j==="cityid"){const n=v==null?void 0:v.find(y=>y.id===w);n&&(r.cityid=n.id,r.city_name=n.name,r.districtid="",r.district_name="",r.villageid="",r.village_name="")}else if(j==="districtid"){const n=m==null?void 0:m.find(y=>y.id===w);n&&(r.districtid=n.id,r.district_name=n.name,r.villageid="",r.village_name="")}else if(j==="villageid"){const n=t==null?void 0:t.find(y=>y.id.trim()===w);n&&(r.villageid=n.id.trim(),r.village_name=n.name)}return r})},E=s=>{s.preventDefault(),T.promise(x(a).unwrap().then(j=>j.message),{loading:"Memproses data...",success:j=>j,error:j=>j.data.message})};return u.useEffect(()=>{f&&(_(),N()),g&&_()},[f,g,_,N]),console.log(i),e.jsx("div",{className:"container mt-3",children:e.jsxs("form",{onSubmit:E,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Tahun Pelajaran",name:"entryid",value:a.entryid,onChange:c,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Tahun Pelajaran"}),d==null?void 0:d.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Satuan Pendidikan",name:"homebaseid",value:a.homebaseid,onChange:c,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Satuan Pendidikan"}),h==null?void 0:h.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{name:"gender",id:"",className:"form-select",value:a.gender,onChange:c,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki-laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Lengkap",name:"name",value:a.name,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"NISN",name:"nisn",value:a.nisn,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"NIS",name:"nis",value:a.nis,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir",name:"birth_place",value:a.birth_place,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",className:"form-control",name:"birth_date",value:a.birth_date,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Urutan Kelahiran",name:"order_number",value:a.order_number,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"TB",name:"height",value:a.height,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"BB",name:"weight",value:a.weight,onChange:c})}),e.jsx("div",{children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Lingkar Kepala",name:"head",value:a.head,onChange:c})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Provinsi",name:"provinceid",value:a.provinceid,onChange:c,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Provinsi"}),k==null?void 0:k.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Kota / Kabupaten",name:"cityid",value:a.cityid,onChange:c,disabled:!a.provinceid,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Kota / Kabupaten"}),v==null?void 0:v.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Kecamatan",name:"districtid",value:a.districtid,onChange:c,disabled:!a.cityid,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Kecamatan"}),m==null?void 0:m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("select",{className:"form-select","aria-label":"Pilih Desa",name:"villageid",value:a.villageid,onChange:c,disabled:!a.districtid,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Desa"}),t==null?void 0:t.map(s=>e.jsx("option",{value:s.id.trim(),children:s.name},s.id))]})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Kode Pos",name:"postal_code",value:a.postal_code,onChange:c})}),e.jsx("div",{className:"mb-3",children:e.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Alamat",name:"address",value:a.address,onChange:c})})]})]}),e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-12 text-end",children:e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",children:"Simpan Data"})})})]})})},W=({studentData:i,userid:N,onRefetch:a})=>{const[o,d]=u.useState({userid:N,father_nik:(i==null?void 0:i.father_nik)||"",father_name:(i==null?void 0:i.father_name)||"",father_birth_place:(i==null?void 0:i.father_birth_place)||"",father_birth_date:i!=null&&i.father_birth_date?new Date(i.father_birth_date).toISOString().split("T")[0]:"",father_job:(i==null?void 0:i.father_job)||"",father_phone:(i==null?void 0:i.father_phone)||"",mother_nik:(i==null?void 0:i.mother_nik)||"",mother_name:(i==null?void 0:i.mother_name)||"",mother_birth_place:(i==null?void 0:i.mother_birth_place)||"",mother_birth_date:i!=null&&i.mother_birth_date?new Date(i.mother_birth_date).toISOString().split("T")[0]:"",mother_job:(i==null?void 0:i.mother_job)||"",mother_phone:(i==null?void 0:i.mother_phone)||""}),[h,{isLoading:k,isSuccess:v,isError:m,reset:t}]=J(),x=f=>{const{name:g,value:_}=f.target;d(c=>({...c,[g]:_}))},p=f=>{f.preventDefault(),T.promise(h(o).unwrap().then(g=>g.message),{loading:"Memproses data...",success:g=>g,error:g=>g.data.message})};return u.useEffect(()=>{v&&(a(),t()),m&&t()},[v,m,t,a]),e.jsx("div",{className:"container mt-3",children:e.jsxs("form",{onSubmit:p,children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"NIK Ayah",name:"father_nik",value:o.father_nik,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Ayah",name:"father_name",value:o.father_name,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir Ayah",name:"father_birth_place",value:o.father_birth_place,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",className:"form-control",name:"father_birth_date",value:o.father_birth_date,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Pekerjaan Ayah",name:"father_job",value:o.father_job,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Tlp Ayah",name:"father_phone",value:o.father_phone,onChange:x})})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"NIK Ibu",name:"mother_nik",value:o.mother_nik,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Ibu",name:"mother_name",value:o.mother_name,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir Ibu",name:"mother_birth_place",value:o.mother_birth_place,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"date",className:"form-control",name:"mother_birth_date",value:o.mother_birth_date,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Pekerjaan Ibu",name:"mother_job",value:o.mother_job,onChange:x})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Tlp Ibu",name:"mother_phone",value:o.mother_phone,onChange:x})})]})]}),e.jsx("div",{className:"row mt-3",children:e.jsx("div",{className:"col-12 text-end",children:e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:k,children:"Simpan Data"})})})]})})},X=({families:i,onRefetch:N,userid:a})=>{const o={id:"",userid:a,name:"",gender:"",birth_date:""},[d,h]=u.useState(o),[k,v]=u.useState(null),[m,t]=u.useState({}),[x,{isLoading:p,isSuccess:f,isError:g,reset:_}]=V(),[c,{isLoadig:E,isSuccess:S,isError:s,reset:j}]=U(),w=()=>{const l={};return d.name.trim()||(l.name="Nama harus diisi"),d.gender||(l.gender="Jenis kelamin harus dipilih"),d.birth_date?new Date(d.birth_date)>new Date&&(l.birth_date="Tanggal lahir tidak boleh lebih dari hari ini"):l.birth_date="Tanggal lahir harus diisi",l},L=l=>{const{name:b,value:C}=l.target;h(P=>({...P,[b]:C})),m[b]&&t(P=>({...P,[b]:""}))},r=l=>{v(l.id),h({id:l.id,userid:l.userid,name:l.name,gender:l.gender,birth_date:new Date(l.birth_date).toISOString().split("T")[0]}),t({})},n=()=>{h(o),v(null),t({})},y=async l=>{l.preventDefault();const b=w();if(Object.keys(b).length>0){t(b);return}T.promise(x(d).unwrap().then(C=>C.message),{loading:"Memproses data...",success:C=>C,error:C=>C.data.message})},A=async l=>{window.confirm("Apakah Anda yakin ingin menghapus data keluarga ini?")&&T.promise(c(l).unwrap().then(b=>b.message),{loading:"Memproses data...",success:b=>b,error:b=>b.data.message})},F=l=>{const b=new Date,C=new Date(l);let P=b.getFullYear()-C.getFullYear();const K=b.getMonth()-C.getMonth();return(K<0||K===0&&b.getDate()<C.getDate())&&P--,P};return u.useEffect(()=>{f&&(_(),N()),g&&_()},[f,g,_,N]),u.useEffect(()=>{S&&(j(),N()),s&&j()},[S,j,N,s]),e.jsx("div",{className:"container mt-3",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-4",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"text",className:`form-control ${m.name?"is-invalid":""}`,placeholder:"Nama Keluarga",name:"name",value:d.name,onChange:L}),m.name&&e.jsx("div",{className:"invalid-feedback",children:m.name})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("select",{className:`form-select ${m.gender?"is-invalid":""}`,name:"gender",value:d.gender,onChange:L,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki Laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]}),m.gender&&e.jsx("div",{className:"invalid-feedback",children:m.gender})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("input",{type:"date",className:`form-control ${m.birth_date?"is-invalid":""}`,name:"birth_date",value:d.birth_date,onChange:L}),m.birth_date&&e.jsx("div",{className:"invalid-feedback",children:m.birth_date})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:n,disabled:p,children:"Batal"}),e.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:p,children:[p?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):null,k?"Update":"Simpan"]})]})]})})})}),e.jsx("div",{className:"col-md-8",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"No"}),e.jsx("th",{children:"Nama"}),e.jsx("th",{children:"Jenis Kelamin"}),e.jsx("th",{children:"Tanggal Lahir"}),e.jsx("th",{children:"Usia"}),e.jsx("th",{children:"Aksi"})]})}),e.jsx("tbody",{children:i==null?void 0:i.map((l,b)=>e.jsxs("tr",{children:[e.jsx("td",{children:b+1}),e.jsx("td",{children:l.name}),e.jsx("td",{children:l.gender==="L"?"Laki Laki":"Perempuan"}),e.jsx("td",{children:new Date(l.birth_date).toLocaleDateString("id-ID")}),e.jsxs("td",{children:[F(l.birth_date)," Tahun"]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>r(l),title:"Edit",children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>A(l.id),title:"Hapus",disabled:E,children:e.jsx("i",{className:"bi bi-trash"})})]})})]},l.id))})]})})})})})]})})},ee=()=>{const i=q(),{name:N,nis:a,periode:o,userid:d}=Y(),[h,k]=u.useState("biodata"),{data:v,isLoading:m,isError:t,refetch:x}=R(d);t&&T.error("Gagal mengambil data siswa");const p=v==null?void 0:v.data,f=c=>{k(c)},g=()=>{i("/database")},_=()=>{x()};return m?e.jsx(I,{title:`Database ${N.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):p?e.jsx(I,{title:`Database ${N.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"row mb-2",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[e.jsxs("span",{className:"badge bg-secondary",children:[e.jsx("i",{className:"bi bi-calendar me-1"}),p.periode_name]}),e.jsxs("span",{className:"badge bg-primary",children:[p.grade_name," ",p.class_name]}),e.jsxs("span",{className:"badge bg-info",children:[e.jsx("i",{className:"bi bi-person me-1"}),p.student_gender]}),e.jsxs("span",{className:"badge bg-success",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),p.isactive?"Aktif":"Tidak Aktif"]})]}),e.jsxs("button",{className:"btn btn-sm btn-info",onClick:g,children:[e.jsx("i",{className:"bi bi-arrow-left"})," Kembali"]})]})})})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("ul",{className:"nav nav-tabs nav-fill mb-3",children:[e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${h==="biodata"?"active":""}`,onClick:()=>f("biodata"),children:[e.jsx("i",{className:"bi bi-person me-2"}),"Biodata"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${h==="parent"?"active":""}`,onClick:()=>f("parent"),children:[e.jsx("i",{className:"bi bi-people me-2"}),"Orang Tua"]})}),e.jsx("li",{className:"nav-item",children:e.jsxs("button",{className:`nav-link ${h==="family"?"active":""}`,onClick:()=>f("family"),children:[e.jsx("i",{className:"bi bi-person-lines-fill me-2"}),"Keluarga"]})})]}),e.jsxs("div",{className:"tab-content",children:[h==="biodata"&&e.jsx(z,{studentData:p,onRefetch:_}),h==="parent"&&e.jsx(W,{studentData:p,userid:p.userid,onRefetch:_}),h==="family"&&e.jsx(X,{families:p.family,userid:p.userid,onRefetch:_})]})]})})})})]})}):e.jsx(I,{title:`Database ${N.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:e.jsx("div",{className:"alert alert-danger text-center",children:"Data siswa tidak ditemukan"})})};export{ee as default};
