import{d as w,r as m,X as L,Y as M,j as e,e as C,a as P,Z as E,_ as T}from"./index-B88h2kYZ.js";import{S as y}from"./react-select.esm-DTmrgZuA.js";import{T as _}from"./Table-BvY52Fag.js";const $=({detail:c,setDetail:u})=>{var N;const{user:s}=w(a=>a.auth),[r,i]=m.useState({id:"",teacher:(s==null?void 0:s.id)||null,subject:null,btype:"",name:""}),{data:d}=L(),[f,{isSuccess:x,isLoading:k,isError:g,reset:o}]=M(),h=d==null?void 0:d.map(a=>({value:a.id,label:a.name,subjects:a.subjects})),j=d==null?void 0:d.find(a=>a.id===r.teacher),b=((N=j==null?void 0:j.subjects)==null?void 0:N.map(a=>({value:a.id,label:a.name})))||[],v=a=>{i(t=>({...t,teacher:(a==null?void 0:a.value)||null,subject:null}))},S=a=>{i(t=>({...t,subject:(a==null?void 0:a.value)||null}))},p=a=>{const{name:t,value:B}=a.target;i(D=>({...D,[t]:B}))},n=a=>{a.preventDefault(),C.promise(f(r).unwrap().then(t=>t.message),{loading:"Memproses...",success:t=>t,error:t=>t.data.message})},l=()=>{u({}),i({id:"",teacher:(s==null?void 0:s.id)||null,subject:null,btype:"",name:""})};return m.useEffect(()=>{(x||g)&&(i({id:"",teacher:(s==null?void 0:s.id)||null,btype:"",subject:null,name:""}),o())},[x,g,s]),m.useEffect(()=>{c&&i({id:c.id,teacher:c.teacher||(s==null?void 0:s.id)||null,subject:c.subject,name:c.name,btype:c.btype})},[c,s]),e.jsxs("form",{onSubmit:n,className:"bg-white p-2 rounded d-flex flex-column gap-2 border",children:[e.jsx("p",{className:"m-0 h6",children:"Bank Soal"}),e.jsx(y,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(h==null?void 0:h.find(a=>a.value===r.teacher))||null,options:h,onChange:v}),e.jsx(y,{isClearable:!0,isSearchable:!0,placeholder:"Pilih Mata Pelajaran",value:(b==null?void 0:b.find(a=>a.value===r.subject))||null,options:b,onChange:S,isDisabled:!r.teacher}),e.jsxs("select",{name:"btype",id:"btype",className:"form-select",value:r.btype,onChange:p,children:[e.jsx("option",{value:"",hidden:!0,children:"Jenis Bank Soal"}),e.jsx("option",{value:"bank",children:"Bank"}),e.jsx("option",{value:"paket",children:"Paket"})]}),e.jsx("input",{name:"name",className:"form-control",placeholder:"Nama Bank Soal",value:r.name,onChange:p}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:l,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",children:"Simpan"})]})]})},F=({setDetail:c})=>{const u=P(),[s,r]=m.useState(1),[i,d]=m.useState(10),[f,x]=m.useState(""),{data:k={},isLoading:g}=E({page:s,limit:i,search:f}),{banks:o=[],totalData:h,totalPages:j}=k,[b,{isLoading:v}]=T(),S=n=>{C.promise(b(n).unwrap().then(l=>l.message),{loading:"Memproses...",success:l=>l,error:l=>l.data.message})},p=(n,l,N)=>{const a=l.replace(/[\s/]/g,"-"),t=n.replace(/[\s/]/g,"-");u(`/admin-cbt-bank/${t}/${a}/${N}`)};return e.jsx(_,{page:s,setPage:r,setLimit:d,setSearch:x,totalData:h,totalPages:j,isLoading:g,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover m-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Guru"}),e.jsx("th",{className:"text-center",children:"Mata Pelajaran"}),e.jsx("th",{className:"text-center",children:"Bank Soal"}),e.jsx("th",{className:"text-center",children:"Jenis"}),e.jsx("th",{className:"text-center",children:"Soal"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(o==null?void 0:o.length)>0?o==null?void 0:o.map((n,l)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(s-1)*i+l+1}),e.jsx("td",{className:"align-middle",children:n.teacher_name}),e.jsx("td",{className:"align-middle",children:n.subject_name}),e.jsx("td",{className:"align-middle",children:n.name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-success",children:n.btype.toUpperCase()})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-secondary",children:`${n.question_count} Soal`})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>p(n.subject_name,n.name,n.id),children:e.jsx("i",{className:"bi bi-folder-fill"})}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>c(n),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:v,onClick:()=>S(n.id),children:e.jsx("i",{className:"bi bi-folder-minus"})})]})})]},l)):e.jsx("tr",{children:e.jsx("td",{colSpan:7,children:"Data belum tersedia"})})})]})})},H=()=>{const[c,u]=m.useState("");return e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx($,{detail:c,setDetail:u})}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsx(F,{setDetail:u})})]})};export{H as C};
