import{ad as e,a4 as s,as as a,j as t,e as l,at as n,au as i,av as d,aw as r,ax as c,V as m,ab as o,ay as u}from"./index-DFhdulld.js";import{b as x}from"./vendor-CnnDPxwB.js";import{L as h}from"./Layout-GZnRoUIy.js";import{T as j}from"./Table-CpyGbvYh.js";import{r as g,u as b}from"./xlsx-B4fPQ8kA.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const p=({detail:n,setDetail:i})=>{const[d,r]=x.useState(""),[c,m]=x.useState(""),[o,u]=x.useState(""),[h,j]=x.useState(""),{data:g}=e({page:"",limit:"",search:""}),{data:b}=s({page:"",limit:"",search:""}),[p,{isSuccess:N,isLoading:f,error:v,reset:S}]=a();return x.useEffect((()=>{N&&(S(),m(""),r(""),u(""),j("")),v&&S()}),[N,v]),x.useEffect((()=>{n&&(r(n.id),m(n.name),u(n.grade),j(n.major))}),[n]),t.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={id:d,name:c,gradeId:o,majorId:h};l.promise(p(s).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},className:"bg-white rounded border d-flex flex-column gap-2 p-2",children:[t.jsx("p",{className:"m-0 h6",children:"Kelas"}),(null==b?void 0:b.length)>0&&t.jsxs("select",{className:"form-select",value:h||"",onChange:e=>j(e.target.value),children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Jurusan"}),null==b?void 0:b.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsxs("select",{className:"form-select",value:o||"",onChange:e=>u(e.target.value),required:!0,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Tingkat"}),null==g?void 0:g.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsx("input",{type:"text",name:"class",id:"class",className:"form-control",placeholder:"Nama Kelas",value:c||"",onChange:e=>m(e.target.value),required:!0}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{i({}),r(""),m(""),u("")},children:"Batal"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:f,children:"Simpan"})]})]})},N=({classid:e})=>{const[s,a]=x.useState(""),[i,{isSuccess:d,isLoading:r,isError:c,reset:m}]=n();return x.useEffect((()=>{d&&(m(),a("")),c&&(m(),a(""))}),[d,c]),t.jsxs("form",{onSubmit:a=>{a.preventDefault();const t={nis:s,classid:e};l.promise(i(t).unwrap().then((e=>e.message)),{loading:"Meyimpan data...",success:e=>e,error:e=>e.data.message})},className:"d-flex align-items-center gap-2",children:[t.jsx("input",{type:"text",name:"nis",id:"nis",className:"form-control",placeholder:"NIS",required:!0,value:s||"",onChange:e=>a(e.target.value)}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-outline-primary",disabled:r,children:"Simpan"})]})},f=({classid:e})=>{const[s,a]=x.useState(null),n=x.useRef(null),[d,{isSuccess:r,isLoading:c,isError:m,reset:o}]=i();return x.useEffect((()=>{r&&(o(),n.current.value=null),m&&(o(),n.current.value=null)}),[r,m]),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("input",{ref:n,type:"file",name:"file",id:"file",className:"form-control",onChange:e=>a(e.target.files[0])}),t.jsx("button",{className:"btn btn-sm btn-outline-primary",disabled:c,onClick:a=>{if(a.preventDefault(),s){const a=new FileReader;a.onload=s=>{const a=new Uint8Array(s.target.result),t=g(a,{type:"array"}),n=t.SheetNames[0],i=t.Sheets[n],r={students:b.sheet_to_json(i,{header:1,range:1}).map((e=>{const[s,a]=e;return[s,a]})).filter((e=>e.every((e=>null!=e)))),classid:e};l.promise(d(r).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},a.readAsArrayBuffer(s)}},children:"Upload"})]})},v=({detail:e})=>{const[s,a]=x.useState(1),[l,n]=x.useState(10),[i,o]=x.useState(""),u=e.id,{data:h={},refetch:g}=d({page:s,limit:l,search:i,classid:u},{skip:!u}),{totalData:b,totalPages:p,students:v=[]}=h,[S,{isSuccess:y,isLoading:k,isError:w,reset:L}]=r(),[C,{isSuccess:D,isLoading:E,isError:_,reset:P}]=c();return x.useEffect((()=>{(y||w)&&L()}),[y,w]),x.useEffect((()=>{(D||_)&&P()}),[D,_]),t.jsx("div",{className:"modal fade",id:"modal-add","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:["Kelas ",t.jsx("span",{children:null==e?void 0:e.name})]}),t.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body bg-light d-flex flex-column gap-2",children:[t.jsxs("div",{className:"row g-2",children:[t.jsx("div",{className:"col-lg-6 col-12",children:t.jsx(N,{classid:e.id})}),t.jsx("div",{className:"col-lg-6 col-12",children:t.jsx(f,{classid:e.id})})]}),t.jsx(j,{page:s,setPage:a,setLimit:n,setSearch:o,totalData:b,totalPages:p,children:t.jsxs("table",{className:"mb-0 table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Jurusan"}),t.jsx("th",{className:"text-center",children:"Tingkat"}),t.jsx("th",{className:"text-center",children:"NIS"}),t.jsx("th",{className:"text-center",children:"Nama"}),t.jsx("th",{className:"text-center",children:"Status"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:(null==v?void 0:v.length)>0?null==v?void 0:v.map(((e,a)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(s-1)*l+a+1}),t.jsx("td",{className:"text-center align-middle",children:e.major_name}),t.jsx("td",{className:"text-center align-middle",children:e.grade_name}),t.jsx("td",{className:"text-center align-middle",children:e.nis}),t.jsx("td",{className:"align-middle",children:e.student_name}),t.jsx("td",{className:"text-center align-middle",children:e.isactive?t.jsx("span",{className:"badge bg-primary",children:"Aktif"}):t.jsx("span",{className:"badge bg-success",children:"Lulus"})}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("button",{className:"btn btn-sm btn-danger",disabled:k,onClick:()=>{return s=e.id,void m.promise(S(s).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var s},children:[t.jsx("i",{className:"bi bi-person-dash"}),t.jsx("span",{className:"ms-2",children:"Hapus"})]})})]},a))):t.jsx("tr",{children:t.jsx("td",{colSpan:7,children:"Data tidak tersedia"})})})]})})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_kelas_siswa.xlsx","_blank")},children:"Template"}),t.jsx("button",{className:"btn btn-sm btn-success",disabled:E,onClick:()=>{m.promise(C(u).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},children:"Luluskan"})]})]})})})},S=({setDetail:e})=>{const[s,a]=x.useState(1),[n,i]=x.useState(10),[d,r]=x.useState(""),[c,m]=x.useState({}),{data:h={},isLoading:g}=o({page:s,limit:n,search:d}),{classes:b=[],totalData:p,totalPages:N}=h,[f,{isSuccess:S,isLoading:y,error:k,reset:w}]=u();return x.useEffect((()=>{S&&w(),k&&w()}),[S,k]),t.jsxs(j,{page:s,setPage:a,setLimit:i,setSearch:r,totalData:p,totalPages:N,isLoading:g,children:[t.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Jurusan"}),t.jsx("th",{className:"text-center",children:"Tingkat"}),t.jsx("th",{className:"text-center",children:"Nama Kelas"}),t.jsx("th",{className:"text-center",children:"Siswa"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:null==b?void 0:b.map(((a,i)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(s-1)*n+i+1}),t.jsx("td",{className:"align-middle",children:a.major_name}),t.jsx("td",{className:"text-center align-middle",children:a.grade_name}),t.jsx("td",{className:"text-center align-middle",children:a.name}),t.jsx("td",{className:"text-center align-middle",children:a.students}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#modal-add",onClick:()=>m(a),children:t.jsx("i",{className:"bi bi-folder-plus"})}),t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(a),children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",disabled:y,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus data kelas ini dan semua data yang terkait dengan kelas ini?")&&l.promise(f(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:t.jsx("i",{className:"bi bi-folder-minus"})})]})})]},i)))})]}),t.jsx(v,{detail:c})]})},y=()=>{const[e,s]=x.useState("");return t.jsx(h,{title:"Kelas",levels:["admin"],children:t.jsxs("div",{className:"row g-2",children:[t.jsx("div",{className:"col-lg-3 col-12",children:t.jsx(p,{detail:e,setDetail:s})}),t.jsx("div",{className:"col-lg-9 col-12",children:t.jsx(S,{setDetail:s})})]})})};export{y as default};
//# sourceMappingURL=AdminClass-DdhSlRB6.js.map
