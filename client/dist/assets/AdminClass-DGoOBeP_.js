import{r as n,A as M,q as A,M as E,j as e,d as k,N as _,O as I,P as G,Q as P,V as T,G as q,R as B}from"./index-Bk0R0AbM.js";import{L as K}from"./Layout-DtCUdCMC.js";import{T as D}from"./Table-ojIeP2TN.js";import{r as Q,u as R}from"./xlsx-BPPrXeCd.js";const H=({detail:t,setDetail:l})=>{const x="",r="",g="",[p,j]=n.useState(""),[u,h]=n.useState(""),[b,i]=n.useState(""),[d,o]=n.useState(""),{data:N}=M({page:x,limit:r,search:g}),{data:m}=A({page:x,limit:r,search:g}),[S,{isSuccess:f,isLoading:w,error:v,reset:y}]=E(),s=c=>{c.preventDefault();const L={id:p,name:u,gradeId:b,majorId:d};k.promise(S(L).unwrap().then(C=>C.message),{loading:"Menyimpan data...",success:C=>C,error:C=>C.data.message})},a=()=>{l({}),j(""),h(""),i("")};return n.useEffect(()=>{f&&(y(),h(""),j(""),i(""),o("")),v&&y()},[f,v]),n.useEffect(()=>{t&&(j(t.id),h(t.name),i(t.grade),o(t.major))},[t]),e.jsxs("form",{onSubmit:s,className:"bg-white rounded border d-flex flex-column gap-2 p-2",children:[e.jsx("p",{className:"m-0 h6",children:"Kelas"}),(m==null?void 0:m.length)>0&&e.jsxs("select",{className:"form-select",value:d||"",onChange:c=>o(c.target.value),children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Jurusan"}),m==null?void 0:m.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsxs("select",{className:"form-select",value:b||"",onChange:c=>i(c.target.value),required:!0,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Tingkat"}),N==null?void 0:N.map(c=>e.jsx("option",{value:c.id,children:c.name},c.id))]}),e.jsx("input",{type:"text",name:"class",id:"class",className:"form-control",placeholder:"Nama Kelas",value:u||"",onChange:c=>h(c.target.value),required:!0}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:a,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:w,children:"Simpan"})]})]})},U=({classid:t})=>{const[l,x]=n.useState(""),[r,{isSuccess:g,isLoading:p,isError:j,reset:u}]=_(),h=b=>{b.preventDefault();const i={nis:l,classid:t};k.promise(r(i).unwrap().then(d=>d.message),{loading:"Meyimpan data...",success:d=>d,error:d=>d.data.message})};return n.useEffect(()=>{g&&(u(),x("")),j&&(u(),x(""))},[g,j]),e.jsxs("form",{onSubmit:h,className:"d-flex gap-2",children:[e.jsx("input",{type:"text",name:"nis",id:"nis",className:"form-control shadow",placeholder:"NIS",required:!0,value:l||"",onChange:b=>x(b.target.value)}),e.jsx("button",{type:"submit",className:"btn btn-success shadow",disabled:p,children:"Simpan"})]})},F=({classid:t})=>{const[l,x]=n.useState(null),r=n.useRef(null),[g,{isSuccess:p,isLoading:j,isError:u,reset:h}]=I(),b=i=>{if(i.preventDefault(),l){const d=new FileReader;d.onload=o=>{const N=new Uint8Array(o.target.result),m=Q(N,{type:"array"}),S=m.SheetNames[0],f=m.Sheets[S],y={students:R.sheet_to_json(f,{header:1,range:1}).map(s=>{const[a,c]=s;return[a,c]}).filter(s=>s.every(a=>a!=null)),classid:t};k.promise(g(y).unwrap().then(s=>s.message),{loading:"Menyimpan data...",success:s=>s,error:s=>s.data.message})},d.readAsArrayBuffer(l)}};return n.useEffect(()=>{p&&(h(),r.current.value=null),u&&(h(),r.current.value=null)},[p,u]),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("input",{ref:r,type:"file",name:"file",id:"file",className:"form-control shadow",onChange:i=>x(i.target.files[0])}),e.jsx("button",{className:"btn btn-sm btn-success shadow",disabled:j,onClick:b,children:"Upload"})]})},J=({detail:t})=>{const[l,x]=n.useState(1),[r,g]=n.useState(10),[p,j]=n.useState(""),u=t.id,{data:h={},refetch:b}=G({page:l,limit:r,search:p,classid:u},{skip:!u}),{totalData:i,totalPages:d,students:o=[]}=h,[N,{isSuccess:m,isLoading:S,isError:f,reset:w}]=P(),v=s=>{T.promise(N(s).unwrap().then(a=>a.message),{loading:"Memproses...",success:a=>a,error:a=>a.data.message})},y=()=>{window.open("/temp/template_kelas_siswa.xlsx","_blank")};return n.useEffect(()=>{(m||f)&&w()},[m,f]),e.jsx("div",{className:"modal fade",id:"modal-add","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:["Kelas ",e.jsx("span",{children:t==null?void 0:t.name})]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body bg-light d-flex flex-column gap-2",children:[e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-6 col-12",children:e.jsx(U,{classid:t.id})}),e.jsx("div",{className:"col-lg-6 col-12",children:e.jsx(F,{classid:t.id})})]}),e.jsx(D,{page:l,setPage:x,setLimit:g,setSearch:j,totalData:i,totalPages:d,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Jurusan"}),e.jsx("th",{className:"text-center",children:"Tingkat"}),e.jsx("th",{className:"text-center",children:"NIS"}),e.jsx("th",{className:"text-center",children:"Nama"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(o==null?void 0:o.length)>0?o==null?void 0:o.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(l-1)*r+a+1}),e.jsx("td",{className:"text-center align-middle",children:s.major_name}),e.jsx("td",{className:"text-center align-middle",children:s.grade_name}),e.jsx("td",{className:"text-center align-middle",children:s.nis}),e.jsx("td",{className:"align-middle",children:s.student_name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-danger",disabled:S,onClick:()=>v(s.id),children:e.jsx("i",{className:"bi bi-person-dash"})})})]},a)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Data tidak tersedia"})})})]})})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:y,children:"Template"}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:b,children:"SYNC"})]})]})})})},V=({setDetail:t})=>{const[l,x]=n.useState(1),[r,g]=n.useState(10),[p,j]=n.useState(""),[u,h]=n.useState({}),{data:b={},isLoading:i}=q({page:l,limit:r,search:p}),{classes:d=[],totalData:o,totalPages:N}=b,[m,{isSuccess:S,isLoading:f,error:w,reset:v}]=B(),y=s=>{k.promise(m(s).unwrap().then(a=>a.message),{loading:"Memproses...",success:a=>a,error:a=>a.data.message})};return n.useEffect(()=>{S&&v(),w&&v()},[S,w]),e.jsxs(D,{page:l,setPage:x,setLimit:g,setSearch:j,totalData:o,totalPages:N,isLoading:i,children:[e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Jurusan"}),e.jsx("th",{className:"text-center",children:"Tingkat"}),e.jsx("th",{className:"text-center",children:"Nama Kelas"}),e.jsx("th",{className:"text-center",children:"Siswa"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:d==null?void 0:d.map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(l-1)*r+a+1}),e.jsx("td",{className:"align-middle",children:s.major_name}),e.jsx("td",{className:"text-center align-middle",children:s.grade_name}),e.jsx("td",{className:"text-center align-middle",children:s.name}),e.jsx("td",{className:"text-center align-middle",children:s.students}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#modal-add",onClick:()=>h(s),children:e.jsx("i",{className:"bi bi-folder-plus"})}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>t(s),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:f,onClick:()=>y(s.id),children:e.jsx("i",{className:"bi bi-folder-minus"})})]})})]},a))})]}),e.jsx(J,{detail:u})]})},X=()=>{const[t,l]=n.useState("");return e.jsx(K,{title:"Kelas",levels:["admin"],children:e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-3 col-12",children:e.jsx(H,{detail:t,setDetail:l})}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsx(V,{setDetail:l})})]})})};export{X as default};
