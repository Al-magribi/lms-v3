import{Z as e,a7 as a,a8 as s,j as t,V as n,a9 as l,d as r,aa as i,ab as c}from"./index-CNbAajcm.js";import{b as d}from"./vendor-BYWiIb5-.js";import{L as m}from"./Layout-_SAc74nU.js";import{S as o}from"./react-select.esm-4h58l94a.js";import{r as u,u as h}from"./xlsx-B4fPQ8kA.js";import{T as x}from"./Table-BSwODE4h.js";import"./index-C-OX0RB-.js";import"./index-DLmIb9aI.js";const j=({detail:l,setDetail:r})=>{const[i,c]=d.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:m}=e({page:"",limit:"",search:""}),{data:u}=a({page:"",limit:"",search:""}),[h,{isSuccess:x,isLoading:j,isError:p,reset:g}]=s(),b=e=>{const{name:a,value:s,type:t,checked:n}=e.target;c((e=>({...e,[a]:"checkbox"===t?n:s})))},N=()=>{r({}),c({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};d.useEffect((()=>{x&&(g(),N()),p&&g()}),[x,p]),d.useEffect((()=>{var e;l&&c({id:l.id||"",username:l.username||"",name:l.name||"",homeroom:l.homeroom||!1,classid:l.class||"",gender:l.gender||"",subjects:(null==(e=l.subjects)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})}),[l]);const f=(null==u?void 0:u.map((e=>({value:e.id,label:e.name}))))||[];return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!i.name||!i.username)return n.error("Lengkapi data");n.promise(h(i).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"rounded bg-white p-2 border d-flex flex-column gap-2",children:[t.jsx("p",{className:"m-0 h6",children:"Guru"}),t.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:i.username,onChange:b}),t.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:i.name,onChange:b}),t.jsxs("select",{name:"gender",className:"form-select",value:i.gender,onChange:b,children:[t.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),t.jsx("option",{value:"L",children:"Laki Laki"}),t.jsx("option",{value:"P",children:"Perempuan"})]}),t.jsx(o,{isMulti:!0,options:f,value:i.subjects,onChange:e=>{c((a=>({...a,subjects:e||[]})))},className:"mb-2",placeholder:"Mata Pelajaran"}),t.jsxs("div",{className:"form-check",children:[t.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:i.homeroom,onChange:b}),t.jsx("label",{className:"form-check-label",children:"Wali Kelas"})]}),i.homeroom&&t.jsxs("select",{name:"classid",className:"form-select",value:i.classid,onChange:b,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),null==m?void 0:m.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:N,children:"Batal"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:j,children:"Simpan"})]})]})},p=()=>{const[e,a]=d.useState(null),s=d.useRef(null),[n,{isSuccess:i,isLoading:c,isError:m,reset:o}]=l();return d.useEffect((()=>{i&&(s.current.value=null,o()),m&&(o(),s.current.value=null)}),[i,m]),t.jsxs("form",{onSubmit:a=>{if(a.preventDefault(),e){const a=new FileReader;a.onload=e=>{const a=new Uint8Array(e.target.result),s=u(a,{type:"array"}),t=s.SheetNames[0],l=s.Sheets[t],i=h.sheet_to_json(l,{header:1,range:1}).map((e=>{const[a,s,t]=e;return[a,s,t]})).filter((e=>e.every((e=>null!=e)))),c=Array.isArray(i)?i:[i];r.promise(n(c).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},a.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[t.jsx("p",{className:"m-0 h6",children:"Upload Guru"}),t.jsx("input",{ref:s,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>a(e.target.files[0])}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_guru.xlsx","_blank")},children:"Template"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:c,children:"Upload Data"})]})]})},g=({setDetail:e})=>{const[a,s]=d.useState(1),[l,r]=d.useState(10),[m,o]=d.useState(""),{data:u={},isLoading:h}=i({page:a,limit:l,search:m}),{teachers:j=[],totalData:p,totalPages:g}=u,[b,{isSuccess:N,isLoading:f,isError:v,reset:y}]=c();return d.useEffect((()=>{N&&y(),v&&y()}),[N,v]),t.jsx(x,{page:a,setPage:s,setLimit:r,setSearch:o,totalData:p,totalPages:g,isLoading:h,children:t.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Satuan"}),t.jsx("th",{className:"text-center",children:"Username"}),t.jsx("th",{className:"text-center",children:"Nama"}),t.jsx("th",{className:"text-center",children:"Jenis Kelamin"}),t.jsx("th",{className:"text-center",children:"Mata Pelajaran"}),t.jsx("th",{className:"text-center",children:"Wali Kelas"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:(null==j?void 0:j.length)>0?null==j?void 0:j.map(((s,r)=>{var i;return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(a-1)*l+r+1}),t.jsx("td",{className:"text-center align-middle",children:s.homebase}),t.jsx("td",{className:"text-center align-middle",children:s.username}),t.jsx("td",{className:"align-middle",children:s.name}),t.jsx("td",{className:"text-center align-middle",children:"L"==s.gender?"Laki Laki":"Perempuan"}),t.jsx("td",{className:"align-middle",children:null==(i=s.subjects)?void 0:i.map((e=>t.jsx("p",{className:"m-0",children:e.name},e.id)))}),t.jsx("td",{className:"text-center align-middle",children:s.homeroom?s.class_name:"-"}),t.jsx("td",{className:"text-cente align-middle",children:t.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(s),children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",disabled:f,onClick:()=>{return e=s.id,void(window.confirm("Apakah anda yakin ingin menghapus data guru ini dan semua data yang terkait dengan guru ini?")&&n.promise(b(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:t.jsx("i",{className:"bi bi-folder-minus"})})]})})]},r)})):t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"",children:"Data Belum tersedia"})})})]})})},b=()=>{const[e,a]=d.useState({});return t.jsx(m,{title:"Guru",levels:["admin"],children:t.jsxs("div",{className:"row g-2",children:[t.jsxs("div",{className:"col-lg-3 col-12",children:[t.jsx(j,{detail:e,setDetail:a}),t.jsx(p,{})]}),t.jsx("div",{className:"col-lg-9 col-12",children:t.jsx(g,{setDetail:a})})]})})};export{b as default};
//# sourceMappingURL=AdminTeachers-BgFRzBVu.js.map
