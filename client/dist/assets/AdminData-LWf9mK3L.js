import{z as e,A as a,E as s,G as t,H as i,s as n,j as r,l,J as d,m as o,n as c,I as m,F as u,t as p,K as g,N as h,O as x,P as j,Q as k,U as y,V as f,W as S,X as b,Y as C,B as w,Z as T,_ as v,$ as F,a0 as E,h as I,y as A}from"./index-DQzW7PZe.js";import{c as L}from"./vendor-BcjG7WjF.js";import{A as D}from"./Add-C7-bik8Z.js";import{T as N}from"./TableLayout-B4uFNFKv.js";import{S as O}from"./index-hpJ9gJA_.js";import{D as K,F as P}from"./Table-BMframHx.js";import{C as z,S as H}from"./Cancel-CGTn8B39.js";import{S as M}from"./Pagination-DC8rVK_V.js";import{S as J}from"./index-Da7kcvRt.js";import{R as _}from"./SaveOutlined-ULDwMm9Z.js";import{R as B}from"./DeleteOutlined-BIucr4kP.js";import{U}from"./Upload-csM8L9cf.js";import{r as R,u as V}from"./xlsx-C5xT2hrF.js";import{A as G}from"./index-CRpkii3Z.js";import{U as q,R as Y}from"./InboxOutlined-B-12CQpF.js";import{R as $}from"./FileExcelOutlined-DgsMScUO.js";import{R as W}from"./CloseCircleOutlined-BhRZVOGl.js";import"./DownloadOutlined-pTdnCz2M.js";import"./progress-DUuXvQKb.js";const Q=({onEdit:l})=>{const[d,o]=L.useState(1),[c,m]=L.useState(10),[u,p]=L.useState(""),{data:g,isLoading:h}=e({page:d,limit:c,search:u}),[x,{data:j,isLoading:k,isSuccess:y,error:f}]=a(),[S,{data:b,isLoading:C,isSuccess:w,error:T}]=s(),{refetch:v}=t({page:d,limit:c,search:u}),{refetch:F}=i({page:d,limit:c,search:u}),E=(e,{key:a})=>{switch(a){case"edit":(e=>{l(e)})(e);break;case"delete":s=e.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?S(s):n.warning("Aksi dibatalkan")}var s};L.useEffect(()=>{w&&n.success(b.message),T&&n.error(T.data.message)},[b,w,T]),L.useEffect(()=>{y&&(v(),F(),n.success(j.message)),f&&n.error(f.data.message)},[y,f,j]);const I=[{title:"_id",dataIndex:"id",key:"id"},{title:"Periode",dataIndex:"name",key:"name"},{title:"Status",dataIndex:"isactive",key:"isactive",render:(e,a)=>r.jsx(O,{checked:e,checkedChildren:"Aktif",unCheckedChildren:"Non-aktif",onChange:()=>{return e=a.id,void x(e);var e}})},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>E(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(N,{onSearch:e=>{p(e),o(1)},isLoading:h||k||C,columns:I,source:g?.periodes,rowKey:"id",page:d,limit:c,totalData:g?.totalData,onChange:e=>{o(e.current),m(e.pageSize)},children:"TableData"})},X=({title:e,open:a,setOpen:s,periode:t,setPeriode:i})=>{const[u]=l.useForm(),[p,{isLoading:g,data:h,isSuccess:x,error:j}]=d(),k=()=>{s(!1),i(),u.resetFields()};return L.useEffect(()=>{a&&(u.resetFields(),t?u.setFieldsValue({name:t.name}):u.resetFields())},[t,a]),L.useEffect(()=>{x&&(n.success(h.message),k()),j&&n.error(j.data.message)},[h,x,j]),r.jsx(o,{open:a,title:e,destroyOnHidden:!0,onCancel:k,style:{top:20},footer:[r.jsx(z,{onClick:k},"cancel"),r.jsx(H,{onClick:()=>u.submit()},"add")],children:r.jsx(c,{spinning:g,tip:"Memuat data...",children:r.jsx(l,{form:u,onFinish:e=>{if(t){const a={...e,id:t.id};p(a)}else u.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Periode",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(m,{placeholder:"Nama Periode"})})})})})},{Title:Z}=p,ee=()=>{const[e,a]=L.useState(!1),[s,t]=L.useState(!1),[i,n]=L.useState({});return r.jsxs(u,{vertical:!0,gap:"middle",children:[r.jsxs(u,{align:"center",justify:"space-between",children:[r.jsx(Z,{style:{margin:0},level:5,children:"Mangement Periode"}),r.jsx(D,{onClick:()=>a(!0)})]}),r.jsx(Q,{onEdit:e=>{n(e),a(!0),t(!0)}}),r.jsx(X,{open:e,title:s?"Edit Periode":"Tambah Periode",periode:i,setPeriode:()=>n({}),setOpen:()=>a(!1)})]})},ae=({onEdit:e})=>{const[a,s]=L.useState(1),[t,i]=L.useState(10),[l,d]=L.useState(""),{data:o,isLoading:c}=g({page:a,limit:t,search:l}),[m,{data:u,isLoading:p,isSuccess:x,error:j,reset:k}]=h(),y=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"delete":t=a.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?m(t):n.warning("Aksi dibatalkan")}var t};L.useEffect(()=>{x&&(n.success(u.message),k()),j&&(n.error(j.data.message),k())},[u,x,j]);const f=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Jurusan",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>y(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(N,{onSearch:e=>{d(e),s(1)},isLoading:c||p,columns:f,source:o?.majors,rowKey:"id",page:a,limit:t,totalData:o?.totalData,onChange:e=>{s(e.current),i(e.pageSize)},children:"TableData"})},se=({title:e,open:a,setOpen:s,major:t,setMajor:i})=>{const[d]=l.useForm(),[u,{isLoading:p,isSuccess:g,error:h,data:j}]=x(),k=()=>{s(!1),i(),d.resetFields()};return L.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name}):d.resetFields())},[t,a]),L.useEffect(()=>{g&&(n.success(j.message),k()),h&&n.error(h.data.message)},[j,g,h]),r.jsx(o,{open:a,title:e,destroyOnHidden:!0,onCancel:k,style:{top:20},footer:[r.jsx(z,{onClick:k},"cancel"),r.jsx(H,{onClick:()=>d.submit()},"add")],children:r.jsx(c,{spinning:p,tip:"Memuat data...",children:r.jsx(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};u(a)}else d.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Jurusan",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(m,{placeholder:"Nama Jurusan"})})})})})},{Title:te}=p,ie=()=>{const[e,a]=L.useState(!1),[s,t]=L.useState(!1),[i,n]=L.useState({});return r.jsxs(u,{vertical:!0,gap:"middle",children:[r.jsxs(u,{align:"center",justify:"space-between",children:[r.jsx(te,{style:{margin:0},level:5,children:"Management Jurusan"}),r.jsx(D,{onClick:()=>a(!0)})]}),r.jsx(ae,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(se,{title:s?"Edit Jurusan":"Tambah Jurusan",open:e,setOpen:()=>a(!1),major:i,setMajor:()=>n({})})]})},ne=({title:e,open:a,setOpen:s,grade:t,setGrade:i})=>{const[d]=l.useForm(),[u,{isLoading:p,isSuccess:g,error:h,data:x}]=j(),k=()=>{s(!1),i(),d.resetFields()};return L.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name}):d.resetFields())},[t,a]),L.useEffect(()=>{g&&(n.success(x.message),k()),h&&n.error(h.data.message)},[x,g,h]),r.jsx(o,{open:a,title:e,destroyOnHidden:!0,onCancel:k,style:{top:20},footer:[r.jsx(z,{onClick:k},"cancel"),r.jsx(H,{onClick:()=>d.submit()},"add")],children:r.jsx(c,{spinning:p,tip:"Memuat data...",children:r.jsx(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};u(a)}else d.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Tingkat",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(m,{type:"number",placeholder:"Nama Tingkat"})})})})})},re=({onEdit:e})=>{const[a,s]=L.useState(1),[t,i]=L.useState(10),[l,d]=L.useState(""),{data:o,isLoading:c}=k({page:a,limit:t,search:l}),[m,{data:u,isLoading:p,isSuccess:g,error:h}]=y(),x=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"delete":t=a.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?m(t):n.warning("Aksi dibatalkan")}var t};L.useEffect(()=>{g&&n.success(u.message),h&&n.error(h.data.message)},[u,g,h]);const j=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Tingkat",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>x(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(N,{onSearch:e=>{d(e),s(1)},isLoading:c||p,columns:j,source:o?.grades,rowKey:"id",page:a,limit:t,totalData:o?.totalData,onChange:e=>{s(e.current),i(e.pageSize)},children:"TableData"})},{Title:le}=p,de=()=>{const[e,a]=L.useState(!1),[s,t]=L.useState(!1),[i,n]=L.useState({});return r.jsxs(u,{vertical:!0,gap:"middle",children:[r.jsxs(u,{align:"center",justify:"space-between",children:[r.jsx(le,{style:{margin:0},level:5,children:"Management Tingkat"}),r.jsx(D,{onClick:()=>a(!0)})]}),r.jsx(re,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(ne,{title:s?"Edit Tingkat":"Tambah Tingkat",open:e,setOpen:()=>a(!1),grade:i,setGrade:()=>n({})})]})},oe=({title:e,open:a,setOpen:s,classData:t,setClassData:i})=>{const[d]=l.useForm(),{data:u}=k({page:"",limit:"",search:""}),{data:p}=g({page:"",limit:"",search:""}),h=u?.map(e=>({value:e.id,label:e.name})),x=p?.map(e=>({value:e.id,label:e.name})),[j,{isLoading:y,isSuccess:S,error:b,data:C}]=f(),w=()=>{s(!1),i(),d.resetFields()};return L.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name,gradeId:t.grade,majorId:t.major}):d.resetFields())},[t,a]),L.useEffect(()=>{S&&(n.success(C.message),w()),b&&n.error(b.data.message)},[C,S,b]),r.jsx(o,{open:a,title:e,destroyOnHidden:!0,onCancel:w,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:()=>d.submit(),confirmLoading:y,loading:y,children:r.jsx(c,{spinning:y,tip:"Memuat data...",children:r.jsxs(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};j(a)}else d.resetFields()},layout:"vertical",children:[r.jsx(l.Item,{name:"gradeId",label:"Pilih Tingkat",rules:[{required:!0,message:"Wajid diisi"}],children:r.jsx(M,{placeholder:"Pilih Tingkat",options:h,onChange:e=>{d.setFieldsValue({gradeId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),r.jsx(l.Item,{name:"majorId",label:"Pilih Jurusan",children:r.jsx(M,{placeholder:"Pilih Jurusan",options:x,onChange:e=>{d.setFieldsValue({majorId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),r.jsx(l.Item,{name:"name",label:"Nama Kelas",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(m,{placeholder:"Nama Kelas"})})]})})})},{Text:ce}=p,me=({open:e,onClose:a,classname:s,classid:t})=>{const[i,l]=L.useState(1),[d,c]=L.useState(10),[p,g]=L.useState(""),[h,x]=L.useState(""),{data:j,isLoading:k,refetch:y}=S({page:i,limit:d,search:p,classid:t},{skip:!t}),[f,{isLoading:v,isSuccess:F,data:E,error:I}]=b(),[A,{data:D,isLoading:O,isSuccess:K,error:P}]=C(),z=e=>{o.confirm({title:"Yakin ingin menghapus siswa ini?",icon:r.jsx(T,{}),content:r.jsxs(ce,{strong:!0,children:[e.student_name," (",e.nis,")"]}),okText:"Hapus",okButtonProps:{danger:!0},cancelText:"Batal",onOk(){var a;a=e.student,A(a)},onCancel(){n.info("Aksi dibatalkan")}})};L.useEffect(()=>{F&&(n.success(E.message),x("")),I&&n.error(I.data.message)},[F,I,E]),L.useEffect(()=>{K&&(n.success(D?.message),y()),P&&n.error(P?.data?.message)},[K,P,D,y]);const H=[{title:"No",key:"no",render:(e,a,s)=>(i-1)*d+s+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(e,a)=>r.jsxs(J,{direction:"vertical",size:0,children:[r.jsx(ce,{children:a.student_name}),r.jsxs(ce,{type:"secondary",style:{fontSize:"12px"},children:["NIS: ",a.nis]})]})},{title:"Aksi",key:"action",render:e=>r.jsx(w,{danger:!0,icon:r.jsx(B,{}),onClick:()=>z(e),loading:O,children:"Hapus"})}];return r.jsx(o,{open:e,title:`Daftar Siswa Kelas ${s}`,onCancel:a,footer:[r.jsx(w,{onClick:a,children:"Tutup"},"close")],width:800,style:{top:20},children:r.jsxs(u,{vertical:!0,gap:"middle",children:[r.jsxs(J.Compact,{children:[r.jsx(m,{placeholder:"Masukan NIS",onChange:e=>x(e.target.value)}),r.jsx(w,{type:"primary",icon:r.jsx(_,{}),onClick:()=>{f({nis:h,classid:t})},disabled:v})]}),r.jsx(N,{onSearch:e=>{g(e),l(1)},isLoading:k||O,columns:H,source:j?.students,rowKey:"student",page:i,limit:d,totalData:j?.totalData,onChange:e=>{l(e.current),c(e.pageSize)}})]})})},{Text:ue}=p,{confirm:pe}=o,ge=({onEdit:e})=>{const[a,s]=L.useState(1),[t,l]=L.useState(10),[d,o]=L.useState(""),[c,m]=L.useState(!1),[p,g]=L.useState(""),{data:h,isLoading:x}=i({page:a,limit:t,search:d}),[j,{data:k,isLoading:y,isSuccess:f,error:S}]=v(),b=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"detail":(e=>{g(e),m(!0)})(a);break;case"delete":t=a.id,pe({title:"Konfirmasi Hapus Data",content:"Apakah anda yakin akan menghapus data ini?!",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){j(t)},onCancel(){n.warning("Aksi dibatalkan")}})}var t};L.useEffect(()=>{f&&n.success(k.message),S&&n.error(S.data.message)},[k,f,S]);const C=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Jurusan",dataIndex:"major_name",key:"major_name"},{title:"Kelas",dataIndex:"name",key:"name",render:(e,a)=>r.jsxs(u,{vertical:!0,gap:"small",children:[r.jsx(ue,{children:e}),r.jsxs("small",{children:["id : ",a.id]})]})},{title:"Jumlah Siswa",dataIndex:"students",key:"students"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"detail",label:"Detail"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>b(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsxs(r.Fragment,{children:[r.jsx(N,{onSearch:e=>{o(e),s(1)},isLoading:x||y,columns:C,source:h?.classes,rowKey:"id",page:a,limit:t,totalData:h?.totalData,onChange:e=>{s(e.current),l(e.pageSize)}}),r.jsx(me,{open:c,onClose:()=>(g({}),void m(!1)),classname:p?.name,classid:p?.id})]})},{Dragger:he}=q,{Text:xe,Title:je}=p,ke=({open:e,onClose:a})=>{const[s,t]=L.useState(null),[i,l]=L.useState([]),[d,{isLoading:c,isSuccess:m,error:p,data:g}]=F();return L.useEffect(()=>{s?(()=>{if(s){const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target.result),s=R(a,{type:"array"}),i=s.SheetNames[0],r=s.Sheets[i],d=V.sheet_to_json(r,{header:1,range:1}).map(e=>e.slice(0,5)).filter(e=>e.some(e=>null!=e&&""!==e));if(0===d.length)return n.error("Tidak ada data dalam file atau template salah."),void t(null);l(d),n.success(`Jumlah data terbaca ${d.length} siswa.`)}catch(a){n.error("Gagal memproses data. Pastikan template yang digunakan benar")}},e.readAsArrayBuffer(s)}})():l([])},[s]),L.useEffect(()=>{m&&(n.success(g.message),t(null),l([]),a()),p&&n.error(p.data.message)},[m,g,p]),r.jsx(o,{title:"Bulk Upload Students",open:e,onCancel:()=>{t(null),l([]),a()},destroyOnHidden:!0,width:700,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:async()=>{0!==i.length?d(i):n.warning("Tidak ada data yang diupload, pastikan template sesuai")},confirmLoading:c,loading:c,children:r.jsxs(J,{direction:"vertical",style:{width:"100%"},size:"large",children:[r.jsx(G,{message:"Follow these steps",description:r.jsxs(J,{direction:"vertical",size:2,children:[r.jsx(xe,{children:"1. Unduh template excel yang sudah disediakan."}),r.jsx(xe,{children:"2. Isikan data siswa berdasarkan kolom yang tersedia."}),r.jsx(xe,{children:"3. Upload kembali file yang sudah diisi."}),r.jsx(w,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_siswa.xlsx","_blank")},children:"Download Template"})]}),type:"info",showIcon:!0}),s?r.jsxs(J,{direction:"vertical",style:{width:"100%"},children:[r.jsxs(u,{align:"center",justify:"space-between",style:{background:"#f0f0f0",padding:"8px 12px",borderRadius:"6px"},children:[r.jsxs(u,{align:"center",gap:"small",children:[r.jsx($,{style:{color:"#217346",fontSize:20}}),r.jsx(xe,{strong:!0,children:s.name}),r.jsxs(E,{color:"green",children:[i.length," records found"]})]}),r.jsx(w,{type:"text",danger:!0,icon:r.jsx(W,{}),onClick:()=>t(null),children:"Change File"})]}),i.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(je,{level:5,style:{marginTop:16},children:"Data Preview"}),r.jsx(P,{columns:[{title:"TAHUN MASUK",dataIndex:0,key:"tahunMasuk"},{title:"NIS",dataIndex:1,key:"nis"},{title:"NAMA LENGKAP",dataIndex:2,key:"nama"},{title:"Kelamin",dataIndex:3,key:"kelamin"},{title:"Kelas",dataIndex:4,key:"kelas"}],dataSource:i.map((e,a)=>({key:a,...e})),size:"small",pagination:{pageSize:5,showSizeChanger:!1},scroll:{y:240}})]})]}):r.jsxs(he,{name:"file",accept:".xlsx, .xls, .csv",beforeUpload:e=>(t(e),!1),children:[r.jsx("p",{className:"ant-upload-drag-icon",children:r.jsx(Y,{})}),r.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),r.jsx("p",{className:"ant-upload-hint",children:"Ensure the file matches the template format."})]})]})})},{Title:ye}=p,fe=()=>{const[e,a]=L.useState(!1),[s,t]=L.useState(!1),[i,n]=L.useState({}),[l,d]=L.useState(!1);return r.jsxs(u,{vertical:!0,gap:"middle",children:[r.jsxs(u,{align:"center",justify:"space-between",children:[r.jsx(ye,{style:{margin:0},level:5,children:"Management Kelas"}),r.jsxs(J,{children:[r.jsx(D,{onClick:()=>a(!0)}),r.jsx(U,{onClick:()=>d(!0)})]})]}),r.jsx(ge,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(oe,{title:s?"Edit Kelas":"Tambah Kelas",open:e,setOpen:()=>a(!1),classData:i,setClassData:()=>n({})}),r.jsx(ke,{open:l,onClose:()=>d(!1)})]})},Se=()=>{const e=[{label:"Periode",key:"1",children:r.jsx(ee,{})},{label:"Jurusan",key:"2",children:r.jsx(ie,{})},{label:"Tingkat",key:"3",children:r.jsx(de,{})},{label:"Kelas",key:"4",children:r.jsx(fe,{})}];return r.jsx(I,{title:"Management Data pokok",levels:["admin"],children:r.jsx(A,{defaultActiveKey:"1",centered:!0,items:e})})};export{Se as default};
