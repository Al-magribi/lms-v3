import{a4 as e,a5 as a,j as s,B as i,l as n,N as t,a6 as l,m as r,I as d,s as o,K as c,a7 as m,F as u,t as g,a8 as h,a9 as p,aa as x,ab as j,ac as k,D as y,a3 as f,ad as S,h as b,A as w}from"./index-B0c3W_5t.js";import{c as A}from"./vendor-DnNJsrFE.js";import{T as N}from"./TableLayout-Ci3QPEVA.js";import{S as v}from"./Pagination-WHZFXTMR.js";import{S as C}from"./index-DdknNc5d.js";import{D as I,F as T}from"./Table-x0yCeKUk.js";import{A as L}from"./Add-DopxF80z.js";import{U as O}from"./Upload-D44XkdB6.js";import{r as D,u as E}from"./xlsx-C5xT2hrF.js";import{U as P,R as _}from"./InboxOutlined-DFIXlufQ.js";import{R as F}from"./DownloadOutlined-CY0ejyjx.js";import{R as M}from"./CheckCircleOutlined-CRE_tZMS.js";import{R}from"./CloseCircleOutlined-BhL0yC3e.js";import{A as K}from"./index-DNhhOToF.js";import"./DeleteOutlined-B6iY7KtB.js";import"./progress-C-9ZUo7L.js";var z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},H=function(s,i){return A.createElement(e,a({},s,{ref:i,icon:z}))},U=A.forwardRef(H);const q=({onClick:e})=>s.jsx(i,{style:{backgroundColor:"#52c41a",color:"#fff"},icon:s.jsx(U,{}),onClick:e,children:"Unduh"}),B=({title:e,open:a,onClose:i,student:c})=>{const[m]=n.useForm(),{data:u,isLoading:g}=t({page:"",limit:"",search:""}),[h,{isLoading:p}]=l();return s.jsx(r,{title:e,open:a,onCancel:i,okText:"Simpan",cancelText:"Tutup",onOk:()=>m.submit(),destroyOnHidden:!0,confirmLoading:p,children:s.jsxs(n,{form:m,onFinish:async e=>{try{const a={id:c.id,...e};await h(a).unwrap(),o.success("Data siswa berhasil diperbarui"),i()}catch(a){o.error(a.data?.message||"Gagal memperbarui siswa")}},layout:"vertical",initialValues:{name:c?.name,nis:c?.nis,gender:c?.gender,classid:c?.classid},children:[s.jsx(n.Item,{name:"name",label:"Nama Lengkap",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(d,{placeholder:"Nama Lengkap"})}),s.jsx(n.Item,{name:"nis",label:"NIS",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(d,{placeholder:"Nomor Induk Siswa"})}),s.jsx(n.Item,{name:"gender",label:"Jenis Kelamin",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsxs(v,{placeholder:"Pilih Jenis Kelamin",children:[s.jsx(v.Option,{value:"L",children:"Laki-laki"}),s.jsx(v.Option,{value:"P",children:"Perempuan"})]})}),s.jsx(n.Item,{name:"classid",label:"Kelas",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(v,{placeholder:"Pilih Kelas",loading:g,options:u?.map(e=>({value:e.id,label:e.name})),showSearch:!0,optionFilterProp:"label"})})]})})},{Text:G}=g,V=()=>{const[e,a]=A.useState(1),[i,n]=A.useState(10),[t,l]=A.useState(""),[r,d]=A.useState(!1),[g,h]=A.useState(""),{data:p,isLoading:x}=c({page:e,limit:i,search:t}),[j,{data:k,isLoading:y,isSuccess:f,error:S}]=m(),b=(e,{key:a})=>{switch(a){case"edit":(e=>{d(!0),h(e)})(e);break;case"delete":s=e.id,window.confirm("Apakah anda yakin akan menghapus siswa ini?!")?j(s):o.warning("Aksi dibatalkan")}var s};A.useEffect(()=>{f&&o.success(k.message),S&&o.error(S.data.message)},[k,f,S]);const w=[{title:"No",key:"no",render:(a,s,n)=>(e-1)*i+n+1},{title:"Nama Siswa",dataIndex:"name",key:"name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx(G,{strong:!0,type:a.isactive?"success":"danger",children:e}),s.jsx(C,{children:s.jsxs("small",{children:[`Periode: ${a.periode_name}`," • ",a.nis," "]})})]})},{title:"Kelas",dataIndex:"classname",key:"classname",render:e=>s.jsx(G,{type:e?"":"danger",children:e||"Belum ada kelas"})},{title:"L/P",dataIndex:"gender",key:"gender",render:e=>s.jsx(G,{children:"P"===e?"Perempuan":"Laki Laki"})},{title:"Aksi",key:"action",render:e=>s.jsx(I.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>b(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsxs(s.Fragment,{children:[s.jsx(N,{onSearch:e=>{l(e),a(1)},isLoading:x||y,columns:w,source:p?.students,rowKey:"id",page:e,limit:i,totalData:p?.totalData,onChange:e=>{a(e.current),n(e.pageSize)}}),s.jsx(B,{title:`Perbarui data ${g?.name}`,open:r,onClose:()=>{d(!1),h("")},student:g})]})},W=()=>s.jsxs(u,{vertical:!0,gap:"middle",children:[s.jsxs(u,{align:"center",justify:"space-between",children:[s.jsx(h,{style:{margin:0},level:5,children:"Mangement Siswa"}),s.jsx(q,{})]}),s.jsx(V,{})]}),{Text:$}=g,{confirm:J}=r,Y=({onEdit:e})=>{const[a,i]=A.useState(1),[n,t]=A.useState(10),[l,r]=A.useState(""),{data:d,isLoading:c}=p({page:a,limit:n,search:l}),[m,{data:g,error:h,isLoading:j,isSuccess:k}]=x(),y=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"reset":o.info(`Reset id ${a.parent_id}`);break;case"delete":i=a.parent_id,J({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang sudah terhapus tidak bisa dikembalikan",okText:"Ya, Hapus",cancelText:"Batal",okType:"danger",onOk(){m(i)}})}var i};A.useEffect(()=>{k&&o.success(g.message),h&&o.error(h.data.message)},[g,k,h]);const f=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*n+i+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx($,{strong:!0,children:e}),s.jsx(C,{children:s.jsxs("small",{children:[a.nis," • ",a.grade," • ",a.class]})})]})},{title:"Nama Orang Tua",dataIndex:"parent_name",key:"parent_name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx($,{children:e}),s.jsx($,{type:"secondary",italic:!0,copyable:!0,children:a.parent_email})]})},{title:"Aksi",key:"action",render:e=>s.jsx(I.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"reset",label:"Reset"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>y(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsx(N,{onSearch:e=>{r(e),i(1)},isLoading:c||j,columns:f,source:d?.data,rowKey:"parent_id",page:a,limit:n,totalData:d?.totalData,onChange:e=>{i(e.current),t(e.pageSize)},children:"TableData"})},Q=({open:e,onClose:a,title:i,parent:t})=>{const[l]=n.useForm(),[c,{data:m,error:u,isLoading:g,isSuccess:h,reset:p}]=j();return A.useEffect(()=>{e&&(l.resetFields(),t&&l.setFieldsValue({nis:t.nis,name:t.parent_name,email:t.parent_email}))},[e,t]),A.useEffect(()=>{h&&(o.success(m.message),l.resetFields(),a(),p()),u&&(o.error(u.data.message),p())},[m,u,h]),s.jsx(r,{title:i,open:e,onCancel:a,okText:"Simpan",cancelText:"Tutup",onOk:()=>l.submit(),destroyOnHidden:!0,loading:g,confirmLoading:g,children:s.jsxs(n,{layout:"vertical",form:l,onFinish:e=>{const a={...e,email:e.email?e.email.toLowerCase():""};if(t.parent_id){const e={id:t.parent_id,...a};c(e)}else c(a)},children:[s.jsx(n.Item,{name:"nis",label:"NIS",rules:[{required:!0,message:"NIS wajib diisi"}],children:s.jsx(d,{placeholder:"NIS"})}),s.jsx(n.Item,{name:"name",label:"Nama Orang Tua",rules:[{required:!0,message:"Nama Orang tua wajib diisi"}],children:s.jsx(d,{placeholder:"Nama Orang Tua"})}),s.jsx(n.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email wajib diisi"}],children:s.jsx(d,{placeholder:"Email"})})]})})},{Dragger:X}=P,{Text:Z}=g,ee=[{title:"NIS",dataIndex:"nis",key:"nis"},{title:"NAMA ORANG TUA",dataIndex:"name",key:"name"},{title:"EMAIL",dataIndex:"email",key:"email"},{title:"KETERANGAN",dataIndex:"issue",key:"issue",render:e=>s.jsx(f,{color:"red",children:e})}],ae=({open:e,onClose:a})=>{const[n,t]=A.useState(null),[l,d]=A.useState([]),[c,m]=A.useState([]),[g,h]=A.useState([]),[p,x]=A.useState(0),[j,{data:b,error:w,isLoading:N,isSuccess:v,reset:I}]=k(),L={name:"file",multiple:!1,accept:".xlsx, .xls, .csv",beforeUpload:e=>(t(e),(e=>{const a=new FileReader;a.onload=e=>{try{const a=new Uint8Array(e.target.result),s=D(a,{type:"array"}),i=s.SheetNames[0],n=s.Sheets[i],t=E.sheet_to_json(n,{defval:""}).map(e=>({nis:e.NIS||e.nis,name:e["NAMA ORANG TUA"]||e.name,email:e.EMAIL?String(e.EMAIL).toLowerCase():e.email?String(e.email).toLowerCase():""})),l=new Set,r=[],o=[],c=[];t.forEach(e=>{e.nis&&e.name&&e.email?l.has(e.nis)?(e.issue="NIS duplikat di dalam file ini",c.push(e)):(l.add(e.nis),r.push(e)):(e.issue="Data tidak lengkap (NIS/Nama/Email wajib diisi)",o.push(e))}),d(r),m(o),h(c)}catch(a){o.error("Gagal memproses file. Pastikan format file sudah benar.")}},a.readAsArrayBuffer(e)})(e),!1),onRemove:()=>{t(null),d([]),m([]),h([])}},O=()=>{t(null),d([]),m([]),h([]),x(e=>e+1),a()};return A.useEffect(()=>{v&&(o.success(b?.message||"Data berhasil diunggah."),I(),O()),w&&(o.error(w?.data?.message||"Terjadi kesalahan saat mengunggah."),I())},[v,w,b,I]),s.jsx(r,{title:"Upload Data Orang Tua",open:e,onCancel:O,footer:[s.jsx(i,{onClick:O,children:"Tutup"},"back"),s.jsx(i,{type:"primary",loading:N,onClick:()=>{l.length>0?j({parents:l}):o.warning("Tidak ada data valid untuk diunggah.")},disabled:0===l.length||N,children:N?"Mengunggah...":`Upload ${l.length} Data Valid`},"submit")],width:800,destroyOnHidden:!0,children:s.jsxs(C,{direction:"vertical",style:{width:"100%"},children:[A.createElement(X,{...L,key:p},s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(_,{})}),s.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),s.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx, .xls, atau .csv. Pastikan kolom memiliki judul: NIS, NAMA ORANG TUA, EMAIL."}),s.jsx(i,{icon:s.jsx(F,{}),onClick:()=>{window.open("/template/template_orangtua.xlsx","_blank")},children:"Download Template"})),n&&s.jsxs("div",{style:{width:"100%",marginTop:16},children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(M,{style:{color:"green"}}),s.jsx(Z,{children:"Data Siap Diupload"}),s.jsx(f,{color:"success",children:l.length})]})}),s.jsx(T,{columns:ee.filter(e=>"issue"!==e.key),dataSource:l,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}}),g.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(S,{style:{color:"orange"}}),s.jsx(Z,{children:"Data Duplikat (Dilewati)"}),s.jsx(f,{color:"warning",children:g.length})]})}),s.jsx(T,{columns:ee,dataSource:g,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]}),c.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(R,{style:{color:"red"}}),s.jsx(Z,{children:"Data Tidak Lengkap (Dilewati)"}),s.jsx(f,{color:"error",children:c.length})]})}),s.jsx(T,{columns:ee,dataSource:c,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]})]})]})})},se=()=>{const[e,a]=A.useState(!1),[i,n]=A.useState(!1),[t,l]=A.useState(!1),[r,d]=A.useState("");return s.jsxs(u,{vertical:!0,gap:"middle",children:[s.jsxs(u,{align:"center",justify:"space-between",children:[s.jsx(h,{style:{margin:0},level:5,children:"Management Orang Tua"}),s.jsxs(C,{children:[s.jsx(O,{onClick:()=>n(!0)}),s.jsx(L,{onClick:()=>a(!0)})]})]}),s.jsx(Y,{onEdit:e=>{d(e),l(!0),a(!0)}}),s.jsx(Q,{title:t?"Edit Data Orang Tua":"Simpan Data Orang tua",open:e,onClose:()=>{d(""),l(!1),a(!1)},parent:r}),s.jsx(ae,{open:i,onClose:()=>n(!1)})]})},ie=()=>s.jsx("div",{children:s.jsx(K,{type:"info",message:"Pengembangan",description:"Mencatat data kelulusan setiap siswa dalam satuannya masing masing",showIcon:!0})}),ne=()=>{const e=[{key:"1",label:"Siswa",children:s.jsx(W,{})},{key:"2",label:"Orang Tua",children:s.jsx(se,{})},{key:"3",label:"Lulusan",children:s.jsx(ie,{})}];return s.jsx(b,{title:"Management Siswa",levels:["admin"],children:s.jsx(w,{centered:!0,defaultActiveKey:"1",items:e})})};export{ne as default};
