import{b as e,aC as a,aD as s,j as l,e as t,aE as n,aF as i}from"./index-BTyVZtjg.js";import{b as d,u as c}from"./vendor-DfXzdC0j.js";import{S as r}from"./react-select.esm-DUeLA41h.js";import{T as o}from"./Table-DbbTqEdN.js";const m=({detail:n,setDetail:i})=>{var c;const{user:o}=e((e=>e.auth)),[m,b]=d.useState({id:"",teacher:(null==o?void 0:o.id)||null,subject:null,btype:"",name:""}),{data:u}=a(),[h,{isSuccess:x,isLoading:j,isError:p,reset:g}]=s(),v=null==u?void 0:u.map((e=>({value:e.id,label:e.name,subjects:e.subjects}))),N=null==u?void 0:u.find((e=>e.id===m.teacher)),f=(null==(c=null==N?void 0:N.subjects)?void 0:c.map((e=>({value:e.id,label:e.name}))))||[],y=e=>{const{name:a,value:s}=e.target;b((e=>({...e,[a]:s})))},k=()=>{i({}),b({id:"",teacher:(null==o?void 0:o.id)||null,subject:null,btype:"",name:""})};return d.useEffect((()=>{if(x||p){b({id:"",teacher:(null==o?void 0:o.id)||null,btype:"",subject:null,name:""}),g();document.querySelector("[data-bs-dismiss='modal']").click()}}),[x,p,o,g]),d.useEffect((()=>{n&&b({id:n.id,teacher:n.teacher||(null==o?void 0:o.id)||null,subject:n.subject,name:n.name,btype:n.btype})}),[n,o]),d.useEffect((()=>{const e=document.getElementById("addbank");if(!e)return;const a=()=>{b({id:"",teacher:(null==o?void 0:o.id)||null,subject:null,btype:"",name:""})};return e.addEventListener("hidden.bs.modal",a),()=>e.removeEventListener("hidden.bs.modal",a)}),[o]),l.jsx("div",{className:"modal fade",id:"addbank","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"bankModalLabel","aria-hidden":"true",children:l.jsx("div",{className:"modal-dialog",children:l.jsxs("form",{onSubmit:e=>{e.preventDefault(),t.promise(h(m).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",id:"bankModalLabel",children:m.id?"Edit Bank Soal":"Tambah Bank Soal"}),l.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:k})]}),l.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[l.jsx(r,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(null==v?void 0:v.find((e=>e.value===m.teacher)))||null,options:v,onChange:e=>{b((a=>({...a,teacher:(null==e?void 0:e.value)||null,subject:null})))},className:"mb-2"}),l.jsx(r,{isClearable:!0,isSearchable:!0,placeholder:"Pilih Mata Pelajaran",value:(null==f?void 0:f.find((e=>e.value===m.subject)))||null,options:f,onChange:e=>{b((a=>({...a,subject:(null==e?void 0:e.value)||null})))},isDisabled:!m.teacher,className:"mb-2"}),l.jsxs("select",{name:"btype",id:"btype",className:"form-select",value:m.btype,onChange:y,required:!0,children:[l.jsx("option",{value:"",hidden:!0,children:"Jenis Bank Soal"}),l.jsx("option",{value:"bank",children:"Bank"}),l.jsx("option",{value:"paket",children:"Paket"})]}),l.jsx("input",{name:"name",className:"form-control",placeholder:"Nama Bank Soal",value:m.name,onChange:y,required:!0})]}),l.jsxs("div",{className:"modal-footer",children:[l.jsxs("button",{type:"button",className:"btn btn-warning","data-bs-dismiss":"modal",onClick:k,children:[l.jsx("i",{className:"bi bi-x-lg me-1"}),"Batal"]}),l.jsxs("button",{type:"submit",className:"btn btn-success",disabled:j,children:[l.jsx("i",{className:"bi bi-save me-1"}),"Simpan"]})]})]})})})},b=({setDetail:e})=>{const a=c(),[s,r]=d.useState(1),[m,b]=d.useState(10),[u,h]=d.useState(""),{data:x={},isLoading:j}=n({page:s,limit:m,search:u}),{banks:p=[],totalData:g,totalPages:v}=x,[N,{isLoading:f}]=i();return l.jsx(o,{page:s,setPage:r,setLimit:b,setSearch:h,totalData:g,totalPages:v,isLoading:j,children:l.jsx("div",{className:"table-responsive",children:l.jsxs("table",{className:"table table-hover align-middle",children:[l.jsx("thead",{className:"table-light",children:l.jsxs("tr",{children:[l.jsx("th",{scope:"col",className:"text-center",style:{width:"60px"},children:"#"}),l.jsx("th",{scope:"col",children:"Nama Bank Soal"}),l.jsx("th",{scope:"col",children:"Guru"}),l.jsx("th",{scope:"col",children:"Mata Pelajaran"}),l.jsx("th",{scope:"col",children:"Jenis"}),l.jsx("th",{scope:"col",className:"text-center",children:"Jumlah Soal"}),l.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:"Aksi"})]})}),l.jsx("tbody",{children:(null==p?void 0:p.length)>0?null==p?void 0:p.map(((n,i)=>l.jsxs("tr",{className:"align-middle",children:[l.jsx("td",{className:"text-center",children:l.jsx("span",{className:"badge bg-primary rounded-pill",children:(s-1)*m+i+1})}),l.jsx("td",{children:l.jsxs("div",{className:"d-flex align-items-center gap-2",children:[l.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",style:{width:40,height:40},children:l.jsx("i",{className:"bi bi-folder-fill text-primary"})}),l.jsx("div",{children:l.jsx("div",{className:"fw-semibold text-primary",title:n.name,children:n.name.length>25?`${n.name.slice(0,25)}...`:n.name})})]})}),l.jsx("td",{children:l.jsx("span",{className:"text-muted",title:n.teacher_name,children:n.teacher_name.length>20?`${n.teacher_name.slice(0,20)}...`:n.teacher_name})}),l.jsx("td",{children:l.jsx("span",{className:"badge bg-secondary bg-opacity-75",children:n.subject_name})}),l.jsx("td",{children:l.jsx("span",{className:"badge bg-success",children:n.btype.toUpperCase()})}),l.jsx("td",{className:"text-center",children:l.jsxs("span",{className:"badge bg-info",children:[n.question_count," Soal"]})}),l.jsx("td",{className:"text-center",children:l.jsxs("div",{className:"dropdown",children:[l.jsx("button",{type:"button",className:"btn btn-sm btn-outline-primary","data-bs-toggle":"dropdown","aria-expanded":"false",children:"Pilihan Aksi"}),l.jsxs("ul",{className:"dropdown-menu dropdown-menu-end shadow-sm",children:[l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>((e,s,l)=>{const t=s.replace(/[\s/]/g,"-"),n=e.replace(/[\s/]/g,"-");a(`/admin-cbt-bank/${n}/${t}/${l}`)})(n.subject_name,n.name,n.id),children:[l.jsx("i",{className:"bi bi-eye"})," Lihat"]})}),l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2",onClick:()=>e(n),"data-bs-toggle":"modal","data-bs-target":"#addbank",children:[l.jsx("i",{className:"bi bi-pencil"})," Edit"]})}),l.jsx("li",{children:l.jsx("hr",{className:"dropdown-divider"})}),l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2 text-danger",disabled:f,onClick:()=>{return e=n.id,void(window.confirm("Apakah anda yakin ingin menghapus bank soal ini dan semua data yang terkait dengan bank soal ini?")&&t.promise(N(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[l.jsx("i",{className:"bi bi-trash"})," Hapus"]})})]})]})})]},i))):l.jsx("tr",{children:l.jsx("td",{colSpan:"7",className:"text-center py-4",children:l.jsxs("div",{className:"text-muted",children:[l.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),"Data belum tersedia"]})})})})]})})})},u=()=>{const[e,a]=d.useState("");return l.jsxs("div",{className:"container-fluid",children:[l.jsx(m,{detail:e,setDetail:a}),l.jsx(b,{setDetail:a})]})};export{u as C};
//# sourceMappingURL=CbtBank-DXPVBySn.js.map
