import{b6 as e,b7 as a,b8 as i,b9 as s,ba as n,bb as l,bc as t,j as d,V as r,bd as c,be as o,bf as m,bg as h}from"./index-Deb7CCnC.js";import{b as u,u as v,e as b}from"./vendor-CAuU4qY4.js";import{L as p}from"./Layout-BbtcclI6.js";const x=({studentData:c,onRefetch:o})=>{var m;console.log(c);const[h,v]=u.useState({userid:(null==c?void 0:c.userid)||"",entryid:(null==c?void 0:c.entryid)||"",entry_name:(null==c?void 0:c.entry_name)||"",homebaseid:(null==c?void 0:c.homebaseid)||"",homebase_name:(null==c?void 0:c.homebase_name)||"",academic_year:(null==c?void 0:c.academic_year)||"",gender:(null==c?void 0:c.gender)||"",name:(null==c?void 0:c.name)||"",nisn:(null==c?void 0:c.nisn)||"",nis:(null==c?void 0:c.nis)||"",birth_place:(null==c?void 0:c.birth_place)||"",birth_date:(null==c?void 0:c.birth_date)?new Date(c.birth_date).toISOString().split("T")[0]:"",order_number:(null==c?void 0:c.order_number)||"",height:(null==c?void 0:c.height)||"",weight:(null==c?void 0:c.weight)||"",head:(null==c?void 0:c.head)||"",provinceid:(null==c?void 0:c.provinceid)||"",province_name:(null==c?void 0:c.province_name)||"",cityid:(null==c?void 0:c.cityid)||"",city_name:(null==c?void 0:c.city_name)||"",districtid:(null==c?void 0:c.districtid)||"",district_name:(null==c?void 0:c.district_name)||"",villageid:(null==(m=null==c?void 0:c.villageid)?void 0:m.trim())||"",village_name:(null==c?void 0:c.village_name)||"",postal_code:(null==c?void 0:c.postal_code)||"",address:(null==c?void 0:c.address)||""}),{data:b}=e(),{data:p}=a(),{data:x}=i(),{data:j}=s(h.provinceid,{skip:!h.provinceid}),{data:N}=n(h.cityid,{skip:!h.cityid}),{data:g}=l(h.districtid,{skip:!h.districtid}),[_,{isLoading:f,isSuccess:y,isError:k,reset:C}]=t(),w=e=>{const{name:a,value:i}=e.target;v((e=>{const s={...e,[a]:i};if("entryid"===a){const e=null==b?void 0:b.find((e=>e.id===parseInt(i)));e&&(s.entryid=e.id,s.entry_name=e.name)}else if("homebaseid"===a){const e=null==p?void 0:p.find((e=>e.id===i));e&&(s.homebaseid=e.id,s.homebase_name=e.name)}else if("provinceid"===a){const e=null==x?void 0:x.find((e=>e.id===i));e&&(s.provinceid=e.id,s.province_name=e.name,s.cityid="",s.city_name="",s.districtid="",s.district_name="",s.villageid="",s.village_name="")}else if("cityid"===a){const e=null==j?void 0:j.find((e=>e.id===i));e&&(s.cityid=e.id,s.city_name=e.name,s.districtid="",s.district_name="",s.villageid="",s.village_name="")}else if("districtid"===a){const e=null==N?void 0:N.find((e=>e.id===i));e&&(s.districtid=e.id,s.district_name=e.name,s.villageid="",s.village_name="")}else if("villageid"===a){const e=null==g?void 0:g.find((e=>e.id.trim()===i));e&&(s.villageid=e.id.trim(),s.village_name=e.name)}return s}))};return u.useEffect((()=>{y&&(C(),o()),k&&C()}),[y,k,C,o]),console.log(c),d.jsx("div",{className:"container mt-3",children:d.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.promise(_(h).unwrap().then((e=>e.message)),{loading:"Memproses data...",success:e=>e,error:e=>e.data.message})},children:[d.jsxs("div",{className:"row",children:[d.jsxs("div",{className:"col-md-6",children:[d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Tahun Pelajaran",name:"entryid",value:h.entryid,onChange:w,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Tahun Pelajaran"}),null==b?void 0:b.map((e=>d.jsx("option",{value:e.id,children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Satuan Pendidikan",name:"homebaseid",value:h.homebaseid,onChange:w,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Satuan Pendidikan"}),null==p?void 0:p.map((e=>d.jsx("option",{value:e.id,children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsxs("select",{name:"gender",id:"",className:"form-select",value:h.gender,onChange:w,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Jenis Kelamin"}),d.jsx("option",{value:"L",children:"Laki-laki"}),d.jsx("option",{value:"P",children:"Perempuan"})]})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Lengkap",name:"name",value:h.name,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"NISN",name:"nisn",value:h.nisn,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"NIS",name:"nis",value:h.nis,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir",name:"birth_place",value:h.birth_place,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"date",className:"form-control",name:"birth_date",value:h.birth_date,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Urutan Kelahiran",name:"order_number",value:h.order_number,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"TB",name:"height",value:h.height,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"BB",name:"weight",value:h.weight,onChange:w})}),d.jsx("div",{children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Lingkar Kepala",name:"head",value:h.head,onChange:w})})]}),d.jsxs("div",{className:"col-md-6",children:[d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Provinsi",name:"provinceid",value:h.provinceid,onChange:w,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Provinsi"}),null==x?void 0:x.map((e=>d.jsx("option",{value:e.id,children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Kota / Kabupaten",name:"cityid",value:h.cityid,onChange:w,disabled:!h.provinceid,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Kota / Kabupaten"}),null==j?void 0:j.map((e=>d.jsx("option",{value:e.id,children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Kecamatan",name:"districtid",value:h.districtid,onChange:w,disabled:!h.cityid,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Kecamatan"}),null==N?void 0:N.map((e=>d.jsx("option",{value:e.id,children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsxs("select",{className:"form-select","aria-label":"Pilih Desa",name:"villageid",value:h.villageid,onChange:w,disabled:!h.districtid,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Desa"}),null==g?void 0:g.map((e=>d.jsx("option",{value:e.id.trim(),children:e.name},e.id)))]})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Kode Pos",name:"postal_code",value:h.postal_code,onChange:w})}),d.jsx("div",{className:"mb-3",children:d.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Alamat",name:"address",value:h.address,onChange:w})})]})]}),d.jsx("div",{className:"row mt-3",children:d.jsx("div",{className:"col-12 text-end",children:d.jsx("button",{type:"submit",className:"btn btn-sm btn-success",children:"Simpan Data"})})})]})})},j=({studentData:e,userid:a,onRefetch:i})=>{const[s,n]=u.useState({userid:a,father_nik:(null==e?void 0:e.father_nik)||"",father_name:(null==e?void 0:e.father_name)||"",father_birth_place:(null==e?void 0:e.father_birth_place)||"",father_birth_date:(null==e?void 0:e.father_birth_date)?new Date(e.father_birth_date).toISOString().split("T")[0]:"",father_job:(null==e?void 0:e.father_job)||"",father_phone:(null==e?void 0:e.father_phone)||"",mother_nik:(null==e?void 0:e.mother_nik)||"",mother_name:(null==e?void 0:e.mother_name)||"",mother_birth_place:(null==e?void 0:e.mother_birth_place)||"",mother_birth_date:(null==e?void 0:e.mother_birth_date)?new Date(e.mother_birth_date).toISOString().split("T")[0]:"",mother_job:(null==e?void 0:e.mother_job)||"",mother_phone:(null==e?void 0:e.mother_phone)||""}),[l,{isLoading:t,isSuccess:o,isError:m,reset:h}]=c(),v=e=>{const{name:a,value:i}=e.target;n((e=>({...e,[a]:i})))};return u.useEffect((()=>{o&&(i(),h()),m&&h()}),[o,m,h,i]),d.jsx("div",{className:"container mt-3",children:d.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.promise(l(s).unwrap().then((e=>e.message)),{loading:"Memproses data...",success:e=>e,error:e=>e.data.message})},children:[d.jsxs("div",{className:"row",children:[d.jsxs("div",{className:"col-md-6",children:[d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"NIK Ayah",name:"father_nik",value:s.father_nik,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Ayah",name:"father_name",value:s.father_name,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir Ayah",name:"father_birth_place",value:s.father_birth_place,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"date",className:"form-control",name:"father_birth_date",value:s.father_birth_date,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Pekerjaan Ayah",name:"father_job",value:s.father_job,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Tlp Ayah",name:"father_phone",value:s.father_phone,onChange:v})})]}),d.jsxs("div",{className:"col-md-6",children:[d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"NIK Ibu",name:"mother_nik",value:s.mother_nik,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Nama Ibu",name:"mother_name",value:s.mother_name,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Tempat Lahir Ibu",name:"mother_birth_place",value:s.mother_birth_place,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"date",className:"form-control",name:"mother_birth_date",value:s.mother_birth_date,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Pekerjaan Ibu",name:"mother_job",value:s.mother_job,onChange:v})}),d.jsx("div",{className:"mb-3",children:d.jsx("input",{type:"text",className:"form-control",placeholder:"Tlp Ibu",name:"mother_phone",value:s.mother_phone,onChange:v})})]})]}),d.jsx("div",{className:"row mt-3",children:d.jsx("div",{className:"col-12 text-end",children:d.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:t,children:"Simpan Data"})})})]})})},N=({families:e,onRefetch:a,userid:i})=>{const s={id:"",userid:i,name:"",gender:"",birth_date:""},[n,l]=u.useState(s),[t,c]=u.useState(null),[h,v]=u.useState({}),[b,{isLoading:p,isSuccess:x,isError:j,reset:N}]=o(),[g,{isLoadig:_,isSuccess:f,isError:y,reset:k}]=m(),C=e=>{const{name:a,value:i}=e.target;l((e=>({...e,[a]:i}))),h[a]&&v((e=>({...e,[a]:""})))},w=e=>{const a=new Date,i=new Date(e);let s=a.getFullYear()-i.getFullYear();const n=a.getMonth()-i.getMonth();return(n<0||0===n&&a.getDate()<i.getDate())&&s--,s};return u.useEffect((()=>{x&&(N(),a()),j&&N()}),[x,j,N,a]),u.useEffect((()=>{f&&(k(),a()),y&&k()}),[f,k,a,y]),d.jsx("div",{className:"container mt-3",children:d.jsxs("div",{className:"row",children:[d.jsx("div",{className:"col-md-4",children:d.jsx("div",{className:"card shadow-sm",children:d.jsx("div",{className:"card-body",children:d.jsxs("form",{onSubmit:async e=>{e.preventDefault();const a=(()=>{const e={};n.name.trim()||(e.name="Nama harus diisi"),n.gender||(e.gender="Jenis kelamin harus dipilih"),n.birth_date?new Date(n.birth_date)>new Date&&(e.birth_date="Tanggal lahir tidak boleh lebih dari hari ini"):e.birth_date="Tanggal lahir harus diisi";return e})();Object.keys(a).length>0?v(a):r.promise(b(n).unwrap().then((e=>e.message)),{loading:"Memproses data...",success:e=>e,error:e=>e.data.message})},children:[d.jsxs("div",{className:"mb-3",children:[d.jsx("input",{type:"text",className:"form-control "+(h.name?"is-invalid":""),placeholder:"Nama Keluarga",name:"name",value:n.name,onChange:C}),h.name&&d.jsx("div",{className:"invalid-feedback",children:h.name})]}),d.jsxs("div",{className:"mb-3",children:[d.jsxs("select",{className:"form-select "+(h.gender?"is-invalid":""),name:"gender",value:n.gender,onChange:C,children:[d.jsx("option",{value:"",hidden:!0,children:"Pilih Jenis Kelamin"}),d.jsx("option",{value:"L",children:"Laki Laki"}),d.jsx("option",{value:"P",children:"Perempuan"})]}),h.gender&&d.jsx("div",{className:"invalid-feedback",children:h.gender})]}),d.jsxs("div",{className:"mb-3",children:[d.jsx("input",{type:"date",className:"form-control "+(h.birth_date?"is-invalid":""),name:"birth_date",value:n.birth_date,onChange:C}),h.birth_date&&d.jsx("div",{className:"invalid-feedback",children:h.birth_date})]}),d.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[d.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{l(s),c(null),v({})},disabled:p,children:"Batal"}),d.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:p,children:[p?d.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):null,t?"Update":"Simpan"]})]})]})})})}),d.jsx("div",{className:"col-md-8",children:d.jsx("div",{className:"card shadow-sm",children:d.jsx("div",{className:"card-body",children:d.jsx("div",{className:"table-responsive",children:d.jsxs("table",{className:"table table-hover",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"No"}),d.jsx("th",{children:"Nama"}),d.jsx("th",{children:"Jenis Kelamin"}),d.jsx("th",{children:"Tanggal Lahir"}),d.jsx("th",{children:"Usia"}),d.jsx("th",{children:"Aksi"})]})}),d.jsx("tbody",{children:null==e?void 0:e.map(((e,a)=>d.jsxs("tr",{children:[d.jsx("td",{children:a+1}),d.jsx("td",{children:e.name}),d.jsx("td",{children:"L"===e.gender?"Laki Laki":"Perempuan"}),d.jsx("td",{children:new Date(e.birth_date).toLocaleDateString("id-ID")}),d.jsxs("td",{children:[w(e.birth_date)," Tahun"]}),d.jsx("td",{children:d.jsxs("div",{className:"d-flex gap-1",children:[d.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>(e=>{c(e.id),l({id:e.id,userid:e.userid,name:e.name,gender:e.gender,birth_date:new Date(e.birth_date).toISOString().split("T")[0]}),v({})})(e),title:"Edit",children:d.jsx("i",{className:"bi bi-pencil-square"})}),d.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{window.confirm("Apakah Anda yakin ingin menghapus data keluarga ini?")&&r.promise(g(e).unwrap().then((e=>e.message)),{loading:"Memproses data...",success:e=>e,error:e=>e.data.message})})(e.id),title:"Hapus",disabled:_,children:d.jsx("i",{className:"bi bi-trash"})})]})})]},e.id)))})]})})})})})]})})},g=()=>{const e=v(),{name:a,nis:i,periode:s,userid:n}=b(),[l,t]=u.useState("biodata"),{data:c,isLoading:o,isError:m,refetch:g}=h(n);m&&r.error("Gagal mengambil data siswa");const _=null==c?void 0:c.data,f=e=>{t(e)},y=()=>{g()};return o?d.jsx(p,{title:`Database ${a.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:d.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:d.jsx("div",{className:"spinner-border text-primary",role:"status",children:d.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):_?d.jsx(p,{title:`Database ${a.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:d.jsxs("div",{className:"container-fluid",children:[d.jsx("div",{className:"row mb-2",children:d.jsx("div",{className:"col-12",children:d.jsx("div",{className:"card shadow-sm",children:d.jsx("div",{className:"card-body",children:d.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[d.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[d.jsxs("span",{className:"badge bg-secondary",children:[d.jsx("i",{className:"bi bi-calendar me-1"}),_.periode_name]}),d.jsxs("span",{className:"badge bg-primary",children:[_.grade_name," ",_.class_name]}),d.jsxs("span",{className:"badge bg-info",children:[d.jsx("i",{className:"bi bi-person me-1"}),_.student_gender]}),d.jsxs("span",{className:"badge bg-success",children:[d.jsx("i",{className:"bi bi-check-circle me-1"}),_.isactive?"Aktif":"Tidak Aktif"]})]}),d.jsxs("button",{className:"btn btn-sm btn-info",onClick:()=>{e("/database")},children:[d.jsx("i",{className:"bi bi-arrow-left"})," Kembali"]})]})})})})}),d.jsx("div",{className:"row",children:d.jsx("div",{className:"col-12",children:d.jsx("div",{className:"card shadow-sm",children:d.jsxs("div",{className:"card-body",children:[d.jsxs("ul",{className:"nav nav-tabs nav-fill mb-3",children:[d.jsx("li",{className:"nav-item",children:d.jsxs("button",{className:"nav-link "+("biodata"===l?"active":""),onClick:()=>f("biodata"),children:[d.jsx("i",{className:"bi bi-person me-2"}),"Biodata"]})}),d.jsx("li",{className:"nav-item",children:d.jsxs("button",{className:"nav-link "+("parent"===l?"active":""),onClick:()=>f("parent"),children:[d.jsx("i",{className:"bi bi-people me-2"}),"Orang Tua"]})}),d.jsx("li",{className:"nav-item",children:d.jsxs("button",{className:"nav-link "+("family"===l?"active":""),onClick:()=>f("family"),children:[d.jsx("i",{className:"bi bi-person-lines-fill me-2"}),"Keluarga"]})})]}),d.jsxs("div",{className:"tab-content",children:["biodata"===l&&d.jsx(x,{studentData:_,onRefetch:y}),"parent"===l&&d.jsx(j,{studentData:_,userid:_.userid,onRefetch:y}),"family"===l&&d.jsx(N,{families:_.family,userid:_.userid,onRefetch:y})]})]})})})})]})}):d.jsx(p,{title:`Database ${a.replace(/-/g," ")}`,levels:["admin","teacher","student","parent"],children:d.jsx("div",{className:"alert alert-danger text-center",children:"Data siswa tidak ditemukan"})})};export{g as default};
//# sourceMappingURL=DbPage-Br_KX4iD.js.map
