import{D as e,L as s,j as a,d as t,G as n,M as i,N as l,p as r,O as c,V as d,P as m}from"./index-D7P20_tq.js";import{b as o}from"./vendor-CpHG0K6b.js";import{L as h}from"./Layout-CQ6yWevG.js";import{T as u}from"./Table-DX6hFpni.js";import{r as x,u as j}from"./xlsx-B4fPQ8kA.js";const p=[{id:"nis",name:"nis",placeholder:"NIS"},{id:"name",name:"name",placeholder:"Name"}],g=({detail:n,setDetail:i})=>{const[l,r]=o.useState({id:"",entry:"",nis:"",name:"",gender:""}),{data:c}=e({page:"",limit:"",search:""}),[d,{isSuccess:m,isLoading:h,isError:u,reset:x}]=s(),j=e=>{const{name:s,value:a}=e.target;r((e=>({...e,[s]:a})))};return o.useEffect((()=>{m&&(x(),i({}),r({id:"",entry:"",nis:"",name:"",gender:""})),u&&x()}),[m,u]),o.useEffect((()=>{n&&r({id:n.id,entry:n.entry_id,name:n.name,nis:n.nis,gender:n.gender})}),[n]),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),t.promise(d(l).unwrap().then((e=>e.message)),{loading:"Menyimpan Data...",success:e=>e,error:e=>e.data.message})},className:"p-2 bg-white rounded border d-flex flex-column gap-2",children:[a.jsx("p",{className:"m-0 h6",children:"Siswa"}),a.jsxs("select",{name:"entry",id:"entry",className:"form-select",value:l.entry,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Tahun Masuk"}),null==c?void 0:c.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),null==p?void 0:p.map(((e,s)=>a.jsx("input",{type:"text",className:"form-control",placeholder:e.placeholder,name:e.name,id:e.name,value:l[e.name],onChange:j},s))),a.jsxs("select",{name:"gender",id:"gender",className:"form-select",value:l.gender,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),a.jsx("option",{value:"L",children:"Laki Laki"}),a.jsx("option",{value:"P",children:"Perempuan"})]}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{i({}),r({id:"",entry:"",nis:"",name:"",gender:""})},children:"Batal"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:h,children:"Simpan"})]})]})},b=({setDetail:e})=>{const[s,t]=o.useState(1),[m,h]=o.useState(10),[x,j]=o.useState(""),[p,g]=o.useState(""),{data:b={},isLoading:N,refetch:f}=n({page:s,limit:m,search:x}),{students:v=[],totalData:y,totalPages:S}=b,{data:w}=i(),[k,{isSuccess:L,isLoading:C,isError:D,reset:P}]=l(),[A]=r(),[E,{isLoading:M}]=c();return o.useEffect((()=>{L&&P(),D&&P()}),[L,D]),a.jsx(u,{page:s,setPage:t,setLimit:h,setSearch:j,totalData:y,totalPages:S,isLoading:N,children:a.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-center",children:"No"}),a.jsx("th",{className:"text-center",children:"Tahun Ajaran"}),a.jsx("th",{className:"text-center",children:"Satuan"}),a.jsx("th",{className:"text-center",children:"Tahun Masuk"}),a.jsx("th",{className:"text-center",children:"NIS"}),a.jsx("th",{className:"text-center",children:"Nama"}),a.jsx("th",{className:"text-center",children:"L/P"}),a.jsx("th",{className:"text-center",children:"Status"}),a.jsx("th",{className:"text-center",children:"Aksi"})]})}),a.jsx("tbody",{children:null==v?void 0:v.map(((t,n)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:(s-1)*m+n+1}),a.jsx("td",{className:"text-center align-middle",children:t.periode_name}),a.jsx("td",{className:"text-center align-middle",children:t.homebase}),a.jsx("td",{className:"text-center align-middle",children:t.entry}),a.jsx("td",{className:"text-center align-middle",children:t.nis}),a.jsx("td",{className:"align-middle",children:t.name}),a.jsx("td",{className:"text-center align-middle",children:t.gender}),a.jsx("td",{className:"text-center align-middle",children:a.jsx("div",{className:"form-check form-switch d-flex justify-content-center",onClick:()=>{return e=t.id,void d.promise(A(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:a.jsx("input",{className:"form-check-input pointer",type:"checkbox",role:"switch",id:"flexSwitchCheckChecked",checked:t.isactive,readOnly:!0})})}),a.jsx("td",{className:"text-cente align-middle",children:a.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[a.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(t),children:a.jsx("i",{className:"bi bi-pencil-square"})}),a.jsx("button",{className:"btn btn-sm btn-danger",disabled:C,onClick:()=>{return e=t.id,void d.promise(k(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:a.jsx("i",{className:"bi bi-person-x-fill"})})]})})]},n)))}),a.jsx("tfoot",{children:a.jsx("tr",{children:a.jsx("td",{colSpan:9,children:a.jsxs("div",{className:"d-flex align-items-center justify-content-end gap-2",children:[a.jsxs("select",{style:{width:"20%"},className:"form-select",value:p,onChange:e=>{const s=e.target.value;g(s)},children:[a.jsx("option",{value:"",hidden:!0,children:"Ganti Tahun Ajaran"}),null==w?void 0:w.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),a.jsxs("button",{className:"btn btn-sm btn-success",onClick:async()=>{if(p)try{const e=v.map((e=>E({userid:e.id,periodeid:p})));await Promise.all(e),d.success("Berhasil mengganti tahun ajaran"),g(""),f()}catch(e){console.error("Error updating periods:",e),d.error("Gagal mengganti tahun ajaran")}else d.error("Pilih tahun ajaran terlebih dahulu")},disabled:M||!p,children:[a.jsx("i",{className:"bi bi-save"}),a.jsx("span",{className:"ms-2",children:M?"Menyimpan...":"Simpan"})]})]})})})})]})})},N=()=>{const[e,s]=o.useState(null),n=o.useRef(null),[i,{isSuccess:l,isLoading:r,isError:c,reset:d}]=m();return o.useEffect((()=>{l&&(n.current.value=null,d()),c&&(d(),n.current.value=null)}),[l,c]),a.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=x(s,{type:"array"}),n=a.SheetNames[0],l=a.Sheets[n],r=j.sheet_to_json(l,{header:1,range:1}).map((e=>{const[s,a,t,n]=e;return[s,a,t,n]})).filter((e=>e.every((e=>null!=e)))),c=Array.isArray(r)?r:[r];t.promise(i(c).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border  d-flex flex-column gap-2 mt-2",children:[a.jsx("p",{className:"m-0 h6",children:"Upload Siswa"}),a.jsx("input",{ref:n,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0])}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_siswa.xlsx","_blank")},children:"Template"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:r,children:"Upload Data"})]})]})},f=()=>{const[e,s]=o.useState("");return a.jsx(h,{title:"Siswa",levels:["admin"],children:a.jsxs("div",{className:"row g-2",children:[a.jsxs("div",{className:"col-lg-3 col-12",children:[a.jsx(g,{detail:e,setDetail:s}),a.jsx(N,{})]}),a.jsx("div",{className:"col-lg-9 col-12",children:a.jsx(b,{setDetail:s})})]})})};export{f as default};
//# sourceMappingURL=AdminStudents-DsdXt4My.js.map
