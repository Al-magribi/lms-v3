import{B as e,_ as a,j as s,E as i,l as n,O as t,a7 as l,m as r,I as d,s as o,N as c,a8 as m,F as u,t as g,a9 as h,aa as p,ab as x,ac as j,ad as k,D as y,a5 as S,ae as f,h as b,A as w,b as N,af as A}from"./index-BerNJ4BB.js";import{c as T}from"./vendor-DnNJsrFE.js";import{T as v}from"./TableLayout-o4CxzGTY.js";import{S as C}from"./Pagination-DLBnpq19.js";import{S as I}from"./index-CgL42zmd.js";import{D as L,F as O}from"./Table-Azebf-5d.js";import{A as D}from"./Add-DOjRQfzr.js";import{U as E}from"./Upload-ChpTU_6n.js";import{U as P,R as _,r as F,u as M}from"./xlsx-scitxe1A.js";import{R}from"./DownloadOutlined-lAR0c42P.js";import{R as z}from"./CheckCircleOutlined-BPH_-5MI.js";import{R as K}from"./CloseCircleOutlined-CMO3cpkO.js";import"./DeleteOutlined-CM6OJbZQ.js";import"./progress-CvxbzCtN.js";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},H=function(s,i){return T.createElement(e,a({},s,{ref:i,icon:U}))},q=T.forwardRef(H);const B=({onClick:e})=>s.jsx(i,{style:{backgroundColor:"#52c41a",color:"#fff"},icon:s.jsx(q,{}),onClick:e,children:"Unduh"}),G=({title:e,open:a,onClose:i,student:c})=>{const[m]=n.useForm(),{data:u,isLoading:g}=t({page:"",limit:"",search:""}),[h,{isLoading:p}]=l();return s.jsx(r,{title:e,open:a,onCancel:i,okText:"Simpan",cancelText:"Tutup",onOk:()=>m.submit(),destroyOnHidden:!0,confirmLoading:p,children:s.jsxs(n,{form:m,onFinish:async e=>{try{const a={id:c.id,...e};await h(a).unwrap(),o.success("Data siswa berhasil diperbarui"),i()}catch(a){o.error(a.data?.message||"Gagal memperbarui siswa")}},layout:"vertical",initialValues:{name:c?.name,nis:c?.nis,gender:c?.gender,classid:c?.classid},children:[s.jsx(n.Item,{name:"name",label:"Nama Lengkap",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(d,{placeholder:"Nama Lengkap"})}),s.jsx(n.Item,{name:"nis",label:"NIS",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(d,{placeholder:"Nomor Induk Siswa"})}),s.jsx(n.Item,{name:"gender",label:"Jenis Kelamin",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsxs(C,{placeholder:"Pilih Jenis Kelamin",children:[s.jsx(C.Option,{value:"L",children:"Laki-laki"}),s.jsx(C.Option,{value:"P",children:"Perempuan"})]})}),s.jsx(n.Item,{name:"classid",label:"Kelas",rules:[{required:!0,message:"Wajid diisi"}],children:s.jsx(C,{placeholder:"Pilih Kelas",loading:g,options:u?.map(e=>({value:e.id,label:e.name})),showSearch:!0,optionFilterProp:"label"})})]})})},{Text:V}=g,W=()=>{const[e,a]=T.useState(1),[i,n]=T.useState(10),[t,l]=T.useState(""),[r,d]=T.useState(!1),[g,h]=T.useState(""),{data:p,isLoading:x}=c({page:e,limit:i,search:t}),[j,{data:k,isLoading:y,isSuccess:S,error:f}]=m(),b=(e,{key:a})=>{switch(a){case"edit":(e=>{d(!0),h(e)})(e);break;case"delete":s=e.id,window.confirm("Apakah anda yakin akan menghapus siswa ini?!")?j(s):o.warning("Aksi dibatalkan")}var s};T.useEffect(()=>{S&&o.success(k.message),f&&o.error(f.data.message)},[k,S,f]);const w=[{title:"No",key:"no",render:(a,s,n)=>(e-1)*i+n+1},{title:"Nama Siswa",dataIndex:"name",key:"name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx(V,{strong:!0,type:a.isactive?"success":"danger",children:e}),s.jsx(I,{children:s.jsxs("small",{children:[`Periode: ${a.periode_name}`," • ",a.nis," "]})})]})},{title:"Kelas",dataIndex:"classname",key:"classname",render:e=>s.jsx(V,{type:e?"":"danger",children:e||"Belum ada kelas"})},{title:"L/P",dataIndex:"gender",key:"gender",render:e=>s.jsx(V,{children:"P"===e?"Perempuan":"Laki Laki"})},{title:"Aksi",key:"action",render:e=>s.jsx(L.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>b(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsxs(s.Fragment,{children:[s.jsx(v,{onSearch:e=>{l(e),a(1)},isLoading:x||y,columns:w,source:p?.students,rowKey:"id",page:e,limit:i,totalData:p?.totalData,onChange:e=>{a(e.current),n(e.pageSize)}}),s.jsx(G,{title:`Perbarui data ${g?.name}`,open:r,onClose:()=>{d(!1),h("")},student:g})]})},$=()=>s.jsxs(u,{vertical:!0,gap:"middle",children:[s.jsxs(u,{align:"center",justify:"space-between",children:[s.jsx(h,{style:{margin:0},level:5,children:"Mangement Siswa"}),s.jsx(B,{})]}),s.jsx(W,{})]}),{Text:J}=g,{confirm:Y}=r,Q=({onEdit:e})=>{const[a,i]=T.useState(1),[n,t]=T.useState(10),[l,r]=T.useState(""),{data:d,isLoading:c}=p({page:a,limit:n,search:l}),[m,{data:g,error:h,isLoading:j,isSuccess:k}]=x(),y=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"reset":o.info(`Reset id ${a.parent_id}`);break;case"delete":i=a.parent_id,Y({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang sudah terhapus tidak bisa dikembalikan",okText:"Ya, Hapus",cancelText:"Batal",okType:"danger",onOk(){m(i)}})}var i};T.useEffect(()=>{k&&o.success(g.message),h&&o.error(h.data.message)},[g,k,h]);const S=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*n+i+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx(J,{strong:!0,children:e}),s.jsx(I,{children:s.jsxs("small",{children:[a.nis," • ",a.grade," • ",a.class]})})]})},{title:"Nama Orang Tua",dataIndex:"parent_name",key:"parent_name",render:(e,a)=>s.jsxs(u,{vertical:!0,gap:"small",children:[s.jsx(J,{children:e}),s.jsx(J,{type:"secondary",italic:!0,copyable:!0,children:a.parent_email})]})},{title:"Aksi",key:"action",render:e=>s.jsx(L.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"reset",label:"Reset"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>y(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsx(v,{onSearch:e=>{r(e),i(1)},isLoading:c||j,columns:S,source:d?.data,rowKey:"parent_id",page:a,limit:n,totalData:d?.totalData,onChange:e=>{i(e.current),t(e.pageSize)},children:"TableData"})},X=({open:e,onClose:a,title:i,parent:t})=>{const[l]=n.useForm(),[c,{data:m,error:u,isLoading:g,isSuccess:h,reset:p}]=j();return T.useEffect(()=>{e&&(l.resetFields(),t&&l.setFieldsValue({nis:t.nis,name:t.parent_name,email:t.parent_email}))},[e,t]),T.useEffect(()=>{h&&(o.success(m.message),l.resetFields(),a(),p()),u&&(o.error(u.data.message),p())},[m,u,h]),s.jsx(r,{title:i,open:e,onCancel:a,okText:"Simpan",cancelText:"Tutup",onOk:()=>l.submit(),destroyOnHidden:!0,loading:g,confirmLoading:g,children:s.jsxs(n,{layout:"vertical",form:l,onFinish:e=>{const a={...e,email:e.email?e.email.toLowerCase():""};if(t.parent_id){const e={id:t.parent_id,...a};c(e)}else c(a)},children:[s.jsx(n.Item,{name:"nis",label:"NIS",rules:[{required:!0,message:"NIS wajib diisi"}],children:s.jsx(d,{placeholder:"NIS"})}),s.jsx(n.Item,{name:"name",label:"Nama Orang Tua",rules:[{required:!0,message:"Nama Orang tua wajib diisi"}],children:s.jsx(d,{placeholder:"Nama Orang Tua"})}),s.jsx(n.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email wajib diisi"}],children:s.jsx(d,{placeholder:"Email"})})]})})},{Dragger:Z}=P,{Text:ee}=g,ae=[{title:"NIS",dataIndex:"nis",key:"nis"},{title:"NAMA ORANG TUA",dataIndex:"name",key:"name"},{title:"EMAIL",dataIndex:"email",key:"email"},{title:"KETERANGAN",dataIndex:"issue",key:"issue",render:e=>s.jsx(S,{color:"red",children:e})}],se=({open:e,onClose:a})=>{const[n,t]=T.useState(null),[l,d]=T.useState([]),[c,m]=T.useState([]),[g,h]=T.useState([]),[p,x]=T.useState(0),[j,{data:b,error:w,isLoading:N,isSuccess:A,reset:v}]=k(),C={name:"file",multiple:!1,accept:".xlsx, .xls, .csv",beforeUpload:e=>(t(e),(e=>{const a=new FileReader;a.onload=e=>{try{const a=new Uint8Array(e.target.result),s=F(a,{type:"array"}),i=s.SheetNames[0],n=s.Sheets[i],t=M.sheet_to_json(n,{defval:""}).map(e=>({nis:e.NIS||e.nis,name:e["NAMA ORANG TUA"]||e.name,email:e.EMAIL?String(e.EMAIL).toLowerCase():e.email?String(e.email).toLowerCase():""})),l=new Set,r=[],o=[],c=[];t.forEach(e=>{e.nis&&e.name&&e.email?l.has(e.nis)?(e.issue="NIS duplikat di dalam file ini",c.push(e)):(l.add(e.nis),r.push(e)):(e.issue="Data tidak lengkap (NIS/Nama/Email wajib diisi)",o.push(e))}),d(r),m(o),h(c)}catch(a){o.error("Gagal memproses file. Pastikan format file sudah benar.")}},a.readAsArrayBuffer(e)})(e),!1),onRemove:()=>{t(null),d([]),m([]),h([])}},L=()=>{t(null),d([]),m([]),h([]),x(e=>e+1),a()};return T.useEffect(()=>{A&&(o.success(b?.message||"Data berhasil diunggah."),v(),L()),w&&(o.error(w?.data?.message||"Terjadi kesalahan saat mengunggah."),v())},[A,w,b,v]),s.jsx(r,{title:"Upload Data Orang Tua",open:e,onCancel:L,footer:[s.jsx(i,{onClick:L,children:"Tutup"},"back"),s.jsx(i,{type:"primary",loading:N,onClick:()=>{l.length>0?j({parents:l}):o.warning("Tidak ada data valid untuk diunggah.")},disabled:0===l.length||N,children:N?"Mengunggah...":`Upload ${l.length} Data Valid`},"submit")],width:800,destroyOnHidden:!0,children:s.jsxs(I,{direction:"vertical",style:{width:"100%"},children:[T.createElement(Z,{...C,key:p},s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(_,{})}),s.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),s.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx, .xls, atau .csv. Pastikan kolom memiliki judul: NIS, NAMA ORANG TUA, EMAIL."}),s.jsx(i,{icon:s.jsx(R,{}),onClick:()=>{window.open("/template/template_orangtua.xlsx","_blank")},children:"Download Template"})),n&&s.jsxs("div",{style:{width:"100%",marginTop:16},children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(z,{style:{color:"green"}}),s.jsx(ee,{children:"Data Siap Diupload"}),s.jsx(S,{color:"success",children:l.length})]})}),s.jsx(O,{columns:ae.filter(e=>"issue"!==e.key),dataSource:l,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}}),g.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(f,{style:{color:"orange"}}),s.jsx(ee,{children:"Data Duplikat (Dilewati)"}),s.jsx(S,{color:"warning",children:g.length})]})}),s.jsx(O,{columns:ae,dataSource:g,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]}),c.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(y,{orientation:"left",plain:!0,children:s.jsxs(u,{align:"center",gap:"small",children:[s.jsx(K,{style:{color:"red"}}),s.jsx(ee,{children:"Data Tidak Lengkap (Dilewati)"}),s.jsx(S,{color:"error",children:c.length})]})}),s.jsx(O,{columns:ae,dataSource:c,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]})]})]})})},ie=()=>{const[e,a]=T.useState(!1),[i,n]=T.useState(!1),[t,l]=T.useState(!1),[r,d]=T.useState("");return s.jsxs(u,{vertical:!0,gap:"middle",children:[s.jsxs(u,{align:"center",justify:"space-between",children:[s.jsx(h,{style:{margin:0},level:5,children:"Management Orang Tua"}),s.jsxs(I,{children:[s.jsx(E,{onClick:()=>n(!0)}),s.jsx(D,{onClick:()=>a(!0)})]})]}),s.jsx(Q,{onEdit:e=>{d(e),l(!0),a(!0)}}),s.jsx(X,{title:t?"Edit Data Orang Tua":"Simpan Data Orang tua",open:e,onClose:()=>{d(""),l(!1),a(!1)},parent:r}),s.jsx(se,{open:i,onClose:()=>n(!1)})]})},ne=()=>{const e=[{key:"1",label:"Siswa",children:s.jsx($,{}),icon:s.jsx(N,{})},{key:"2",label:"Orang Tua",children:s.jsx(ie,{}),icon:s.jsx(A,{})}];return s.jsx(b,{title:"Management Siswa",levels:["admin"],children:s.jsx(w,{defaultActiveKey:"1",items:e})})};export{ne as default};
