import{ad as e,a4 as s,as as a,j as t,e as l,at as i,au as d,av as n,aw as r,ax as c,V as o,ab as m,ay as x}from"./index--FDqv5DW.js";import{b as u}from"./vendor-DfXzdC0j.js";import{L as b}from"./Layout-gnwZRalp.js";import{T as h}from"./Table-DHqShDAt.js";import{r as p,u as j}from"./xlsx-B4fPQ8kA.js";import"./index-Cjq_QsmG.js";import"./index-33-gAEu4.js";import"./index-C1AnEztE.js";const g=({detail:i,setDetail:d})=>{const[n,r]=u.useState(""),[c,o]=u.useState(""),[m,x]=u.useState(""),[b,h]=u.useState(""),{data:p}=e({page:"",limit:"",search:""}),{data:j}=s({page:"",limit:"",search:""}),[g,{isSuccess:f,isLoading:N,error:v,reset:y}]=a(),w=()=>{d({}),r(""),o(""),x(""),h("")};return u.useEffect((()=>{if(f){y(),o(""),r(""),x(""),h("");const e=document.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}v&&y()}),[f,v]),u.useEffect((()=>{i&&(r(i.id||""),o(i.name||""),x(i.grade||""),h(i.major||""))}),[i]),u.useEffect((()=>{const e=document.getElementById("addclass");if(!e)return;const s=()=>{r(""),o(""),x(""),h("")};return e.addEventListener("hidden.bs.modal",s),()=>e.removeEventListener("hidden.bs.modal",s)}),[]),t.jsx("div",{className:"modal fade",id:"addclass","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"classModalLabel","aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog ",children:t.jsxs("form",{onSubmit:e=>{e.preventDefault();const s={id:n,name:c,gradeId:m,majorId:b};l.promise(g(s).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[t.jsxs("div",{className:"modal-header",children:[t.jsx("h5",{className:"modal-title",id:"classModalLabel",children:n?"Edit Kelas":"Tambah Kelas"}),t.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:w})]}),t.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[(null==j?void 0:j.length)>0&&t.jsxs("select",{className:"form-select",value:b||"",onChange:e=>h(e.target.value),required:!0,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Jurusan"}),null==j?void 0:j.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsxs("select",{className:"form-select",value:m||"",onChange:e=>x(e.target.value),required:!0,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Tingkat"}),null==p?void 0:p.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsx("input",{type:"text",name:"class",id:"class",className:"form-control",placeholder:"Nama Kelas",value:c||"",onChange:e=>o(e.target.value),required:!0})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsxs("button",{type:"button",className:"btn btn-sm btn-warning","data-bs-dismiss":"modal",onClick:w,children:[t.jsx("i",{className:"bi bi-x-lg me-1"}),"Batal"]}),t.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:N,children:[t.jsx("i",{className:"bi bi-save me-1"}),"Simpan"]})]})]})})})},f=({classid:e})=>{const[s,a]=u.useState(""),[d,{isSuccess:n,isLoading:r,isError:c,reset:o}]=i();return u.useEffect((()=>{n&&(o(),a("")),c&&(o(),a(""))}),[n,c]),t.jsxs("form",{onSubmit:a=>{a.preventDefault();const t={nis:s,classid:e};l.promise(d(t).unwrap().then((e=>e.message)),{loading:"Meyimpan data...",success:e=>e,error:e=>e.data.message})},className:"d-flex align-items-center gap-2",children:[t.jsx("input",{type:"text",name:"nis",id:"nis",className:"form-control",placeholder:"NIS",required:!0,value:s||"",onChange:e=>a(e.target.value)}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-outline-primary",disabled:r,children:"Simpan"})]})},N=()=>{const[e,s]=u.useState(null),a=u.useRef(null),[i,{isSuccess:n,isLoading:r,isError:c,reset:o}]=d();return u.useEffect((()=>{if(n){a.current.value=null,o();document.querySelector("[data-bs-dismiss='modal']").click()}c&&(o(),a.current.value=null)}),[n,c]),u.useEffect((()=>{const e=document.getElementById("uploadstudents");if(!e)return;const t=()=>{s(null),a.current&&(a.current.value=null)};return e.addEventListener("hidden.bs.modal",t),()=>e.removeEventListener("hidden.bs.modal",t)}),[]),t.jsx("div",{className:"modal fade",id:"uploadstudents","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"uploadStudentModalLabel","aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog",children:t.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=p(s,{type:"array"}),t=a.SheetNames[0],d=a.Sheets[t],n=j.sheet_to_json(d,{header:1,range:1}).map((e=>{const[s,a,t,l,i]=e;return[s,a,t,l,i]})).filter((e=>e.every((e=>null!=e)))),r=Array.isArray(n)?n:[n];l.promise(i(r).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"modal-content p-3",children:[t.jsxs("div",{className:"modal-header",children:[t.jsxs("h5",{className:"modal-title",id:"uploadStudentModalLabel",children:[t.jsx("i",{className:"bi bi-file-earmark-arrow-up-fill me-2"}),"Upload Siswa"]}),t.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[t.jsxs("div",{className:"alert alert-info py-2 d-flex align-items-center gap-2",children:[t.jsx("i",{className:"bi bi-info-circle-fill"}),"Upload file Excel sesuai template yang disediakan."]}),t.jsx("input",{ref:a,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0]),required:!0})]}),t.jsxs("div",{className:"modal-footer",children:[t.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_siswa.xlsx","_blank")},children:[t.jsx("i",{className:"bi bi-download me-1"}),"Template"]}),t.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:r,children:[t.jsx("i",{className:"bi bi-upload me-1"}),"Upload Data"]})]})]})})})},v=({detail:e})=>{const[s,a]=u.useState(1),[l,i]=u.useState(10),[d,m]=u.useState(""),x=e.id,{data:b={},refetch:p}=n({page:s,limit:l,search:d,classid:x},{skip:!x}),{totalData:j,totalPages:g,students:N=[]}=b,[v,{isSuccess:y,isLoading:w,isError:S,reset:k}]=r(),[L,{isSuccess:E,isLoading:C,isError:D,reset:M}]=c();return u.useEffect((()=>{(y||S)&&k()}),[y,S]),u.useEffect((()=>{(E||D)&&M()}),[E,D]),t.jsx("div",{className:"modal fade",id:"modal-add","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",children:t.jsxs("div",{className:"modal-content",children:[t.jsxs("div",{className:"modal-header border-bottom bg-white py-3 px-4",children:[t.jsxs("h1",{className:"modal-title fs-5 d-flex align-items-center gap-2 fw-bold",id:"staticBackdropLabel",children:[t.jsx("i",{className:"bi bi-mortarboard-fill text-primary fs-4"}),"Kelas ",t.jsx("span",{className:"text-primary",children:null==e?void 0:e.name})]}),t.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),t.jsxs("div",{className:"modal-body bg-light d-flex flex-column gap-3 px-4 py-3",children:[t.jsx("div",{className:"card shadow-sm h-100 border-0",children:t.jsxs("div",{className:"card-body",children:[t.jsx("h6",{className:"card-title mb-3 fw-semibold",children:"Tambah Siswa"}),t.jsx(f,{classid:e.id})]})}),t.jsx("div",{className:"card shadow-sm border-0",children:t.jsx("div",{className:"card-body",children:t.jsx(h,{page:s,setPage:a,setLimit:i,setSearch:m,totalData:j,totalPages:g,children:t.jsx("div",{className:"table-responsive",children:t.jsxs("table",{className:"table table-hover table-striped table-bordered align-middle mb-0",children:[t.jsx("thead",{className:"bg-light",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",style:{width:"60px"},children:"No"}),t.jsx("th",{className:"text-center",children:"Jurusan"}),t.jsx("th",{className:"text-center",children:"Tingkat"}),t.jsx("th",{className:"text-center",children:"NIS"}),t.jsx("th",{children:"Nama"}),t.jsx("th",{className:"text-center",children:"Status"}),t.jsx("th",{className:"text-center",style:{width:"100px"},children:"Aksi"})]})}),t.jsx("tbody",{children:(null==N?void 0:N.length)>0?null==N?void 0:N.map(((e,a)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center",children:(s-1)*l+a+1}),t.jsx("td",{className:"text-center",children:e.major_name}),t.jsx("td",{className:"text-center",children:e.grade_name}),t.jsx("td",{className:"text-center",children:e.nis}),t.jsx("td",{children:e.student_name}),t.jsx("td",{className:"text-center",children:e.isactive?t.jsx("span",{className:"badge rounded-pill bg-primary bg-opacity-25 text-primary px-3 py-2 fw-normal",children:"Aktif"}):t.jsx("span",{className:"badge rounded-pill bg-success bg-opacity-25 text-success px-3 py-2 fw-normal",children:"Lulus"})}),t.jsx("td",{className:"text-center",children:t.jsx("button",{className:"btn btn-sm btn-outline-danger d-flex align-items-center justify-content-center gap-1",disabled:w,style:{transition:"0.2s"},onMouseOver:e=>e.currentTarget.classList.add("shadow"),onMouseOut:e=>e.currentTarget.classList.remove("shadow"),onClick:()=>{return s=e.id,void o.promise(v(s).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var s},children:t.jsx("i",{className:"bi bi-person-dash"})})})]},a))):t.jsx("tr",{children:t.jsx("td",{colSpan:7,className:"text-center py-4",children:t.jsxs("div",{className:"d-flex flex-column align-items-center gap-2 text-muted",children:[t.jsx("i",{className:"bi bi-inbox fs-4"}),t.jsx("span",{children:"Data tidak tersedia"})]})})})})]})})})})})]}),t.jsxs("div",{className:"modal-footer border-top bg-white px-4 py-3 d-flex justify-content-between align-items-center",children:[t.jsxs("button",{className:"btn btn-outline-primary d-flex align-items-center gap-2",onClick:()=>{window.open("/temp/template_kelas_siswa.xlsx","_blank")},children:[t.jsx("i",{className:"bi bi-download"}),"Template"]}),t.jsxs("button",{className:"btn btn-success d-flex align-items-center gap-2",disabled:C,onClick:()=>{o.promise(L(x).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},children:[t.jsx("i",{className:"bi bi-mortarboard"}),"Luluskan"]})]})]})})})},y=({setDetail:e})=>{const[s,a]=u.useState(1),[i,d]=u.useState(12),[n,r]=u.useState(""),[c,o]=u.useState({}),{data:b={},isLoading:p}=m({page:s,limit:i,search:n}),{classes:j=[],totalData:g,totalPages:f}=b,[N,{isSuccess:y,isLoading:w,error:S,reset:k}]=x();return u.useEffect((()=>{y&&k(),S&&k()}),[y,S]),t.jsxs(h,{page:s,setPage:a,setLimit:d,setSearch:r,totalData:g,totalPages:f,isLoading:p,children:[t.jsx("div",{className:"row g-4",children:j.length>0?j.map(((s,a)=>t.jsx("div",{className:"col-12 col-md-6 col-lg-4 col-xl-3",children:t.jsx("div",{className:"card bg-white border rounded-4 shadow-sm hover-shadow h-100 position-relative",children:t.jsx("div",{className:"card-body p-4 d-flex flex-column h-100",children:t.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-3",children:[t.jsxs("div",{className:"d-flex flex-column gap-2",children:[t.jsxs("div",{className:"d-flex flex-column align-items-start",children:[t.jsxs("span",{className:"badge bg-secondary bg-opacity-10 text-secondary fst-italic",children:["_id: ",s.id]}),t.jsx("h4",{className:"fw-bold text-primary m-0",style:{fontSize:22},children:s.name})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("i",{className:"bi bi-mortarboard text-success"}),t.jsx("span",{className:"text-muted small",children:s.major_name})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("i",{className:"bi bi-bar-chart text-info"}),t.jsxs("span",{className:"text-muted small",children:["Tingkat: ",s.grade_name]})]}),t.jsxs("div",{className:"d-flex align-items-center gap-2",children:[t.jsx("i",{className:"bi bi-people text-primary"}),t.jsxs("span",{className:"text-muted small",children:[s.students," Siswa"]})]})]}),t.jsxs("div",{className:"dropdown ms-2",children:[t.jsx("button",{className:"btn btn-sm btn-outline-primary",type:"button",id:`dropdownMenuButton-${a}`,"data-bs-toggle":"dropdown","aria-expanded":"false",children:t.jsx("i",{className:"bi bi-three-dots-vertical"})}),t.jsxs("ul",{className:"dropdown-menu dropdown-menu-end shadow","aria-labelledby":`dropdownMenuButton-${a}`,children:[t.jsx("li",{children:t.jsxs("button",{type:"button",className:"dropdown-item d-flex align-items-center gap-2","data-bs-toggle":"modal","data-bs-target":"#modal-add",onClick:()=>o(s),children:[t.jsx("i",{className:"bi bi-people-fill"})," Siswa"]})}),t.jsx("li",{children:t.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2","data-bs-toggle":"modal","data-bs-target":"#addclass",onClick:()=>e(s),children:[t.jsx("i",{className:"bi bi-pencil-square"})," Edit"]})}),t.jsx("li",{children:t.jsx("hr",{className:"dropdown-divider"})}),t.jsx("li",{children:t.jsxs("button",{className:"dropdown-item d-flex align-items-center gap-2 text-danger",disabled:w,onClick:()=>{return e=s.id,void(window.confirm("Apakah anda yakin ingin menghapus data kelas ini dan semua data yang terkait dengan kelas ini?")&&l.promise(N(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[t.jsx("i",{className:"bi bi-folder-minus"})," Hapus"]})})]})]})]})})})},a))):t.jsx("div",{className:"col-12",children:t.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5 text-muted gap-2",children:[t.jsx("i",{className:"bi bi-inbox fs-1"}),t.jsx("span",{className:"fs-5",children:"Data belum tersedia"})]})})}),t.jsx(v,{detail:c})]})},w=()=>{const[e,s]=u.useState("");return t.jsxs(b,{title:"Kelas",levels:["admin"],children:[t.jsx(g,{detail:e,setDetail:s}),t.jsx(y,{setDetail:s}),t.jsx(N,{})]})};export{w as default};
//# sourceMappingURL=AdminClass-ASpldrBf.js.map
