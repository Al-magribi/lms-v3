import{b as e,aC as a,aG as s,aH as l,j as n,e as t,aI as i,aJ as d,aK as c}from"./index-DFhdulld.js";import{b as r}from"./vendor-CnnDPxwB.js";import{S as o}from"./react-select.esm-C351JJ6e.js";import{T as m}from"./Table-CpyGbvYh.js";const u=({detail:i,setDetail:d,onSuccess:c})=>{var m;const{user:u}=e((e=>e.auth)),h={examid:"",teacher:(null==u?void 0:u.id)||"",bank:[],name:"",duration:"",classes:[],token:"",isshuffle:"",mc_score:"",essay_score:""},[b,p]=r.useState(h),{data:x}=a(),{data:j}=s(),[g,{isSuccess:v,isLoading:N,isError:f,reset:k}]=l(),y=null==x?void 0:x.map((e=>({value:e.id,label:e.name,bank:e.bank}))),C="teacher"===(null==u?void 0:u.level)?null==x?void 0:x.find((e=>e.id===u.id)):null==x?void 0:x.find((e=>e.id===b.teacher)),S=null==(m=null==C?void 0:C.bank)?void 0:m.map((e=>({value:e.id,label:e.name,type:e.type}))),_=null==j?void 0:j.map((e=>({value:e.id,label:e.name})));r.useEffect((()=>{(null==i?void 0:i.id)?p({examid:i.id,teacher:i.teacher,name:i.name,duration:i.duration,token:i.token,isshuffle:i.isshuffle,mc_score:i.mc_score,essay_score:i.essay_score,bank:i.banks.map((e=>({bankid:e.id,type:e.type,pg:e.pg,essay:e.essay}))),classes:i.classes.map((e=>({value:e.id,label:e.name})))}):"teacher"===(null==u?void 0:u.level)&&p((e=>({...e,teacher:u.id})))}),[i,u]);const w=(e,a,s)=>{const{value:l}=e.target;p((e=>({...e,bank:e.bank.map((e=>e.bankid===a?{...e,[s]:l}:e))})))},E=()=>{p({...h,teacher:(null==u?void 0:u.id)||""}),d(null)};return r.useEffect((()=>{if(v){E(),k(),null==c||c();const e=document.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}f&&k()}),[v,f,c]),r.useEffect((()=>()=>{document.body.style.overflow="unset"}),[]),n.jsx("div",{className:"modal fade",id:"addexam","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:n.jsx("div",{className:"modal-dialog",children:n.jsxs("form",{onSubmit:e=>{e.preventDefault(),t.promise(g(b).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message})},className:"modal-content",children:[n.jsxs("div",{className:"modal-header",children:[n.jsx("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:(null==i?void 0:i.id)?"Edit Ujian":"Tambah Ujian"}),n.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),n.jsx("div",{className:"modal-body",children:n.jsxs("div",{className:"d-flex flex-column gap-2",children:[n.jsx(o,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(null==y?void 0:y.find((e=>e.value===b.teacher)))||null,options:y,onChange:e=>{p((a=>({...a,teacher:(null==e?void 0:e.value)||null,bank:[]})))},isDisabled:!!(null==i?void 0:i.id)}),n.jsx(o,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Pilih Bank Soal",value:null==S?void 0:S.filter((e=>b.bank.some((a=>a.bankid===e.value)))),options:S,onChange:e=>{const a=(null==e?void 0:e.map((e=>({bankid:e.value,type:e.type,pg:"",essay:""}))))||[];p((e=>({...e,bank:a})))},isDisabled:!b.teacher||!!(null==i?void 0:i.id)}),b.bank.filter((e=>"bank"===e.type)).map((e=>{var a,s,l;return n.jsxs("div",{className:"border p-2 rounded",children:[n.jsx("p",{className:"m-0",children:(null==(a=null==S?void 0:S.find((a=>a.value===e.bankid)))?void 0:a.label)||(null==(l=null==(s=null==i?void 0:i.banks)?void 0:s.find((a=>a.id===e.bankid)))?void 0:l.name)}),n.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal PG ",value:e.pg,onChange:a=>w(a,e.bankid,"pg")}),n.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal Essay ",value:e.essay,onChange:a=>w(a,e.bankid,"essay")})]},e.bankid)})),n.jsx(o,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Untuk Kelas",value:b.classes,options:_,onChange:e=>{p((a=>({...a,classes:e||[]})))}}),n.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Ujian",value:b.name||"",onChange:e=>p({...b,name:e.target.value})}),n.jsx("input",{type:"number",name:"duration",className:"form-control",placeholder:"Durasi",value:b.duration||"",onChange:e=>p({...b,duration:e.target.value})}),n.jsx("input",{type:"number",name:"mc_score",id:"mc_score",className:"form-control",placeholder:"Persentase Nilai PG",value:b.mc_score,onChange:e=>p({...b,mc_score:e.target.value})}),n.jsx("input",{type:"number",name:"essay_score",id:"essay_score",className:"form-control",placeholder:"Persentase Nilai Essay",value:b.essay_score,onChange:e=>p({...b,essay_score:e.target.value})}),n.jsxs("select",{name:"isshuffle",className:"form-control",value:b.isshuffle,onChange:e=>p({...b,isshuffle:e.target.value}),children:[n.jsx("option",{value:"",hidden:!0,children:"Acak Soal"}),n.jsx("option",{value:!0,children:"Ya"}),n.jsx("option",{value:!1,children:"Tidak"})]})]})}),n.jsxs("div",{className:"modal-footer",children:[n.jsx("button",{type:"button",className:"btn btn-sm btn-warning","data-bs-dismiss":"modal",onClick:()=>{E(),null==c||c()},children:"Batal"}),n.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:N,children:(null==i?void 0:i.id)?"Update":"Simpan"})]})]})})})},h=({setDetail:e})=>{const[a,s]=r.useState(1),[l,o]=r.useState(10),[u,h]=r.useState(""),{data:b={},isLoading:p}=i({page:a,limit:l,search:u}),{exams:x=[],totalData:j,totalPages:g}=b,[v,{isSuccess:N,isLoading:f,isError:k,reset:y}]=d(),[C,{isSuccess:S,isError:_,reset:w}]=c();return r.useEffect((()=>{(N||k)&&y()}),[N,k]),r.useEffect((()=>{(S||_)&&w()}),[S,_]),n.jsx(m,{page:a,setPage:s,setLimit:o,setSearch:h,totalData:j,totalPages:g,isLoading:p,children:n.jsxs("table",{className:"table table-striped table-bordered table-hover mb-0",children:[n.jsx("thead",{children:n.jsxs("tr",{children:[n.jsx("th",{className:"text-center",children:"Guru"}),n.jsx("th",{className:"text-center",children:"Bank Soal"}),n.jsx("th",{className:"text-center",children:"Nama Ujian"}),n.jsx("th",{className:"text-center",children:"PG"}),n.jsx("th",{className:"text-center",children:"Essay"}),n.jsx("th",{className:"text-center",children:"Kelas"}),n.jsx("th",{className:"text-center",children:"Acak"}),n.jsx("th",{className:"text-center",children:"Durasi"}),n.jsx("th",{className:"text-center",children:"Status"}),n.jsx("th",{className:"text-center",children:"Token"}),n.jsx("th",{style:{width:280},className:"text-center",children:"Aksi"})]})}),n.jsx("tbody",{children:(null==x?void 0:x.length)>0?null==x?void 0:x.map(((a,s)=>{var l;return n.jsxs("tr",{children:[n.jsx("td",{className:"align-middle",children:a.teacher_name}),n.jsx("td",{className:"align-middle",children:a.banks.map(((e,a)=>n.jsx("p",{className:"m-0",children:"paket"!==e.type?`${e.name} - PG ${e.pg} - Essay ${e.essay}`:`${e.name}`},a)))}),n.jsx("td",{className:"align-middle",children:a.name}),n.jsx("td",{className:"text-center align-middle",children:n.jsx("p",{className:"m-0 badge bg-success",children:`${a.mc_score}%`})}),n.jsx("td",{className:"text-center align-middle",children:n.jsx("p",{className:"m-0 badge bg-success",children:`${a.essay_score}%`})}),n.jsx("td",{className:"align-middle",children:n.jsx("div",{style:{width:100},className:"d-flex align-items-center justify-content-center flex-wrap gap-2",children:null==(l=a.classes)?void 0:l.map(((e,a)=>n.jsx("span",{className:"badge bg-primary",children:e.name},a)))})}),n.jsx("td",{className:"text-center align-middle",children:a.isshuffle?n.jsx("p",{className:"m-0 badge bg-success",children:"Ya"}):n.jsx("p",{className:"m-0 badge bg-danger",children:"Tidak"})}),n.jsx("td",{className:"text-center align-middle",children:n.jsx("p",{className:"m-0 badge bg-primary",children:`${a.duration} Menit`})}),n.jsx("td",{className:"text-center align-middle",children:n.jsx("div",{className:"form-check form-switch pointer d-flex justify-content-center",onClick:()=>{return e=a.id,void t.promise(C(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:n.jsx("input",{className:"form-check-input bg-success",type:"checkbox",id:"flexSwitchCheckChecked",checked:a.isactive,readOnly:!0})})}),n.jsx("td",{className:"text-center align-middle",children:n.jsx("p",{className:"m-0 badge bg-secondary pointer","data-toggle":"tooltip","data-placement":"top",title:"Copy Token",onClick:()=>{return e=a.token,navigator.clipboard.writeText(e),void t.success("Token berhasil disalin");var e},children:a.token})}),n.jsx("td",{className:"text-center align-middle",children:n.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[n.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>((e,a,s)=>{const l=e.toUpperCase().replace(/ /g,"-");window.open(`/laporan-ujian/${l}/${a}/${s}`,"_blank")})(a.name,a.id,a.token),children:[n.jsx("i",{className:"bi bi-people"}),n.jsx("span",{className:"ms-2",children:"Lihat"})]}),n.jsxs("button",{className:"btn btn-sm btn-warning","data-bs-toggle":"modal","data-bs-target":"#addexam",onClick:()=>e(a),children:[n.jsx("i",{className:"bi bi-pencil-square"}),n.jsx("span",{className:"ms-2",children:"Edit"})]}),n.jsxs("button",{className:"btn btn-sm btn-danger",disabled:f,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus ujian ini dan semua data yang terkait dengan ujian ini?")&&t.promise(v(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[n.jsx("i",{className:"bi bi-folder-x"}),n.jsx("span",{className:"ms-2",children:"Hapus"})]})]})})]},s)})):n.jsx("tr",{children:n.jsx("td",{colSpan:11,children:"Data belum tersedia"})})})]})})},b=()=>{const[e,a]=r.useState(null);return n.jsxs("div",{className:"row g-2",children:[n.jsx("div",{className:"col-12",children:n.jsx(h,{setDetail:e=>{a(e)}})}),n.jsx(u,{detail:e,setDetail:a})]})};export{b as C};
//# sourceMappingURL=CbtExam-Bs6NDpH5.js.map
