import{r as o,H as C,I as D,J as T,j as e,V as k,K as M,e as A,L as E,M as P}from"./index-_V-Hszfs.js";import{L as G}from"./Layout-BOPYSC9s.js";import{S as U}from"./react-select.esm-BK9OElNt.js";import{r as K,u as _}from"./xlsx-BPPrXeCd.js";import{T as B}from"./Table-pFA1e1UJ.js";const F=({detail:t,setDetail:d})=>{const[n,u]=o.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:x}=C({page:"",limit:"",search:""}),{data:j}=D({page:"",limit:"",search:""}),[f,{isSuccess:b,isLoading:v,isError:i,reset:p}]=T(),m=s=>{const{name:l,value:a,type:c,checked:r}=s.target;u(h=>({...h,[l]:c==="checkbox"?r:a}))},S=s=>{u(l=>({...l,subjects:s||[]}))},N=async s=>{if(s.preventDefault(),!n.name||!n.username)return k.error("Lengkapi data");k.promise(f(n).unwrap().then(l=>l.message),{loading:"Memproses...",success:l=>l,error:l=>l.data.message})},g=()=>{d({}),u({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};o.useEffect(()=>{b&&(p(),g()),i&&p()},[b,i]),o.useEffect(()=>{var s;t&&u({id:t.id||"",username:t.username||"",name:t.name||"",homeroom:t.homeroom||!1,classid:t.class||"",gender:t.gender||"",subjects:((s=t.subjects)==null?void 0:s.map(l=>({value:l.id,label:l.name})))||[]})},[t]);const y=(j==null?void 0:j.map(s=>({value:s.id,label:s.name})))||[];return e.jsxs("form",{onSubmit:N,className:"rounded bg-white p-2 border d-flex flex-column gap-2",children:[e.jsx("p",{className:"m-0 h6",children:"Guru"}),e.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:n.username,onChange:m}),e.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:n.name,onChange:m}),e.jsxs("select",{name:"gender",className:"form-select",value:n.gender,onChange:m,children:[e.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki Laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]}),e.jsx(U,{isMulti:!0,options:y,value:n.subjects,onChange:S,className:"mb-2",placeholder:"Mata Pelajaran"}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:n.homeroom,onChange:m}),e.jsx("label",{className:"form-check-label",children:"Wali Kelas"})]}),n.homeroom&&e.jsxs("select",{name:"classid",className:"form-select",value:n.classid,onChange:m,children:[e.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),x==null?void 0:x.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:g,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:v,children:"Simpan"})]})]})},R=()=>{const[t,d]=o.useState(null),n=o.useRef(null),[u,{isSuccess:x,isLoading:j,isError:f,reset:b}]=M(),v=()=>{window.open("/temp/template_guru.xlsx","_blank")},i=p=>{if(p.preventDefault(),t){const m=new FileReader;m.onload=S=>{const N=new Uint8Array(S.target.result),g=K(N,{type:"array"}),y=g.SheetNames[0],s=g.Sheets[y],a=_.sheet_to_json(s,{header:1,range:1}).map(r=>{const[h,L,w]=r;return[h,L,w]}).filter(r=>r.every(h=>h!=null)),c=Array.isArray(a)?a:[a];A.promise(u(c).unwrap().then(r=>r.message),{loading:"Menyimpan data...",success:r=>r,error:r=>r.data.message})},m.readAsArrayBuffer(t)}};return o.useEffect(()=>{x&&(n.current.value=null,b()),f&&(b(),n.current.value=null)},[x,f]),e.jsxs("form",{onSubmit:i,className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[e.jsx("p",{className:"m-0 h6",children:"Upload Guru"}),e.jsx("input",{ref:n,type:"file",name:"students",id:"student",className:"form-control",onChange:p=>d(p.target.files[0])}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:v,children:"Template"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:j,children:"Upload Data"})]})]})},H=({setDetail:t})=>{const[d,n]=o.useState(1),[u,x]=o.useState(10),[j,f]=o.useState(""),{data:b={},isLoading:v}=E({page:d,limit:u,search:j}),{teachers:i=[],totalData:p,totalPages:m}=b,[S,{isSuccess:N,isLoading:g,isError:y,reset:s}]=P(),l=a=>{k.promise(S(a).unwrap().then(c=>c.message),{loading:"Memproses...",success:c=>c,error:c=>c.data.message})};return o.useEffect(()=>{N&&s(),y&&s()},[N,y]),e.jsx(B,{page:d,setPage:n,setLimit:x,setSearch:f,totalData:p,totalPages:m,isLoading:v,children:e.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Satuan"}),e.jsx("th",{className:"text-center",children:"Username"}),e.jsx("th",{className:"text-center",children:"Nama"}),e.jsx("th",{className:"text-center",children:"Jenis Kelamin"}),e.jsx("th",{className:"text-center",children:"Mata Pelajaran"}),e.jsx("th",{className:"text-center",children:"Wali Kelas"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(i==null?void 0:i.length)>0?i==null?void 0:i.map((a,c)=>{var r;return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(d-1)*u+c+1}),e.jsx("td",{className:"text-center align-middle",children:a.homebase}),e.jsx("td",{className:"text-center align-middle",children:a.username}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"text-center align-middle",children:a.gender=="L"?"Laki Laki":"Perempuan"}),e.jsx("td",{className:"align-middle",children:(r=a.subjects)==null?void 0:r.map(h=>e.jsx("p",{className:"m-0",children:h.name},h.id))}),e.jsx("td",{className:"text-center align-middle",children:a.homeroom?a.class_name:"-"}),e.jsx("td",{className:"text-cente align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>t(a),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:g,onClick:()=>l(a.id),children:e.jsx("i",{className:"bi bi-folder-minus"})})]})})]},c)}):e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"",children:"Data Belum tersedia"})})})]})})},I=()=>{const[t,d]=o.useState({});return e.jsx(G,{title:"Guru",levels:["admin"],children:e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-lg-3 col-12",children:[e.jsx(F,{detail:t,setDetail:d}),e.jsx(R,{})]}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsx(H,{setDetail:d})})]})})};export{I as default};
