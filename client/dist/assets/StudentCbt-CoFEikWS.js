import{b as e,aQ as a,aR as s,j as i,e as n,aS as t}from"./index-DFhdulld.js";import{b as l}from"./vendor-CnnDPxwB.js";import{L as d}from"./Layout-GZnRoUIy.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const r=({exam:t,setExam:d})=>{const[r,c]=l.useState(""),o=l.useRef(null),{user:m}=e((e=>e.auth)),{data:u,isLoading:x}=a({exam:t.id,student:m.user_id},{skip:!t.id||!m.user_id}),[b,{isLoading:h}]=s();l.useEffect((()=>{o.current&&(o.current.addEventListener("shown.bs.modal",(()=>{o.current.removeAttribute("aria-hidden")})),o.current.addEventListener("hidden.bs.modal",(()=>{o.current.setAttribute("aria-hidden","true")})))}),[]);const j=()=>{d({}),c("")};return i.jsx("div",{ref:o,className:"modal fade",id:"token",tabIndex:"-1",role:"dialog","aria-labelledby":"token-label","aria-modal":"true",children:i.jsx("div",{className:"modal-dialog",children:i.jsxs("div",{className:"modal-content",children:[i.jsxs("div",{className:"modal-header",children:[i.jsxs("h5",{className:"modal-title",id:"token-label",children:["Token ",t.name]}),i.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:j})]}),i.jsx("div",{className:"modal-body",children:i.jsx("input",{type:"text",name:"token",id:"token",className:"form-control",placeholder:"Masukkan Token",value:r,onChange:e=>c(e.target.value),"aria-label":"Token input"})}),i.jsxs("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-danger","data-bs-dismiss":"modal",onClick:j,children:"Tutup"}),i.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{if(!t.id)return void n.error("Ujian tidak ditemukan");if(r!==t.token)return n.error("Token Salah"),void c("");if(u&&u.ispenalty)return n.error("Anda melanggar ketentuan"),void c("");if(u&&u.isactive)return n.error("Anda sedang mengikuti ujian"),void c("");if(u&&u.isdone)return n.error("Anda sudah mengikuti ujian"),void c("");console.log(u);const e={exam:t.id,student:m.user_id,action:"start",start_time:(new Date).toISOString()};n.promise(b(e).unwrap(),{loading:"Memuat...",success:e=>{d({}),c("");const a=document.getElementById("token");if(a){const e=a.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}localStorage.removeItem("questions");const s=t.name.replace(/\s+/g,"-");window.location.href=`/siswa-cbt/${s}/${t.id}/${t.token}`},error:e=>{var a;return console.log("Error starting exam:",e),(null==(a=e.data)?void 0:a.message)||"Gagal memulai ujian"}})},disabled:x||h,children:"Konfirmasi"})]})]})})})},c=({classid:e})=>{const[a,s]=l.useState(1),[n,d]=l.useState(10),[c,o]=l.useState(""),{data:m={},isLoading:u}=t({classid:e,page:a,limit:n,search:c},{skip:!e}),{exams:x=[],totalData:b,totalPages:h}=m,[j,p]=l.useState({}),g=e=>{e>=1&&e<=h&&s(e)};return i.jsxs("div",{className:"container-fluid py-4",children:[i.jsxs("div",{className:"row mb-4",children:[i.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:i.jsxs("div",{className:"input-group",children:[i.jsx("span",{className:"input-group-text bg-white border-end-0",children:i.jsx("i",{className:"bi bi-search"})}),i.jsx("input",{type:"text",className:"form-control border-start-0 ps-0",placeholder:"Cari ujian...",value:c,onChange:e=>{o(e.target.value),s(1)}})]})}),i.jsx("div",{className:"col-md-6 col-lg-2",children:i.jsxs("select",{className:"form-select",value:n,onChange:e=>{d(Number(e.target.value)),s(1)},children:[i.jsx("option",{value:"5",children:"5 per halaman"}),i.jsx("option",{value:"10",children:"10 per halaman"}),i.jsx("option",{value:"25",children:"25 per halaman"}),i.jsx("option",{value:"50",children:"50 per halaman"})]})})]}),u?i.jsx("div",{className:"text-center py-5",children:i.jsx("div",{className:"spinner-border text-primary",role:"status",children:i.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):i.jsxs(i.Fragment,{children:[i.jsx("div",{className:"row g-3 mb-4",children:(null==x?void 0:x.length)>0?null==x?void 0:x.map(((e,a)=>i.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:i.jsx("div",{className:"card h-100 shadow-sm border hover-shadow",children:i.jsxs("div",{className:"card-body",children:[i.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[i.jsx("h5",{className:"card-title text-primary mb-0 fw-bold",children:e.name}),e.isactive?i.jsxs("span",{className:"badge rounded-pill bg-success px-3 py-2",children:[i.jsx("i",{className:"bi bi-check-circle me-1"}),"Aktif"]}):i.jsxs("span",{className:"badge rounded-pill bg-danger px-3 py-2",children:[i.jsx("i",{className:"bi bi-x-circle me-1"}),"Nonaktif"]})]}),i.jsxs("div",{className:"mb-3",children:[i.jsxs("div",{className:"d-flex align-items-center text-muted mb-2",children:[i.jsx("i",{className:"bi bi-person-circle me-2"}),i.jsx("span",{children:e.teacher_name})]}),i.jsxs("div",{className:"d-flex align-items-center text-muted",children:[i.jsx("i",{className:"bi bi-clock me-2"}),i.jsxs("span",{children:[e.duration," Menit"]})]})]}),i.jsx("div",{className:"d-grid",children:i.jsxs("button",{className:"btn btn-sm btn-primary rounded-pill","data-bs-toggle":"modal","data-bs-target":"#token",disabled:!e.isactive,onClick:()=>p(e),children:[i.jsx("i",{className:"bi bi-reception-4 me-2"}),"Ikuti Ujian"]})})]})})},e.id))):i.jsx("div",{className:"col-12",children:i.jsxs("div",{className:"text-center py-5 text-muted",children:[i.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-3"}),i.jsx("h5",{children:"Data Belum Tersedia"}),i.jsx("p",{className:"text-muted mb-0",children:c?"Tidak ada ujian yang sesuai dengan pencarian Anda":"Belum ada ujian yang tersedia saat ini"})]})})}),h>0&&i.jsxs("nav",{"aria-label":"Page navigation",className:"d-flex justify-content-between align-items-center",children:[i.jsxs("div",{className:"text-muted",children:[b," Ujian Tersedia"]}),i.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[i.jsx("li",{className:"page-item "+(1===a?"disabled":""),children:i.jsx("button",{className:"page-link",onClick:()=>g(a-1),disabled:1===a,children:i.jsx("i",{className:"bi bi-chevron-left"})})}),[...Array(h)].map(((e,s)=>i.jsx("li",{className:"page-item "+(a===s+1?"active":""),children:i.jsx("button",{className:"page-link",onClick:()=>g(s+1),children:s+1})},s+1))),i.jsx("li",{className:"page-item "+(a===h?"disabled":""),children:i.jsx("button",{className:"page-link",onClick:()=>g(a+1),disabled:a===h,children:i.jsx("i",{className:"bi bi-chevron-right"})})})]})]})]}),i.jsx(r,{exam:j,setExam:p})]})},o=()=>{const{user:a}=e((e=>e.auth));return i.jsx(d,{title:"Daftar Ujian Saya",levels:["student"],children:i.jsx(c,{classid:a.class_id})})};export{o as default};
//# sourceMappingURL=StudentCbt-CoFEikWS.js.map
