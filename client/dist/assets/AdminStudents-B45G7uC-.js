import{r as i,x as E,D as A,j as e,e as D,a as M,E as P,F as T,V as F,G as U}from"./index-_V-Hszfs.js";import{L as _}from"./Layout-BOPYSC9s.js";import{T as R}from"./Table-pFA1e1UJ.js";import{r as B,u as G}from"./xlsx-BPPrXeCd.js";const w=[{id:"nis",name:"nis",placeholder:"NIS"},{id:"name",name:"name",placeholder:"Name"}],H=({detail:t,setDetail:l})=>{const x="",g="",b="",[o,c]=i.useState({id:"",entry:"",nis:"",name:"",gender:""}),{data:m}=E({page:x,limit:g,search:b}),[S,{isSuccess:u,isLoading:p,isError:j,reset:f}]=A(),h=s=>{const{name:n,value:a}=s.target;c(r=>({...r,[n]:a}))},N=s=>{s.preventDefault(),D.promise(S(o).unwrap().then(n=>n.message),{loading:"Menyimpan Data...",success:n=>n,error:n=>n.data.message})},y=()=>{l({}),c({id:"",entry:"",nis:"",name:"",gender:""})};return i.useEffect(()=>{u&&(f(),l({}),c({id:"",entry:"",nis:"",name:"",gender:""})),j&&f()},[u,j]),i.useEffect(()=>{t&&c({id:t.id,entry:t.entry_id,name:t.name,nis:t.nis,gender:t.gender})},[t]),e.jsxs("form",{onSubmit:N,className:"p-2 bg-white rounded border d-flex flex-column gap-2",children:[e.jsx("p",{className:"m-0 h6",children:"Siswa"}),e.jsxs("select",{name:"entry",id:"entry",className:"form-select",value:o.entry,onChange:h,children:[e.jsx("option",{value:"",hidden:!0,children:"Tahun Masuk"}),m==null?void 0:m.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),w==null?void 0:w.map((s,n)=>e.jsx("input",{type:"text",className:"form-control",placeholder:s.placeholder,name:s.name,id:s.name,value:o[s.name],onChange:h},n)),e.jsxs("select",{name:"gender",id:"gender",className:"form-select",value:o.gender,onChange:h,children:[e.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),e.jsx("option",{value:"L",children:"Laki Laki"}),e.jsx("option",{value:"P",children:"Perempuan"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:y,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:p,children:"Simpan"})]})]})},I=({setDetail:t})=>{M();const[l,x]=i.useState(1),[g,b]=i.useState(10),[o,c]=i.useState(""),{data:m={},isLoading:S}=P({page:l,limit:g,search:o}),{students:u=[],totalData:p,totalPages:j}=m,[f,{isSuccess:h,isLoading:N,isError:y,reset:s}]=T(),n=a=>{F.promise(f(a).unwrap().then(r=>r.message),{loading:"Memproses...",success:r=>r,error:r=>r.data.message})};return i.useEffect(()=>{h&&s(),y&&s()},[h,y]),e.jsx(R,{page:l,setPage:x,setLimit:b,setSearch:c,totalData:p,totalPages:j,isLoading:S,children:e.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Satuan"}),e.jsx("th",{className:"text-center",children:"Tahun Masuk"}),e.jsx("th",{className:"text-center",children:"NIS"}),e.jsx("th",{className:"text-center",children:"Nama"}),e.jsx("th",{className:"text-center",children:"Kelamin"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:u==null?void 0:u.map((a,r)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(l-1)*g+r+1}),e.jsx("td",{className:"text-center align-middle",children:a.homebase}),e.jsx("td",{className:"text-center align-middle",children:a.entry}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"text-center align-middle",children:a.gender==="L"?"Laki - Laki":"Perempuan"}),e.jsx("td",{className:"text-cente align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>t(a),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:N,onClick:()=>n(a.id),children:e.jsx("i",{className:"bi bi-person-x-fill"})})]})})]},r))})]})})},K=()=>{const[t,l]=i.useState(null),x=i.useRef(null),[g,{isSuccess:b,isLoading:o,isError:c,reset:m}]=U(),S=()=>{window.open("/temp/template_siswa.xlsx","_blank")},u=p=>{if(p.preventDefault(),t){const j=new FileReader;j.onload=f=>{const h=new Uint8Array(f.target.result),N=B(h,{type:"array"}),y=N.SheetNames[0],s=N.Sheets[y],a=G.sheet_to_json(s,{header:1,range:1}).map(d=>{const[v,L,k,C]=d;return[v,L,k,C]}).filter(d=>d.every(v=>v!=null)),r=Array.isArray(a)?a:[a];D.promise(g(r).unwrap().then(d=>d.message),{loading:"Menyimpan data...",success:d=>d,error:d=>d.data.message})},j.readAsArrayBuffer(t)}};return i.useEffect(()=>{b&&(x.current.value=null,m()),c&&(m(),x.current.value=null)},[b,c]),e.jsxs("form",{onSubmit:u,className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[e.jsx("p",{className:"m-0 h6",children:"Upload Siswa"}),e.jsx("input",{ref:x,type:"file",name:"students",id:"student",className:"form-control",onChange:p=>l(p.target.files[0])}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:S,children:"Template"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:o,children:"Upload Data"})]})]})},z=()=>{const[t,l]=i.useState("");return e.jsx(_,{title:"Siswa",levels:["admin"],children:e.jsxs("div",{className:"row g-2",children:[e.jsxs("div",{className:"col-lg-3 col-12",children:[e.jsx(H,{detail:t,setDetail:l}),e.jsx(K,{})]}),e.jsx("div",{className:"col-lg-9 col-12",children:e.jsx(I,{setDetail:l})})]})})};export{z as default};
