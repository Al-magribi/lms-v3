import{j as e,m as a,bn as t,b as s,bu as n,bv as l,bw as i}from"./index-BAWIGdgW.js";import{u as r,k as c,b as d}from"./vendor-DfXzdC0j.js";import{L as o}from"./Layout-Doij1l_7.js";import{S as u}from"./react-select.esm-DUeLA41h.js";import"./index-Cjq_QsmG.js";import"./index-33-gAEu4.js";import"./index-C1AnEztE.js";const h=({subjects:t,user:s})=>{const n=r(),l=(e,a)=>{const t=e.replace(/\s+/g,"-");n(`/guru-penilaian?subject=${t}&id=${a}`)},i={hidden:{y:20,opacity:0},show:{y:0,opacity:1}};return e.jsx(a.div,{className:"row g-3",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:t.map((t=>e.jsx(a.div,{className:"col-xl-3 col-lg-4 col-md-6",variants:i,children:e.jsxs("div",{className:"card h-100 shadow-sm border-0 hover-card rounded-3 overflow-hidden",onClick:()=>l(t.name,t.id),style:{cursor:"pointer",transition:"all 0.3s ease"},children:[e.jsx("div",{className:"position-relative",children:e.jsx("img",{src:t.cover?`${window.location.origin}${t.cover}`:"/logo.png",alt:t.name,className:"card-img-top",style:{height:"250px",objectFit:"cover"}})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h5",{className:"card-title mb-3 fw-bold text-primary",children:t.name}),e.jsxs("div",{className:"d-flex align-items-center text-muted mb-3",children:[e.jsx("i",{className:"bi bi-mortarboard-fill me-2"}),e.jsx("span",{className:"small",children:null==s?void 0:s.name})]}),e.jsxs("button",{className:"btn btn-primary w-100 rounded-pill py-2",onClick:e=>{e.stopPropagation(),l(t.name,t.id)},children:[e.jsx("i",{className:"bi bi-arrow-right-circle-fill me-2"}),"Kelola Penilaian"]})]})]})},t.id)))})},m={menuPortal:e=>({...e,zIndex:10})},p=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],j=({subject:a,id:s})=>{const{data:n}=t(s),[l,i]=c(),r=d.useMemo((()=>(null==n?void 0:n.map((e=>({value:e.chapter_id,label:e.chapter_name}))))||[]),[n]),o=l.get("chapterid"),h=l.get("classid"),j=l.get("month"),[x,v]=d.useState(null),[g,b]=d.useState(null),[f,y]=d.useState(null),N=d.useMemo((()=>{var e;if(!x&&!o)return[];const a=x?x.value:o,t=null==n?void 0:n.find((e=>String(e.chapter_id)===String(a)));return(null==(e=null==t?void 0:t.class)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]}),[n,x,o]),w=d.useMemo((()=>p.map((e=>({value:e,label:e})))),[]);d.useEffect((()=>{if(o&&r.length>0){const e=r.find((e=>String(e.value)===String(o)));v(e||null)}}),[o,r]),d.useEffect((()=>{if(h&&N.length>0){const e=N.find((e=>String(e.value)===String(h)));b(e||null)}}),[h,N]),d.useEffect((()=>{if(j&&w.length>0){const e=w.find((e=>e.value===j));y(e||null)}}),[j,w]);const k=(e,t,n)=>{const l={};a&&(l.subject=a),s&&(l.id=s),e&&(l.chapterid=e.value),t&&(l.classid=t.value),n&&(l.month=n.value),i(l)};return e.jsxs("div",{className:"d-flex gap-3",children:[e.jsx(u,{options:r,value:x,onChange:e=>{v(e),b(null),k(e,null,f)},placeholder:"Pilih Chapter",menuPortalTarget:document.body,styles:m}),e.jsx(u,{options:N,value:g,onChange:e=>{b(e),k(x,e,f)},placeholder:"Pilih Kelas",isDisabled:!x,menuPortalTarget:document.body,styles:m}),e.jsx(u,{options:w,value:f,onChange:e=>{y(e),k(x,g,e)},placeholder:"Pilih Bulan",menuPortalTarget:document.body})]})},x=[{key:"taks_score",label:"Tugas"},{key:"writing_score",label:"Menulis"},{key:"speaking_score",label:"Berbicara"},{key:"lab_score",label:"Lab"},{key:"note",label:"Catatan Materi"}],v=[{value:"A",label:"A"},{value:"B",label:"B"},{value:"C",label:"C"}],g=()=>{var a;const[r]=c(),o=r.get("id"),u=r.get("chapterid"),h=r.get("classid"),m=r.get("month"),{user:p}=s((e=>e.auth)),[j,g]=d.useState({}),[b,f]=d.useState({}),[y,N]=d.useState(null),{data:w,isLoading:k}=t(o,{skip:!o}),S=d.useMemo((()=>null==w?void 0:w.find((e=>String(e.chapter_id)===String(u)))),[w,u]),_=(null==(a=null==S?void 0:S.contents)?void 0:a.map((e=>({chapter_id:e.content_id,chapter_title:e.content_title,...e}))))||[],{data:C,isLoading:P,refetch:M}=n({classid:h,subjectid:o,month:m,chapterid:u},{skip:!(h&&o&&u&&m)});d.useEffect((()=>{var e;if(C&&_&&(0===Object.keys(j).length||Object.keys(j).length!==C.length||C.length>0&&(!j[C[0].studentid]||(null==(e=j[C[0].studentid].scores)?void 0:e.length)!==_.length))){const e={};C.forEach((a=>{e[a.studentid]={...a,scores:a.scores&&a.scores.length>0?a.scores:_.map((e=>({chapterid:e.chapter_id,taks_score:"",writing_score:"",speaking_score:"",lab_score:"",note:""})))}})),g(e)}}),[C,_]);const[A]=l(),[L]=i(),B=(e,a,t)=>{g((s=>({...s,[e]:{...s[e],[a]:t}})))};return k||P?e.jsx("div",{children:"Loading..."}):h&&o&&u&&m?C&&0!==C.length?e.jsxs("div",{className:"mt-3",children:[y&&e.jsx("div",{className:"alert alert-danger",children:y}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered align-middle",children:[e.jsxs("thead",{children:[e.jsxs("tr",{children:[e.jsx("th",{rowSpan:2,children:"#"}),e.jsx("th",{rowSpan:2,children:"Nama Siswa"}),_.map((a=>e.jsx("th",{colSpan:x.length,className:"text-center",children:a.chapter_title},a.chapter_id))),e.jsx("th",{rowSpan:2,children:"Kinerja"}),e.jsx("th",{rowSpan:2,children:"Disiplin"}),e.jsx("th",{rowSpan:2,children:"Keaktifan"}),e.jsx("th",{rowSpan:2,children:"Kepercayaan Diri"}),e.jsx("th",{rowSpan:2,children:"Catatan Guru"}),e.jsx("th",{rowSpan:2,children:"Catatan Umum"}),e.jsx("th",{rowSpan:2,children:"Aksi"})]}),e.jsx("tr",{children:_.map((a=>x.map((t=>e.jsx("th",{children:t.label},a.chapter_id+t.key)))))})]}),e.jsx("tbody",{children:C.map(((a,t)=>{const s=j[a.studentid]||{};return e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:a.name}),_.map((t=>{const n=(s.scores||[]).find((e=>e.chapterid===t.chapter_id))||{};return x.map((s=>e.jsx("td",{children:e.jsx("input",{type:"note"===s.key?"text":"number",className:"form-control form-control-sm",value:n[s.key]||"",onChange:e=>((e,a,t,s)=>{g((n=>({...n,[e]:{...n[e],scores:n[e].scores.map((e=>e.chapterid===a?{...e,[t]:s}:e))}})))})(a.studentid,t.chapter_id,s.key,e.target.value)})},t.chapter_id+s.key)))})),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm",value:s.performance||"",onChange:e=>B(a.studentid,"performance",e.target.value),children:[e.jsx("option",{value:"",children:"-"}),v.map((a=>e.jsx("option",{value:a.value,children:a.label},a.value)))]})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm",value:s.discipline||"",onChange:e=>B(a.studentid,"discipline",e.target.value),children:[e.jsx("option",{value:"",children:"-"}),v.map((a=>e.jsx("option",{value:a.value,children:a.label},a.value)))]})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm",value:s.activeness||"",onChange:e=>B(a.studentid,"activeness",e.target.value),children:[e.jsx("option",{value:"",children:"-"}),v.map((a=>e.jsx("option",{value:a.value,children:a.label},a.value)))]})}),e.jsx("td",{children:e.jsxs("select",{className:"form-select form-select-sm",value:s.confidence||"",onChange:e=>B(a.studentid,"confidence",e.target.value),children:[e.jsx("option",{value:"",children:"-"}),v.map((a=>e.jsx("option",{value:a.value,children:a.label},a.value)))]})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:s.teacher_note||"",onChange:e=>B(a.studentid,"teacher_note",e.target.value)})}),e.jsx("td",{children:e.jsx("input",{type:"text",className:"form-control form-control-sm",value:s.note||"",onChange:e=>B(a.studentid,"note",e.target.value)})}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-success btn-sm",disabled:b[a.studentid],onClick:()=>(async e=>{var a;const t=j[e.studentid];if(t){f((a=>({...a,[e.studentid]:!0}))),N(null);try{const a={classid:h,subjectid:o,studentid:e.studentid,teacherid:p.id,type_report:"bulanan",month:m,performance:t.performance,discipline:t.discipline,activeness:t.activeness,confidence:t.confidence,teacher_note:t.teacher_note,note:t.note,scores:t.scores};t.id?await L({id:t.id,body:a}).unwrap():await A(a).unwrap(),f((a=>({...a,[e.studentid]:!1}))),M()}catch(s){f((a=>({...a,[e.studentid]:!1}))),N("Gagal menyimpan laporan: "+((null==(a=null==s?void 0:s.data)?void 0:a.message)||s.message))}}})(a),children:b[a.studentid]?"Menyimpan...":s.id?"Update":"Simpan"})})]},a.studentid)}))})]})})]}):e.jsx("div",{children:"Tidak ada siswa di kelas ini."}):e.jsx("div",{children:"Pilih chapter, kelas, dan bulan terlebih dahulu."})},b=()=>{const[t]=c(),n=t.get("subject"),l=t.get("id"),{user:i}=s((e=>e.auth)),r=null==i?void 0:i.subjects,d=!r||0===r.length;return n&&l?e.jsxs(o,{title:"Penilaian",levels:["teacher"],children:[e.jsx(j,{subject:n,id:l}),e.jsx(g,{})]}):e.jsx(o,{title:"Penilaian",levels:["teacher"],children:d?e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"row justify-content-center",children:e.jsx("div",{className:"col-md-6 text-center",children:e.jsxs("div",{className:"py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mx-auto mb-4 d-flex align-items-center justify-content-center",style:{width:"100px",height:"100px"},children:e.jsx("i",{className:"bi bi-journal-x display-4 text-primary"})}),e.jsx("h4",{className:"fw-bold mb-3",children:"Belum Ada Mata Pelajaran"}),e.jsx("p",{className:"text-muted mb-0",children:"Anda belum ditugaskan untuk mengajar mata pelajaran apapun saat ini"})]})})}):e.jsx(h,{subjects:r,user:i})})};export{b as default};
//# sourceMappingURL=TeacherScores-DAEI8kW8.js.map
