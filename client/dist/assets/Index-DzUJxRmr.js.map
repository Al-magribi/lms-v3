{"version":3,"file":"Index-DzUJxRmr.js","sources":["../../src/home/Index.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport {\r\n  useSigninMutation,\r\n  useLoadUserMutation,\r\n} from \"../controller/api/auth/ApiAuth\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { setLogin } from \"../controller/slice/AuthSlice\";\r\nimport \"./Index.css\";\r\n\r\nconst Index = () => {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const [role, setRole] = useState(\"none\");\r\n  const [isSignup, setSignup] = useState(false);\r\n  const [accountValue, setAccountValue] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [signin, { isLoading, data }] = useSigninMutation();\r\n  const [loadUser, { isLoading: isLoadingUser }] = useLoadUserMutation();\r\n  const { user, isSignin } = useSelector((state) => state.auth);\r\n\r\n  const handlePasswordToggle = () => {\r\n    setShowPassword((prev) => !prev);\r\n  };\r\n\r\n  const handleRoleChange = (value) => {\r\n    setRole(value);\r\n    setAccountValue(\"\"); // Reset account value when role changes\r\n  };\r\n\r\n  const handleSignup = () => {\r\n    setRole(\"\");\r\n    setSignup(true);\r\n    setAccountValue(\"\");\r\n  };\r\n\r\n  const back = () => {\r\n    setRole(\"none\");\r\n    setSignup(false);\r\n    setAccountValue(\"\");\r\n  };\r\n\r\n  const routes = {\r\n    center: \"/center-dashboard\",\r\n    admin: \"/admin-dashboard\",\r\n    student: \"/siswa-dashboard\",\r\n    teacher: \"/guru-dashboard\",\r\n    parent: \"/wali-dashboard\",\r\n    tahfiz: \"/tahfiz-dashboard\",\r\n  };\r\n\r\n  const loginHandler = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const credentials = {\r\n      password,\r\n      ...(role === \"student\"\r\n        ? { nis: accountValue }\r\n        : role === \"teacher\"\r\n        ? { username: accountValue }\r\n        : role === \"parent\"\r\n        ? { name: accountValue }\r\n        : { email: accountValue }),\r\n    };\r\n\r\n    try {\r\n      // First sign in the user\r\n      const signinResult = await signin(credentials).unwrap();\r\n\r\n      // Show loading toast\r\n      toast.loading(\"Memuat data pengguna...\");\r\n\r\n      // Dispatch initial user data\r\n      dispatch(setLogin(signinResult.user));\r\n\r\n      try {\r\n        // Then load the complete user data\r\n        const userData = await loadUser().unwrap();\r\n\r\n        // Update with complete user data\r\n        dispatch(setLogin(userData));\r\n\r\n        // Dismiss loading toast\r\n        toast.dismiss();\r\n\r\n        // Show success message\r\n        toast.success(signinResult.message);\r\n\r\n        // Redirect after loading complete user data\r\n        window.location.href = routes[userData.level] || \"/\";\r\n      } catch (error) {\r\n        console.error(\"Error loading user data:\", error);\r\n        toast.dismiss();\r\n        toast.error(\"Gagal memuat data lengkap pengguna\");\r\n\r\n        // Still redirect even if loadUser fails\r\n        window.location.href = routes[signinResult.user.level] || \"/\";\r\n      }\r\n    } catch (error) {\r\n      toast.error(error.data?.message || \"Gagal masuk\");\r\n    }\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   if (user.level && isSignin) {\r\n  //     window.location.href = routes[user.level];\r\n  //   }\r\n  // }, [user, isSignin]);\r\n\r\n  return (\r\n    <div>\r\n      <div className=\"area\">\r\n        <ul className=\"circles\">\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n        </ul>\r\n      </div>\r\n\r\n      <div\r\n        className=\"d-flex align-items-center justify-content-center flex-column gap-3\"\r\n        style={{ height: \"100vh\" }}\r\n      >\r\n        <img\r\n          src=\"/logo.png\"\r\n          alt=\"logo\"\r\n          style={{ height: 120, width: 120, marginBottom: \"1rem\" }}\r\n        />\r\n\r\n        {role === \"none\" && (\r\n          <div className=\"d-flex flex-wrap justify-content-center gap-3\">\r\n            <div\r\n              className=\"card bg-info text-white transition-card\"\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"admin\")}\r\n            >\r\n              <div className=\"card-body d-flex flex-column align-items-center justify-content-center gap-2\">\r\n                <i\r\n                  className=\"bi bi-person-badge-fill transition-icon\"\r\n                  style={{ fontSize: \"2rem\" }}\r\n                ></i>\r\n                <h5 className=\"card-title mb-0\">Admin</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className=\"card bg-info text-white transition-card\"\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"teacher\")}\r\n            >\r\n              <div className=\"card-body d-flex flex-column align-items-center justify-content-center gap-2\">\r\n                <i\r\n                  className=\"bi bi-person-workspace transition-icon\"\r\n                  style={{ fontSize: \"2rem\" }}\r\n                ></i>\r\n                <h5 className=\"card-title mb-0\">Guru</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className=\"card bg-info text-white transition-card\"\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"student\")}\r\n            >\r\n              <div className=\"card-body d-flex flex-column align-items-center justify-content-center gap-2\">\r\n                <i\r\n                  className=\"bi bi-mortarboard-fill transition-icon\"\r\n                  style={{ fontSize: \"2rem\" }}\r\n                ></i>\r\n                <h5 className=\"card-title mb-0\">Siswa</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className=\"card bg-info text-white transition-card\"\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"parent\")}\r\n            >\r\n              <div className=\"card-body d-flex flex-column align-items-center justify-content-center gap-2\">\r\n                <i\r\n                  className=\"bi bi-people-fill transition-icon\"\r\n                  style={{ fontSize: \"2rem\" }}\r\n                ></i>\r\n                <h5 className=\"card-title mb-0\">Wali Murid</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className=\"card bg-info text-white transition-card\"\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={handleSignup}\r\n            >\r\n              <div className=\"card-body d-flex flex-column align-items-center justify-content-center gap-2\">\r\n                <i\r\n                  className=\"bi bi-person-plus-fill transition-icon\"\r\n                  style={{ fontSize: \"2rem\" }}\r\n                ></i>\r\n                <h5 className=\"card-title mb-0\">Pendaftaran</h5>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {role !== \"none\" && !isSignup && (\r\n          <form\r\n            style={{ width: 300 }}\r\n            className=\"d-flex flex-column gap-3\"\r\n            onSubmit={loginHandler}\r\n          >\r\n            <div className=\"input-group\">\r\n              <span className=\"input-group-text\">\r\n                <i\r\n                  className={`bi ${\r\n                    role === \"student\"\r\n                      ? \"bi-person-badge\"\r\n                      : role === \"teacher\"\r\n                      ? \"bi-person-workspace\"\r\n                      : \"bi-envelope\"\r\n                  }`}\r\n                ></i>\r\n              </span>\r\n              <input\r\n                type={role === \"admin\" || role === \"parent\" ? \"email\" : \"text\"}\r\n                placeholder={\r\n                  role === \"student\"\r\n                    ? \"NIS\"\r\n                    : role === \"teacher\"\r\n                    ? \"USERNAME\"\r\n                    : \"EMAIL\"\r\n                }\r\n                value={accountValue}\r\n                onChange={(e) => setAccountValue(e.target.value)}\r\n                required\r\n                className=\"form-control\"\r\n              />\r\n            </div>\r\n\r\n            <div className=\"input-group\">\r\n              <span className=\"input-group-text\">\r\n                <i className=\"bi bi-lock-fill\"></i>\r\n              </span>\r\n              <input\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                placeholder=\"Password\"\r\n                className=\"form-control\"\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className=\"form-check\">\r\n              <input\r\n                className=\"form-check-input\"\r\n                type=\"checkbox\"\r\n                id=\"flexCheckDefault\"\r\n                checked={showPassword}\r\n                onChange={handlePasswordToggle}\r\n              />\r\n              <label\r\n                className=\"form-check-label text-white\"\r\n                htmlFor=\"flexCheckDefault\"\r\n              >\r\n                Tampilkan Password\r\n              </label>\r\n            </div>\r\n\r\n            <div className=\"d-flex justify-content-between\">\r\n              <button\r\n                type=\"button\"\r\n                className=\"btn btn-danger d-flex align-items-center gap-2\"\r\n                onClick={() => setRole(\"none\")}\r\n              >\r\n                <i className=\"bi bi-arrow-left\"></i>\r\n                Kembali\r\n              </button>\r\n              <button\r\n                type=\"submit\"\r\n                className=\"btn btn-success d-flex align-items-center gap-2\"\r\n                disabled={isLoading || isLoadingUser}\r\n              >\r\n                {isLoading || isLoadingUser ? (\r\n                  <>\r\n                    <span\r\n                      className=\"spinner-border spinner-border-sm\"\r\n                      aria-hidden=\"true\"\r\n                    ></span>\r\n                    <span role=\"status\">Loading...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <i className=\"bi bi-box-arrow-in-right\"></i>\r\n                    Masuk\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {isSignup && <SignUp setRole={back} />}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Index;\r\n"],"names":["Index","dispatch","useDispatch","useNavigate","role","setRole","useState","isSignup","setSignup","accountValue","setAccountValue","password","setPassword","showPassword","setShowPassword","signin","isLoading","data","useSigninMutation","loadUser","isLoadingUser","useLoadUserMutation","useSelector","state","auth","handleRoleChange","value","routes","center","admin","student","teacher","parent","tahfiz","children","jsx","className","jsxs","jsxRuntimeExports","style","height","src","alt","width","marginBottom","cursor","transition","boxShadow","onClick","fontSize","onSubmit","async","e","preventDefault","credentials","nis","username","name","email","signinResult","unwrap","toast","loading","setLogin","user","userData","dismiss","c","success","message","window","location","href","level","error","console","_a","type","placeholder","onChange","target","required","id","checked","prev","htmlFor","disabled","Fragment","SignUp"],"mappings":"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"}