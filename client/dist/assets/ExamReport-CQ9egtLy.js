import{b2 as e,j as a,b as s,a_ as n,b3 as t,e as i,b4 as l,b1 as d,b5 as r,b6 as c,b7 as o,b8 as m,b9 as x}from"./index-DFhdulld.js";import{b,e as h,R as g}from"./vendor-CnnDPxwB.js";import{L as p}from"./Layout-GZnRoUIy.js";import{T as u}from"./Table-CpyGbvYh.js";import{C as j,b as N,L as v,e as f,f as w,c as y,p as k,a as S,i as _,g as C}from"./index-BQoB5aE1.js";import{u as L,w as $}from"./xlsx-B4fPQ8kA.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const T=({classid:s,setClassid:n,examid:t,name:i,token:l,onRefetch:d,activeView:r,setActiveView:c,onExport:o})=>{const[m,x]=b.useState(null),{data:h,refetch:g}=e({exam:t},{skip:!t});return a.jsx("div",{className:"card my-2 hover-shadow transition-all",children:a.jsx("div",{className:"card-body p-2",children:a.jsxs("div",{className:"row g-3 align-items-center",children:[a.jsx("div",{className:"col-md-4",children:a.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[a.jsx("span",{className:"badge bg-primary px-3 py-2 rounded-pill",children:l}),m&&a.jsxs("span",{className:"badge bg-danger px-3 py-2 rounded-pill",children:[a.jsx("i",{className:"bi bi-clock-history me-1"}),"Terakhir diperbarui: ",m]})]})}),a.jsx("div",{className:"col-md-4",children:a.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-2",children:[a.jsxs("button",{className:`btn btn-sm ${"table"===r?"btn-success":"btn-outline-success"} rounded-pill hover-scale`,onClick:()=>c("table"),title:"Log",children:[a.jsx("i",{className:"bi bi-person-lines-fill"}),a.jsx("span",{className:"ms-2",children:"Log"})]}),a.jsxs("button",{className:`btn btn-sm ${"chart"===r?"btn-success":"btn-outline-success"} rounded-pill hover-scale`,onClick:()=>c("chart"),title:"Grafik",children:[a.jsx("i",{className:"bi bi-bar-chart"}),a.jsx("span",{className:"ms-2",children:"Grafik"})]}),a.jsxs("button",{className:`btn btn-sm ${"analysis"===r?"btn-success":"btn-outline-success"} rounded-pill hover-scale`,onClick:()=>c("analysis"),title:"Analisis",children:[a.jsx("i",{className:"bi bi-clipboard2-data-fill"}),a.jsx("span",{className:"ms-2",children:"Analisis"})]}),a.jsxs("button",{className:`btn btn-sm ${"list"===r?"btn-success":"btn-outline-success"} rounded-pill hover-scale`,onClick:()=>c("list"),title:"Nilai",children:[a.jsx("i",{className:"bi bi-file-earmark-excel"}),a.jsx("span",{className:"ms-2",children:"Nilai"})]}),("table"===r||"list"===r||"analysis"===r)&&a.jsxs("button",{className:"btn btn-sm btn-primary rounded-pill hover-scale",onClick:o,title:"Export to Excel",children:[a.jsx("i",{className:"bi bi-file-earmark-arrow-down"}),a.jsx("span",{className:"ms-2",children:"Export"})]})]})}),a.jsx("div",{className:"col-md-4",children:a.jsxs("div",{className:"d-flex justify-content-end gap-2 flex-wrap",children:[null==h?void 0:h.map((e=>a.jsx("button",{className:`btn btn-sm ${s===e.id?"btn-secondary":"btn-outline-secondary"}  hover-scale`,onClick:()=>n(e.id),children:e.name},e.id))),a.jsx("button",{className:"btn btn-sm btn-dark  hover-scale",onClick:()=>n(""),title:"Reset Filter",children:a.jsx("i",{className:"bi bi-recycle"})}),a.jsx("button",{className:"btn btn-sm btn-danger  hover-scale",onClick:()=>{x((new Date).toLocaleString()),g(),d()},title:"Refresh Data",children:a.jsx("i",{className:"bi bi-repeat"})})]})})]})})})},R=({studentData:e})=>a.jsx("div",{className:"card mb-3",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h5",{className:"card-title mb-3",children:"Ringkasan Nilai"}),a.jsxs("div",{className:"row",children:[a.jsxs("div",{className:"col-md-4",children:[a.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[a.jsx("span",{children:"Jawaban Benar:"}),a.jsx("span",{className:"badge bg-success",children:e.correct})]}),a.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[a.jsx("span",{children:"Jawaban Salah:"}),a.jsx("span",{className:"badge bg-danger",children:e.incorrect})]})]}),a.jsxs("div",{className:"col-md-4",children:[a.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[a.jsx("span",{children:"Nilai PG:"}),a.jsx("span",{className:"badge bg-primary",children:e.pg_score})]}),a.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[a.jsx("span",{children:"Nilai Essay:"}),a.jsx("span",{className:"badge bg-info",children:e.essay_score})]})]}),a.jsx("div",{className:"col-md-4",children:a.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[a.jsx("span",{children:"Total Nilai:"}),a.jsx("span",{className:"badge bg-success fs-5",children:e.score})]})})]})]})}),D=({studentData:e,name:s})=>a.jsx("div",{className:"card mb-3",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h5",{className:"card-title mb-3",children:"Lembar Jawaban"}),a.jsx("table",{className:"table table-sm table-borderless mb-0",children:a.jsxs("tbody",{children:[a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("strong",{children:"NIS"})}),a.jsxs("td",{children:[": ",e.student_nis]}),a.jsx("td",{children:a.jsx("strong",{children:"Tingkat"})}),a.jsxs("td",{children:[": ",e.student_grade]}),a.jsx("td",{children:a.jsx("strong",{children:"Ujian"})}),a.jsxs("td",{children:[": ",s.replace(/-/g," ")]})]}),a.jsxs("tr",{children:[a.jsx("td",{children:a.jsx("strong",{children:"Nama"})}),a.jsxs("td",{children:[": ",e.student_name]}),a.jsx("td",{children:a.jsx("strong",{children:"Kelas"})}),a.jsxs("td",{children:[": ",e.student_class]}),a.jsx("td",{children:a.jsx("strong",{children:"Tanggal"})}),a.jsxs("td",{children:[":"," ",e.log_exam?new Date(e.log_exam).toLocaleString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"-"]})]})]})})]})}),E=({answer:e,index:s,isTeacherOrAdmin:n,gradingAnswers:t,setGradingAnswers:i,handleGradeEssay:l,isGrading:d})=>a.jsx("div",{className:"card mb-3",children:a.jsxs("div",{className:"card-body",children:[a.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[a.jsx("h6",{className:"card-title mb-0",children:a.jsxs("span",{className:"badge bg-primary",children:["Pertanyaan ",s+1]})}),a.jsxs("span",{className:"badge "+(e.point>0?"bg-success":"bg-danger"),children:[e.point," Poin"]})]}),a.jsx("p",{className:"card-text",dangerouslySetInnerHTML:{__html:e.question_text}}),a.jsx("div",{className:"mt-3",children:e.answer?a.jsxs("div",{className:"d-flex gap-4",children:[a.jsxs("p",{className:"m-0 badge "+(e.point>0?"bg-success":"bg-danger"),children:["Jawaban Siswa: ",a.jsx("strong",{children:e.answer.toUpperCase()})]}),a.jsxs("p",{className:"m-0 badge bg-success",children:["Jawaban Benar: ",a.jsx("strong",{children:e.correct})]})]}):a.jsx("div",{className:"card bg-light",children:a.jsxs("div",{className:"card-body",children:[a.jsx("h6",{className:"card-subtitle mb-2 text-muted",children:"Jawaban Essay"}),a.jsx("p",{className:"card-text",children:e.essay||"-"}),n&&a.jsxs("div",{className:"mt-3",children:[a.jsxs("div",{className:"d-flex align-items-center gap-2",children:[a.jsx("input",{type:"number",className:"form-control form-control-sm",style:{width:"80px"},placeholder:"Nilai",min:"0",max:e.max_point||100,value:t[e.id]||"",onChange:a=>i({...t,[e.id]:a.target.value})}),a.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>l(e.id,e.max_point||100),disabled:d,children:d?"Menyimpan...":"Simpan Nilai"})]}),a.jsxs("small",{className:"text-muted",children:["Maksimal nilai: ",e.max_point||100]})]})]})})})]})}),B=({detail:e})=>{var l;const{examid:d,name:r}=h(),[c,o]=b.useState(!1),{user:m}=s((e=>e.auth)),x="teacher"===(null==m?void 0:m.level)||"admin"===(null==m?void 0:m.level),[g,p]=b.useState({}),{data:u,isLoading:j,isError:N,error:v,refetch:f}=n({student:e.student_id,exam:d},{skip:!e.student_id}),[w,{isLoading:y}]=t(),k=null==u?void 0:u[0];b.useEffect((()=>{k&&o(!0)}),[k]);const S=async(e,a)=>{var s;const n=g[e];if(void 0!==n&&""!==n)if(n<0||n>a)i.error(`Nilai harus antara 0 dan ${a}`);else try{await w({answer_id:e,point:parseInt(n)}).unwrap(),i.success("Nilai berhasil disimpan"),f()}catch(t){i.error((null==(s=t.data)?void 0:s.message)||"Gagal menyimpan nilai")}else i.error("Nilai tidak boleh kosong")};return a.jsx("div",{className:"modal fade",id:"answerSheet","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:a.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:a.jsxs("div",{className:"modal-content",children:[a.jsxs("div",{className:"modal-header",children:[a.jsxs("div",{className:"modal-title d-flex flex-column justify-content-end align-items-start",id:"staticBackdropLabel",children:[a.jsx("p",{className:"m-0 h5",children:null==r?void 0:r.replace(/-/g," ")}),a.jsxs("small",{className:"text-muted",children:[null==e?void 0:e.nis," - ",null==e?void 0:e.student_name]})]}),a.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),a.jsx("div",{className:"modal-body",children:j?a.jsx("p",{children:"Loading..."}):N?a.jsxs("div",{className:"alert alert-danger",role:"alert",children:["Gagal memuat data jawaban:"," ",(null==(l=null==v?void 0:v.data)?void 0:l.message)||v.message]}):k?a.jsxs(a.Fragment,{children:[a.jsx(R,{studentData:k}),a.jsx(D,{studentData:k,name:r}),k.answers&&k.answers.length>0?k.answers.map(((e,s)=>a.jsx(E,{answer:e,index:s,isTeacherOrAdmin:x,gradingAnswers:g,setGradingAnswers:p,handleGradeEssay:S,isGrading:y},e.question_id))):a.jsx("div",{className:"alert alert-info mt-3",role:"alert",children:"Tidak ada data jawaban untuk siswa ini."})]}):a.jsx("div",{className:"alert alert-warning",role:"alert",children:"Data siswa tidak ditemukan."})}),a.jsxs("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-secondary","data-bs-dismiss":"modal",children:"Tutup"}),a.jsx("button",{type:"button",className:"btn btn-sm btn-danger",onClick:f,children:a.jsx("i",{className:"bi bi-repeat"})}),a.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{k&&((e,a,s)=>{if(!e)return;const n=window.open("","_blank");if(!n)return void alert("Please allow popups for this website to print.");const t=(new Date).toLocaleString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),i=window.location.href,l=`\n    <!DOCTYPE html>\n    <html>\n      <head>\n        <title>${null==a?void 0:a.replace(/-/g," ")} - ${null==s?void 0:s.student_name}</title>\n        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">\n        <style>\n          body { \n            padding: 10px; \n            font-size: 12px;\n          }\n          .card { \n            margin-bottom: 15px; \n            border: 1px solid rgba(0,0,0,.125);\n            border-radius: 0.25rem;\n          }\n          .card-body {\n            padding: 1rem;\n          }\n          .badge { \n            font-size: 0.9em; \n            padding: 0.35em 0.65em;\n            border-radius: 0.25rem;\n            font-weight: 700;\n          }\n          .bg-primary {\n            background-color: #0d6efd !important;\n            color: white;\n          }\n          .bg-success {\n            background-color: #198754 !important;\n            color: white;\n          }\n          .bg-danger {\n            background-color: #dc3545 !important;\n            color: white;\n          }\n          .table {\n            width: 100%;\n            margin-bottom: 1rem;\n            color: #212529;\n            border-collapse: collapse;\n          }\n          .table-sm td {\n            padding: 0.3rem;\n          }\n          .table-borderless {\n            border: 0;\n          }\n          .d-flex {\n            display: flex !important;\n          }\n          .justify-content-between {\n            justify-content: space-between !important;\n          }\n          .align-items-center {\n            align-items: center !important;\n          }\n          .gap-4 {\n            gap: 1.5rem !important;\n          }\n          .mt-3 {\n            margin-top: 1rem !important;\n          }\n          .mb-2 {\n            margin-bottom: 0.5rem !important;\n          }\n          .mb-3 {\n            margin-bottom: 1rem !important;\n          }\n          .mb-0 {\n            margin-bottom: 0 !important;\n          }\n          .m-0 {\n            margin: 0 !important;\n          }\n          .text-muted {\n            color: #6c757d !important;\n          }\n          .h5 {\n            font-size: 1.25rem;\n            margin-top: 0;\n            margin-bottom: 0.5rem;\n            font-weight: 500;\n          }\n          .alert {\n            position: relative;\n            padding: 0.75rem 1.25rem;\n            margin-bottom: 1rem;\n            border: 1px solid transparent;\n            border-radius: 0.25rem;\n          }\n          .alert-info {\n            color: #0c5460;\n            background-color: #d1ecf1;\n            border-color: #bee5eb;\n          }\n          .alert-warning {\n            color: #856404;\n            background-color: #fff3cd;\n            border-color: #ffeeba;\n          }\n          .alert-danger {\n            color: #721c24;\n            background-color: #f8d7da;\n            border-color: #f5c6cb;\n          }\n          .print-header {\n            border-bottom: 1px solid #dee2e6;\n            padding-bottom: 5px;\n            margin-bottom: 5px;\n            font-size: 10px;\n            color: #6c757d;\n            display: flex;\n            justify-content: space-between;\n          }\n          .print-header p {\n            margin-bottom: 5px;\n          }\n          .print-footer {\n            border-top: 1px solid #dee2e6;\n            padding-top: 5px;\n            margin-top: 5px;\n            font-size: 10px;\n            color: #6c757d;\n            display: flex;\n            justify-content: space-between;\n            position: fixed;\n            bottom: 0;\n            left: 0;\n            right: 0;\n            background-color: white;\n            padding: 10px 20px;\n          }\n          .content {\n            margin-bottom: 40px; /* Space for footer */\n          }\n          @media print {\n            .no-print { display: none; }\n            body { font-size: 12px; }\n            .card { page-break-inside: avoid; }\n            .print-header {\n              position: fixed;\n              top: 0;\n              left: 0;\n              right: 0;\n              padding: 10px 20px;\n              background-color: white;\n              z-index: 1000;\n            }\n            .content {\n              margin-top: 40px;\n              margin-bottom: 40px;\n            }\n            @page {\n              margin-top: 60px;\n              margin-bottom: 60px;\n            }\n          }\n        </style>\n      </head>\n      <body>\n        <div class="container-fluid">\n          <div class="print-header">\n            <p>${i}</p>\n          </div>\n          \n          <div class="content">\n            <div class="card mb-3">\n              <div class="card-body">\n                <h5 class="card-title mb-3">Lembar Jawaban</h5>\n                <table class="table table-sm table-borderless mb-0">\n                  <tbody>\n                    <tr>\n                      <td><strong>NIS</strong></td>\n                      <td>: ${e.student_nis}</td>\n                      <td><strong>Tingkat</strong></td>\n                      <td>: ${e.student_grade}</td>\n                      <td><strong>Ujian</strong></td>\n                      <td>: ${a.replace(/-/g," ")}</td>\n                    </tr>\n                    <tr>\n                      <td><strong>Nama</strong></td>\n                      <td>: ${e.student_name}</td>\n                      <td><strong>Kelas</strong></td>\n                      <td>: ${e.student_class}</td>\n                      <td><strong>Tanggal</strong></td>\n                      <td>: ${e.log_exam?new Date(e.log_exam).toLocaleString("id-ID",{weekday:"long",day:"2-digit",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}):"-"}</td>\n                    </tr>\n                  </tbody>\n                </table>\n              </div>\n            </div>\n\n            \x3c!-- Score Summary Card --\x3e\n            <div class="card mb-3">\n              <div class="card-body">\n                <h5 class="card-title mb-3">Ringkasan Nilai</h5>\n                <div class="row">\n                  <div class="col-md-4">\n                    <div class="d-flex justify-content-between mb-2">\n                      <span>Jawaban Benar:</span>\n                      <span class="badge bg-success">${e.correct}</span>\n                    </div>\n                    <div class="d-flex justify-content-between mb-2">\n                      <span>Jawaban Salah:</span>\n                      <span class="badge bg-danger">${e.incorrect}</span>\n                    </div>\n                  </div>\n                  <div class="col-md-4">\n                    <div class="d-flex justify-content-between mb-2">\n                      <span>Nilai PG:</span>\n                      <span class="badge bg-primary">${e.pg_score}</span>\n                    </div>\n                    <div class="d-flex justify-content-between mb-2">\n                      <span>Nilai Essay:</span>\n                      <span class="badge bg-info">${e.essay_score}</span>\n                    </div>\n                  </div>\n                  <div class="col-md-4">\n                    <div class="d-flex justify-content-between mb-2">\n                      <span>Total Nilai:</span>\n                      <span class="badge bg-success fs-5">${e.score}</span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            ${e.answers&&e.answers.length>0?e.answers.map(((e,a)=>{var s;return`\n                <div class="card mb-3">\n                  <div class="card-body">\n                    <div class="d-flex justify-content-between align-items-center mb-2">\n                      <h6 class="card-title mb-0">\n                        <span class="badge bg-primary">Pertanyaan ${a+1}</span>\n                      </h6>\n                      <span class="badge ${e.point>0?"bg-success":"bg-danger"}">\n                        ${e.point} Poin\n                      </span>\n                    </div>\n                    <div class="card-text">${e.question_text}</div>\n                    <div class="mt-3 d-flex gap-4">\n                      <p class="m-0 badge ${e.point>0?"bg-success":"bg-danger"}">\n                        Jawaban Siswa: <strong>${(null==(s=e.answer)?void 0:s.toUpperCase())||"-"}</strong>\n                      </p>\n                      <p class="m-0 badge bg-success">\n                        Jawaban Benar: <strong>${e.correct}</strong>\n                      </p>\n                    </div>\n                    ${e.essay?`\n                    <div class="mt-3">\n                      <div class="card bg-light">\n                        <div class="card-body">\n                          <h6 class="card-subtitle mb-2 text-muted">Jawaban Essay</h6>\n                          <p class="card-text">${e.essay}</p>\n                          <div class="d-flex align-items-center gap-2">\n                            <span class="badge bg-info">Nilai: ${e.point}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                    `:""}\n                  </div>\n                </div>\n              `})).join(""):'<div class="alert alert-info mt-3">Tidak ada data jawaban untuk siswa ini.</div>'}\n            \n            <div class="no-print text-center mt-4">\n              <button class="btn btn-primary" onclick="window.print()">Cetak</button>\n            </div>\n          </div>\n          \n          <div class="print-footer">\n            <div>${t}</div>\n            <div>Halaman <span class="pageNumber"></span></div>\n          </div>\n        </div>\n        \n        <script>\n          // Add page numbers when printing\n          window.onbeforeprint = function() {\n            const pages = document.querySelectorAll('.pageNumber');\n            for (let i = 0; i < pages.length; i++) {\n              pages[i].textContent = (i + 1).toString();\n            }\n          };\n        <\/script>\n      </body>\n    </html>\n  `;n.document.open(),n.document.write(l),n.document.close(),n.onload=function(){n.focus(),n.print()}})(k,r,e)},children:[a.jsx("i",{className:"bi bi-printer"})," Cetak"]})]})]})})})},P=b.forwardRef((({classid:e,examid:s},n)=>{const[t,o]=b.useState(1),[m,x]=b.useState(10),[h,g]=b.useState(""),p=b.useRef(),{data:j={},isLoading:N,refetch:v}=l({exam:s,classid:e,page:t,limit:m,search:h}),{result:f=[],totalData:w,totalPages:y}=j,[k,S]=b.useState({}),[_,{isLoading:C}]=d(),[L,{isLoading:$}]=r(),[T,{isLoading:R}]=c();b.useImperativeHandle(n,(()=>({refetch:v,getTableElement:()=>p.current})));return console.log(f),a.jsxs(a.Fragment,{children:[a.jsx(u,{isLoading:N,page:t,setPage:o,totalPages:y,limit:m,setLimit:x,setSearch:g,totalData:w,children:a.jsxs("table",{ref:p,className:"table table-striped table-hover table-bordered",children:[a.jsx("thead",{className:"table-light",children:a.jsxs("tr",{children:[a.jsx("th",{scope:"col",className:"text-center",children:"No"}),a.jsx("th",{scope:"col",className:"text-center",children:"NIS"}),a.jsx("th",{scope:"col",className:"text-center",children:"Nama Siswa"}),a.jsx("th",{scope:"col",className:"text-center",children:"Kelas"}),a.jsx("th",{scope:"col",className:"text-center",children:"Tingkat"}),a.jsx("th",{scope:"col",className:"text-center",children:"IP Address"}),a.jsx("th",{scope:"col",className:"text-center",children:"Browser"}),a.jsx("th",{scope:"col",className:"text-center",children:"Waktu Mulai"}),a.jsx("th",{scope:"col",className:"text-center",children:"Status"}),a.jsx("th",{scope:"col",className:"text-center",children:"Aksi"})]})}),a.jsx("tbody",{children:f.length>0?f.map(((e,n)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:(t-1)*m+n+1}),a.jsx("td",{className:"text-center align-middle",children:e.nis}),a.jsx("td",{className:"align-middle",children:e.student_name}),a.jsx("td",{className:"text-center align-middle",children:e.class_name}),a.jsx("td",{className:"text-center align-middle",children:e.grade_name}),a.jsx("td",{className:"text-center align-middle",children:e.ip||"-"}),a.jsx("td",{className:"text-center align-middle",children:e.browser||"-"}),a.jsx("td",{className:"text-center align-middle",children:e.createdat?a.jsx("span",{className:"badge bg-success",children:new Date(e.createdat).toLocaleString()}):"-"}),a.jsx("td",{className:"text-center align-middle",children:e.ispenalty?a.jsx("span",{className:"badge bg-danger",children:"Melanggar"}):e.isactive?a.jsx("span",{className:"badge bg-warning",children:"Mengerjakan"}):e.isdone?a.jsx("span",{className:"badge bg-success",children:"Selesai"}):a.jsx("span",{className:"badge bg-secondary",children:"Belum Masuk"})}),a.jsx("td",{className:"text-center align-middle",children:a.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[a.jsxs("button",{className:"btn btn-sm btn-primary",title:"Lihat Detail","data-bs-toggle":"modal","data-bs-target":"#answerSheet",onClick:()=>S(e),children:[a.jsx("i",{className:"bi bi-eye"}),a.jsx("span",{className:"ms-2",children:"Lihat"})]}),a.jsxs("button",{className:"btn btn-sm btn-warning",title:"Izinkan Masuk",onClick:()=>{return a=e.log_id,void i.promise(L({id:a}).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message});var a},disabled:$||!e.isactive,children:[a.jsx("i",{className:"bi bi-arrow-repeat"}),a.jsx("span",{className:"ms-2",children:"Izinkan"})]}),a.jsxs("button",{className:"btn btn-sm btn-success",title:"Selesaikan",onClick:()=>{return a=e.log_id,void i.promise(_({id:a,exam:s}).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message});var a},disabled:C||e.isdone||!e.isactive,children:[a.jsx("i",{className:"bi bi-check-circle"}),a.jsx("span",{className:"ms-2",children:"Selesaikan"})]}),a.jsxs("button",{className:"btn btn-sm btn-danger",title:"Ulangi Ujian",onClick:()=>{return a=e.log_id,n=e.student_id,void(window.confirm("Apakah anda yakin ingin mengulang ujian dan menghapus seluruh data jawaban siswa? ")&&i.promise(T({id:a,student:n,exam:s}).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message}));var a,n},disabled:R||!e.isdone,children:[a.jsx("i",{className:"bi bi-recycle"}),a.jsx("span",{className:"ms-2",children:"Ulangi"})]})]})})]},e.student_id||n))):a.jsx("tr",{children:a.jsx("td",{colSpan:"10",className:"text-center",children:N?"Memuat data...":"Tidak ada data yang ditemukan"})})})]})}),a.jsx(B,{detail:k})]})}));j.register(N,v,f,w,y,k,S,_);const z=b.forwardRef((({examid:e},s)=>{const{data:n,isLoading:t,error:i,refetch:l}=o(e,{skip:!e});b.useImperativeHandle(s,(()=>({refetch:l})));const d={labels:(null==n?void 0:n.map((e=>e.score)))||[],datasets:[{label:"Jumlah Siswa",data:(null==n?void 0:n.map((e=>e.quantity)))||[],borderColor:"rgb(53, 162, 235)",backgroundColor:"rgba(53, 162, 235, 0.5)",tension:.4,fill:!0,pointStyle:"circle",pointRadius:6,pointHoverRadius:8,pointBackgroundColor:"rgb(53, 162, 235)",pointBorderColor:"white",pointBorderWidth:2}]};return t?a.jsx("div",{className:"card shadow w-100 h-75 d-flex justify-content-center align-items-center",children:a.jsx("div",{className:"spinner-border text-primary",role:"status",children:a.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):i?a.jsx("div",{className:"card shadow w-100 h-75 text-danger",children:a.jsx("div",{className:"card-body",children:"Data belum tersedia"})}):a.jsx("div",{className:"card shadow w-100 h-75 p-3",children:a.jsx("div",{style:{width:"100%",height:"100%",minHeight:"550px"},children:a.jsx(C,{options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"top",labels:{font:{size:14,weight:"bold"}}},title:{display:!0,text:"Distribusi Nilai Siswa",font:{size:20,weight:"bold"},padding:20},tooltip:{backgroundColor:"rgba(255, 255, 255, 0.9)",titleColor:"#333",bodyColor:"#666",titleFont:{size:14,weight:"bold"},bodyFont:{size:13},padding:12,borderColor:"rgba(53, 162, 235, 0.5)",borderWidth:1,displayColors:!1,callbacks:{title:e=>`Rentang Nilai: ${e[0].label}`,label:e=>`Jumlah Siswa: ${e.raw} orang`}}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0, 0, 0, 0.1)",drawBorder:!1},ticks:{font:{size:12},stepSize:1},title:{display:!0,text:"Jumlah Siswa",font:{size:14,weight:"bold"},padding:10}},x:{grid:{display:!1},ticks:{font:{size:12}},title:{display:!0,text:"Rentang Nilai",font:{size:14,weight:"bold"},padding:10}}},interaction:{intersect:!1,mode:"index"},elements:{line:{borderWidth:3}}},data:d})})})})),A=b.forwardRef((({examid:e,classid:s},n)=>{const[t,i]=b.useState(1),[l,d]=b.useState(10),[r,c]=b.useState(""),o=b.useRef(),{data:x={},isLoading:h,error:g,refetch:p}=m({exam:e,classid:s,page:t,limit:l,search:r},{skip:!e});b.useImperativeHandle(n,(()=>({refetch:p,getTableElement:()=>o.current})));const j=(null==x?void 0:x.students)||[];return a.jsx(u,{isLoading:h,page:t,setPage:i,limit:l,setLimit:d,setSearch:c,totalData:null==x?void 0:x.totalData,totalPages:null==x?void 0:x.totalPages,children:a.jsxs("table",{ref:o,className:"mb-0 table table-bordered table-striped",children:[a.jsxs("thead",{children:[a.jsxs("tr",{children:[a.jsx("td",{colSpan:2,className:"text-muted align-middle",children:null==x?void 0:x.homebase_name}),a.jsx("td",{colSpan:2,className:"text-muted align-middle",children:a.jsxs("p",{className:"m-0",children:[null==x?void 0:x.exam_name," ",a.jsx("span",{className:"badge bg-success",children:null==x?void 0:x.exam_token})]})}),a.jsx("td",{colSpan:6,className:"text-muted align-middle",children:null==x?void 0:x.teacher_name})]}),a.jsxs("tr",{children:[a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"No"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"NIS"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Nama"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Tingkat"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Kelas"}),a.jsx("th",{colSpan:3,className:"text-center align-middle",children:"PG"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Essay"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Total"})]}),a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:"Benar"}),a.jsx("td",{className:"text-center align-middle",children:"Salah"}),a.jsx("td",{className:"text-center align-middle",children:"Total"})]})]}),a.jsx("tbody",{children:null==j?void 0:j.map(((e,s)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:(t-1)*l+s+1}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.student_nis}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.student_name}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.student_grade}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.student_class}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.correct}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.incorrect}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.mc_score}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.essay_score}),a.jsx("td",{className:"text-center align-middle",children:null==e?void 0:e.score})]},null==e?void 0:e.student_id)))})]})})})),I=b.forwardRef((({examid:e,classid:s},n)=>{const[t,i]=b.useState(1),[l,d]=b.useState(10),[r,c]=b.useState(""),o=b.useRef(),{data:m,isLoading:h,error:p,refetch:j}=x({exam:e,classid:s,page:t,limit:l,search:r});console.log(m),b.useImperativeHandle(n,(()=>({refetch:j,getTableElement:()=>o.current})));const N=(null==m?void 0:m.questions)||[],v=(null==m?void 0:m.students)||[];return console.log(N.length),a.jsx(u,{isLoading:h,page:t,setPage:i,totalPages:null==m?void 0:m.totalPages,totalData:null==m?void 0:m.totalData,limit:l,setLimit:d,setSearch:c,children:a.jsxs("table",{ref:o,className:"mb-0 table table-bordered table-striped table-hover",children:[a.jsxs("thead",{children:[a.jsxs("tr",{children:[a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"No"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"NIS"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Nama"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Kelas"}),a.jsx("th",{colSpan:N.length,className:"text-center align-middle",children:"Jawaban"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Benar"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Salah"}),a.jsx("th",{rowSpan:2,className:"text-center align-middle",children:"Nilai"})]}),a.jsx("tr",{children:N.map((e=>a.jsx("th",{className:"text-center",children:e.qkey},e.id)))})]}),a.jsx("tbody",{children:v.length>0?null==v?void 0:v.map(((e,s)=>a.jsxs(g.Fragment,{children:[a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:(t-1)*l+s+1}),a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:e.nis}),a.jsx("td",{className:"align-middle",rowSpan:2,children:e.name}),a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:e.class}),N.map((s=>{var n;const t=null==(n=null==e?void 0:e.answers)?void 0:n.find((e=>e.id===s.id));return(null==t?void 0:t.mc)&&s.qkey&&(t.mc.toUpperCase(),s.qkey.toUpperCase()),a.jsx("td",{className:"text-center align-middle",children:a.jsx("div",{children:(null==t?void 0:t.mc)?t.mc.toUpperCase():"-"})},s.id)})),a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:e.correct}),a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:e.incorrect}),a.jsx("td",{className:"text-center align-middle",rowSpan:2,children:e.mc_score})]}),a.jsx("tr",{children:N.map((s=>{var n;const t=null==(n=null==e?void 0:e.answers)?void 0:n.find((e=>e.id===s.id)),i=(null==t?void 0:t.mc)&&s.qkey&&t.mc.toUpperCase()===s.qkey.toUpperCase();return a.jsx("td",{className:"text-center align-middle",style:{color:i?"green":"red"},children:i?s.poin:0},s.id+"-poin")}))})]},e.id))):a.jsx("tr",{children:a.jsx("td",{children:"Data belum tersedia"})})})]})})})),U=()=>{const{name:e,examid:s,token:n}=h(),[t,i]=b.useState(""),[l,d]=b.useState("table"),r=b.useRef(),c=b.useRef(),o=b.useRef(),m=b.useRef();return a.jsxs(p,{title:`${e.replace(/-/g," ")}`,levels:["admin","teacher"],children:[a.jsx(T,{classid:t,setClassid:i,examid:s,name:e,token:n,onRefetch:()=>{var e,a,s;null==(e=r.current)||e.refetch(),null==(a=c.current)||a.refetch(),null==(s=o.current)||s.refetch()},activeView:l,setActiveView:d,onExport:()=>{if("table"===l&&r.current){const a=L.book_new(),s=r.current.getTableElement(),n=L.table_to_sheet(s);L.book_append_sheet(a,n,"Sheet1");const t=$(a,{bookType:"xlsx",type:"array"}),i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=`Log_${e}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(i,l);else{const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.download=l,e.click()}}else if("list"===l&&o.current){const a=L.book_new(),s=o.current.getTableElement(),n=L.table_to_sheet(s);L.book_append_sheet(a,n,"Sheet1");const t=$(a,{bookType:"xlsx",type:"array"}),i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=`Nilai_${e}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(i,l);else{const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.download=l,e.click()}}else if("analysis"===l&&m.current){const a=L.book_new(),s=m.current.getTableElement(),n=L.table_to_sheet(s);L.book_append_sheet(a,n,"Sheet1");const t=$(a,{bookType:"xlsx",type:"array"}),i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=`Analisis_${e}.xlsx`;if(navigator.msSaveBlob)navigator.msSaveBlob(i,l);else{const e=document.createElement("a");e.href=window.URL.createObjectURL(i),e.download=l,e.click()}}}}),a.jsxs("div",{className:"mt-3",children:["table"===l&&a.jsx(P,{ref:r,examid:s,classid:t}),"chart"===l&&a.jsx(z,{ref:c,examid:s,classid:t}),"list"===l&&a.jsx(A,{ref:o,examid:s,classid:t}),"analysis"===l&&a.jsx(I,{ref:m,examid:s,classid:t})]})]})};export{U as default};
//# sourceMappingURL=ExamReport-CQ9egtLy.js.map
