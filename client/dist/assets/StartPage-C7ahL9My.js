import{j as e,b as s,a_ as a,a$ as n,e as t,b0 as i,b1 as r,aQ as l,J as c}from"./index-DFhdulld.js";import{e as o,b as d,u}from"./vendor-CnnDPxwB.js";const m=e=>{if(!e&&0!==e)return"--:--:--";const s=Math.floor(e/3600),a=Math.floor(e%3600/60),n=e%60;return`${String(s).padStart(2,"0")}:${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`},x=({name:s,user:a,examid:n,timeLeft:t,isExamStarted:i})=>e.jsx("div",{className:"container-fluid bg-primary text-white",children:e.jsx("div",{className:"container p-2",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"card-title mb-0",children:s.replace(/-/g," ")}),e.jsxs("small",{children:["Nama: ",a.name," | Kelas: ",a.class]})]}),e.jsx("div",{className:"d-flex align-items-center gap-3",children:i&&e.jsx("div",{className:"h3 m-0",children:m(t)})})]})})}),h=({currentPage:s,questionsLength:a,isLoading:n,onPrevious:t,onNext:i,onReset:r,onFinish:l,questionsData:c,answers:o})=>{const d=()=>c.every((e=>{const s=o[e.id];return 2===e.qtype?Boolean((null==s?void 0:s.essay)&&""!==s.essay.trim()):Boolean(null==s?void 0:s.mc)}));return e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:t,disabled:1===s||n,children:e.jsx("i",{className:"bi bi-chevron-double-left"})}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",disabled:!0,children:`Pertanyaan No ${s}`}),e.jsx("button",{className:"btn btn-sm btn-primary",onClick:i,disabled:s===a||n,children:e.jsx("i",{className:"bi bi-chevron-double-right"})})]}),e.jsxs("div",{className:"btn-group",children:[e.jsxs("button",{className:"btn btn-sm btn-warning",onClick:r,disabled:n,children:[e.jsx("i",{className:"bi bi-recycle"})," Sync"]}),e.jsxs("button",{className:"btn btn-sm btn-danger",onClick:l,disabled:!d(),title:d()?"Selesaikan ujian":"Semua pertanyaan harus dijawab",children:[e.jsx("i",{className:"bi bi-check-circle"})," Selesaikan Ujian"]})]})]})},b=({question:s})=>{return e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("p",{className:"card-text",dangerouslySetInnerHTML:(a=s,{__html:a})})})});var a},y=({currentQuestion:s,answers:a,essay:n,setEssay:t,currentPage:i,handleSubmit:r,isLoadingAnswer:l})=>e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:l?e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):(()=>{var l;if(!s)return null;if(2===s.qtype){const i=(null==(l=a[s.id])?void 0:l.essay)||"";return e.jsx("div",{className:"answer-options",children:e.jsx("textarea",{className:"form-control",rows:"4",placeholder:"Ketikkan jawabanmu disini...",value:i||n,onChange:e=>t(e.target.value),onBlur:()=>r()})})}return e.jsx("div",{className:"d-flex flex-column gap-2",children:s.choices&&s.choices.map(((n,t)=>{var l;const c=null==(l=a[s.id])?void 0:l.mc,o=c&&c===n.key;return e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:`question-${i}`,id:`option-${n.key}`,value:n.key,checked:o,onChange:e=>r(e.target.value)}),e.jsx("label",{className:"form-check-label pointer",htmlFor:`option-${n.key}`,children:e.jsx("span",{dangerouslySetInnerHTML:(d=n.text,{__html:d})})})]},t);var d}))})})()})}),g=({questionsData:s,currentPage:a,answers:n,isLoading:t,onQuestionNumberClick:i})=>e.jsx("div",{className:"card",children:e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:s.map(((s,r)=>{const l=null==s?void 0:s.id,c=n[l],o=2===s.qtype?Boolean((null==c?void 0:c.essay)&&""!==c.essay.trim()):Boolean((null==c?void 0:c.mc)&&""!==c.mc);return e.jsx("button",{className:"btn btn-sm "+(a===r+1?"btn-primary":o?"btn-danger":"btn-outline-primary"),onClick:()=>i(r),disabled:t,children:r+1},r)}))})})}),j=({questionsData:i,currentPage:r,onNext:l,onPrevious:c,onQuestionNumberClick:u,onReset:m,onFinish:x})=>{const{examid:j}=o(),v=i[r-1]||{},[p,f]=d.useState(""),[N,q]=d.useState(""),[S,k]=d.useState({}),{user:w}=s((e=>e.auth)),{data:E,isLoading:L}=a({student:w.user_id,exam:j}),[P,{isLoading:_,isSuccess:C,isError:A,reset:$}]=n();console.log(E),d.useEffect((()=>{var e;if(E){const s={};E.forEach((e=>{e.question_id&&(s[e.question_id]={id:e.id,mc:e.mc||null,essay:e.essay||null,point:e.point||0,qtype:e.qtype})})),k(s),(null==(e=s[v.id])?void 0:e.mc)&&q(s[v.id].mc)}}),[E,v]),d.useEffect((()=>{S[v.id]?2===v.qtype?f(S[v.id].essay||""):q(S[v.id].mc||""):(q(""),f(""))}),[v,S]);const I=async(e=null)=>{var s;if(!v)return;const a=2===v.qtype?p:e,n={id:(null==(s=S[v.id])?void 0:s.id)||null,student:w.user_id,exam:j,question:v.id,mc:2===v.qtype?null:a,essay:2===v.qtype?a:null};t.promise(P(n).unwrap().then((e=>(e.id&&k((s=>({...s,[v.id]:{...s[v.id],id:e.id,mc:2===v.qtype?null:a,essay:2===v.qtype?a:null}}))),e.message))),{loading:"Meyimpan data...",success:e=>e,error:e=>e.data.message})};return d.useEffect((()=>{A&&$(),C&&$()}),[A,$,C]),e.jsxs("div",{className:"container-fluid mt-2",children:[e.jsx(h,{currentPage:r,questionsLength:i.length,isLoading:_,onPrevious:async()=>{2===v.qtype&&p&&await I(),c()},onNext:async()=>{2===v.qtype&&p&&await I(),l()},onReset:m,onFinish:x,questionsData:i,answers:S}),e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-5 col-12",children:e.jsx(b,{question:v.question})}),e.jsx("div",{className:"col-lg-5 col-12",children:e.jsx(y,{currentQuestion:v,answers:S,essay:p,setEssay:f,currentPage:r,handleSubmit:I,isLoadingAnswer:L})}),e.jsx("div",{className:"col-lg-2 col-12",children:e.jsx(g,{questionsData:i,currentPage:r,answers:S,isLoading:_,onQuestionNumberClick:u})})]})]})},v=()=>{const{name:a,examid:n,token:m}=o(),h=u(),{user:b}=s((e=>e.auth)),{data:y={},refetch:g,isLoading:v,error:p}=i({examid:n}),{exam:f,banks:N,questions:q}=y,[S,k]=d.useState([]),[w,E]=d.useState(1),[L,P]=d.useState(null),[_,C]=d.useState(!1),[A]=r(),{data:$,error:I}=l({exam:n,student:b.user_id},{skip:!n||!b.user_id});d.useEffect((()=>{p&&(t.error("Anda tidak memiliki akses ke ujian ini"),h("/siswa-daftar-ujian"))}),[p,h]),d.useEffect((()=>{I&&(t.error("Anda belum memulai ujian ini"),h("/siswa-daftar-ujian"))}),[I,h]),d.useEffect((()=>{if($&&f&&$.start_time){const e=new Date($.start_time).getTime(),s=(new Date).getTime(),a=Math.floor((s-e)/1e3),n=60*f.duration,t=Math.max(0,n-a);t<=0?D():(P(t),C(!0))}}),[$,f]),d.useEffect((()=>{if(!_||!L)return;const e=setInterval((()=>{P((s=>s<=1?(clearInterval(e),D(),0):s-1))}),1e3);return()=>clearInterval(e)}),[_,L]);const D=async()=>{t.promise(A({id:$.id,exam:n}).unwrap(),{loading:"Submitting exam...",success:e=>(t.success("Exam submitted successfully"),h("/siswa-daftar-ujian"),e.message||"Exam submitted successfully"),error:e=>{var s;return`Failed to submit exam: ${(null==(s=e.data)?void 0:s.message)||e.message}`}})};return d.useEffect((()=>{if(!q)return;const e=localStorage.getItem("questions");if(e)try{const s=JSON.parse(e);Array.isArray(s.questions)?k(s.questions):k([])}catch(s){console.error("Error parsing stored questions:",s),k([])}else q&&Array.isArray(q)&&(localStorage.setItem("questions",JSON.stringify({questions:q})),k(q))}),[q]),v?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"100vh"},children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs("div",{style:{height:"100vh"},className:"bg-light",children:[e.jsx(c,{title:`Pertanyaan No ${w}`}),e.jsx(x,{name:a,user:b,examid:n,timeLeft:L,isExamStarted:_}),e.jsx(j,{questionsData:S,currentPage:w,onNext:()=>{w<S.length&&E(w+1)},onPrevious:()=>{w>1&&E(w-1)},onQuestionNumberClick:e=>{E(e+1)},onReset:()=>{localStorage.removeItem("questions"),g(),q&&Array.isArray(q)&&(localStorage.setItem("questions",JSON.stringify({questions:q})),k(q))},onFinish:D})]})};export{v as default};
//# sourceMappingURL=StartPage-C7ahL9My.js.map
