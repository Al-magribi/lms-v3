import{a1 as e,a2 as a,ay as s,az as t,s as n,j as i,a as l,F as r,m as o,R as d,C as c,aA as u,r as h,b as m,an as x,n as p,aq as g,l as j,aB as k,aC as b,I as y,aD as f,aE as S,B as w,$ as C,aF as v,aG as T,aH as _,D as I,aI as P,aJ as L,aK as q,aL as A,aM as D,aN as E,aO as B,aP as $,aQ as M,aR as z,aS as N,aT as F,x as U,h as O}from"./index-uqXiPZaM.js";import{c as R,k as J,u as K}from"./vendor-DTs43g_X.js";import{A as G}from"./Add-ClBUWLqP.js";import{E as H,P as V,S as Y}from"./Pagination-CcDshGE9.js";import{S as Q}from"./index-DimbDAWW.js";import{R as W}from"./ContainerOutlined-CyeNz6X2.js";import{R as X,F as Z,D as ee}from"./Table-Cvq4F04g.js";import{R as ae}from"./DeleteOutlined-C5VyeaFb.js";import{M as se}from"./index-DzGsxoGF.js";import{E as te}from"./Editor-Bw8O7CXI.js";import{T as ne}from"./index-BAm9WSKq.js";import{U as ie}from"./Upload-4363HaMA.js";import{r as le,u as re,w as oe}from"./xlsx-Dmkey_AY.js";import{A as de}from"./index-7mhCT5El.js";import{U as ce,R as ue,a as he}from"./InboxOutlined-DhcWKAB8.js";import{P as me}from"./index-yWlD8c-I.js";import{S as xe}from"./index-BX8uTKmp.js";import{R as pe}from"./ClockCircleOutlined-QE2gWT7q.js";import{R as ge}from"./CalendarOutlined-Chrjrg9V.js";import{T as je}from"./TableLayout-C9zhRGu7.js";import"./progress-BWpqLqt3.js";var ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"},be=function(s,t){return R.createElement(e,a({},s,{ref:t,icon:ke}))},ye=R.forwardRef(be);const{confirm:fe}=se,Se=({onEdit:e,search:a})=>{const[g,j]=J(),[k,b]=R.useState(1),[y,f]=R.useState(8),[S,w]=R.useState(""),{data:C,isLoading:v}=s({page:k,limit:y,search:S}),T=C?.banks,[_,{data:I,isLoading:P,isSuccess:L,error:q,reset:A}]=t();return R.useEffect(()=>{L&&(n.success(I.message),A()),q&&n.error(q.data.message)},[I,L,q]),R.useEffect(()=>{const e=setTimeout(()=>{w(a),b(1)},500);return()=>clearTimeout(e)},[a]),v||0!==T?.length?i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsx(o,{tip:"Memuat data...",spinning:v||P,children:i.jsx(d,{gutter:[16,16],children:T?.map(a=>i.jsx(c,{xs:24,sm:12,md:8,lg:6,children:i.jsx(l,{title:i.jsx(x,{title:a.name,children:a.name}),loading:v||P,actions:[i.jsx(x,{title:"Detail",children:i.jsx(X,{onClick:()=>{var e;j({subject:(e=a).subject_name.replace(/\s+/g,"-"),bankid:e.id,name:e.name.replace(/\s+/g,"-")})}},"more")}),i.jsx(x,{title:"Ubah Data",children:i.jsx(p,{onClick:()=>e(a)},"edit")}),i.jsx(x,{title:"Hapus Data",children:i.jsx(ae,{onClick:()=>{return e=a.id,void fe({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang dihapus tidak bisa dikembalikan",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){_(e)},onCancel(){n.warning("Aksi dibatalkan")}});var e}},"delete")})],children:i.jsx(l.Meta,{description:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(Q,{children:[i.jsx(u,{}),i.jsx(h.Text,{children:a.subject_name})]}),i.jsxs(Q,{children:[i.jsx(m,{}),i.jsx(h.Text,{children:a.teacher_name})]}),i.jsxs(Q,{children:[i.jsx(ye,{}),i.jsx(h.Text,{children:a.btype})]}),i.jsxs(Q,{children:[i.jsx(W,{}),i.jsxs(h.Text,{children:[a.question_count," Soal"]})]})]})})})},a.id))})}),T?.length>0&&i.jsx(V,{align:"center",total:C?.totalData,pageSize:y,current:k,onChange:(e,a)=>{b(e),f(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`})]}):i.jsx(l,{children:i.jsx(H,{description:S?`Data dengan kata kunci "${S}" tidak ditemukan.`:"Belum ada data bank soal yang dapat ditampilkan."})})},we=({open:e,onClose:a,title:s,bank:t})=>{const{user:l}=g(e=>e.auth),[r,d]=R.useState(""),[c,u]=R.useState([]),[h]=j.useForm(),{data:m,isLoading:x}=k({page:"",limit:"",search:r}),[p,{data:f,isLoading:S,isSuccess:w,error:C}]=b(),v=m?.map(e=>({value:e.id,label:e.name,subjects:e.subjects}))||[];return R.useEffect(()=>{w&&(n.success(f.message),h.resetFields(),a()),C&&n.error(C.data.message)},[f,w,C]),R.useEffect(()=>{if(e)if(h.resetFields(),u([]),t.id){if(t&&m){const e=m.find(e=>e.id===t.teacher);if(e){const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}h.setFieldsValue({name:t.name,btype:t.btype,teacher:t.teacher,subject:t.subject})}}else if(h.setFieldsValue({btype:"paket"}),"teacher"===l?.level&&m){const e=m.find(e=>e.id===l.id);if(e){h.setFieldsValue({teacher:e.id});const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}}},[e,t,m,h,l]),i.jsx(se,{title:s,open:e,onCancel:a,cancelText:"Tutup",okText:"Simpan",onOk:()=>h.submit(),confirmLoading:S,forceRender:!0,children:i.jsx(o,{tip:"Memproses data...",spinning:S,children:i.jsxs(j,{form:h,layout:"vertical",onFinish:e=>{if(t.id){const a={id:t.id,...e};p(a)}else p(e)},initialValues:{btype:"paket"},children:[i.jsx(j.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(Y,{placeholder:"Ketik untuk mencari guru...",allowClear:!0,showSearch:!0,onSearch:e=>{d(e)},options:v,onChange:(e,a)=>{if(a){const e=a.subjects.map(e=>({value:e.id,label:e.name}));u(e)}else u([]);h.setFieldsValue({subject:void 0})},loading:x,disabled:"teacher"===l?.level,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(j.Item,{name:"subject",label:"Pilih Mata Pelajaran",rules:[{required:!0,message:"Pilih mata pelajaran terlebih dahulu"}],children:i.jsx(Y,{placeholder:"Pilih mata pelajaran",allowClear:!0,options:c,disabled:0===c.length&&!t,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(j.Item,{name:"btype",label:"Tipe Bank Soal",children:i.jsx(Y,{placeholder:"Pilih tipe bank soal",options:[{label:"Paket",value:"paket"}],disabled:!0})}),i.jsx(j.Item,{name:"name",label:"Nama Bank Soal",rules:[{required:!0,message:"Nama bank soal wajib diisi"}],children:i.jsx(y,{placeholder:"maks 30 karakter",maxLength:30})})]})})})},Ce=()=>{const[e,a]=R.useState(!1),[s,t]=R.useState(!1),[n,l]=R.useState({}),[o,d]=R.useState("");return i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Manajemen Bank Soal"}),i.jsxs(Q,{children:[i.jsx(y.Search,{placeholder:"Cari Data ...",allowClear:!0,onChange:e=>d(e.target.value),style:{width:250}}),i.jsx(G,{onClick:()=>a(!0)})]})]}),i.jsx(Se,{onEdit:e=>{l(e),t(!0),a(!0)},search:o}),i.jsx(we,{title:s?`Edit Bank Soal ${n.name}`:"Tambah Bank Soal",open:e,onClose:()=>{l({}),t(!1),a(!1)},bank:n})]})},ve=({open:e,onClose:a,title:s,ques:t,bankid:l})=>{const[r]=j.useForm(),[o,u]=R.useState(1),[h,{data:m,isSuccess:x,error:p,isLoading:g}]=f();return R.useEffect(()=>{e&&(t?(console.log(t),r.setFieldsValue({qtype:t.type||1,qkey:t.qkey||null,poin:t.poin||0,question:t.question||"",choiceA:t.a||"",choiceB:t.b||"",choiceC:t.c||"",choiceD:t.d||"",choiceE:t.e||""}),u(t.type||1)):(r.resetFields(),r.setFieldsValue({type:1,poin:0})))},[e,t,r]),R.useEffect(()=>{x&&(n.success(m.message),r.resetFields(),a()),p&&n.error(p.data.message)},[m,x,p]),i.jsx(se,{title:s,open:e,onCancel:a,width:900,destroyOnHidden:!0,okText:"Simpan",cancelText:"Tutup",confirmLoading:g,loading:g,onOk:()=>r.submit(),style:{top:20},children:i.jsxs(j,{form:r,layout:"vertical",onFinish:e=>{const a={id:t?.id?t?.id:"",qtype:e.type,poin:e.poin,question:e.question,bank:l,qkey:e.qkey,a:e.choiceA,b:e.choiceB,c:e.choiceC,d:e.choiceD,e:e.choiceE};console.log(a),h(a)},initialValues:{type:1,poin:0},style:{height:600,overflowY:"auto",overflowX:"hidden",scrollbarWidth:"none"},children:[i.jsxs(d,{gutter:16,children:[i.jsx(c,{span:12,children:i.jsx(j.Item,{name:"type",label:"Tipe Pertanyaan",rules:[{required:!0,message:"Silakan pilih tipe pertanyaan!"}],children:i.jsx(Y,{placeholder:"Pilih Tipe Pertanyaan",onChange:e=>u(e),options:[{label:"Pilihan Ganda",value:1},{label:"Essai",value:2}],allowClear:!0})})}),i.jsx(c,{span:12,children:i.jsx(j.Item,{name:"poin",label:"Poin",rules:[{required:!0,message:"Silakan masukkan poin!"}],children:i.jsx(ne,{style:{width:"100%"},min:0,placeholder:"Masukkan Poin"})})})]}),1===o&&i.jsx(j.Item,{name:"qkey",label:"Kunci Jawaban",rules:[{required:!0,message:"Silakan pilih kunci jawaban!"}],children:i.jsx(Y,{placeholder:"Pilih Kunci Jawaban",options:[{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"},{label:"D",value:"D"},{label:"E",value:"E"}],allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(j.Item,{name:"question",label:"Pertanyaan",rules:[{required:!0,message:"Pertanyaan tidak boleh kosong!"}],children:i.jsx(te,{placeholder:"Ketikan pertanyaan di sini ...",height:200})}),1===o&&["A","B","C","D","E"].map(e=>i.jsx(j.Item,{name:`choice${e}`,label:`Pilihan ${e}`,children:i.jsx(te,{placeholder:`Ketikan jawaban untuk pilihan ${e} ...`,height:150})},e))]})})},{Text:Te}=h,{Dragger:_e}=ce,Ie=({title:e,open:a,onClose:s,bankid:t})=>{const[l,{isLoading:r,isSuccess:o,error:d,data:c,reset:u}]=S(),[h,m]=R.useState([]),[x,p]=R.useState([]),[g,j]=R.useState([]);R.useEffect(()=>{o&&(n.success(c?.message||"Soal berhasil diunggah!"),p([]),m([]),s()),d&&n.error(d.data?.message||"Terjadi kesalahan saat mengunggah.")},[c,o,d,s]);const k={name:"file",multiple:!1,accept:".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",fileList:h,onRemove:()=>{m([]),p([]),j([])},customRequest:({file:e,onSuccess:a,onError:s})=>{const t=new FileReader;t.onload=t=>{try{const s=new Uint8Array(t.target.result),n=le(s,{type:"array"}),l=n.SheetNames[0],r=n.Sheets[l],o=re.sheet_to_json(r,{header:1,range:1}),d=o.filter(e=>e.length>0&&e.some(e=>null!=e&&""!==e)).map(e=>{const[a,s,t,n,i,l,r,o,d]=e;return 2===Number(a)?{Jenis:a,Pertanyaan:s,A:null,B:null,C:null,D:null,E:null,Jawaban:o,Poin:d}:{Jenis:a,Pertanyaan:s,A:t,B:n,C:i,D:l,E:r,Jawaban:o,Poin:d}});if(d.length>0){const e=Object.keys(d[0]).map(e=>({title:e,dataIndex:e,key:e,..."Jenis"===e&&{render:e=>i.jsx(C,{color:1===Number(e)?"green":"blue",children:1===Number(e)?"Pilihan Ganda":"Essay"}),width:150}}));j(e)}p(d),m([e]),a("ok")}catch(l){console.error("File processing error:",l),n.error("Gagal memproses file. Periksa kembali formatnya."),s(l)}},t.readAsArrayBuffer(e)}};return i.jsx(se,{title:e,open:a,onCancel:()=>{p([]),m([]),j([]),(d||o)&&u(),s()},onOk:()=>{if(0===x.length)return void n.error("Tidak ada data untuk diunggah. Silakan pilih file yang valid.");const e=x.map(e=>[Number(e.Jenis),String(e.Pertanyaan),e.A?String(e.A):null,e.B?String(e.B):null,e.C?String(e.C):null,e.D?String(e.D):null,e.E?String(e.E):null,String(e.Jawaban),Number(e.Poin||0)]);l({body:e,bankid:t})},okText:"Simpan",cancelText:"Tutup",width:1e3,confirmLoading:r,children:i.jsxs(Q,{direction:"vertical",style:{width:"100%"},size:"large",children:[i.jsx(de,{message:"Ikuti langkah-langkah berikut",description:i.jsxs(Q,{direction:"vertical",size:2,children:[i.jsx(Te,{children:"1. Unduh template Excel yang disediakan."}),i.jsx(Te,{children:"2. Isi data soal sesuai dengan kolom yang tersedia."}),i.jsx(Te,{children:"3. Unggah file yang sudah diisi pada area di bawah ini."}),i.jsx(w,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_soal.xlsx","_blank")},children:"Unduh Template"})]}),type:"info",showIcon:!0}),i.jsxs(_e,{...k,children:[i.jsx("p",{className:"ant-upload-drag-icon",children:i.jsx(ue,{})}),i.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),i.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx atau .xls."})]}),x.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Te,{strong:!0,children:"Pratinjau Data:"}),i.jsx(Z,{columns:g,dataSource:x,bordered:!0,size:"small",rowKey:(e,a)=>a,loading:r,pagination:{pageSize:5},scroll:{x:"max-content"}})]})]})})},Pe=e=>({__html:e||""}),Le={1:{label:"Pilihan Ganda",color:"blue"},2:{label:"Esai",color:"purple"}},qe=({subject:e,bankid:a,name:s})=>{const t=K(),[u,m]=R.useState(1),[x,g]=R.useState(10),[j,k]=R.useState(""),[b,y]=R.useState(!1),[f,S]=R.useState(!1),[L,q]=R.useState(null),{data:A,isLoading:D,error:E}=v({page:u,limit:x,search:j,bankid:a}),[B,{data:$,isLoading:M,isSuccess:z,error:N}]=T(),F=(e=null)=>{q(e),y(!0)};R.useEffect(()=>{z&&n.success($.message),N&&n.error(N.data.message)},[$,z,N]);return i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(Q,{children:[i.jsx(w,{shape:"circle",icon:i.jsx(_,{}),onClick:()=>t("/computer-based-test")}),i.jsxs("div",{children:[i.jsxs(h.Title,{style:{margin:0},level:4,children:["Bank Soal: ",s]}),i.jsx(h.Text,{type:"secondary",children:e})]})]}),i.jsxs(Q,{children:[i.jsx(ie,{onClick:()=>S(!0)}),i.jsx(G,{onClick:()=>F(null)})]})]}),0===A?.questions.length?i.jsx(H,{description:"Data pertanyaan belum tersedia"}):i.jsx(o,{tip:"Memuat data...",spinning:D||M,children:i.jsxs(r,{vertical:!0,gap:"large",children:[E?i.jsx(de,{type:"warning",showIcon:!0,message:"Soal Belum Tersedia",description:E?E.data?.message||"Gagal memuat soal.":"Silakan unggah atau buat soal terlebih dahulu."}):A?.questions.map((e,a)=>{const s=Le[e.qtype]||{label:"Tipe Tidak Dikenal",color:"default"},t=[{key:"A",text:e.a},{key:"B",text:e.b},{key:"C",text:e.c},{key:"D",text:e.d},{key:"E",text:e.e}];return i.jsxs(l,{loading:D||M,title:i.jsxs(r,{vertical:!0,children:[i.jsx(h.Text,{children:`Pertanyaan ${(u-1)*x+a+1}`}),i.jsxs(Q,{size:"small",children:[i.jsx(C,{color:s.color,children:s.label}),i.jsxs(C,{children:[i.jsx("strong",{children:e.poin||0})," Poin"]})]})]}),extra:i.jsxs(Q,{children:[i.jsx(w,{icon:i.jsx(p,{}),onClick:()=>F(e),children:"Ubah"}),i.jsx(me,{title:"Hapus Soal",description:"Apakah Anda yakin ingin menghapus soal ini?",onConfirm:()=>B(e.id),okText:"Ya, Hapus",cancelText:"Batal",children:i.jsx(w,{danger:!0,icon:i.jsx(ae,{}),children:"Hapus"})})]}),children:[i.jsx("div",{dangerouslySetInnerHTML:Pe(e.question)}),1===e.qtype&&i.jsxs(i.Fragment,{children:[i.jsx(I,{orientation:"left",plain:!0,children:"Opsi Jawaban"}),i.jsx(d,{gutter:[16,16],children:t.map(a=>a.text&&""!==a.text.trim()&&i.jsx(c,{xs:24,sm:24,md:12,children:i.jsxs(r,{align:"start",gap:"small",style:{padding:"12px",borderRadius:"8px",border:e.qkey===a.key?"1px solid #52c41a":"1px solid #d9d9d9",background:e.qkey===a.key?"#f6ffed":"transparent",width:"100%",height:"100%"},children:[i.jsx(C,{children:a.key}),i.jsx("div",{style:{flex:1},dangerouslySetInnerHTML:Pe(a.text)}),e.qkey===a.key&&i.jsx(P,{style:{color:"#52c41a",fontSize:"16px",marginTop:"2px"}})]})},a.key))})]})]},e.id)}),i.jsx(V,{size:"small",align:"center",total:A?.totalData,pageSize:x,current:u,onChange:(e,a)=>{m(e),g(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`})]})}),i.jsx(ve,{title:L?"Ubah Soal":"Tambah Soal",open:b,onClose:()=>{q(null),y(!1)},bankid:a,ques:L}),i.jsx(Ie,{title:`Upload pertanyaan ${s?.replace(/-/g," ")}`,open:f,onClose:()=>S(!1),bankid:a})]})},Ae=({title:e,open:a,onClose:s,exam:t})=>{const{user:l}=g(e=>e.auth),[r]=j.useForm(),{data:o}=k(),{data:d}=L(),[c,{isLoading:u}]=q(),[h,m]=R.useState([]),x=t?"Edit Ujian":e,p=R.useMemo(()=>o?o.map(e=>({value:e.id,label:e.name,banks:e.bank})):[],[o]),b=R.useMemo(()=>d?d.map(e=>({value:e.id,label:e.name})):[],[d]);R.useEffect(()=>{if(a)if(r.resetFields(),t&&o){const e=p?.find(e=>e.value===t.teacher);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}r.setFieldsValue({...t,classes:(t.classes||[]).map(e=>e.id),bank:(t.banks||[]).map(e=>e.id)})}else if(r.resetFields(),m([]),"teacher"===l?.level&&p.length>0){r.setFieldsValue({teacher:l.id});const e=p.find(e=>e.value===l.id);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}}},[a,t,o,l,r,p]);return i.jsx(se,{title:x,open:a,onCancel:s,destroyOnHidden:!0,okText:"Simpan",cancelText:"Batal",onOk:r.submit,confirmLoading:u,style:{top:20},children:i.jsxs(j,{form:r,layout:"vertical",onFinish:async e=>{const a=e.bank.map(e=>({bankid:e,pg:null,essay:null})),i=e.classes.map(e=>({value:e})),l={...e,bank:a,classes:i,isshuffle:e.isshuffle||!1};t&&(l.examid=t.id,l.token=t.token);try{await c(l).unwrap(),n.success(`Ujian berhasil ${t?"diperbarui":"dibuat"}!`),s()}catch(r){console.error("Gagal menyimpan ujian:",r),n.error("Terjadi kesalahan saat menyimpan ujian.")}},initialValues:{mc_score:100,essay_score:0,isshuffle:!1},children:[i.jsx(j.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(Y,{placeholder:"Cari Guru",options:p,onChange:(e,a)=>{r.setFieldsValue({bank:[]}),m(a?(a.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type})):[])},allowClear:!0,showSearch:!0,disabled:"teacher"===l?.level,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),virtual:!1})}),i.jsx(j.Item,{name:"bank",label:"Pilih Bank Soal",rules:[{required:!0,message:"Pilih bank soal terlebih dahulu"}],children:i.jsx(Y,{mode:"multiple",placeholder:"Pilih satu atau lebih bank soal",options:h,onChange:e=>{if(0===e.length)return;const a=e[e.length-1],s=h.find(e=>e.value===a);if("paket"===s?.type)r.setFieldsValue({bank:[a]});else{const a=e.filter(e=>{const a=h.find(a=>a.value===e);return a&&"paket"!==a.type});r.setFieldsValue({bank:a})}},allowClear:!0,virtual:!1,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})}),i.jsx(j.Item,{name:"classes",label:"Untuk Kelas",rules:[{required:!0,message:"Pilih kelas terlebih dahulu"}],children:i.jsx(Y,{mode:"multiple",placeholder:"Pilih satu atau lebih kelas",options:b,allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(j.Item,{name:"name",label:"Nama Ujian",rules:[{required:!0,message:"Masukkan nama ujian"}],children:i.jsx(y,{placeholder:"maks 30 karakter",maxLength:30})}),i.jsx(j.Item,{name:"duration",label:"Durasi (Menit)",rules:[{required:!0,message:"Masukkan durasi ujian"}],children:i.jsx(ne,{style:{width:"100%"},placeholder:"Masukkan durasi dalam menit",min:1})}),i.jsx(j.Item,{name:"mc_score",label:"Persentase Nilai PG",rules:[{required:!0,message:"Masukkan persentase nilai PG"}],children:i.jsx(ne,{style:{width:"100%"},min:0,max:100})}),i.jsx(j.Item,{name:"essay_score",label:"Persentase Nilai Essay",rules:[{required:!0,message:"Masukkan persentase nilai essay"}],children:i.jsx(ne,{style:{width:"100%"},min:0,max:100})}),i.jsx(j.Item,{name:"isshuffle",label:"Acak Soal?",valuePropName:"checked",children:i.jsx(xe,{})})]})})},{Text:De,Title:Ee}=h,{confirm:Be}=se,$e=()=>{J();const[e,a]=R.useState(1),[s,t]=R.useState(8),[u,g]=R.useState(""),[j,k]=R.useState(""),[b,f]=R.useState({}),[S,w]=R.useState(!1),[v,T]=R.useState(!1),{data:_,isLoading:P,error:L}=A({page:e,limit:s,search:j}),[q,{data:E,isSuccess:B,error:$,isLoading:M,reset:z}]=D(),N=_?.exams;return R.useEffect(()=>{B&&(n.success(E.message),z()),$&&(n.error($.data.message),z())},[E,B,$]),R.useEffect(()=>{const e=setTimeout(()=>{k(u),a(1)},500);return()=>clearTimeout(e)},[u]),L?i.jsx(de,{showIcon:!0,type:"error",message:"Terjadi Kesalahan",description:L?L.data.message:"Jadwal ujian belum tersedia"}):i.jsx(o,{tip:"Memuat data...",spinning:P,children:i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Managemen Penjadwalan"}),i.jsxs(Q,{children:[i.jsx(y.Search,{placeholder:"Cari data ...",allowClear:!0,onChange:e=>g(e.target.value)}),i.jsx(G,{onClick:()=>T(!0)})]})]}),i.jsx(d,{gutter:[16,16],children:N?.map(e=>i.jsx(c,{sm:24,md:12,lg:6,children:i.jsx(l,{hoverable:!0,loading:P||M,title:i.jsx(x,{title:e.name,children:i.jsx(De,{ellipsis:!0,children:e.name})}),extra:i.jsx(C,{color:e.isactive?"green":"volcano",children:e.isactive?"Aktif":"Tidak Aktif"}),actions:[i.jsx(x,{title:"Detail",children:i.jsx(X,{onClick:()=>{return a=e,void window.open(`/computer-based-test?report=true&examid=${a.id}&token=${a.token}&name=${a.name?.replace(/\s+/g,"-")}`,"_blank");var a}},"detail")}),i.jsx(x,{title:"Edit",children:i.jsx(p,{onClick:()=>(f(e),w(!0),void T(!0))},"edit")}),i.jsx(x,{title:"Hapus",children:i.jsx(ae,{onClick:()=>{return a=e.id,void Be({title:"Apa anda yakin menghapus data ini?",content:"Data yang sudah dihapus tidak bisa dikembalikan",okText:"Ya, hapus",okType:"danger",cancelText:"Batal",onOk(){q(a)},onCancel(){n.info("Aksi dibatalkan")}});var a}},"remove")})],children:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(De,{type:"secondary",children:"Token Ujian"}),i.jsx(De,{strong:!0,copyable:!0,children:e.token})]}),i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(De,{type:"secondary",children:"Acak Soal"}),i.jsx(C,{color:e.isshuffle?"blue":"purple",children:e.isshuffle?"Acak":"Urut"})]}),i.jsx(I,{style:{margin:"8px 0"}}),i.jsxs(r,{vertical:!0,children:[i.jsx(De,{type:"secondary",children:"Bank Soal"}),i.jsx(r,{vertical:!0,gap:"small",children:e.banks?.map((e,a)=>i.jsx(x,{title:e.name,children:i.jsx(h.Text,{ellipsis:!0,children:i.jsx(C,{color:"magenta",children:e.name})})},a))})]}),i.jsx(I,{style:{margin:"8px 0"}}),i.jsxs(Q,{direction:"vertical",size:"small",style:{width:"100%"},children:[i.jsxs(r,{align:"center",gap:8,children:[i.jsx(m,{}),i.jsx(De,{children:e.teacher_name})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(pe,{}),i.jsxs(De,{children:[e.duration," Menit"]})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(ge,{}),i.jsx(De,{children:new Date(e.createdat).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})})]})]}),i.jsx(I,{style:{margin:"8px 0"}}),i.jsx(r,{wrap:"wrap",gap:"8px 0",children:e.classes.map(e=>i.jsx(C,{color:"cyan",children:e.name},e.id))})]})})},e.id))}),N?.length>0&&i.jsx(V,{size:"small",align:"center",total:_?.totalData,pageSize:s,current:e,onChange:(e,s)=>{a(e),t(s)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`}),i.jsx(Ae,{title:S?"Ubah Jadwal Ujian":"Simpan Jadwan Ujian",open:v,onClose:()=>{f({}),w(!1),T(!1)},exam:b})]})})},{confirm:Me}=se,ze=({examid:e,classid:a,tableRef:s})=>{const[t,l]=R.useState(1),[r,o]=R.useState(10),[d,c]=R.useState(""),{data:u,isLoading:h}=E({page:t,limit:r,search:d,exam:e,classid:a}),[m,{isLoading:x}]=B(),[p,{isLoading:g}]=$(),[j,{isLoading:k}]=M(),b=[{title:"No",key:"no",render:(e,a,s)=>(t-1)*r+s+1},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Kelas",dataIndex:"class_name",key:"class_name"},{title:"Ip",dataIndex:"ip",key:"ip"},{title:"Browser",dataIndex:"browser",key:"browser"},{title:"Mulai",dataIndex:"createdat",key:"createdat",render:e=>i.jsx(C,{color:"volcano",children:e&&new Date(e).toLocaleString()})},{title:"Status",key:"status",render:e=>e.ispenalty?i.jsx(C,{color:"red",children:"Melanggar"}):e.isactive?i.jsx(C,{color:"blue",children:"Mengerjakan"}):e.isdone?i.jsx(C,{color:"green",children:"Selesai"}):i.jsx(C,{children:"Belum Masuk"})},{title:"Aksi",key:"action",render:e=>i.jsx(ee.Button,{menu:{items:[{key:"detail",label:"Lihat Jawaban",disabled:!e.log_id},{key:"allow",label:"Izikan Masuk",disabled:!e.isactive},{key:"finish",label:"Selesaikan Ujian",disabled:!e.isdone||!e.isactive},{key:"retake",label:"Ulangi Ujian",disabled:!e.isdone}],onClick:({key:a})=>((e,{key:a})=>{switch(a){case"detail":n.info("detail");break;case"allow":Me({title:"Apakah anda yakin mengizinkan peserta mengikuti ujian ini?",content:"peserta harus refresh halaman ujian agar dapat mengikuti ujian ini",okText:"Ya, Izinkan",cancelText:"Tutup",okType:"danger",async onOk(){try{await p(e.log_id),n.success(`${e.student_name} telah diizinkan masuk kembali`)}catch(a){n.error(a?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"finish":Me({title:`Apakah anda yakin menyelesaikan ujian ${e.student_name} ?`,content:"Setelah diselesaikan peserta tidak ada ikut ujian ini",okText:"Ya, Selesaikan",cancelText:"Tutup",okType:"danger",async onOk(){try{await m(e.log_id),n.success(`Ujian ${e.student_name} telah diselesaikan`)}catch(a){n.error(a?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"retake":Me({title:`Apakah anda yakin mengulang ujian ${e.student_name} ?`,content:"Jawaban dan nilai yang telah diperoleh akan dihapus",okText:`Ya, Ulangi Ujian ${e.student_name}`,cancelText:"Tutup",okType:"danger",async onOk(){try{await j(e.log_id),n.success(`Data ujian ${e.student_name} telah direset`)}catch(a){n.error(a?.data?.message||"Terjadi Kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}})}})(e,{key:a})},children:"Pilihan Aksi"})}];return i.jsx(je,{tableRef:s,onSearch:e=>{c(e),l(1)},isLoading:h||g||x||k,columns:b,source:u?.result,rowKey:"student_id",page:t,limit:r,totalData:u?.totalData,onChange:e=>{l(e.current),o(e.pageSize)}})},Ne=({examid:e,classid:a,tableRef:s})=>{const[t,n]=R.useState(1),[l,r]=R.useState(10),[o,d]=R.useState(""),{data:c,isLoading:u}=z({page:t,limit:l,search:o,exam:e,classid:a}),m=R.useMemo(()=>{if(!c)return[];return[...[{title:"No",key:"no",width:60,fixed:"left",align:"center",render:(e,a,s)=>(t-1)*l+s+1},{title:"Nama Siswa",dataIndex:"name",key:"name",width:250,fixed:"left"}],{title:"Analisis Jawaban Siswa",align:"center",children:c.questions.map((e,a)=>({title:i.jsx(x,{title:`Kunci: ${e.qkey} | Poin: ${e.poin}`,children:`S${a+1}`}),dataIndex:"answers",key:`question_${e.id}`,width:75,align:"center",render:a=>{const s=a?.find(a=>a.id===e.id),t=s?s.mc.toUpperCase():"-",n=t===e.qkey.toUpperCase();return s?i.jsx(h.Text,{style:{marginLeft:"4px",color:n?"#52c41a":"#f5222d"},children:t}):i.jsx(h.Text,{type:"secondary",children:"-"})}}))},...[{title:"Benar",dataIndex:"correct",key:"correct",width:80,fixed:"right",align:"center",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",width:80,fixed:"right",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#f5222d"},children:e})},{title:"Nilai Akhir",dataIndex:"mc_score",key:"mc_score",width:100,fixed:"right",align:"center",render:e=>i.jsx(C,{color:e>=75?"blue":"volcano",style:{fontSize:14,padding:"4px 8px"},children:e})}]]},[c,t,l]);return i.jsx(je,{tableRef:s,onSearch:e=>{d(e),n(1)},isLoading:u,columns:m,source:c?.students,rowKey:"id",page:t,limit:l,totalData:c?.totalData,onChange:e=>{n(e.current),r(e.pageSize)},bordered:!0,scroll:{x:"max-content"}})},{Title:Fe,Text:Ue}=h,{Search:Oe}=y,Re=({examid:e,classid:a,tableRef:s})=>{const[t,n]=R.useState(1),[r,o]=R.useState(10),[u,h]=R.useState(""),[m,x]=R.useState(""),{data:p,isLoading:g,isError:j}=N({exam:e,classid:a,page:t,limit:r,search:m});R.useEffect(()=>{const e=setTimeout(()=>{x(u),1!==t&&n(1)},500);return()=>clearTimeout(e)},[u]);const k=[{title:"No",key:"no",render:(e,a,s)=>(t-1)*r+s+1,width:"5%"},{title:"NIS",dataIndex:"student_nis",key:"student_nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"student_grade",key:"student_grade"},{title:"Kelas",dataIndex:"student_class",key:"student_class"},{title:"Benar",dataIndex:"correct",key:"correct",align:"center",render:e=>i.jsx(Ue,{style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",align:"center",render:e=>i.jsx(Ue,{style:{color:"#f5222d"},children:e})},{title:"Skor PG",dataIndex:"mc_score",key:"mc_score",align:"center"},{title:"Skor Esai",dataIndex:"essay_score",key:"essay_score",align:"center"},{title:"Nilai Akhir",dataIndex:"score",key:"score",align:"center",render:e=>i.jsx(Ue,{strong:!0,style:{color:"#1890ff"},children:e})}];if(j)return i.jsx(de,{message:"Terjadi Kesalahan",description:"Gagal memuat data nilai. Silakan coba lagi nanti.",type:"error",showIcon:!0});const b=p?.exam_name||"Daftar Nilai",y=i.jsxs(Q,{direction:"vertical",size:"small",children:[i.jsxs(Ue,{type:"secondary",children:["Guru: ",p?.teacher_name]}),i.jsxs(Ue,{type:"secondary",children:["Sekolah: ",p?.homebase_name]})]});return i.jsx("div",{ref:s,children:i.jsxs(l,{children:[i.jsx(Fe,{level:4,children:b}),y,i.jsx(d,{justify:"end",style:{margin:"16px 0"},children:i.jsx(c,{children:i.jsx(Oe,{placeholder:"Cari nama atau NIS siswa...",value:u,onChange:e=>h(e.target.value),style:{width:280},allowClear:!0,enterButton:!0})})}),i.jsx(Z,{columns:k,dataSource:p?.students||[],rowKey:"student_id",loading:g,onChange:e=>{n(e.current),o(e.pageSize)},pagination:{current:t,pageSize:r,total:p?.totalData||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} data`},scroll:{x:"max-content"}})]})})},Je=({name:e,examid:a,token:s})=>{const t=K(),[l,o]=R.useState(""),[d,c]=R.useState("1"),u=R.useRef(null),m=R.useRef(null),x=R.useRef(null),{data:p}=F({exam:a},{skip:!a}),g=p?.map(e=>({value:e.id,label:e.name})),j=(e,a)=>{if(!e.current)return void n.error("Tabel tidak ditemukan, tidak dapat mengunduh data.");const s=e.current.querySelector("table");if(!s)return void n.error("Elemen tabel HTML tidak ditemukan.");const t=re.book_new(),i=re.table_to_sheet(s);re.book_append_sheet(t,i,"Data"),oe(t,`${a}.xlsx`)},k=[{label:"Absen",key:"1",children:i.jsx(ze,{examid:a,classid:l,tableRef:u})},{label:"Analisis",key:"2",children:i.jsx(Ne,{examid:a,classid:l,tableRef:m})},{label:"Nilai",key:"3",children:i.jsx(Re,{examid:a,classid:l,tableRef:x})}];return i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(Q,{children:[i.jsx(w,{shape:"circle",icon:i.jsx(_,{}),onClick:()=>{t("/computer-based-test")}}),i.jsxs("div",{children:[i.jsx(h.Title,{style:{margin:0},level:5,children:e?.replace(/-/g," ")}),i.jsx(h.Text,{copyable:!0,strong:!0,children:s})]})]}),i.jsxs(Q,{children:[i.jsx(Y,{style:{width:200},placeholder:"Pilih Kelas",options:g,onChange:e=>{o(e)},allowClear:!0}),i.jsx(w,{icon:i.jsx(he,{}),onClick:()=>{switch(d){case"1":j(u,`Absensi_${e.replace(/-/g,"_")}`);break;case"2":j(m,`Analisis_${e.replace(/-/g,"_")}`);break;case"3":j(x,`Nilai_${e.replace(/-/g,"_")}`)}},children:"Unduh Data"})]})]}),i.jsx(U,{centered:!0,items:k,onChange:e=>c(e)})]})},Ke=()=>{const[e]=J(),a=e.get("subject")?.replace(/-/g," "),s=e.get("bankid"),t=e.get("name")?.replace(/-/g," "),n=e.get("report"),l=e.get("examid"),r=e.get("token"),o=[{label:"Bank Soal",key:"1",children:i.jsx(Ce,{})},{label:"Jadwal Ujian",key:"2",children:i.jsx($e,{})}];return s?i.jsx(O,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(qe,{subject:a,bankid:s,name:t})}):n?i.jsx(O,{title:t?t?.replace(/-/g," "):"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(Je,{name:t,examid:l,token:r})}):i.jsx(O,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(U,{centered:!0,items:o})})};export{Ke as default};
//# sourceMappingURL=CbtControl-BM1Jk0JV.js.map
