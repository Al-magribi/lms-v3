import{a2 as e,a3 as a,j as s,B as n,G as i,a4 as t,s as l,F as r,t as d,a5 as o,a6 as c,a7 as m,m as u,l as g,a8 as h,I as p,a9 as x,D as j,a0 as k,aa as y,h as f,y as S}from"./index-DQzW7PZe.js";import{c as w}from"./vendor-BcjG7WjF.js";import{T as b}from"./TableLayout-B4uFNFKv.js";import{S as A}from"./index-Da7kcvRt.js";import{D as N,F as T}from"./Table-BMframHx.js";import{A as v}from"./Add-C7-bik8Z.js";import{U as C}from"./Upload-csM8L9cf.js";import{r as I,u as D}from"./xlsx-C5xT2hrF.js";import{U as E,R as O}from"./InboxOutlined-B-12CQpF.js";import{R as L}from"./DownloadOutlined-pTdnCz2M.js";import{R as _}from"./CheckCircleOutlined-D1qSfdtf.js";import{R as M}from"./CloseCircleOutlined-BhRZVOGl.js";import{A as P}from"./index-CRpkii3Z.js";import"./Pagination-DC8rVK_V.js";import"./DeleteOutlined-BIucr4kP.js";import"./progress-DUuXvQKb.js";var R={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},z=function(s,n){return w.createElement(e,a({},s,{ref:n,icon:R}))},F=w.forwardRef(z);const U=({onClick:e})=>s.jsx(n,{style:{backgroundColor:"#52c41a",color:"#fff"},icon:s.jsx(F,{}),onClick:e,children:"Unduh"}),{Text:H}=d,B=({onEdit:e})=>{const[a,n]=w.useState(1),[d,o]=w.useState(10),[c,m]=w.useState(""),{data:u,isLoading:g}=i({page:a,limit:d,search:c}),[h,{data:p,isLoading:x,isSuccess:j,error:k}]=t(),y=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"delete":n=a.id,window.confirm("Apakah anda yakin akan menghapus siswa ini?!")?h(n):l.warning("Aksi dibatalkan")}var n};w.useEffect(()=>{j&&l.success(p.message),k&&l.error(k.data.message)},[p,j,k]);const f=[{title:"No",key:"no",render:(e,s,n)=>(a-1)*d+n+1},{title:"Nama Siswa",dataIndex:"name",key:"name",render:(e,a)=>s.jsxs(r,{vertical:!0,gap:"small",children:[s.jsx(H,{strong:!0,type:a.isactive?"success":"danger",children:e}),s.jsx(A,{children:s.jsxs("small",{children:[`Periode: ${a.periode_name}`," • ",a.nis," "]})})]})},{title:"Kelas",dataIndex:"classname",key:"classname",render:e=>s.jsx(H,{type:e?"":"danger",children:e||"Belum ada kelas"})},{title:"L/P",dataIndex:"gender",key:"gender",render:e=>s.jsx(H,{children:"P"===e?"Perempuan":"Laki Laki"})},{title:"Aksi",key:"action",render:e=>s.jsx(N.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>y(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsx(b,{onSearch:e=>{m(e),n(1)},isLoading:g||x,columns:f,source:u?.students,rowKey:"id",page:a,limit:d,totalData:u?.totalData,onChange:e=>{n(e.current),o(e.pageSize)}})},G=()=>s.jsxs(r,{vertical:!0,gap:"middle",children:[s.jsxs(r,{align:"center",justify:"space-between",children:[s.jsx(o,{style:{margin:0},level:5,children:"Mangement Siswa"}),s.jsx(U,{})]}),s.jsx(B,{})]}),{Text:K}=d,{confirm:q}=u,V=({onEdit:e})=>{const[a,n]=w.useState(1),[i,t]=w.useState(10),[d,o]=w.useState(""),{data:u,isLoading:g}=c({page:a,limit:i,search:d}),[h,{data:p,error:x,isLoading:j,isSuccess:k}]=m(),y=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"reset":l.info(`Reset id ${a.parent_id}`);break;case"delete":n=a.parent_id,q({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang sudah terhapus tidak bisa dikembalikan",okText:"Ya, Hapus",cancelText:"Batal",okType:"danger",onOk(){h(n)}})}var n};w.useEffect(()=>{k&&l.success(p.message),x&&l.error(x.data.message)},[p,k,x]);const f=[{title:"No",key:"no",render:(e,s,n)=>(a-1)*i+n+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(e,a)=>s.jsxs(r,{vertical:!0,gap:"small",children:[s.jsx(K,{strong:!0,children:e}),s.jsx(A,{children:s.jsxs("small",{children:[a.nis," • ",a.grade," • ",a.class]})})]})},{title:"Nama Orang Tua",dataIndex:"parent_name",key:"parent_name",render:(e,a)=>s.jsxs(r,{vertical:!0,gap:"small",children:[s.jsx(K,{children:e}),s.jsx(K,{type:"secondary",italic:!0,copyable:!0,children:a.parent_email})]})},{title:"Aksi",key:"action",render:e=>s.jsx(N.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"reset",label:"Reset"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>y(e,{key:a})},children:"Pilihan Aksi"})}];return s.jsx(b,{onSearch:e=>{o(e),n(1)},isLoading:g||j,columns:f,source:u?.data,rowKey:"parent_id",page:a,limit:i,totalData:u?.totalData,onChange:e=>{n(e.current),t(e.pageSize)},children:"TableData"})},$=({open:e,onClose:a,title:n,parent:i})=>{const[t]=g.useForm(),[r,{data:d,error:o,isLoading:c,isSuccess:m,reset:x}]=h();return w.useEffect(()=>{e&&(t.resetFields(),i&&t.setFieldsValue({nis:i.nis,name:i.parent_name,email:i.parent_email}))},[e,i]),w.useEffect(()=>{m&&(l.success(d.message),t.resetFields(),a(),x()),o&&(l.error(o.data.message),x())},[d,o,m]),s.jsx(u,{title:n,open:e,onCancel:a,okText:"Simpan",cancelText:"Tutup",onOk:()=>t.submit(),destroyOnHidden:!0,loading:c,confirmLoading:c,children:s.jsxs(g,{layout:"vertical",form:t,onFinish:e=>{const a={...e,email:e.email?e.email.toLowerCase():""};if(i.parent_id){const e={id:i.parent_id,...a};r(e)}else r(a)},children:[s.jsx(g.Item,{name:"nis",label:"NIS",rules:[{required:!0,message:"NIS wajib diisi"}],children:s.jsx(p,{placeholder:"NIS"})}),s.jsx(g.Item,{name:"name",label:"Nama Orang Tua",rules:[{required:!0,message:"Nama Orang tua wajib diisi"}],children:s.jsx(p,{placeholder:"Nama Orang Tua"})}),s.jsx(g.Item,{name:"email",label:"Email",rules:[{required:!0,message:"Email wajib diisi"}],children:s.jsx(p,{placeholder:"Email"})})]})})},{Dragger:Y}=E,{Text:J}=d,Q=[{title:"NIS",dataIndex:"nis",key:"nis"},{title:"NAMA ORANG TUA",dataIndex:"name",key:"name"},{title:"EMAIL",dataIndex:"email",key:"email"},{title:"KETERANGAN",dataIndex:"issue",key:"issue",render:e=>s.jsx(k,{color:"red",children:e})}],W=({open:e,onClose:a})=>{const[i,t]=w.useState(null),[d,o]=w.useState([]),[c,m]=w.useState([]),[g,h]=w.useState([]),[p,f]=w.useState(0),[S,{data:b,error:N,isLoading:v,isSuccess:C,reset:E}]=x(),P={name:"file",multiple:!1,accept:".xlsx, .xls, .csv",beforeUpload:e=>(t(e),(e=>{const a=new FileReader;a.onload=e=>{try{const a=new Uint8Array(e.target.result),s=I(a,{type:"array"}),n=s.SheetNames[0],i=s.Sheets[n],t=D.sheet_to_json(i,{defval:""}).map(e=>({nis:e.NIS||e.nis,name:e["NAMA ORANG TUA"]||e.name,email:e.EMAIL?String(e.EMAIL).toLowerCase():e.email?String(e.email).toLowerCase():""})),l=new Set,r=[],d=[],c=[];t.forEach(e=>{e.nis&&e.name&&e.email?l.has(e.nis)?(e.issue="NIS duplikat di dalam file ini",c.push(e)):(l.add(e.nis),r.push(e)):(e.issue="Data tidak lengkap (NIS/Nama/Email wajib diisi)",d.push(e))}),o(r),m(d),h(c)}catch(a){l.error("Gagal memproses file. Pastikan format file sudah benar.")}},a.readAsArrayBuffer(e)})(e),!1),onRemove:()=>{t(null),o([]),m([]),h([])}},R=()=>{t(null),o([]),m([]),h([]),f(e=>e+1),a()};return w.useEffect(()=>{C&&(l.success(b?.message||"Data berhasil diunggah."),E(),R()),N&&(l.error(N?.data?.message||"Terjadi kesalahan saat mengunggah."),E())},[C,N,b,E]),s.jsx(u,{title:"Upload Data Orang Tua",open:e,onCancel:R,footer:[s.jsx(n,{onClick:R,children:"Tutup"},"back"),s.jsx(n,{type:"primary",loading:v,onClick:()=>{d.length>0?S({parents:d}):l.warning("Tidak ada data valid untuk diunggah.")},disabled:0===d.length||v,children:v?"Mengunggah...":`Upload ${d.length} Data Valid`},"submit")],width:800,destroyOnHidden:!0,children:s.jsxs(A,{direction:"vertical",style:{width:"100%"},children:[w.createElement(Y,{...P,key:p},s.jsx("p",{className:"ant-upload-drag-icon",children:s.jsx(O,{})}),s.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),s.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx, .xls, atau .csv. Pastikan kolom memiliki judul: NIS, NAMA ORANG TUA, EMAIL."}),s.jsx(n,{icon:s.jsx(L,{}),onClick:()=>{window.open("/template/template_orangtua.xlsx","_blank")},children:"Download Template"})),i&&s.jsxs("div",{style:{width:"100%",marginTop:16},children:[s.jsx(j,{orientation:"left",plain:!0,children:s.jsxs(r,{align:"center",gap:"small",children:[s.jsx(_,{style:{color:"green"}}),s.jsx(J,{children:"Data Siap Diupload"}),s.jsx(k,{color:"success",children:d.length})]})}),s.jsx(T,{columns:Q.filter(e=>"issue"!==e.key),dataSource:d,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}}),g.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(j,{orientation:"left",plain:!0,children:s.jsxs(r,{align:"center",gap:"small",children:[s.jsx(y,{style:{color:"orange"}}),s.jsx(J,{children:"Data Duplikat (Dilewati)"}),s.jsx(k,{color:"warning",children:g.length})]})}),s.jsx(T,{columns:Q,dataSource:g,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]}),c.length>0&&s.jsxs(s.Fragment,{children:[s.jsx(j,{orientation:"left",plain:!0,children:s.jsxs(r,{align:"center",gap:"small",children:[s.jsx(M,{style:{color:"red"}}),s.jsx(J,{children:"Data Tidak Lengkap (Dilewati)"}),s.jsx(k,{color:"error",children:c.length})]})}),s.jsx(T,{columns:Q,dataSource:c,size:"small",pagination:{pageSize:3,hideOnSinglePage:!0},scroll:{x:!0}})]})]})]})})},X=()=>{const[e,a]=w.useState(!1),[n,i]=w.useState(!1),[t,l]=w.useState(!1),[d,c]=w.useState("");return s.jsxs(r,{vertical:!0,gap:"middle",children:[s.jsxs(r,{align:"center",justify:"space-between",children:[s.jsx(o,{style:{margin:0},level:5,children:"Management Orang Tua"}),s.jsxs(A,{children:[s.jsx(C,{onClick:()=>i(!0)}),s.jsx(v,{onClick:()=>a(!0)})]})]}),s.jsx(V,{onEdit:e=>{c(e),l(!0),a(!0)}}),s.jsx($,{title:t?"Edit Data Orang Tua":"Simpan Data Orang tua",open:e,onClose:()=>{c(""),l(!1),a(!1)},parent:d}),s.jsx(W,{open:n,onClose:()=>i(!1)})]})},Z=()=>s.jsx("div",{children:s.jsx(P,{type:"info",message:"Pengembangan",description:"Mencatat data kelulusan setiap siswa dalam satuannya masing masing",showIcon:!0})}),ee=()=>{const e=[{key:"1",label:"Siswa",children:s.jsx(G,{})},{key:"2",label:"Orang Tua",children:s.jsx(X,{})},{key:"3",label:"Lulusan",children:s.jsx(Z,{})}];return s.jsx(f,{title:"Management Siswa",levels:["admin"],children:s.jsx(S,{centered:!0,defaultActiveKey:"1",items:e})})};export{ee as default};
