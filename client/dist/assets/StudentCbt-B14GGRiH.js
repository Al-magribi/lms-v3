import{r as c,d as k,a6 as f,a7 as y,j as e,e as u,a8 as v}from"./index-B88h2kYZ.js";import{L as S}from"./Layout-BzzV81EK.js";import{T as L}from"./Table-BvY52Fag.js";const C=({exam:t,setExam:l})=>{const[h,s]=c.useState(""),n=c.useRef(null),{user:m}=k(d=>d.auth),{data:r,isLoading:x}=f({exam:t.id,student:m.user_id},{skip:!t.id||!m.user_id}),[j,{isLoading:i}]=y(),g=()=>{if(h!==t.token){u.error("Token Salah"),s("");return}if(r&&r.ispenalty){u.error("Anda melanggar ketentuan"),s("");return}if(r&&r.isactive){u.error("Anda sedang mengikuti ujian"),s("");return}if(r&&r.isdone){u.error("Anda sudah mengikuti ujian"),s("");return}const d={exam:t.id,student:m.user_id,action:"start",start_time:new Date().toISOString()};u.promise(j(d).unwrap(),{loading:"Memuat...",success:o=>{l({}),s("");const a=document.getElementById("token");if(a){const p=a.querySelector('[data-bs-dismiss="modal"]');p&&p.click()}localStorage.removeItem("questions");const N=t.name.replace(/\s+/g,"-");return window.location.href=`/siswa-cbt/${N}/${t.id}/${t.token}`,o.message||"Berhasil memulai ujian"},error:o=>{var a;return((a=o.data)==null?void 0:a.message)||"Gagal memulai ujian"}})};c.useEffect(()=>{n.current&&(n.current.addEventListener("shown.bs.modal",()=>{n.current.removeAttribute("aria-hidden")}),n.current.addEventListener("hidden.bs.modal",()=>{n.current.setAttribute("aria-hidden","true")}))},[]);const b=()=>{l({}),s("")};return e.jsx("div",{ref:n,className:"modal fade",id:"token",tabIndex:"-1",role:"dialog","aria-labelledby":"token-label","aria-modal":"true",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",id:"token-label",children:["Token ",t.name]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:b})]}),e.jsx("div",{className:"modal-body",children:e.jsx("input",{type:"text",name:"token",id:"token",className:"form-control",placeholder:"Masukkan Token",value:h,onChange:d=>s(d.target.value),"aria-label":"Token input"})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-danger","data-bs-dismiss":"modal",onClick:b,children:"Tutup"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:g,disabled:x||i,children:"Konfirmasi"})]})]})})})},E=({classid:t})=>{const[l,h]=c.useState(1),[s,n]=c.useState(10),[m,r]=c.useState(""),{data:x={},isLoading:j}=v({classid:t,page:l,limit:s,search:m},{skip:!t}),{exams:i=[],totalData:g,totalPages:b}=x,[d,o]=c.useState({});return e.jsxs(L,{isLoading:j,page:l,setPage:h,limit:s,setLimit:n,totalPages:b,setSearch:r,totalData:g,children:[e.jsxs("table",{className:"mb-0 table table-hover table-striped table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Guru"}),e.jsx("th",{className:"text-center",children:"Nama Ujian"}),e.jsx("th",{className:"text-center",children:"Durasi"}),e.jsx("th",{className:"text-center",children:"Status"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(i==null?void 0:i.length)>0?i==null?void 0:i.map((a,N)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:N+1}),e.jsx("td",{className:"align-middle",children:a.teacher_name}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-primary",children:`${a.duration} Menit`})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0",children:a.isactive?e.jsx("span",{className:"badge bg-success",children:"Aktif"}):e.jsx("span",{className:"badge bg-danger",children:"nonaktif"})})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("button",{className:"btn btn-sm btn-primary","data-bs-toggle":"modal","data-bs-target":"#token",disabled:!a.isactive,onClick:()=>o(a),children:e.jsx("i",{className:"bi bi-eye"})})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:6,children:"Data Belum Tersedia"})})})]}),e.jsx(C,{exam:d,setExam:o})]})},_=()=>{const{user:t}=k(l=>l.auth);return e.jsx(S,{title:"Daftar Ujian",levels:["student"],children:e.jsx(E,{classid:t.class_id})})};export{_ as default};
