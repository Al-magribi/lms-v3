import{B as e,_ as a,l as t,bo as i,s,j as n,m as r,n as l,I as d,bp as c,bq as o,br as u,F as h,t as m,am as p,E as x,r as g,bs as j,bt as f,bu as b,bv as k,h as y,aL as w,R as v,C as S,a as C,A as _,a5 as N,$ as T,bw as P,bx as L,by as M,bz as I,bA as A,aB as F,aq as z,b as E,bB as B,aA as D,bC as O,bD as R,D as H,bE as K,bF as $,bG as V,bH as Y,bI as U,bJ as G,bK as q,bL as J,bM as W,bN as X,ay as Z,O as Q,bO as ee,bP as ae,aO as te}from"./index-DuGHnWSh.js";import{c as ie,i as se,u as ne}from"./vendor-DnNJsrFE.js";import{S as re}from"./Subjects-DWHjicx3.js";import{A as le}from"./Add-BBLE_Trg.js";import{U as de,R as ce,a as oe,r as ue,u as he,w as me}from"./xlsx-BQGk1Ojx.js";import{E as pe,S as xe}from"./Pagination-4eRtu2vp.js";import{c as ge,R as je,a as fe,f as be,b as ke,d as ye,e as we,P as ve,A as Se,D as Ce,F as _e}from"./Attitude-CBYH9Sc5.js";import{L as Ne}from"./index-C6IEzWZL.js";import{P as Te}from"./index-dStun_uf.js";import{R as Pe}from"./DeleteOutlined-CkmrN41Q.js";import{S as Le}from"./index-3xIavl8F.js";import{C as Me}from"./Collapse-BvAcQKVj.js";import{E as Ie}from"./Editor-Dd96ADcI.js";import{R as Ae}from"./ReadOutlined-1uX17Lct.js";import{R as Fe}from"./FileTextOutlined-BUUzkEJh.js";import{d as ze}from"./dayjs.min-NR93IlBy.js";import"./id-BaT3o_TC.js";import{R as Ee}from"./CalendarOutlined-pPYb-LCm.js";import{D as Be}from"./index-Cfwc7o4N.js";import{R as De}from"./CheckCircleOutlined-BuuC8yEF.js";import{R as Oe}from"./CloseCircleOutlined-C_avgFI7.js";import{F as Re,a as He}from"./Table-BHFuAB9g.js";import{R as Ke}from"./FileExcelOutlined-Bcm0pmKf.js";import{A as $e}from"./index-DjelRtRM.js";import{T as Ve}from"./index-BU4HBZE0.js";import{R as Ye}from"./BookOutlined-CgVSmwOJ.js";import{R as Ue}from"./ScheduleOutlined-Cv-syxGi.js";import{R as Ge}from"./DownloadOutlined-CVckzmNW.js";import{R as qe}from"./SaveOutlined-BoQBxI5C.js";import"./progress-DhH2LDwF.js";import"./moment-CBOc1lqT.js";import"./ClockCircleOutlined-B406rajF.js";var Je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M251.2 387H320v68.8c0 1.8 1.8 3.2 4 3.2h48c2.2 0 4-1.4 4-3.3V387h68.8c1.8 0 3.2-1.8 3.2-4v-48c0-2.2-1.4-4-3.3-4H376v-68.8c0-1.8-1.8-3.2-4-3.2h-48c-2.2 0-4 1.4-4 3.2V331h-68.8c-1.8 0-3.2 1.8-3.2 4v48c0 2.2 1.4 4 3.2 4zm328 0h193.6c1.8 0 3.2-1.8 3.2-4v-48c0-2.2-1.4-4-3.3-4H579.2c-1.8 0-3.2 1.8-3.2 4v48c0 2.2 1.4 4 3.2 4zm0 265h193.6c1.8 0 3.2-1.8 3.2-4v-48c0-2.2-1.4-4-3.3-4H579.2c-1.8 0-3.2 1.8-3.2 4v48c0 2.2 1.4 4 3.2 4zm0 104h193.6c1.8 0 3.2-1.8 3.2-4v-48c0-2.2-1.4-4-3.3-4H579.2c-1.8 0-3.2 1.8-3.2 4v48c0 2.2 1.4 4 3.2 4zm-195.7-81l61.2-74.9c4.3-5.2.7-13.1-5.9-13.1H388c-2.3 0-4.5 1-5.9 2.9l-34 41.6-34-41.6a7.85 7.85 0 00-5.9-2.9h-50.9c-6.6 0-10.2 7.9-5.9 13.1l61.2 74.9-62.7 76.8c-4.4 5.2-.8 13.1 5.8 13.1h50.8c2.3 0 4.5-1 5.9-2.9l35.5-43.5 35.5 43.5c1.5 1.8 3.7 2.9 5.9 2.9h50.8c6.6 0 10.2-7.9 5.9-13.1L383.5 675zM880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-36 732H180V180h664v664z"}}]},name:"calculator",theme:"outlined"},We=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:Je}))},Xe=ie.forwardRef(We),Ze={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M923 283.6a260.04 260.04 0 00-56.9-82.8 264.4 264.4 0 00-84-55.5A265.34 265.34 0 00679.7 125c-49.3 0-97.4 13.5-139.2 39-10 6.1-19.5 12.8-28.5 20.1-9-7.3-18.5-14-28.5-20.1-41.8-25.5-89.9-39-139.2-39-35.5 0-69.9 6.8-102.4 20.3-31.4 13-59.7 31.7-84 55.5a258.44 258.44 0 00-56.9 82.8c-13.9 32.3-21 66.6-21 101.9 0 33.3 6.8 68 20.3 103.3 11.3 29.5 27.5 60.1 48.2 91 32.8 48.9 77.9 99.9 133.9 151.6 92.8 85.7 184.7 144.9 188.6 147.3l23.7 15.2c10.5 6.7 24 6.7 34.5 0l23.7-15.2c3.9-2.5 95.7-61.6 188.6-147.3 56-51.7 101.1-102.7 133.9-151.6 20.7-30.9 37-61.5 48.2-91 13.5-35.3 20.3-70 20.3-103.3.1-35.3-7-69.6-20.9-101.9zM512 814.8S156 586.7 156 385.5C156 283.6 240.3 201 344.3 201c73.1 0 136.5 40.8 167.7 100.4C543.2 241.8 606.6 201 679.7 201c104 0 188.3 82.6 188.3 184.5 0 201.2-356 429.3-356 429.3z"}}]},name:"heart",theme:"outlined"},Qe=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:Ze}))},ea=ie.forwardRef(Qe),aa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M536.1 273H488c-4.4 0-8 3.6-8 8v275.3c0 2.6 1.2 5 3.3 6.5l165.3 120.7c3.6 2.6 8.6 1.9 11.2-1.7l28.6-39c2.7-3.7 1.9-8.7-1.7-11.2L544.1 528.5V281c0-4.4-3.6-8-8-8zm219.8 75.2l156.8 38.3c5 1.2 9.9-2.6 9.9-7.7l.8-161.5c0-6.7-7.7-10.5-12.9-6.3L752.9 334.1a8 8 0 003 14.1zm167.7 301.1l-56.7-19.5a8 8 0 00-10.1 4.8c-1.9 5.1-3.9 10.1-6 15.1-17.8 42.1-43.3 80-75.9 112.5a353 353 0 01-112.5 75.9 352.18 352.18 0 01-137.7 27.8c-47.8 0-94.1-9.3-137.7-27.8a353 353 0 01-112.5-75.9c-32.5-32.5-58-70.4-75.9-112.5A353.44 353.44 0 01171 512c0-47.8 9.3-94.2 27.8-137.8 17.8-42.1 43.3-80 75.9-112.5a353 353 0 01112.5-75.9C430.6 167.3 477 158 524.8 158s94.1 9.3 137.7 27.8A353 353 0 01775 261.7c10.2 10.3 19.8 21 28.6 32.3l59.8-46.8C784.7 146.6 662.2 81.9 524.6 82 285 82.1 92.6 276.7 95 516.4 97.4 751.9 288.9 942 524.8 942c185.5 0 343.5-117.6 403.7-282.3 1.5-4.2-.7-8.9-4.9-10.4z"}}]},name:"history",theme:"outlined"},ta=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:aa}))},ia=ie.forwardRef(ta),sa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M168 504.2c1-43.7 10-86.1 26.9-126 17.3-41 42.1-77.7 73.7-109.4S337 212.3 378 195c42.4-17.9 87.4-27 133.9-27s91.5 9.1 133.8 27A341.5 341.5 0 01755 268.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.7 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c0-6.7-7.7-10.5-12.9-6.3l-56.4 44.1C765.8 155.1 646.2 92 511.8 92 282.7 92 96.3 275.6 92 503.8a8 8 0 008 8.2h60c4.4 0 7.9-3.5 8-7.8zm756 7.8h-60c-4.4 0-7.9 3.5-8 7.8-1 43.7-10 86.1-26.9 126-17.3 41-42.1 77.8-73.7 109.4A342.45 342.45 0 01512.1 856a342.24 342.24 0 01-243.2-100.8c-9.9-9.9-19.2-20.4-27.8-31.4l60.2-47a8 8 0 00-3-14.1l-175.7-43c-5-1.2-9.9 2.6-9.9 7.7l-.7 181c0 6.7 7.7 10.5 12.9 6.3l56.4-44.1C258.2 868.9 377.8 932 512.2 932c229.2 0 415.5-183.7 419.8-411.8a8 8 0 00-8-8.2z"}}]},name:"sync",theme:"outlined"},na=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:sa}))},ra=ie.forwardRef(na),la={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},da=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:la}))},ca=ie.forwardRef(da),oa={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M368 724H252V608c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v116H72c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h116v116c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V788h116c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M912 302.3L784 376V224c0-35.3-28.7-64-64-64H128c-35.3 0-64 28.7-64 64v352h72V232h576v560H448v72h272c35.3 0 64-28.7 64-64V648l128 73.7c21.3 12.3 48-3.1 48-27.6V330c0-24.6-26.7-40-48-27.7zM888 625l-104-59.8V458.9L888 399v226z"}},{tag:"path",attrs:{d:"M320 360c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H208c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h112z"}}]},name:"video-camera-add",theme:"outlined"},ua=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:oa}))},ha=ie.forwardRef(ua),ma={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M960 509.2c0-2.2 0-4.7-.1-7.6-.1-8.1-.3-17.2-.5-26.9-.8-27.9-2.2-55.7-4.4-81.9-3-36.1-7.4-66.2-13.4-88.8a139.52 139.52 0 00-98.3-98.5c-28.3-7.6-83.7-12.3-161.7-15.2-37.1-1.4-76.8-2.3-116.5-2.8-13.9-.2-26.8-.3-38.4-.4h-29.4c-11.6.1-24.5.2-38.4.4-39.7.5-79.4 1.4-116.5 2.8-78 3-133.5 7.7-161.7 15.2A139.35 139.35 0 0082.4 304C76.3 326.6 72 356.7 69 392.8c-2.2 26.2-3.6 54-4.4 81.9-.3 9.7-.4 18.8-.5 26.9 0 2.9-.1 5.4-.1 7.6v5.6c0 2.2 0 4.7.1 7.6.1 8.1.3 17.2.5 26.9.8 27.9 2.2 55.7 4.4 81.9 3 36.1 7.4 66.2 13.4 88.8 12.8 47.9 50.4 85.7 98.3 98.5 28.2 7.6 83.7 12.3 161.7 15.2 37.1 1.4 76.8 2.3 116.5 2.8 13.9.2 26.8.3 38.4.4h29.4c11.6-.1 24.5-.2 38.4-.4 39.7-.5 79.4-1.4 116.5-2.8 78-3 133.5-7.7 161.7-15.2 47.9-12.8 85.5-50.5 98.3-98.5 6.1-22.6 10.4-52.7 13.4-88.8 2.2-26.2 3.6-54 4.4-81.9.3-9.7.4-18.8.5-26.9 0-2.9.1-5.4.1-7.6v-5.6zm-72 5.2c0 2.1 0 4.4-.1 7.1-.1 7.8-.3 16.4-.5 25.7-.7 26.6-2.1 53.2-4.2 77.9-2.7 32.2-6.5 58.6-11.2 76.3-6.2 23.1-24.4 41.4-47.4 47.5-21 5.6-73.9 10.1-145.8 12.8-36.4 1.4-75.6 2.3-114.7 2.8-13.7.2-26.4.3-37.8.3h-28.6l-37.8-.3c-39.1-.5-78.2-1.4-114.7-2.8-71.9-2.8-124.9-7.2-145.8-12.8-23-6.2-41.2-24.4-47.4-47.5-4.7-17.7-8.5-44.1-11.2-76.3-2.1-24.7-3.4-51.3-4.2-77.9-.3-9.3-.4-18-.5-25.7 0-2.7-.1-5.1-.1-7.1v-4.8c0-2.1 0-4.4.1-7.1.1-7.8.3-16.4.5-25.7.7-26.6 2.1-53.2 4.2-77.9 2.7-32.2 6.5-58.6 11.2-76.3 6.2-23.1 24.4-41.4 47.4-47.5 21-5.6 73.9-10.1 145.8-12.8 36.4-1.4 75.6-2.3 114.7-2.8 13.7-.2 26.4-.3 37.8-.3h28.6l37.8.3c39.1.5 78.2 1.4 114.7 2.8 71.9 2.8 124.9 7.2 145.8 12.8 23 6.2 41.2 24.4 47.4 47.5 4.7 17.7 8.5 44.1 11.2 76.3 2.1 24.7 3.4 51.3 4.2 77.9.3 9.3.4 18 .5 25.7 0 2.7.1 5.1.1 7.1v4.8zM423 646l232-135-232-133z"}}]},name:"youtube",theme:"outlined"},pa=function(t,i){return ie.createElement(e,a({},t,{ref:i,icon:ma}))},xa=ie.forwardRef(pa);const{TextArea:ga}=d,ja=({title:e,open:a,onClose:c,chapterid:o,content:u})=>{const[h]=t.useForm(),[m,{isLoading:p,isSuccess:x,error:g,data:j,reset:f}]=i();return ie.useEffect(()=>{x&&(s.success(j.message),h.resetFields(),c(),f()),g&&(s.error(g.data.message),f())},[j,x,g]),ie.useEffect(()=>{a&&(h.resetFields(),u&&h.setFieldsValue({title:u.content_title,content:u.content_target}))},[u]),n.jsx(r,{title:e,open:a,onCancel:c,okText:"Simpan",cancelText:"Tutup",onOk:()=>h.submit(),children:n.jsx(l,{tip:"Memproses Data",spinning:p,children:n.jsxs(t,{layout:"vertical",form:h,onFinish:e=>{if(u){const a={chapterid:o,contentid:u.content_id,...e};m(a)}else{const a={chapterid:o,...e};m(a)}},children:[n.jsx(t.Item,{name:"title",label:"Judul Materi",rules:[{required:!0,message:"Judul Materi Wajib diisi!"}],children:n.jsx(d,{placeholder:"Judul Materi"})}),n.jsx(t.Item,{name:"content",label:"Capaian Pembelajaran",rules:[{required:!0,message:"Capaian Wajib diisi!"}],children:n.jsx(ga,{rows:4,placeholder:"Capaian Pembelajaran"})})]})})})},{Dragger:fa}=de,ba=({title:e,open:a,onClose:i,contentid:o})=>{const[u]=t.useForm(),[h,{isLoading:m,isSuccess:p,error:x,data:g,reset:j}]=c();ie.useEffect(()=>{a&&u.resetFields(),p&&(s.success(g?.message||"File berhasil diunggah!"),j(),i(),u.resetFields()),x&&(s.error(x.data?.message||"Terjadi kesalahan saat mengunggah."),j())},[g,p,x,i,j,a]);return n.jsx(r,{title:e,open:a,onCancel:i,okText:"Simpan",cancelText:"Tutup",onOk:()=>u.submit(),confirmLoading:m,destroyOnHidden:!0,maskClosable:!1,children:n.jsx(l,{tip:"Mengunggah File...",spinning:m,children:n.jsxs(t,{form:u,layout:"vertical",onFinish:e=>{const a=new FormData;a.append("contentId",o),a.append("title",e.title),e.files.forEach(e=>{a.append("files",e.originFileObj)}),h(a)},children:[n.jsx(t.Item,{name:"title",label:"Nama File",rules:[{required:!0,message:"Nama file tidak boleh kosong!"}],children:n.jsx(d,{placeholder:"Nama File"})}),n.jsx(t.Item,{label:"Pilih File",name:"files",valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e?.fileList,rules:[{required:!0,message:"Silakan pilih minimal satu file!"}],children:n.jsxs(fa,{name:"files",multiple:!0,accept:".pdf,.doc,.docx,.ppt,.pptx,.xls,.xlsx,.txt,.zip,.rar",beforeUpload:()=>!1,children:[n.jsx("p",{className:"ant-upload-drag-icon",children:n.jsx(ce,{})}),n.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),n.jsx("p",{className:"ant-upload-hint",children:"Mendukung unggahan tunggal atau massal. Format yang diizinkan: PDF, DOC, PPT, XLS, TXT, ZIP, RAR."})]})})]})})})},ka=({title:e,open:a,onClose:i,contentid:l})=>{const[o]=t.useForm(),[u,{data:h,error:m,isLoading:p,isSuccess:x,reset:g}]=c();return ie.useEffect(()=>{a&&o.resetFields(),x&&(s.success(h.message),o.resetFields(),i(),g()),m&&(s.error(m.data.message),g())},[a,h,x,m]),n.jsx(r,{title:e,open:a,onCancel:i,okText:"Simpan",cancelText:"Tutup",onOk:()=>o.submit(),destroyOnHidden:!0,loading:p,children:n.jsxs(t,{layout:"vertical",form:o,onFinish:e=>{if(!/^(https?:\/\/)?(www\.)?(youtube\.com|youtu\.be)\/.+/.test(e.video))return void s.error("URL tidak valid. Pastikan URL dari YouTube");const a=new FormData;a.append("contentId",l),a.append("title",e.title),a.append("video",e.video),u(a)},children:[n.jsx(t.Item,{name:"title",label:"Judul Video",rules:[{required:!0,message:"Judul Wajib diisi"}],children:n.jsx(d,{placeholder:"Judul Video"})}),n.jsx(t.Item,{name:"video",label:"YouTube URL",rules:[{required:!0,message:"YouTube URL harus diisi"}],children:n.jsx(d,{placeholder:"YouTube URL"})})]})})},ya=({open:e,onClose:a,video:t})=>{if(!t||!t.video)return null;const i=(e=>{let a="";const t=e.match(/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return t&&(a=t[1]),a})(t.video),s=`https://www.youtube.com/embed/${i}?autoplay=1`;return n.jsx(r,{title:t.title?`Playing Video: ${t.title}`:"Play Video",open:e,onCancel:a,destroyOnHidden:!0,width:800,footer:null,children:i?n.jsx("div",{className:"video-responsive",style:{position:"relative",paddingBottom:"56.25%",height:0,overflow:"hidden",borderRadius:"15px"},children:n.jsx("iframe",{width:"100%",height:"100%",src:s,title:t.title||"YouTube video player",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})}):n.jsx("p",{children:"Invalid YouTube URL provided."})})},{Panel:wa}=Me,{Text:va,Paragraph:Sa,Title:Ca}=m,_a=({contents:e,chapterId:a})=>{const[t,{isSuccess:i,isLoading:r,data:l,error:d,reset:c}]=o(),[m]=u(),[j,f]=ie.useState(!1),[b,k]=ie.useState(""),[y,w]=ie.useState(""),[v,S]=ie.useState(!1),[C,_]=ie.useState(!1),[N,T]=ie.useState(!1),[P,L]=ie.useState(""),M=e=>{t(e)};if(ie.useEffect(()=>{i&&(s.success(l.message),c()),d&&(s.error(d.data.message),c())},[l,i,d]),!e||0===e.length)return n.jsx(pe,{image:pe.PRESENTED_IMAGE_SIMPLE,description:"Belum ada materi untuk bab ini."});const I=e.map((e,a)=>({key:e.content_id,label:n.jsx(Ca,{level:5,style:{margin:0},children:e.content_title}),extra:n.jsxs(Le,{onClick:e=>e.stopPropagation(),children:[n.jsx(p,{title:"Edit Materi",children:n.jsx(x,{shape:"circle",icon:n.jsx(g,{}),onClick:()=>(e=>{k(e),f(!0)})(e)})}),n.jsx(Te,{title:"Hapus materi ini?",description:"Semua file dan video di dalamnya akan ikut terhapus.",onConfirm:()=>{return a=e.content_id,void m(a);var a},okText:"Ya, Hapus",cancelText:"Batal",children:n.jsx(p,{title:"Hapus Materi",children:n.jsx(x,{danger:!0,shape:"circle",icon:n.jsx(Pe,{})})})})]}),children:n.jsxs(h,{vertical:!0,gap:"large",children:[n.jsxs("div",{children:[n.jsx(va,{strong:!0,children:"Tujuan Pembelajaran:"}),n.jsx(Sa,{children:n.jsx(va,{type:"secondary",style:{whiteSpace:"pre-wrap"},children:e.content_target||"-"})})]}),n.jsxs("div",{children:[n.jsxs(h,{justify:"space-between",align:"center",wrap:"wrap",gap:8,children:[n.jsx(va,{strong:!0,children:"File Materi:"}),n.jsx(p,{title:"Tambah File Baru",children:n.jsx(x,{icon:n.jsx(ge,{}),onClick:()=>{return a=e.content_id,w(a),void S(!0);var a},children:"Tambah File"})})]}),n.jsx(Ne,{itemLayout:"horizontal",dataSource:e.files,renderItem:e=>n.jsx(Ne.Item,{actions:[n.jsx(Te,{title:"Hapus file ini?",onConfirm:()=>M(e.id),okText:"Ya",cancelText:"Tidak",children:n.jsx(p,{title:"Hapus File",children:n.jsx(x,{type:"text",danger:!0,shape:"circle",icon:n.jsx(Pe,{})})})},`delete-${e.id}`)],children:n.jsx(Ne.Item.Meta,{avatar:n.jsx(oe,{}),title:n.jsx("a",{href:e.file,target:"_blank",rel:"noopener noreferrer",children:e.title})})})})]}),n.jsxs("div",{children:[n.jsxs(h,{justify:"space-between",align:"center",wrap:"wrap",gap:8,children:[n.jsx(va,{strong:!0,children:"Video Materi:"}),n.jsx(p,{title:"Tambah Video Baru",children:n.jsx(x,{icon:n.jsx(ha,{}),onClick:()=>{return a=e.content_id,w(a),void _(!0);var a},children:"Tambah Video"})})]}),n.jsx(Ne,{dataSource:e.videos,renderItem:e=>n.jsx(Ne.Item,{actions:[n.jsx(x,{shape:"circle",icon:n.jsx(ha,{}),onClick:()=>(e=>{L(e),T(!0)})(e)},`Play-${e.id}`),n.jsx(Te,{title:"Hapus file ini?",onConfirm:()=>M(e.id),okText:"Ya",cancelText:"Tidak",children:n.jsx(p,{title:"Hapus File",children:n.jsx(x,{type:"text",danger:!0,shape:"circle",icon:n.jsx(Pe,{})})})},`delete-${e.id}`)],children:n.jsx(Ne.Item.Meta,{avatar:n.jsx(xa,{style:{color:"#CD201F"}}),title:n.jsx(va,{children:e.title})})})})]})]})}));return n.jsxs(n.Fragment,{children:[n.jsx(Me,{accordion:!0,items:I}),n.jsx(ja,{title:`Edit Materi ${b.content_title}`,open:j,content:b,onClose:()=>{k(""),f(!1)}}),n.jsx(ba,{title:"Simpan File Baru",open:v,onClose:()=>{w(""),S(!1)},contentid:y}),n.jsx(ka,{title:"Simpan YouTube Video",open:C,onClose:()=>{w(""),_(!1)},contentid:y}),n.jsx(ya,{open:N,onClose:()=>{L(""),T(!1)},video:P})]})},Na=({title:e,open:a,onClose:i,chapter:c})=>{const[o]=t.useForm(),[u]=se(),[h,m]=ie.useState(""),{data:p}=j(),[x,{isLoading:g,isSuccess:b,data:k,error:y}]=f(),w=u.get("subjectid"),v=p?.map(e=>({value:e.id,label:e.name}));return ie.useEffect(()=>{b&&(s.success(k.message),o.resetFields(),m(""),i()),y&&s.error(y.data.message)},[k,b,y]),ie.useEffect(()=>{a&&(o.resetFields(),m(""),c&&(m(c.chapter_id),o.setFieldsValue({title:c.chapter_name,target:c.target,classes:c.class?.map(e=>e.id)})))},[c,a]),n.jsx(r,{title:e,open:a,onCancel:i,okText:"Simpan",cancelText:"Tutup",destroyOnHidden:!0,onOk:()=>o.submit(),children:n.jsx(l,{tip:"Memproses data",spinning:g,children:n.jsxs(t,{form:o,layout:"vertical",onFinish:e=>{if(h){const a={subjectid:w,chapterid:h,...e};x(a)}else{const a={subjectid:w,...e};x(a)}},children:[n.jsx(t.Item,{name:"title",label:"Nama Bab",rules:[{required:!0,message:"Nama bab wajib diisi"}],children:n.jsx(d,{placeholder:"Nama Bab"})}),n.jsx(t.Item,{name:"target",label:"Capaian Pembelajaran",children:n.jsx(Ie,{placeholder:"Tuliskan Capaian Pembelajaran",height:250})}),n.jsx(t.Item,{name:"classes",label:"Pilih Kelas",rules:[{required:!0,message:"Kelas wajib dipilih"}],children:n.jsx(xe,{mode:"multiple",placeholder:"Pilih Kelas",options:v,allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})})]})})})},{confirm:Ta}=r,Pa=({name:e,id:a,onBack:t})=>{const[i,r]=ie.useState(!1),[l,d]=ie.useState(!1),[c,o]=ie.useState(!1),[u,j]=ie.useState(""),{data:f,isLoading:T}=b(a,{skip:!a}),[P,{isLoading:L,isSuccess:M,error:I,data:A}]=k();return ie.useEffect(()=>{M&&s.success(A.message),I&&s.error(I.data.message)},[A,M,I]),n.jsxs(y,{title:e.replace(/-/g," "),levels:["teacher"],children:[n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsxs(h,{align:"center",justify:"space-between",children:[n.jsxs(Le,{children:[n.jsx(x,{shape:"circle",icon:n.jsx(w,{}),onClick:t}),n.jsxs("div",{children:[n.jsx(m.Title,{style:{margin:0},level:5,children:`Pelajaran: ${e.replace(/-/g," ")}`}),n.jsx(m.Text,{type:"secondary",children:"Daftar Bab"})]})]}),n.jsx(le,{onClick:()=>d(!0)})]}),n.jsx(v,{gutter:[16,16],children:f?.length>0?f?.map((e,a)=>{return n.jsx(S,{sm:24,children:n.jsx(C,{hoverable:!0,loading:T||L,title:n.jsx(N,{color:"green",children:e.chapter_name}),actions:[n.jsx(p,{title:"Edit Bab",children:n.jsx(g,{onClick:()=>(e=>{j(e),o(!0),d(!0)})(e)},"edit")}),n.jsx(p,{title:"Hapus Bab",children:n.jsx(Pe,{onClick:()=>{return a=e.chapter_id,void Ta({title:"Apakah anda yakin akan menghapus bab ini?",content:"Semua file akan ikut terhapus permanen",okText:"Ya, Hapus",cancelText:"Batal",okType:"danger",onOk(){P(a)}});var a}},"add_content")})],extra:n.jsx(x,{icon:n.jsx(ge,{}),onClick:()=>(j(e),void r(!0)),children:"Tambah Materi"}),children:n.jsxs(h,{vertical:!0,gap:"small",children:[n.jsx(_,{defaultActiveKey:"1",items:[{label:"Capaian",key:"1",children:n.jsx("article",{dangerouslySetInnerHTML:(t=e.target,{__html:t})})},{label:"Materi",key:"2",children:n.jsx(_a,{contents:e.contents,chapterId:e.chapter_id})}]}),n.jsxs(m.Text,{children:[n.jsx("strong",{children:"Pengajar:"})," ",e.teacher_name]}),n.jsxs(Le,{size:[0,8],wrap:!0,children:[n.jsx("strong",{style:{marginRight:5},children:"Kelas: "}),e.class?.map(e=>n.jsx(N,{color:"blue",children:e.name},e.id))]}),n.jsxs(Le,{size:"middle",wrap:!0,style:{marginTop:16},children:[n.jsxs(m.Text,{type:"secondary",children:[n.jsx(Ae,{})," ",e.content," Konten"]}),n.jsxs(m.Text,{type:"secondary",children:[n.jsx(Fe,{})," ",e.file," File"]}),n.jsxs(m.Text,{type:"secondary",children:[n.jsx(xa,{})," ",e.video," Video"]})]})]})})},e.chapter_id);var t}):n.jsx(S,{span:24,style:{textAlign:"center",marginTop:"2rem"},children:n.jsx(pe,{description:n.jsx(m.Text,{type:"secondary",children:`Bab untuk pelajaran ${e.replace(/-/g," ")} belum tersedia`})})})})]}),n.jsx(Na,{title:c?"Perbaiki Bab":"Tambah Bab baru",open:l,onClose:()=>{j(""),o(!1),d(!1)},chapter:u}),n.jsx(ja,{title:`Tambah Materi ${u.chapter_name}`,open:i,onClose:()=>{j(""),r(!1)},chapterid:u.chapter_id})]})};ze.locale("id");const{Text:La}=m,Ma={Hadir:"#52c41a",Telat:"#faad14",Sakit:"#1677ff",Izin:"#722ed1",Alpa:"#f5222d"},Ia=({classid:e,subjectid:a})=>{const[t,i]=ie.useState({current:1,pageSize:10}),[l,d]=ie.useState(""),[c,o]=ie.useState(ze()),[u,h]=ie.useState([]),m=c.format("YYYY-MM-DD"),{data:p,isLoading:g,isFetching:j}=T({page:t.current,limit:t.pageSize,search:l,classid:e},{skip:!e}),{data:f}=P({classid:e,subjectid:a,date:m},{skip:!e||!a}),[b]=L(),[k]=M(),[y]=I(),[w]=A(),{students:_,totalData:N}=p||{},B=u.length>0;ie.useEffect(()=>{h([])},[c,e,a]);const D=async(e,a,t,i)=>{const n="apiCall";s.loading({content:a,key:n});try{const a=await e.unwrap();return s.success({content:a.message||t,key:n}),!0}catch(r){return s.error({content:r.data?.message||i,key:n}),!1}},O=t=>{if(!B)return void s.warning("Pilih siswa terlebih dahulu.");D(k({classid:e,subjectid:a,studentids:u,note:t,date:m}),`Memproses ${t} untuk ${u.length} siswa...`,"Presensi massal berhasil","Gagal memproses presensi massal").then(e=>{e&&h([])})},R=[{title:"No",key:"no",width:"5%",render:(e,a,i)=>(t.current-1)*t.pageSize+i+1},{title:"Siswa",dataIndex:"student_name",key:"student",render:(e,a)=>n.jsxs(Le,{children:[n.jsx(z,{icon:n.jsx(E,{})}),n.jsxs("div",{children:[n.jsx(La,{strong:!0,children:e}),n.jsx("br",{}),n.jsxs(La,{type:"secondary",children:["NIS: ",a.nis," | ",a.class_name]})]})]})},{title:"Status Presensi",key:"attendance",width:"40%",render:(t,i)=>{const s=f?.find(e=>e.studentid===i.student),r=s?.note,l=e=>r===e?{backgroundColor:Ma[e],borderColor:Ma[e],color:"#fff"}:{};return n.jsxs(He.Group,{value:r,onChange:t=>{return s=i.student,n=t.target.value,void D(b({classid:e,subjectid:a,studentid:s,note:n,date:m}),"Menyimpan presensi...","Presensi berhasil disimpan","Gagal menyimpan presensi");var s,n},buttonStyle:"solid",size:"small",block:!0,children:[n.jsx(He.Button,{value:"Hadir",style:l("Hadir"),children:"Hadir"}),n.jsx(He.Button,{value:"Telat",style:l("Telat"),children:"Telat"}),n.jsx(He.Button,{value:"Sakit",style:l("Sakit"),children:"Sakit"}),n.jsx(He.Button,{value:"Izin",style:l("Izin"),children:"Izin"}),n.jsx(He.Button,{value:"Alpa",style:l("Alpa"),children:"Alpa"})]})}},{title:"Aksi",key:"action",align:"center",render:(t,i)=>n.jsx(Te,{title:"Hapus Presensi?",description:"Anda yakin ingin menghapus presensi siswa ini?",onConfirm:()=>{return t=i.student,void D(y({classid:e,subjectid:a,studentid:t,date:m}),"Menghapus presensi...","Presensi berhasil dihapus","Gagal menghapus presensi");var t},okText:"Ya",cancelText:"Tidak",children:n.jsx(x,{icon:n.jsx(Pe,{}),type:"text",danger:!0})})}],H={selectedRowKeys:u,onChange:e=>h(e)};return e&&a?n.jsxs(C,{variant:"bordered",children:[n.jsxs(v,{gutter:[16,16],justify:"space-between",align:"middle",children:[n.jsx(S,{xs:24,md:8,children:n.jsxs(Le,{direction:"vertical",children:[n.jsxs(La,{strong:!0,children:[n.jsx(Ee,{style:{marginRight:8}}),"Tanggal Presensi"]}),n.jsx(Be,{value:c,onChange:e=>o(e||ze()),format:"dddd, D MMMM YYYY",disabledDate:e=>e&&e>ze().endOf("day"),style:{width:"100%"}})]})}),n.jsx(S,{xs:24,md:16,children:n.jsxs(Le,{wrap:!0,style:{float:"right"},children:[n.jsxs(x,{onClick:()=>O("Hadir"),disabled:!B,icon:n.jsx(De,{}),type:"primary",children:["Hadir (",u.length,")"]}),n.jsxs(x,{onClick:()=>O("Sakit"),disabled:!B,icon:n.jsx(ea,{}),children:["Sakit (",u.length,")"]}),n.jsxs(x,{onClick:()=>O("Izin"),disabled:!B,icon:n.jsx(F,{}),children:["Izin (",u.length,")"]}),n.jsxs(x,{onClick:()=>O("Alpa"),disabled:!B,icon:n.jsx(Oe,{}),danger:!0,children:["Alpa (",u.length,")"]}),n.jsxs(x,{onClick:()=>{B?r.confirm({title:`Hapus Presensi ${u.length} Siswa?`,content:"Apakah Anda yakin ingin menghapus data presensi untuk semua siswa yang dipilih pada tanggal ini?",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>{D(w({classid:e,subjectid:a,studentids:u,date:m}),"Menghapus presensi massal...","Presensi massal berhasil dihapus","Gagal menghapus presensi massal").then(e=>{e&&h([])})}}):s.warning("Pilih siswa terlebih dahulu.")},disabled:!B,icon:n.jsx(Pe,{}),danger:!0,type:"primary",children:["Hapus (",u.length,")"]})]})})]}),n.jsx(Re,{style:{marginTop:24},rowSelection:H,columns:R,dataSource:_,rowKey:"student",loading:g||j,pagination:{...t,total:N,showSizeChanger:!0},onChange:e=>{i(e)},scroll:{x:!0}})]}):n.jsx(C,{children:n.jsx(pe,{image:pe.PRESENTED_IMAGE_SIMPLE,description:"Silakan pilih kelas dan mata pelajaran terlebih dahulu."})})};ze.locale("id");const{Text:Aa,Title:Fa}=m,za=({classid:e,subjectid:a})=>{const[t,i]=ie.useState(ze()),{data:s,isLoading:r,isError:d,error:c}=B({classid:e,subjectid:a,month:t?.format("YYYY-MM")},{skip:!e||!a||!t}),o=e=>{switch(e?.toLowerCase()){case"hadir":return"success";case"sakit":return"processing";case"izin":return"warning";case"alpa":return"error";default:return"default"}},u=(()=>{const e=[{title:"No",key:"index",width:60,fixed:"left",align:"center",render:(e,a,t)=>t+1},{title:"NIS",dataIndex:"nis",key:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",width:250,fixed:"left",render:e=>n.jsx(Aa,{strong:!0,children:e})}];if(!s?.dates||0===s.dates.length)return e;const a=s.dates.map(e=>{return{title:(a=e,a?ze(a).format("D-MMM-YY"):"-"),dataIndex:e,key:e,align:"center",width:110,render:e=>n.jsx(N,{color:o(e),style:{minWidth:"70px",textAlign:"center"},children:e||"-"})};var a}),t={title:"Presentase %",dataIndex:"presentase",key:"presentase",width:120,fixed:"right",align:"center",render:e=>n.jsx(Aa,{strong:!0,children:null!=e?`${e}%`:"-"})};return[...e,...a,t]})();return d?n.jsx(pe,{description:c?.data?.message||"Gagal memuat data."}):n.jsx(l,{spinning:r,tip:"Memuat data riwayat...",children:n.jsxs(C,{title:n.jsxs(Le,{children:[n.jsx(ia,{}),n.jsx(Fa,{level:5,style:{margin:0},children:"Riwayat Presensi"})]}),children:[n.jsx(v,{style:{marginBottom:24},children:n.jsx(S,{children:n.jsxs(Le,{direction:"vertical",children:[n.jsxs(Aa,{strong:!0,children:[n.jsx(Ee,{})," Filter Berdasarkan Bulan"]}),n.jsx(Be,{picker:"month",value:t,onChange:e=>i(e),style:{width:250},allowClear:!1})]})})}),n.jsx(Re,{columns:u,dataSource:s?.students,rowKey:"studentid",bordered:!0,pagination:{pageSize:10,showSizeChanger:!0},scroll:{x:"max-content"},locale:{emptyText:n.jsx(pe,{image:n.jsx(Ke,{style:{fontSize:48,color:"#bfbfbf"}}),description:!r&&s?.students?.length>0?`Tidak ada data presensi pada bulan ${t.format("MMMM YYYY")}`:"Belum ada siswa di kelas ini untuk periode aktif."})}})]})})},Ea=()=>{const{user:e}=D(e=>e.auth),{data:a,isLoading:t}=j(),[i,s]=ie.useState(""),[r,l]=ie.useState(""),d=e?.subjects?.map(e=>({label:e.name,value:e.id})),c=a?.map(e=>({label:e.name,value:e.id})),o=[{label:"Presensi Harian",key:"1",children:n.jsx(Ia,{classid:i,subjectid:r}),icon:n.jsx(Ee,{})},{label:"Riwayat Presensi",key:"2",children:n.jsx(za,{classid:i,subjectid:r}),icon:n.jsx(ia,{})}];return n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsx(C,{hoverable:!0,title:"Managemen Kehadiran Siswa",children:n.jsxs(v,{gutter:[16,16],children:[n.jsx(S,{sm:24,md:12,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Mata Pelajran",allowClear:!0,options:d,onChange:e=>{l(e)},showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),n.jsx(S,{sm:24,md:12,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Kelas",allowClear:!0,options:c,onChange:e=>{s(e)},showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})})]})}),i&&r?n.jsx(_,{items:o}):n.jsx($e,{type:"info",showIcon:!0,description:"Silakan pilih mata pelajaran dan kelas terlebih dahulu untuk\r\n              melihat data presensi"})]})},{Text:Ba}=m,Da=({title:e,open:a,onClose:i,subject:l})=>{const[d]=t.useForm(),c=t.useWatch([],d),{data:o,isLoading:u}=O({subjectid:l.id},{skip:!l.id}),[h,{data:m,isLoading:p,isSuccess:x,error:g}]=R(),j=ie.useMemo(()=>{const{presensi:e=0,attitude:a=0,daily:t=0}=c||{};return e+a+t},[c]);return ie.useEffect(()=>{a&&d.resetFields()},[a]),ie.useEffect(()=>{o&&d.setFieldsValue({presensi:o.presensi,attitude:o.attitude,daily:o.daily})},[o]),ie.useEffect(()=>{x&&(s.success(m.message),i(),d.resetFields()),g&&s.error(g.data.message)},[m,x,g]),n.jsx(r,{title:e,open:a,onCancel:i,destroyOnHidden:!0,okText:"Simpan",cancelText:"Tutup",onOk:()=>d.submit(),okButtonProps:{disabled:100!==j},loading:p||u,confirmLoading:p||u,children:n.jsxs(t,{form:d,layout:"vertical",onFinish:e=>{if(100!==j)return void r.error({title:"Input Tidak Valid",content:"Total bobot nilai harus tepat 100%."});const a={subjectid:l.id,...e};h(a)},children:[n.jsx(Ba,{type:"secondary",children:"Pastikan total bobot dari semua komponen penilaian adalah 100%."}),n.jsx(H,{style:{marginTop:"12px"}}),n.jsxs(v,{gutter:16,children:[n.jsx(S,{span:12,children:n.jsx(t.Item,{name:"presensi",label:n.jsxs(Le,{children:[n.jsx(je,{}),"Bobot Nilai Kehadiran"]}),rules:[{required:!0,message:"Wajib diisi"}],children:n.jsx(Ve,{style:{width:"100%"},min:0,max:100,addonAfter:"%",placeholder:"e.g., 10"})})}),n.jsx(S,{span:12,children:n.jsx(t.Item,{name:"attitude",label:n.jsxs(Le,{children:[n.jsx(fe,{}),"Bobot Nilai Sikap"]}),rules:[{required:!0,message:"Wajib diisi"}],children:n.jsx(Ve,{style:{width:"100%"},min:0,max:100,addonAfter:"%",placeholder:"e.g., 20"})})})]}),n.jsx(v,{gutter:16,children:n.jsx(S,{span:12,children:n.jsx(t.Item,{name:"daily",label:n.jsxs(Le,{children:[n.jsx(Ye,{}),"Bobot Nilai Harian"]}),tooltip:"Nilai rerata dari sumatif dan formatif",rules:[{required:!0,message:"Wajib diisi"}],children:n.jsx(Ve,{style:{width:"100%"},min:0,max:100,addonAfter:"%",placeholder:"e.g., 40"})})})}),n.jsx(H,{}),100===j?n.jsx($e,{message:n.jsxs(Ba,{strong:!0,children:["Total Bobot: ",j,"%"]}),description:"Total bobot sudah sesuai.",type:"success",showIcon:!0}):n.jsx($e,{message:n.jsxs(Ba,{strong:!0,children:["Total Bobot: ",j,"%"]}),description:"Total bobot harus tepat 100% untuk dapat menyimpan.",type:"warning",showIcon:!0})]})})},{Meta:Oa}=C,Ra=()=>{const[e,a]=ie.useState(!1),[t,i]=ie.useState(""),[s,r]=se(),{user:l}=D(e=>e.auth),d=l?.subjects;return n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsx(m.Title,{level:5,children:"Pilih Mata Pelajaran Untuk Penilaian"}),n.jsx(v,{gutter:[16,16],children:d?.map(e=>n.jsx(S,{sm:24,md:12,lg:6,children:n.jsx(C,{hoverable:!0,cover:n.jsx("img",{src:e.cover?e.cover:"/logo.png",alt:e.name}),actions:[n.jsx(p,{title:"Penilaian Akhir Semester",children:n.jsx(be,{onClick:()=>(e=>{r({mode:"finalscore",name:e.name?.replace(/\s+/g,"-"),subjectid:e.id})})(e)})},"scoring"),n.jsx(p,{title:"Penilaian Bulanan",children:n.jsx(Ue,{onClick:()=>(e=>{r({mode:"scoring",name:e.name?.replace(/\s+/g,"-"),subjectid:e.id})})(e)})},"scoring"),n.jsx(p,{title:"Pembobotan",children:n.jsx(ke,{onClick:()=>(e=>{i(e),a(!0)})(e)})},"setting")],children:n.jsx(Oa,{title:e.name})})},e.id))}),n.jsx(Da,{title:`Pembobotan Nilai ${t?.name} Bulanan`,open:e,onClose:()=>{i(""),a(!1)},subject:t})]})},{Dragger:Ha}=de,Ka=({title:e,open:a,onCancel:t,onUpload:i,isLoading:l})=>{const[d,c]=ie.useState(null),[o,u]=ie.useState([]),[h,m]=ie.useState([]),[p,g]=ie.useState([]);ie.useEffect(()=>{a||(c(null),u([]),m([]),g([]))},[a]);const j={name:"file",multiple:!1,accept:".xlsx, .xls",fileList:d?[d]:[],beforeUpload:e=>{c(e);const a=new FileReader;return a.onload=e=>{try{const a=new Uint8Array(e.target.result),t=ue(a,{type:"array"}),i=t.SheetNames[0],n=t.Sheets[i],r=he.sheet_to_json(n,{header:1});if(r.length>1){const e=r[0],a=r.slice(1).filter(e=>null!==e[0]&&void 0!==e[0]&&""!==String(e[0]).trim());u(a);const t=e.map((e,a)=>({title:e,dataIndex:a,key:a,width:1===a?250:120}));m(t);const i=a.map((e,a)=>{const t={key:a};return e.forEach((e,a)=>{t[a]=e}),t});g(i),s.success(`Berhasil membaca ${a.length} baris data dari file.`)}else s.warn("File excel tidak memiliki data untuk ditampilkan."),u([]),m([]),g([])}catch(a){s.error("Terjadi kesalahan saat membaca file.")}},a.readAsArrayBuffer(e),!1},onRemove:()=>{c(null),u([]),m([]),g([])}};return n.jsxs(r,{title:e,open:a,onCancel:t,width:1e3,confirmLoading:l,footer:[n.jsx(x,{onClick:t,children:"Batal"},"back"),n.jsx(x,{type:"primary",loading:l,onClick:()=>{o.length>0?i(o):s.error("Tidak ada data untuk diunggah. Silakan pilih file yang valid.")},disabled:0===o.length,icon:n.jsx(ca,{}),children:"Upload Data"},"submit")],children:[n.jsxs(Ha,{...j,style:{marginBottom:20},children:[n.jsx("p",{className:"ant-upload-drag-icon",children:n.jsx(ce,{})}),n.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),n.jsx("p",{className:"ant-upload-hint",children:"Gunakan template yang disediakan dan pastikan file dalam format .xlsx"})]}),p.length>0&&n.jsxs(n.Fragment,{children:[n.jsx($e,{message:`Pratinjau Data: Ditemukan ${p.length} baris data yang akan diunggah.`,type:"info",showIcon:!0,style:{marginBottom:16}}),n.jsx(Re,{columns:h,dataSource:p,bordered:!0,size:"small",pagination:{pageSize:5},scroll:{y:240,x:"max-content"}})]})]})},$a=({students:e,totalData:a,page:t,limit:i,setPage:r,setLimit:l,isLoading:c})=>{const[o,u]=ie.useState({}),[h,m]=ie.useState(!1),{user:p}=D(e=>e.auth),g=p?.id,[j]=se(),f=j.get("name"),b=j.get("subjectid"),k=j.get("chapter"),y=j.get("class"),w=j.get("month"),v=j.get("semester"),{data:S,refetch:_}=K({classid:y,subjectid:b,chapterid:k,month:w,semester:v},{skip:!(y&&b&&k&&w&&v),refetchOnMountOrArgChange:!0}),[N,{isLoading:T}]=$(),[P,{isLoading:L,data:M,error:I,isSuccess:A,reset:F}]=V();ie.useEffect(()=>{u({})},[y,b,k,w,v]),ie.useEffect(()=>{if(S&&Array.isArray(S)){const e=S.reduce((e,a)=>(e[a.student_id]={kinerja:a.kinerja??"",kedisiplinan:a.kedisiplinan??"",keaktifan:a.keaktifan??"",percayaDiri:a.percaya_diri??"",catatan:a.catatan_guru??""},e),{});Object.keys(e).length>0&&u(e)}},[S]),ie.useEffect(()=>{A&&(s.success(M.message),F(),m(!1)),I&&(s.error(I.data.message),F())},[M,I,A]);const z=(e,a,t)=>{u(i=>({...i,[e]:{...i[e],[a]:t}}))},E=e=>{const a=o[e];if(!a)return 0;const t=[a.kinerja,a.kedisiplinan,a.keaktifan,a.percayaDiri].filter(e=>""!==e&&null!=e);return 0===t.length?0:(t.reduce((e,a)=>e+Number(a),0)/t.length).toFixed(1)},B=[{title:"No",key:"index",render:(e,a,s)=>(t-1)*i+s+1,width:60,fixed:"left"},{title:"NIS",dataIndex:"nis",key:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",width:200,fixed:"left"},{title:"Kinerja",key:"kinerja",width:120,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,value:o[a.student]?.kinerja??"",onChange:e=>z(a.student,"kinerja",e.target.value),placeholder:"0-100"})},{title:"Kedisiplinan",key:"kedisiplinan",width:120,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,value:o[a.student]?.kedisiplinan??"",onChange:e=>z(a.student,"kedisiplinan",e.target.value),placeholder:"0-100"})},{title:"Keaktifan",key:"keaktifan",width:120,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,value:o[a.student]?.keaktifan??"",onChange:e=>z(a.student,"keaktifan",e.target.value),placeholder:"0-100"})},{title:"Percaya Diri",key:"percayaDiri",width:120,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,value:o[a.student]?.percayaDiri??"",onChange:e=>z(a.student,"percayaDiri",e.target.value),placeholder:"0-100"})},{title:"Catatan Guru",key:"catatan",width:250,render:(e,a)=>n.jsx(d.TextArea,{rows:3,value:o[a.student]?.catatan||"",onChange:e=>z(a.student,"catatan",e.target.value),placeholder:"Catatan..."})},{title:"Rerata",key:"average",width:100,render:(e,a)=>n.jsx("strong",{children:E(a.student)})},{title:"Aksi",key:"action",width:100,fixed:"right",render:(e,a)=>n.jsx(x,{type:"primary",size:"small",onClick:()=>(async e=>{const a=e.student,t=o[a]||{},i={student_id:a,subject_id:Number(b),class_id:Number(y),chapter_id:Number(k),teacher_id:g,month:w,semester:v,kinerja:t.kinerja?Number(t.kinerja):null,kedisiplinan:t.kedisiplinan?Number(t.kedisiplinan):null,keaktifan:t.keaktifan?Number(t.keaktifan):null,percaya_diri:t.percayaDiri?Number(t.percayaDiri):null,catatan_guru:t.catatan||null};try{const e=await N(i).unwrap();s.success(e.message||"Nilai berhasil disimpan!"),_()}catch(n){s.error(n.data?.message||"Gagal menyimpan nilai.")}})(a),loading:T,children:"Simpan"})}];return n.jsxs(C,{title:"Penilaian Sikap",extra:n.jsxs(Le,{children:[n.jsx(x,{icon:n.jsx(ca,{}),onClick:()=>m(!0),children:"Upload Nilai"}),n.jsx(x,{icon:n.jsx(Ge,{}),onClick:()=>{const a=[["NIS","Nama Siswa","Kinerja","Kedisiplinan","Keaktifan","Percaya Diri","Catatan","Rerata"]];e&&e.forEach(e=>{const t=e.student,i=o[t]||{},s=E(t);a.push([e.nis||"",e.student_name||"",i.kinerja??"",i.kedisiplinan??"",i.keaktifan??"",i.percayaDiri??"",i.catatan??"",s>0?s:""])});const t=he.book_new(),i=he.aoa_to_sheet(a);i["!cols"]=[{wch:15},{wch:30},{wch:12},{wch:15},{wch:12},{wch:15},{wch:40},{wch:12}],he.book_append_sheet(t,i,"Penilaian Sikap");const n=`penilaian_sikap_${f?.replace(/-/g," ")}.xlsx`;me(t,n),s.success("Template berhasil diunduh!")},type:"primary",children:"Download"})]}),children:[n.jsx(Re,{columns:B,dataSource:e,rowKey:"id",bordered:!0,loading:c,pagination:{current:t,pageSize:i,total:a,showSizeChanger:!0},onChange:e=>{r(e.current),l(e.pageSize)},scroll:{x:1500}}),n.jsx(Ka,{title:"Upload Nilai Sikap (Bulk)",open:h,onCancel:()=>m(!1),onUpload:async e=>{if(!e||0===e.length)return void s.error("Tidak ada data untuk diunggah.");const a={classid:Number(y),subjectid:Number(b),chapterid:Number(k),month:w,semester:v,data:e};try{await P(a).unwrap(),s.success("Data nilai berhasil di-upload!"),m(!1),_()}catch(t){s.error(t.data?.message||"Gagal mengupload file.")}},isLoading:L})]})},Va=({students:e,totalData:a,page:t,limit:i,setPage:r,setLimit:l,isLoading:c})=>{const[o,u]=ie.useState({}),[h,m]=ie.useState(!1),{user:p}=D(e=>e.auth),g=p?.id,[j]=se(),f=j.get("name"),b=j.get("subjectid"),k=j.get("chapter"),y=j.get("class"),w=j.get("month"),v=j.get("semester"),{data:S,refetch:_}=Y({classid:y,subjectid:b,chapterid:k,month:w,semester:v},{skip:!(y&&b&&k&&w&&v),refetchOnMountOrArgChange:!0}),[N,{isLoading:T,isSuccess:P,error:L,data:M}]=U(),[I,{isLoading:A,data:F,error:z,isSuccess:E,reset:B}]=G();ie.useEffect(()=>{if(S&&Array.isArray(S)){const e=S.reduce((e,a)=>(e[a.student_id]={f_1:a.f_1??"",f_2:a.f_2??"",f_3:a.f_3??"",f_4:a.f_4??"",f_5:a.f_5??"",f_6:a.f_6??"",f_7:a.f_7??"",f_8:a.f_8??""},e),{});u(e)}},[S]),ie.useEffect(()=>{E&&(s.success(F.message),B(),m(!1)),z&&(s.error(z.data.message),B())},[F,z,E]),ie.useEffect(()=>{P&&s.success(M.message),L&&s.error(L.data.message)},[M,L,P]);const O=e=>{const a=o[e];if(!a)return 0;const t=Object.values(a).filter(e=>""!==e&&null!=e);return 0===t.length?0:(t.reduce((e,a)=>e+Number(a),0)/t.length).toFixed(1)},R=[...[{title:"No",key:"index",render:(e,a,s)=>(t-1)*i+s+1,width:60,fixed:"left"},{title:"NIS",dataIndex:"nis",key:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",width:200,fixed:"left"}],...Array.from({length:8},(e,a)=>{const t=a+1;return{title:`f_${t}`,key:`f_${t}`,width:100,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,style:{textAlign:"center"},placeholder:"0-100",value:o[a.student]?.[`f_${t}`]??"",onChange:e=>((e,a,t)=>{u(i=>({...i,[e]:{...i[e],[`f_${a}`]:t}}))})(a.student,t,e.target.value)})}}),...[{title:"Rerata",key:"average",width:80,fixed:"right",render:(e,a)=>n.jsx("strong",{children:O(a.student)})},{title:"Aksi",key:"action",width:100,fixed:"right",render:(e,a)=>n.jsx(x,{type:"primary",size:"small",onClick:()=>(async e=>{const a=e.student,t=o[a]||{},i={student_id:a,subject_id:Number(b),class_id:Number(y),chapter_id:Number(k),teacher_id:g,month:w,semester:v,F_1:t.f_1?Number(t.f_1):null,F_2:t.f_2?Number(t.f_2):null,F_3:t.f_3?Number(t.f_3):null,F_4:t.f_4?Number(t.f_4):null,F_5:t.f_5?Number(t.f_5):null,F_6:t.f_6?Number(t.f_6):null,F_7:t.f_7?Number(t.f_7):null,F_8:t.f_8?Number(t.f_8):null};N(i)})(a),loading:T,children:"Simpan"})}]];return n.jsxs(C,{title:"Penilaian Formatif",extra:n.jsxs(Le,{children:[n.jsx(x,{icon:n.jsx(ca,{}),onClick:()=>m(!0),children:"Upload Nilai"}),n.jsx(x,{icon:n.jsx(Ge,{}),onClick:()=>{const a=["NIS","Nama Siswa"];for(let e=1;e<=8;e++)a.push(`F_${e}`);a.push("Rerata");const t=[a];e&&e.forEach(e=>{const a=e.student,i=o[a]||{},s=O(a),n=[e.nis||"",e.student_name||""];for(let t=1;t<=8;t++)n.push(i[`f_${t}`]??"");n.push(s>0?s:""),t.push(n)});const i=he.book_new(),n=he.aoa_to_sheet(t);n["!cols"]=[{wch:15},{wch:30},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:8},{wch:10}],he.book_append_sheet(i,n,"Penilaian Formatif"),me(i,`penilaian_formatif_${f?.replace(/-/g," ")}.xlsx`),s.success("Template berhasil diunduh!")},type:"primary",children:"Download"})]}),children:[n.jsx(Re,{columns:R,dataSource:e,rowKey:"id",bordered:!0,loading:c,pagination:{current:t,pageSize:i,total:a,showSizeChanger:!0},onChange:e=>{r(e.current),l(e.pageSize)},scroll:{x:1500}}),n.jsx(Ka,{title:"Upload Nilai Formatif (Bulk)",open:h,onCancel:()=>m(!1),onUpload:async e=>{const a={classid:Number(y),subjectid:Number(b),chapterid:Number(k),month:w,semester:v,data:e};I(a)},isLoading:A})]})},Ya=({students:e,totalData:a,page:t,limit:i,setPage:r,setLimit:l,isLoading:c})=>{const[o,u]=ie.useState({}),[h,m]=ie.useState(!1),{user:p}=D(e=>e.auth),g=p?.id,[j]=se(),f=j.get("name"),b=j.get("subjectid"),k=j.get("chapter"),y=j.get("class"),w=j.get("month"),v=j.get("semester"),{data:S,refetch:_}=q({classid:y,subjectid:b,chapterid:k,month:w,semester:v},{skip:!(y&&b&&k&&w&&v),refetchOnMountOrArgChange:!0}),[N,{isLoading:T}]=J(),[P,{isLoading:L,isSuccess:M,data:I,error:A,reset:F}]=W(),z=e=>{const a=o[e];if(!a)return 0;const t=Object.values(a).filter(e=>""!==e&&null!=e);return 0===t.length?0:(t.reduce((e,a)=>e+Number(a),0)/t.length).toFixed(1)};ie.useEffect(()=>{if(S&&Array.isArray(S)){const e=S.reduce((e,a)=>(e[a.student_id]={oral:a.oral??"",written:a.written??"",project:a.project??"",performance:a.performance??""},e),{});u(e)}},[S]);ie.useEffect(()=>{M&&(s.success(I.message),F(),m(!1)),A&&(s.error(A.data.message),F())},[I,A,M]);const E=[{title:"No",key:"index",render:(e,a,s)=>(t-1)*i+s+1,width:60,fixed:"left"},{title:"NIS",dataIndex:"nis",key:"nis",width:120,fixed:"left"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",width:250,fixed:"left"},...[{title:"Lisan",key:"oral"},{title:"Tulis",key:"written"},{title:"Proyek",key:"project"},{title:"Keterampilan",key:"performance"}].map(e=>({title:e.title,key:e.key,width:120,render:(a,t)=>n.jsx(d,{type:"number",min:0,max:100,placeholder:"0-100",value:o[t.student]?.[e.key]??"",onChange:a=>{return i=t.student,s=e.key,n=a.target.value,void u(e=>({...e,[i]:{...e[i],[s]:n}}));var i,s,n}})})),{title:"Rata2",key:"average",width:100,render:(e,a)=>n.jsx("strong",{children:z(a.student)})},{title:"Aksi",key:"action",width:100,fixed:"right",render:(e,a)=>n.jsx(x,{type:"primary",size:"small",onClick:()=>(async e=>{const a=e.student,t=o[a]||{},i={student_id:a,subject_id:Number(b),class_id:Number(y),chapter_id:Number(k),teacher_id:g,month:w,semester:v,oral:t.oral?Number(t.oral):null,written:t.written?Number(t.written):null,project:t.project?Number(t.project):null,performance:t.performance?Number(t.performance):null};try{const e=await N(i).unwrap();s.success(e.message||"Nilai berhasil disimpan!"),_()}catch(n){s.error(n.data?.message||"Gagal menyimpan nilai.")}})(a),loading:T,children:"Simpan"})}];return n.jsxs(C,{title:"Penilaian Sumatif",extra:n.jsxs(Le,{children:[n.jsx(x,{icon:n.jsx(ca,{}),onClick:()=>m(!0),children:"Upload Nilai"}),n.jsx(x,{icon:n.jsx(Ge,{}),onClick:()=>{const a=[["NIS","Nama Siswa","Lisan","Tulis","Proyek","Keterampilan","Rata2"]];e&&e.forEach(e=>{const t=e.student,i=o[t]||{},s=z(t);a.push([e.nis||"",e.student_name||"",i.oral??"",i.written??"",i.project??"",i.performance??"",s>0?s:""])});const t=he.book_new(),i=he.aoa_to_sheet(a);i["!cols"]=[{wch:15},{wch:30},{wch:12},{wch:12},{wch:12},{wch:12},{wch:12}],he.book_append_sheet(t,i,"Penilaian Sumatif"),me(t,`penilaian_sumatif_${f?.replace(/-/g," ")}.xlsx`),s.success("Template berhasil diunduh!")},type:"primary",children:"Download"})]}),children:[n.jsx(Re,{columns:E,dataSource:e,rowKey:"id",bordered:!0,loading:c,pagination:{current:t,pageSize:i,total:a,showSizeChanger:!0},onChange:e=>{r(e.current),l(e.pageSize)},scroll:{x:1200}}),n.jsx(Ka,{title:"Upload Nilai Sumatif (Bulk)",open:h,onCancel:()=>m(!1),onUpload:async e=>{const a={classid:Number(y),subjectid:Number(b),chapterid:Number(k),month:w,semester:v,data:e};P(a)},isLoading:L})]})},{Title:Ua,Text:Ga}=m,{Search:qa}=d,Ja=({data:e})=>{if(!e?.results?.[0])return null;const a=e.results[0];return n.jsx(C,{size:"small",children:n.jsxs(h,{justify:"space-between",wrap:"wrap",children:[n.jsxs(h,{vertical:!0,children:[n.jsx(Ga,{strong:!0,children:"Mata Pelajaran"}),n.jsx(Ga,{children:a.subject_name})]}),n.jsxs(h,{vertical:!0,children:[n.jsx(Ga,{strong:!0,children:"Chapter"}),n.jsx(Ga,{children:a.chapter_name})]}),n.jsxs(h,{vertical:!0,children:[n.jsx(Ga,{strong:!0,children:"Kelas"}),n.jsx(Ga,{children:a.class_name})]}),n.jsxs(h,{vertical:!0,children:[n.jsx(Ga,{strong:!0,children:"Guru Pengampu"}),n.jsx(Ga,{children:a.teacher_name})]})]})})},Wa=()=>{const[e,a]=ie.useState(1),[t,i]=ie.useState(10),[s,r]=ie.useState(""),[d,c]=ie.useState(s),{user:o}=D(e=>e.auth),[u]=se(),m=u.get("month"),p=u.get("subjectid"),g=u.get("chapter"),j=u.get("class"),{data:f,isLoading:b,isError:k,refetch:y,error:w}=X({page:e,limit:t,search:d,month:m,subjectid:p,chapterid:g,classid:j});ie.useEffect(()=>{const e=setTimeout(()=>{c(s),a(1)},500);return()=>{clearTimeout(e)}},[s]);const v=[{title:"No",key:"no",render:(a,i,s)=>(e-1)*t+s+1,width:50},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Kehadiran",dataIndex:"attendance",key:"attendance",align:"center"},{title:"Sikap",dataIndex:"attitude",key:"attitude",align:"center"},{title:"Harian",dataIndex:"daily",key:"daily",align:"center"},{title:"Nilai Akhir",dataIndex:"final_score",key:"final_score",align:"center",render:e=>n.jsx(Ga,{strong:!0,children:e})}];return m&&g&&j?n.jsxs(h,{vertical:!0,gap:"large",children:[n.jsx($e,{showIcon:!0,type:"info",message:"Informasi Rekapitulasi",description:"Data yang ditampilkan adalah nilai yang sudah dibobotkan berdasarkan pengaturan yang telah ditentukan sebelumnya."}),n.jsx(C,{children:n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsx(Ja,{data:f}),n.jsxs(h,{justify:"space-between",children:[n.jsx(qa,{placeholder:"Cari nama siswa...",value:s,onChange:e=>r(e.target.value),style:{maxWidth:300},allowClear:!0}),n.jsx(x,{icon:n.jsx(ra,{}),onClick:y,color:"cyan",variant:"solid",children:"Sinkron Data"})]}),n.jsx(l,{spinning:b,children:n.jsx(Re,{columns:v,dataSource:f?.results,rowKey:"student_id",pagination:{current:e,pageSize:t,total:f?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50"]},onChange:e=>{a(e.current),i(e.pageSize)},bordered:!0,scroll:{x:"max-content"}})})]})})]}):n.jsx($e,{message:"Parameter Tidak Lengkap",description:"Harap pilih Bulan, Chapter, dan Kelas terlebih dahulu untuk melihat rekapitulasi nilai.",type:"warning",showIcon:!0})},{Search:Xa}=d,Za=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],Qa=[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],et=({name:e,id:a})=>{const t=ne(),[i,s]=se(),{data:r,isLoading:l}=b(a),[d,c]=ie.useState(1),[o,u]=ie.useState(10),[p,g]=ie.useState(""),j=i.get("semester"),f=i.get("month"),k=i.get("chapter"),C=i.get("class"),N=i.get("subjectid"),{data:P,isLoading:L}=T({page:d,limit:o,search:p,classid:C},{skip:!C}),M=ie.useMemo(()=>Za.map(e=>({value:e,label:e})),[]),I=ie.useMemo(()=>Qa.map(e=>({value:e.value,label:e.label})),[]),A=ie.useMemo(()=>r?.map(e=>({value:e.chapter_id,label:e.chapter_name}))||[],[r]),F=ie.useMemo(()=>{if(!k)return[];const e=r?.find(e=>String(e.chapter_id)===String(k));return e?.class?.map(e=>({value:e.id,label:e.name}))||[]},[r,k]),z=(e,a)=>{const t=new URLSearchParams(i);a?t.set(e,a):t.delete(e),"chapter"===e&&t.delete("class"),c(1),s(t)},E=[{label:"Kehadiran",key:"1",children:n.jsx(za,{classid:C,subjectid:N}),icon:n.jsx(ye,{})},{label:"Sikap",key:"2",children:n.jsx($a,{students:P?.students,totalData:P?.totalData,page:d,limit:o,search:p,setPage:c,setLimit:u,setSearch:g,isLoading:L}),icon:n.jsx(we,{})},{label:"Formatif",key:"3",children:n.jsx(Va,{students:P?.students,totalData:P?.totalData,page:d,limit:o,search:p,setPage:c,setLimit:u,setSearch:g,isLoading:L}),icon:n.jsx(Z,{})},{label:"Sumatif",key:"4",children:n.jsx(Ya,{students:P?.students,totalData:P?.totalData,page:d,limit:o,search:p,setPage:c,setLimit:u,setSearch:g,isLoading:L}),icon:n.jsx(Z,{})},{label:"Rekap",key:"5",children:n.jsx(Wa,{}),icon:n.jsx(ia,{})}],B=j&&f&&k&&C;return n.jsx(y,{title:`Pelajaran ${e.replace(/-/g," ")}`,levels:["teacher"],children:n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsxs(Le,{children:[n.jsx(x,{shape:"circle",icon:n.jsx(w,{}),onClick:()=>t("/learning-management-system")}),n.jsx(m.Title,{style:{margin:0},level:5,children:`Penilaian ${e.replace(/-/g," ")}`})]}),n.jsxs(v,{gutter:[10,10],children:[n.jsx(S,{sm:24,md:6,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Semester",options:I,allowClear:!0,value:j?Number(j):null,onChange:e=>z("semester",e),showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),n.jsx(S,{sm:24,md:6,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Bulan",options:M,allowClear:!0,value:f,onChange:e=>z("month",e),showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),n.jsx(S,{sm:24,md:6,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Chapter",options:A,allowClear:!0,loading:l,value:k?Number(k):null,onChange:e=>z("chapter",e),showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),n.jsx(S,{sm:24,md:6,children:n.jsx(xe,{style:{width:"100%"},placeholder:"Pilih Kelas",options:F,allowClear:!0,disabled:!k,value:C?Number(C):null,onChange:e=>z("class",e),showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})})]}),B?n.jsxs(n.Fragment,{children:[n.jsx(Xa,{placeholder:"Cari nama siswa...",onSearch:e=>{g(e),c(1)},enterButton:!0,allowClear:!0}),n.jsx(_,{items:E})]}):n.jsx(pe,{description:"Pilih Semester, bulan, chapter dan kelas terlebih dahulu"})]})})},{Title:at}=m,tt=()=>{const[e]=se(),a=e.get("subjectid"),t=e.get("name"),i=ne(),[r,l]=ie.useState(null),[c,o]=ie.useState(null),[u,m]=ie.useState({}),[p,g]=ie.useState(!1),{data:j}=Q({page:"",limit:"",search:""}),f=j?.map(e=>({label:e.name,value:e.id})),{data:b,isLoading:k,refetch:v}=ee({semester:r,classid:c,subjectid:a},{skip:!r||!c||!a,refetchOnMountOrArgChange:!0}),[S,{isLoading:C}]=ae();ie.useEffect(()=>{if(b&&Array.isArray(b)){const e={};b.forEach(a=>{e[a.studentid]=a.score}),m(e)}else m({})},[b]);const _=[{title:"No",key:"index",render:(e,a,t)=>t+1,width:60,align:"center"},{title:"NIS",dataIndex:"nis",key:"nis",width:150},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Nilai",key:"score",width:150,render:(e,a)=>n.jsx(d,{type:"number",min:0,max:100,value:u[a.studentid]??"",onChange:e=>{return t=a.studentid,i=e.target.value,void m(e=>({...e,[t]:i}));var t,i},placeholder:"0-100",style:{width:"100%"}})}];return n.jsx(y,{title:"Penilaian Akhir Semester",levels:["teacher"],children:n.jsxs(h,{vertical:!0,gap:"middle",children:[n.jsxs(h,{align:"center",justify:"space-between",wrap:!0,children:[n.jsxs(Le,{children:[n.jsx(x,{shape:"circle",icon:n.jsx(w,{}),onClick:()=>i("/learning-management-system")}),n.jsx(at,{level:5,style:{margin:0},children:` Penilaian Akhir Semester ${t?.replace(/-/g," ")}`})]}),n.jsxs(Le,{wrap:!0,children:[n.jsx(xe,{style:{width:150},placeholder:"Pilih Semester",allowClear:!0,options:[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],onChange:e=>l(e),value:r}),n.jsx(xe,{style:{width:150},placeholder:"Pilih Kelas",allowClear:!0,options:f,onChange:e=>o(e),showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),value:c}),n.jsx(x,{icon:n.jsx(Ge,{}),onClick:()=>{if(!b||0===b.length)return void s.warning("Tidak ada data siswa untuk didownload.");const e=[["NIS","Nama Siswa","Nilai Akhir"]];b.forEach(a=>{e.push([a.nis,a.student_name,u[a.studentid]??""])});const a=he.book_new(),i=he.aoa_to_sheet(e);i["!cols"]=[{wch:15},{wch:30},{wch:10}],he.book_append_sheet(a,i,"Nilai Akhir"),me(a,`Nilai_Akhir_${t.replace(/-/g," ")}.xlsx`)},disabled:!b?.length,children:"Download"}),n.jsx(x,{icon:n.jsx(ca,{}),onClick:()=>g(!0),disabled:!c||!r,children:"Upload"}),n.jsx(x,{type:"primary",icon:n.jsx(qe,{}),onClick:async()=>{if(!c||!r)return void s.warning("Mohon pilih Kelas dan Semester terlebih dahulu.");const e=b.map(e=>{const a=u[e.studentid];return void 0!==a&&""!==a&&null!==a?{studentid:e.studentid,score:Number(a)}:null}).filter(e=>null!==e);if(0===e.length)return void s.info("Tidak ada nilai yang diisi untuk disimpan.");const t={semester:r,classid:Number(c),subjectid:Number(a),data:e};try{await S(t).unwrap(),s.success(`Berhasil menyimpan ${e.length} data nilai!`),v()}catch(i){s.error(i.data?.message||"Gagal menyimpan data.")}},loading:C,disabled:!c||!r||!b?.length,children:"Simpan Data"})]})]}),n.jsx(Re,{bordered:!0,dataSource:b||[],columns:_,rowKey:"studentid",loading:k,pagination:!1,scroll:{y:500},locale:{emptyText:"Silakan pilih Semester dan Kelas terlebih dahulu"}}),n.jsx(Ka,{title:"Upload Nilai Akhir",open:p,onCancel:()=>g(!1),onUpload:e=>(async e=>{if(!e||0===e.length)return void s.error("Data kosong atau tidak valid.");const t=e.map(e=>{const a=e[0],t=e[2],i=b.find(e=>String(e.nis).trim()===String(a).trim());return i&&null!=t&&""!==t?{studentid:i.studentid,score:Number(t)}:null}).filter(e=>null!==e);if(0!==t.length)try{const e={semester:r,classid:Number(c),subjectid:Number(a),data:t};await S(e).unwrap(),s.success(`Berhasil mengupload ${t.length} data nilai!`),g(!1),v()}catch(i){s.error("Gagal menyimpan data ke server.")}else s.error("Data Excel tidak cocok. Pastikan NIS sesuai dengan data kelas ini.")})(e),isLoading:C})]})})},it=()=>{const e=ne(),[a]=se(),t=a.get("name"),i=a.get("subjectid"),s=a.get("mode"),r=()=>{e("/learning-management-system")},l=[{label:"Mata Pelajaran",key:"1",children:n.jsx(re,{}),icon:n.jsx(te,{})},{label:"Absen",key:"2",children:n.jsx(Ea,{}),icon:n.jsx(Z,{})},{label:"Penilaian",key:"3",children:n.jsx(Ra,{}),icon:n.jsx(Xe,{})},{label:"Rekap Kehadiran",key:"4",children:n.jsx(ve,{}),icon:n.jsx(ye,{})},{label:"Nilai Sikap",key:"5",children:n.jsx(Se,{}),icon:n.jsx(we,{})},{label:"Nilai Sumatif",key:"6",children:n.jsx(Ce,{}),icon:n.jsx(Z,{})},{label:"Nilai Akhir",key:"7",children:n.jsx(_e,{}),icon:n.jsx(be,{})}];return"lms"===s?n.jsx(Pa,{name:t,id:i,onBack:r}):"finalscore"===s?n.jsx(tt,{name:t,id:i}):"scoring"===s?n.jsx(et,{name:t,id:i}):n.jsx(y,{title:"Learning Management System",levels:["teacher"],children:n.jsx(_,{defaultActiveKey:"1",items:l})})};export{it as default};
