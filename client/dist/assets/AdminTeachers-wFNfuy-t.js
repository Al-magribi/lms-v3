import{ac as e,an as a,ao as s,j as l,V as t,ap as i,e as n,aq as r,ar as d}from"./index-CWxNWZvk.js";import{b as c}from"./vendor-DfXzdC0j.js";import{L as o}from"./Layout-CrHSAK76.js";import{S as m}from"./react-select.esm-DUeLA41h.js";import{r as u,u as h}from"./xlsx-Daov8euU.js";import{T as b}from"./Table-CP5BEHya.js";import"./index-CGMX7dKw.js";import"./index-hpZ4eOv6.js";import"./index-DyuEXp_a.js";const x=({detail:i,setDetail:n})=>{const[r,d]=c.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:o}=e({page:"",limit:"",search:""}),{data:u}=a({page:"",limit:"",search:""}),[h,{isSuccess:b,isLoading:x,isError:p,reset:j}]=s(),g=e=>{const{name:a,value:s,type:l,checked:t}=e.target;d((e=>({...e,[a]:"checkbox"===l?t:s})))},f=()=>{n({}),d({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};c.useEffect((()=>{if(b){j(),f();document.querySelector("[data-bs-dismiss='modal']").click()}p&&j()}),[b,p]),c.useEffect((()=>{var e;i&&d({id:i.id||"",username:i.username||"",name:i.name||"",homeroom:i.homeroom||!1,classid:i.class||"",gender:i.gender||"",subjects:(null==(e=i.subjects)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})}),[i]),c.useEffect((()=>{const e=document.getElementById("addteacher");if(!e)return;const a=()=>{d({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};return e.addEventListener("hidden.bs.modal",a),()=>e.removeEventListener("hidden.bs.modal",a)}),[]);const N=(null==u?void 0:u.map((e=>({value:e.id,label:e.name}))))||[];return l.jsx("div",{className:"modal fade",id:"addteacher","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"teacherModalLabel","aria-hidden":"true",children:l.jsx("div",{className:"modal-dialog",children:l.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!r.name||!r.username)return t.error("Lengkapi data");t.promise(h(r).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",id:"teacherModalLabel",children:r.id?"Edit Guru":"Tambah Guru"}),l.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:f})]}),l.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[l.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:r.username,onChange:g,required:!0}),l.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:r.name,onChange:g,required:!0}),l.jsxs("select",{name:"gender",className:"form-select",value:r.gender,onChange:g,required:!0,children:[l.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),l.jsx("option",{value:"L",children:"Laki Laki"}),l.jsx("option",{value:"P",children:"Perempuan"})]}),l.jsx(m,{isMulti:!0,options:N,value:r.subjects,onChange:e=>{d((a=>({...a,subjects:e||[]})))},className:"mb-2",placeholder:"Mata Pelajaran"}),l.jsxs("div",{className:"form-check",children:[l.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:r.homeroom,onChange:g,id:"homeroomCheck"}),l.jsx("label",{className:"form-check-label",htmlFor:"homeroomCheck",children:"Wali Kelas"})]}),r.homeroom&&l.jsxs("select",{name:"classid",className:"form-select",value:r.classid,onChange:g,required:!0,children:[l.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),null==o?void 0:o.map((e=>l.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),l.jsxs("div",{className:"modal-footer",children:[l.jsxs("button",{type:"button",className:"btn btn-warning","data-bs-dismiss":"modal",onClick:f,children:[l.jsx("i",{className:"bi bi-x-lg me-1"}),"Batal"]}),l.jsxs("button",{type:"submit",className:"btn btn-success",disabled:x,children:[l.jsx("i",{className:"bi bi-save me-1"}),"Simpan"]})]})]})})})},p=()=>{const[e,a]=c.useState(null),s=c.useRef(null),[t,{isSuccess:r,isLoading:d,isError:o,reset:m}]=i();return c.useEffect((()=>{if(r){s.current.value=null,m();document.querySelector("[data-bs-dismiss='modal']").click()}o&&(m(),s.current.value=null)}),[r,o]),c.useEffect((()=>{const e=document.getElementById("uploadteacher");if(!e)return;const l=()=>{a(null),s.current&&(s.current.value=null)};return e.addEventListener("hidden.bs.modal",l),()=>e.removeEventListener("hidden.bs.modal",l)}),[]),l.jsx("div",{className:"modal fade",id:"uploadteacher","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"uploadTeacherModalLabel","aria-hidden":"true",children:l.jsx("div",{className:"modal-dialog modal-dialog-centered",children:l.jsxs("div",{className:"modal-content",children:[l.jsxs("div",{className:"modal-header bg-success text-white",children:[l.jsxs("h5",{className:"modal-title",id:"uploadTeacherModalLabel",children:[l.jsx("i",{className:"bi bi-file-earmark-arrow-up-fill me-2"}),"Upload Guru"]}),l.jsx("button",{type:"button",className:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})]}),l.jsx("div",{className:"modal-body p-4",children:l.jsxs("form",{onSubmit:a=>{if(a.preventDefault(),e){const a=new FileReader;a.onload=e=>{const a=new Uint8Array(e.target.result),s=u(a,{type:"array"}),l=s.SheetNames[0],i=s.Sheets[l],r=h.sheet_to_json(i,{header:1,range:1}).map((e=>{const[a,s,l]=e;return[a,s,l]})).filter((e=>e.every((e=>null!=e)))),d=Array.isArray(r)?r:[r];n.promise(t(d).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},a.readAsArrayBuffer(e)}},className:"d-flex flex-column gap-3",children:[l.jsxs("div",{className:"alert alert-info py-2 d-flex align-items-center gap-2",children:[l.jsx("i",{className:"bi bi-info-circle-fill"}),"Upload file Excel sesuai template yang disediakan."]}),l.jsx("input",{ref:s,type:"file",name:"teachers",id:"teacher",className:"form-control",onChange:e=>a(e.target.files[0]),required:!0}),l.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-2",children:[l.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_guru.xlsx","_blank")},children:[l.jsx("i",{className:"bi bi-download me-1"}),"Template"]}),l.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:d,children:[l.jsx("i",{className:"bi bi-upload me-1"}),"Upload Data"]})]})]})})]})})})},j=({setDetail:e})=>{const[a,s]=c.useState(1),[i,n]=c.useState(10),[o,m]=c.useState(""),{data:u={},isLoading:h}=r({page:a,limit:i,search:o}),{teachers:x=[],totalData:p,totalPages:j}=u,[g,{isSuccess:f,isLoading:N,isError:v,reset:y}]=d();return c.useEffect((()=>{f&&y(),v&&y()}),[f,v]),l.jsx(b,{page:a,setPage:s,setLimit:n,setSearch:m,totalData:p,totalPages:j,isLoading:h,children:l.jsx("div",{className:"table-responsive",children:l.jsxs("table",{className:"table table-hover align-middle",children:[l.jsx("thead",{className:"table-light",children:l.jsxs("tr",{children:[l.jsx("th",{scope:"col",className:"text-center",style:{width:"60px"},children:"#"}),l.jsx("th",{scope:"col",children:"Nama Guru"}),l.jsx("th",{scope:"col",children:"NIP/Username"}),l.jsx("th",{scope:"col",children:"Wali Kelas"}),l.jsx("th",{scope:"col",children:"Mata Pelajaran"}),l.jsx("th",{scope:"col",className:"text-center",style:{width:"120px"},children:"Aksi"})]})}),l.jsx("tbody",{children:(null==x?void 0:x.length)>0?null==x?void 0:x.map(((s,n)=>{var r;return l.jsxs("tr",{children:[l.jsx("td",{className:"text-center text-muted",children:(a-1)*i+n+1}),l.jsx("td",{children:l.jsx("div",{className:"d-flex align-items-center",children:l.jsxs("div",{children:[l.jsx("h6",{className:"mb-0 fw-semibold",children:s.name}),l.jsx("small",{className:"text-muted",children:"L"===s.gender?"Laki-laki":"Perempuan"}),s.email&&l.jsxs("div",{className:"text-muted small",children:[l.jsx("i",{className:"bi bi-envelope me-1"}),s.email]}),s.phone&&l.jsxs("div",{className:"text-muted small",children:[l.jsx("i",{className:"bi bi-telephone me-1"}),s.phone]})]})})}),l.jsx("td",{children:l.jsx("span",{className:"badge bg-light text-dark",children:s.username})}),l.jsx("td",{children:s.homeroom?l.jsxs("span",{className:"badge bg-success bg-opacity-10 text-success",children:[l.jsx("i",{className:"bi bi-check-circle me-1"}),s.class_name]}):l.jsx("span",{className:"badge bg-secondary bg-opacity-10 text-secondary",children:"Bukan Wali Kelas"})}),l.jsx("td",{children:l.jsx("div",{className:"d-flex flex-wrap gap-1",children:null==(r=s.subjects)?void 0:r.map((e=>l.jsx("span",{className:"badge bg-primary bg-opacity-10 text-primary",style:{fontSize:"0.75rem"},children:e.name},e.id)))})}),l.jsx("td",{children:l.jsxs("div",{className:"d-flex gap-1 justify-content-center",children:[l.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>e(s),"data-bs-toggle":"modal","data-bs-target":"#addteacher",title:"Edit",children:l.jsx("i",{className:"bi bi-pencil-square"})}),l.jsx("button",{className:"btn btn-sm btn-outline-danger",disabled:N,onClick:()=>{return e=s.id,void(window.confirm("Apakah anda yakin ingin menghapus data guru ini dan semua data yang terkait dengan guru ini?")&&t.promise(g(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},title:"Hapus",children:l.jsx("i",{className:"bi bi-trash"})})]})})]},s.id)})):l.jsx("tr",{children:l.jsx("td",{colSpan:"7",className:"text-center py-4",children:l.jsxs("div",{className:"text-muted",children:[l.jsx("i",{className:"bi bi-inbox display-4 d-block mb-3"}),l.jsx("h5",{children:"Data Belum Tersedia"}),l.jsx("p",{className:"mb-0",children:"Tidak ada data guru yang ditemukan"})]})})})})]})})})},g=()=>{const[e,a]=c.useState({});return l.jsxs(o,{title:"Guru",levels:["admin"],children:[l.jsx(x,{detail:e,setDetail:a}),l.jsx(p,{}),l.jsx(j,{setDetail:a})]})};export{g as default};
//# sourceMappingURL=AdminTeachers-wFNfuy-t.js.map
