import{ab as e,an as a,ao as s,j as l,V as i,ap as t,e as d,aq as n,ar as r}from"./index-BrYqPfJf.js";import{b as c}from"./vendor-CnnDPxwB.js";import{L as m}from"./Layout-BiUTaUnj.js";import{S as o}from"./react-select.esm-C351JJ6e.js";import{r as u,u as h}from"./xlsx-B4fPQ8kA.js";import{T as x}from"./Table-Ya74POof.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";import"./index-BpPDjKa5.js";const b=({detail:t,setDetail:d})=>{const[n,r]=c.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:m}=e({page:"",limit:"",search:""}),{data:u}=a({page:"",limit:"",search:""}),[h,{isSuccess:x,isLoading:b,isError:j,reset:p}]=s(),g=e=>{const{name:a,value:s,type:l,checked:i}=e.target;r((e=>({...e,[a]:"checkbox"===l?i:s})))},N=()=>{d({}),r({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};c.useEffect((()=>{if(x){p(),N();document.querySelector("[data-bs-dismiss='modal']").click()}j&&p()}),[x,j]),c.useEffect((()=>{var e;t&&r({id:t.id||"",username:t.username||"",name:t.name||"",homeroom:t.homeroom||!1,classid:t.class||"",gender:t.gender||"",subjects:(null==(e=t.subjects)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})}),[t]),c.useEffect((()=>{const e=document.getElementById("addteacher");if(!e)return;const a=()=>{r({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};return e.addEventListener("hidden.bs.modal",a),()=>e.removeEventListener("hidden.bs.modal",a)}),[]);const f=(null==u?void 0:u.map((e=>({value:e.id,label:e.name}))))||[];return l.jsx("div",{className:"modal fade",id:"addteacher","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"teacherModalLabel","aria-hidden":"true",children:l.jsx("div",{className:"modal-dialog",children:l.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!n.name||!n.username)return i.error("Lengkapi data");i.promise(h(n).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[l.jsxs("div",{className:"modal-header",children:[l.jsx("h5",{className:"modal-title",id:"teacherModalLabel",children:n.id?"Edit Guru":"Tambah Guru"}),l.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:N})]}),l.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[l.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:n.username,onChange:g,required:!0}),l.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:n.name,onChange:g,required:!0}),l.jsxs("select",{name:"gender",className:"form-select",value:n.gender,onChange:g,required:!0,children:[l.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),l.jsx("option",{value:"L",children:"Laki Laki"}),l.jsx("option",{value:"P",children:"Perempuan"})]}),l.jsx(o,{isMulti:!0,options:f,value:n.subjects,onChange:e=>{r((a=>({...a,subjects:e||[]})))},className:"mb-2",placeholder:"Mata Pelajaran"}),l.jsxs("div",{className:"form-check",children:[l.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:n.homeroom,onChange:g,id:"homeroomCheck"}),l.jsx("label",{className:"form-check-label",htmlFor:"homeroomCheck",children:"Wali Kelas"})]}),n.homeroom&&l.jsxs("select",{name:"classid",className:"form-select",value:n.classid,onChange:g,required:!0,children:[l.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),null==m?void 0:m.map((e=>l.jsx("option",{value:e.id,children:e.name},e.id)))]})]}),l.jsxs("div",{className:"modal-footer",children:[l.jsxs("button",{type:"button",className:"btn btn-warning","data-bs-dismiss":"modal",onClick:N,children:[l.jsx("i",{className:"bi bi-x-lg me-1"}),"Batal"]}),l.jsxs("button",{type:"submit",className:"btn btn-success",disabled:b,children:[l.jsx("i",{className:"bi bi-save me-1"}),"Simpan"]})]})]})})})},j=()=>{const[e,a]=c.useState(null),s=c.useRef(null),[i,{isSuccess:n,isLoading:r,isError:m,reset:o}]=t();return c.useEffect((()=>{if(n){s.current.value=null,o();document.querySelector("[data-bs-dismiss='modal']").click()}m&&(o(),s.current.value=null)}),[n,m]),c.useEffect((()=>{const e=document.getElementById("uploadteacher");if(!e)return;const l=()=>{a(null),s.current&&(s.current.value=null)};return e.addEventListener("hidden.bs.modal",l),()=>e.removeEventListener("hidden.bs.modal",l)}),[]),l.jsx("div",{className:"modal fade",id:"uploadteacher","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"uploadTeacherModalLabel","aria-hidden":"true",children:l.jsx("div",{className:"modal-dialog modal-dialog-centered",children:l.jsxs("div",{className:"modal-content",children:[l.jsxs("div",{className:"modal-header bg-success text-white",children:[l.jsxs("h5",{className:"modal-title",id:"uploadTeacherModalLabel",children:[l.jsx("i",{className:"bi bi-file-earmark-arrow-up-fill me-2"}),"Upload Guru"]}),l.jsx("button",{type:"button",className:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})]}),l.jsx("div",{className:"modal-body p-4",children:l.jsxs("form",{onSubmit:a=>{if(a.preventDefault(),e){const a=new FileReader;a.onload=e=>{const a=new Uint8Array(e.target.result),s=u(a,{type:"array"}),l=s.SheetNames[0],t=s.Sheets[l],n=h.sheet_to_json(t,{header:1,range:1}).map((e=>{const[a,s,l]=e;return[a,s,l]})).filter((e=>e.every((e=>null!=e)))),r=Array.isArray(n)?n:[n];d.promise(i(r).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},a.readAsArrayBuffer(e)}},className:"d-flex flex-column gap-3",children:[l.jsxs("div",{className:"alert alert-info py-2 d-flex align-items-center gap-2",children:[l.jsx("i",{className:"bi bi-info-circle-fill"}),"Upload file Excel sesuai template yang disediakan."]}),l.jsx("input",{ref:s,type:"file",name:"teachers",id:"teacher",className:"form-control",onChange:e=>a(e.target.files[0]),required:!0}),l.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-2",children:[l.jsxs("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_guru.xlsx","_blank")},children:[l.jsx("i",{className:"bi bi-download me-1"}),"Template"]}),l.jsxs("button",{type:"submit",className:"btn btn-sm btn-success",disabled:r,children:[l.jsx("i",{className:"bi bi-upload me-1"}),"Upload Data"]})]})]})})]})})})},p=({setDetail:e})=>{const[a,s]=c.useState(1),[t,d]=c.useState(12),[m,o]=c.useState(""),{data:u={},isLoading:h}=n({page:a,limit:t,search:m}),{teachers:b=[],totalData:j,totalPages:p}=u,[g,{isSuccess:N,isLoading:f,isError:v,reset:y}]=r();return c.useEffect((()=>{N&&y(),v&&y()}),[N,v]),l.jsx(x,{page:a,setPage:s,setLimit:d,setSearch:o,totalData:j,totalPages:p,isLoading:h,children:l.jsx("div",{className:"row g-4",children:(null==b?void 0:b.length)>0?null==b?void 0:b.map(((a,s)=>{var t;return l.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:l.jsx("div",{className:"card shadow-sm hover-shadow h-100",children:l.jsxs("div",{className:"card-body",children:[l.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("span",{style:{height:50,width:50},className:"badge bg-primary bg-opacity-10 rounded-circle d-flex align-items-center justify-content-center",children:l.jsx("i",{className:"bi bi-person-circle text-primary",style:{fontSize:25}})}),l.jsxs("div",{className:"ms-3",children:[l.jsx("h5",{className:"card-title mb-1 text-primary",children:a.name}),l.jsx("p",{className:"text-muted small mb-0",children:a.username})]})]}),l.jsx("div",{className:"d-flex gap-2",children:l.jsxs("div",{className:"dropdown",children:[l.jsx("button",{className:"btn btn-sm btn-outline-primary",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:l.jsx("i",{className:"bi bi-three-dots-vertical"})}),l.jsxs("ul",{className:"dropdown-menu dropdown-menu-end",children:[l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item",onClick:()=>e(a),"data-bs-toggle":"modal","data-bs-target":"#addteacher",children:[l.jsx("i",{className:"bi bi-pencil-square me-2"}),"Edit"]})}),l.jsx("li",{children:l.jsxs("button",{className:"dropdown-item text-danger",disabled:f,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus data guru ini dan semua data yang terkait dengan guru ini?")&&i.promise(g(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[l.jsx("i",{className:"bi bi-folder-minus me-2"}),"Hapus"]})})]})]})})]}),l.jsxs("div",{className:"row g-3",children:[l.jsx("div",{className:"col-4",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-building me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Satuan"}),l.jsx("span",{className:"fw-medium",children:a.homebase})]})]})}),l.jsx("div",{className:"col-4",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-gender-ambiguous me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Jenis Kelamin"}),l.jsx("span",{className:"fw-medium",children:"L"===a.gender?"Laki-laki":"Perempuan"})]})]})}),l.jsx("div",{className:"col-4",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-mortarboard me-2 text-primary"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Wali Kelas"}),l.jsx("span",{className:"fw-medium",children:a.homeroom?a.class_name:"-"})]})]})}),l.jsx("div",{className:"col-12",children:l.jsxs("div",{className:"d-flex align-items-start",children:[l.jsx("i",{className:"bi bi-book me-2 text-primary mt-1"}),l.jsxs("div",{children:[l.jsx("small",{className:"text-muted d-block",children:"Mata Pelajaran"}),l.jsx("div",{className:"d-flex flex-wrap gap-2",children:null==(t=a.subjects)?void 0:t.map((e=>l.jsx("span",{className:"badge bg-light text-dark",children:e.name},e.id)))})]})]})})]})]})})},s)})):l.jsx("div",{className:"col-12",children:l.jsx("div",{className:"alert alert-info mb-0",children:"Data Belum tersedia"})})})})},g=()=>{const[e,a]=c.useState({});return l.jsxs(m,{title:"Guru",levels:["admin"],children:[l.jsx(b,{detail:e,setDetail:a}),l.jsx(j,{}),l.jsx(p,{setDetail:a})]})};export{g as default};
//# sourceMappingURL=AdminTeachers-DnjNbP_Q.js.map
