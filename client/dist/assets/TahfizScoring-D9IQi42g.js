import{l as e,c$ as a,s as t,j as i,m as n,I as s,d0 as r,d1 as l,F as o,o as d,d2 as c,d3 as u,d4 as g,d5 as m,d6 as h,d7 as p,d8 as k,d9 as x,a0 as j,ap as y,cf as f,da as T,cV as b,db as S,dc as C,dd as w,B as I,t as v,h as P,y as L}from"./index-BNhpMj6K.js";import{c as F}from"./vendor-BcjG7WjF.js";import{A as z}from"./Add-V6havsjn.js";import{F as E,D as _}from"./Table-R-tYCrOm.js";import{R as A}from"./DeleteOutlined-Bb5lE5WY.js";import{s as O}from"./index-BXbGKirB.js";import{S as K}from"./Pagination-ZXHhTthY.js";import{S as B}from"./index-B6dBhLgq.js";const $=({title:r,open:l,onClose:o,examiner:d})=>{const[c]=e.useForm(),[u,{data:g,error:m,isLoading:h,isSuccess:p}]=a();return F.useEffect(()=>{l&&(c.resetFields(),d&&c.setFieldsValue({name:d.name}))},[l,d]),F.useEffect(()=>{p&&(t.success(g.message),c.resetFields(),o()),m&&t.error(m.data.message)},[g,m,p]),i.jsx(n,{title:r,open:l,onCancel:o,okText:"Simpan",cancelText:"Tutup",loading:h,confirmLoading:h,onOk:()=>c.submit(),children:i.jsx(e,{layout:"vertical",form:c,onFinish:e=>{if(d){const a={id:d.id,...e};u(a)}else u(e)},children:i.jsx(e.Item,{name:"name",label:"Nama Penguji",rules:[{required:!0,message:"Nama Penguji wajib diisi"}],children:i.jsx(s,{placeholder:"Nama Penguji"})})})})},H=()=>{const[e,a]=F.useState(1),[n,c]=F.useState(10),[u,g]=F.useState(""),[m,h]=F.useState(""),[p,k]=F.useState(!1),[x,j]=F.useState(""),{data:y,isLoading:f}=r({page:e,limit:n,search:m}),[T,{data:b,isLoading:S,error:C,isSuccess:w,reset:I}]=l();F.useEffect(()=>{const e=setTimeout(()=>{h(u),a(1)},500);return()=>clearTimeout(e)},[u]),F.useEffect(()=>{w&&(t.success(b.message),I()),C&&(t.error(C.data.message),I())},[b,C,w]);const v=[{title:"No",key:"no",render:(a,t,i)=>(e-1)*n+i+1},{title:"Penguji",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",width:120,align:"center",render:(e,a)=>i.jsx(_.Button,{menu:{items:[{key:"edit",label:"Edit",icon:i.jsx(d,{})},{key:"delete",label:"Hapus",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"edit":j(e),k(!0);break;case"delete":confirm({title:`Anda yakin ingin menghapus ${e.name}?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>T(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(o,{vertical:!0,gap:"middle",children:[i.jsxs(o,{align:"center",justify:"space-between",children:[i.jsx(s.Search,{style:{width:300},allowClear:!0,onChange:e=>g(e.target.value),placeholder:"Cari Penguji ..."}),i.jsx(z,{onClick:()=>k(!0)})]}),i.jsx(E,{columns:v,dataSource:y?.examiners,loading:f||S,rowKey:"id",pagination:{current:e,pageSize:n,total:y?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),c(t)}}}),i.jsx($,{title:x?"Edit Penguji":"Simpan Penguji",open:p,onClose:()=>{j(""),k(!1)},examiner:x})]})},N=({title:a,open:r,onClose:l,type:o})=>{const[d]=e.useForm(),[u,{data:g,error:m,isLoading:h,isSuccess:p}]=c();return F.useEffect(()=>{r&&(d.resetFields(),o&&d.setFieldsValue({name:o.name}))},[r,o]),F.useEffect(()=>{p&&(t.success(g.message),d.resetFields(),l()),m&&t.error(m.data.message)},[g,m,p]),i.jsx(n,{title:a,open:r,onCancel:l,okText:"Simpan",cancelText:"Tutup",loading:h,confirmLoading:h,onOk:()=>d.submit(),destroyOnHidden:!0,children:i.jsx(e,{layout:"vertical",form:d,onFinish:e=>{if(o){const a={id:o.id,...e};u(a)}else u(e)},children:i.jsx(e.Item,{name:"name",label:"Jenis Penilaian",rules:[{required:!0,message:"Wajib disisi"}],children:i.jsx(s,{placeholder:"Jenis Penilaian"})})})})},{confirm:D}=n,J=()=>{const[e,a]=F.useState(1),[n,r]=F.useState(10),[l,c]=F.useState(""),[m,h]=F.useState(""),[p,k]=F.useState(!1),[x,j]=F.useState(""),{data:y,isLoading:f}=u({page:e,limit:n,search:m}),[T,{data:b,isLoading:S,error:C,isSuccess:w,reset:I}]=g();F.useEffect(()=>{const e=setTimeout(()=>{h(l),a(1)},500);return()=>clearTimeout(e)},[l]),F.useEffect(()=>{w&&(t.success(b.message),I()),C&&(t.error(C.data.message),I())},[b,C,w]);const v=[{title:"No",key:"no",render:(a,t,i)=>(e-1)*n+i+1},{title:"Jenis Penilaian",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",width:120,align:"center",render:(e,a)=>i.jsx(_.Button,{menu:{items:[{key:"edit",label:"Edit",icon:i.jsx(d,{})},{key:"delete",label:"Hapus",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"edit":j(e),k(!0);break;case"delete":D({title:`Anda yakin ingin menghapus ${e.name}?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>T(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(o,{vertical:!0,gap:"middle",children:[i.jsxs(o,{align:"center",justify:"space-between",children:[i.jsx(s.Search,{style:{width:300},allowClear:!0,onChange:e=>c(e.target.value),placeholder:"Cari Penguji ..."}),i.jsx(z,{onClick:()=>k(!0)})]}),i.jsx(E,{columns:v,dataSource:y?.types,loading:f||S,rowKey:"id",pagination:{current:e,pageSize:n,total:y?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),r(t)}}}),i.jsx(N,{title:x?"Edit Penguji":"Simpan Penguji",open:p,onClose:()=>{j(""),k(!1)},type:x})]})},q=({open:a,onClose:r,detail:l})=>{const[o]=e.useForm(),[d,{isLoading:c}]=m();F.useEffect(()=>{a&&(l?o.setFieldsValue(l):o.resetFields())},[a,l,o]);return i.jsx(n,{title:l?"Edit Kategori Penilaian":"Tambah Kategori Penilaian",open:a,onCancel:r,okText:"Simpan",cancelText:"Batal",confirmLoading:c,onOk:()=>o.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:o,onFinish:async e=>{const a=l?{...e,id:l.id}:e;try{const e=await d(a).unwrap();t.success(e.message),r()}catch(i){O.error({message:"Gagal Menyimpan Kategori",description:i.data?.message||"Terjadi kesalahan pada server."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"id",hidden:!0,children:i.jsx(s,{})}),i.jsx(e.Item,{name:"name",label:"Nama Kategori",rules:[{required:!0,message:"Nama kategori tidak boleh kosong!"}],children:i.jsx(s,{placeholder:"Contoh: Tajwid, Kelancaran, Adab"})})]})})},M=({open:a,onClose:r,detail:l,category:o})=>{const[d]=e.useForm(),{data:c,isLoading:u}=h({page:"",limit:"",search:""}),[g,{isLoading:m}]=p(),k=c?.categories?.map(e=>({label:e.name,value:e.id}));F.useEffect(()=>{a&&(l?d.setFieldsValue({id:l.id,name:l.name,categoryId:l.category_id}):(d.resetFields(),o&&d.setFieldsValue({categoryId:o.id})))},[a,l,o,d]);return i.jsx(n,{title:l?"Edit Indikator":"Tambah Indikator",open:a,onCancel:r,okText:"Simpan",cancelText:"Batal",confirmLoading:m,onOk:()=>d.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:d,onFinish:async e=>{const a=l?{...e,id:l.id}:e;try{const e=await g(a).unwrap();t.success(e.message),r()}catch(i){O.error({message:"Gagal Menyimpan Indikator",description:i.data?.message||"Terjadi kesalahan pada server."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"id",hidden:!0,children:i.jsx(s,{})}),i.jsx(e.Item,{name:"categoryId",label:"Kategori Penilaian",rules:[{required:!0,message:"Silakan pilih kategori!"}],children:i.jsx(K,{showSearch:!0,placeholder:"Pilih Kategori",options:k,loading:u,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})}),i.jsx(e.Item,{name:"name",label:"Nama Indikator",rules:[{required:!0,message:"Nama indikator tidak boleh kosong!"}],children:i.jsx(s,{placeholder:"Contoh: Ketuk, Tuntun, Ulang"})})]})})},V=()=>{const[e,a]=F.useState(1),[r,l]=F.useState(10),[c,u]=F.useState(""),[g,m]=F.useState(""),[p,T]=F.useState(!1),[b,S]=F.useState(null),[C,w]=F.useState(!1),[I,v]=F.useState(null),{data:P,isLoading:L,refetch:O}=h({page:e,limit:r,search:g}),[K,{isLoading:$,isSuccess:H,error:N}]=k(),[D,{isLoading:J,isSuccess:V,error:G}]=x();F.useEffect(()=>{const e=setTimeout(()=>{m(c),a(1)},500);return()=>clearTimeout(e)},[c]),F.useEffect(()=>{(H||V)&&(t.success("Data berhasil dihapus."),O()),(N||G)&&t.error(N?.data?.message||G?.data?.message||"Gagal menghapus data.")},[H,V,N,G,O]);const Y=[{title:"No",key:"no",width:70,render:(a,t,i)=>(e-1)*r+i+1},{title:"Kategori Penilaian",dataIndex:"name",key:"name"},{title:"Indikator Penilaian",dataIndex:"indicators",key:"indicators",render:(e,a)=>i.jsx(B,{wrap:!0,children:Array.isArray(e)&&e.filter(e=>e).map(e=>i.jsxs(j,{closable:!0,onClose:()=>{return a=e,void n.confirm({title:`Anda yakin ingin menghapus indikator "${a.name}"?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>D(a.id)});var a},style:{display:"flex",alignItems:"center",padding:"4px 8px",margin:"2px"},children:[e.name,i.jsx(y,{title:"Edit Indikator",children:i.jsx(d,{style:{marginLeft:8,cursor:"pointer",color:"#1890ff"},onClick:()=>{return t=e,S(a),v(t),void w(!0);var t}})})]},e.id))})},{title:"Aksi",key:"action",width:150,align:"center",render:(e,a)=>i.jsx(_.Button,{menu:{items:[{key:"add_indicator",label:"Tambah Indikator",icon:i.jsx(f,{})},{key:"edit_category",label:"Edit Kategori",icon:i.jsx(d,{})},{key:"delete_category",label:"Hapus Kategori",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"add_indicator":S(e),v(null),w(!0),t.info(`Menambahkan indikator untuk kategori: ${e.name}`);break;case"edit_category":S(e),T(!0);break;case"delete_category":n.confirm({title:`Anda yakin ingin menghapus kategori "${e.name}"?`,content:"Semua indikator di dalamnya juga akan terhapus.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>K(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(o,{vertical:!0,gap:"middle",children:[i.jsxs(o,{align:"center",justify:"space-between",children:[i.jsx(s.Search,{style:{width:300},placeholder:"Cari Kategori atau Indikator...",allowClear:!0,value:c,onChange:e=>u(e.target.value)}),i.jsx(z,{onClick:()=>{S(null),T(!0)},children:"Tambah Kategori"})]}),i.jsx(E,{columns:Y,dataSource:P?.categories,loading:L||$||J,rowKey:"id",bordered:!0,pagination:{current:e,pageSize:r,total:P?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),l(t)}}}),i.jsx(q,{open:p,onClose:()=>T(!1),detail:b}),i.jsx(M,{open:C,onClose:()=>w(!1),detail:I,category:b})]})},G=({open:a,onClose:s})=>{const[r]=e.useForm(),{data:l,isLoading:o}=T(),{data:d,isLoading:c}=b({page:"",limit:"",search:""}),[u,{isLoading:g}]=S(),m=l?.map(e=>({label:e.name,value:e.id})),h=d?.map(e=>({label:e.name,value:e.id}));F.useEffect(()=>{a&&r.resetFields()},[a]);return i.jsx(n,{title:"Tambah Target Hafalan Baru",open:a,onCancel:s,okText:"Simpan Semua",cancelText:"Batal",confirmLoading:g,onOk:()=>r.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:r,onFinish:async e=>{const{grade_id:a,juz_ids:i}=e,n=i.map(e=>({gradeId:a,juzId:e})).map(e=>u(e).unwrap());try{await Promise.all(n),t.success(`Berhasil menambahkan ${n.length} target hafalan baru.`),s()}catch(r){O.error({message:"Gagal Menyimpan Target",description:r.data?.message||"Terjadi kesalahan saat menyimpan salah satu target."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"grade_id",label:"Tingkat",rules:[{required:!0,message:"Silakan pilih tingkat!"}],children:i.jsx(K,{placeholder:"Pilih Tingkat",options:m,loading:o,virtual:!1})}),i.jsx(e.Item,{name:"juz_ids",label:"Juz yang Ditargetkan",rules:[{required:!0,message:"Silakan pilih minimal satu juz!"}],children:i.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Pilih satu atau lebih juz",options:h,loading:c,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),virtual:!1})})]})})},{Title:Y,Text:R}=v,U=()=>{const[e,a]=F.useState(!1),{data:s,isLoading:r,refetch:l}=C(),[d,{isLoading:c,isSuccess:u,error:g}]=w();F.useEffect(()=>{u&&(t.success("Target berhasil dihapus."),l()),g&&t.error(g.data?.message||"Gagal menghapus target.")},[u,g,l]);return i.jsxs(o,{vertical:!0,gap:"large",children:[i.jsx(o,{justify:"end",align:"center",children:i.jsx(I,{type:"primary",icon:i.jsx(f,{}),onClick:()=>a(!0),children:"Tambah Target"})}),i.jsx(E,{columns:[{title:"No",key:"no",render:(e,a,t)=>t+1,width:70},{title:"Tingkat",dataIndex:"grade",key:"grade"},{title:"Total Ayat",dataIndex:"total_ayat",key:"total_ayat",align:"center"},{title:"Total Baris",dataIndex:"total_line",key:"total_line",align:"center"}],dataSource:s,rowKey:"grade",loading:r||c,expandable:{expandedRowRender:e=>{const a=[{title:"Juz",dataIndex:"juz",key:"juz"},{title:"Jumlah Ayat",dataIndex:"total_ayat",key:"total_ayat",align:"center"},{title:"Jumlah Baris",dataIndex:"total_line",key:"total_line",align:"center"},{title:"Aksi",key:"action",align:"center",render:(a,t)=>i.jsx(I,{type:"primary",danger:!0,icon:i.jsx(A,{}),onClick:()=>{return a=t.target_id,i=e.grade,s=t.juz,void n.confirm({title:"Hapus Target?",content:`Anda yakin ingin menghapus target ${s} dari tingkat ${i}?`,okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>d(a)});var a,i,s},children:"Hapus"})}];return i.jsx(E,{columns:a,dataSource:e.target,rowKey:"target_id",pagination:!1})}},pagination:!1,bordered:!0,title:()=>i.jsx(R,{strong:!0,children:"Daftar Target Berdasarkan Tingkat"})}),i.jsx(G,{open:e,onClose:()=>{a(!1),l()}})]})},W=()=>{const e=[{label:"Penguji",key:"1",children:i.jsx(H,{})},{label:"Jenis Penilaian",key:"2",children:i.jsx(J,{})},{label:"Indikator Penilaian",key:"3",children:i.jsx(V,{})},{label:"Target",key:"4",children:i.jsx(U,{})}];return i.jsx(P,{title:"Managemen Penilaian Tahfiz",levels:["tahfiz"],children:i.jsxs(o,{vertical:!0,gap:"small",children:[i.jsx(v.Title,{style:{margin:0},level:5,children:"Managemen Penilaian"}),i.jsx(L,{centered:!0,items:e,defaultActiveKey:"1"})]})})};export{W as default};
