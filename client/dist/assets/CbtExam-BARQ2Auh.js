import{d as P,r as h,X as U,$ as B,a0 as L,j as e,e as S,a1 as H,a2 as A,a3 as F}from"./index-Bkq01jzn.js";import{S as G}from"./react-select.esm-DldCcTPv.js";import{T as Q}from"./Table-BJdfPgdp.js";const K=({detail:n,setDetail:p})=>{var k;const{user:i}=P(s=>s.auth),g={examid:"",teacher:(i==null?void 0:i.id)||"",bank:[],name:"",duration:"",classes:[],token:"",isshuffle:"",mc_score:"",essay_score:""},[l,r]=h.useState(g),{data:o}=U(),{data:b}=B(),[C,{isSuccess:m,isLoading:E,isError:N,reset:y}]=L(),x=o==null?void 0:o.map(s=>({value:s.id,label:s.name,bank:s.bank})),j=(i==null?void 0:i.level)==="teacher"?o==null?void 0:o.find(s=>s.id===i.id):o==null?void 0:o.find(s=>s.id===l.teacher),d=(k=j==null?void 0:j.bank)==null?void 0:k.map(s=>({value:s.id,label:s.name,type:s.type})),_=b==null?void 0:b.map(s=>({value:s.id,label:s.name}));h.useEffect(()=>{n!=null&&n.id?r({examid:n.id,teacher:n.teacher,name:n.name,duration:n.duration,token:n.token,isshuffle:n.isshuffle,mc_score:n.mc_score,essay_score:n.essay_score,bank:n.banks.map(s=>({bankid:s.id,type:s.type,pg:s.pg,essay:s.essay})),classes:n.classes.map(s=>({value:s.id,label:s.name}))}):(i==null?void 0:i.level)==="teacher"&&r(s=>({...s,teacher:i.id}))},[n,i]);const w=s=>{r(a=>({...a,teacher:(s==null?void 0:s.value)||null,bank:[]}))},v=s=>{const a=(s==null?void 0:s.map(t=>({bankid:t.value,type:t.type,pg:"",essay:""})))||[];r(t=>({...t,bank:a}))},f=(s,a,t)=>{const{value:u}=s.target;r(c=>({...c,bank:c.bank.map(M=>M.bankid===a?{...M,[t]:u}:M)}))},T=s=>{r(a=>({...a,classes:s||[]}))},$=s=>{s.preventDefault(),S.promise(C(l).unwrap().then(a=>a.message),{loading:"Memuat data...",success:a=>a,error:a=>a.data.message})},D=()=>{p({}),r({...g,teacher:""})};return h.useEffect(()=>{m&&(p({}),r({...g,teacher:""}),y()),N&&y()},[m,N]),e.jsxs("form",{onSubmit:$,className:"rounded p-2 border bg-white d-flex flex-column gap-2",children:[e.jsx("p",{className:"m-0 h6",children:n!=null&&n.id?"Edit Ujian":"Tambah Ujian"}),e.jsx(G,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(x==null?void 0:x.find(s=>s.value===l.teacher))||null,options:x,onChange:w,isDisabled:!!(n!=null&&n.id)}),e.jsx(G,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Pilih Bank Soal",value:d==null?void 0:d.filter(s=>l.bank.some(a=>a.bankid===s.value)),options:d,onChange:v,isDisabled:!l.teacher||!!(n!=null&&n.id)}),l.bank.filter(s=>s.type==="bank").map(s=>{var a,t,u;return e.jsxs("div",{className:"border p-2 rounded",children:[e.jsx("p",{className:"m-0",children:((a=d==null?void 0:d.find(c=>c.value===s.bankid))==null?void 0:a.label)||((u=(t=n==null?void 0:n.banks)==null?void 0:t.find(c=>c.id===s.bankid))==null?void 0:u.name)}),e.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal PG ",value:s.pg,onChange:c=>f(c,s.bankid,"pg")}),e.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal Essay ",value:s.essay,onChange:c=>f(c,s.bankid,"essay")})]},s.bankid)}),e.jsx(G,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Untuk Kelas",value:l.classes,options:_,onChange:T}),e.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Ujian",value:l.name||"",onChange:s=>r({...l,name:s.target.value})}),e.jsx("input",{type:"number",name:"duration",className:"form-control",placeholder:"Durasi",value:l.duration||"",onChange:s=>r({...l,duration:s.target.value})}),e.jsx("input",{type:"number",name:"mc_score",id:"mc_score",className:"form-control",placeholder:"Persentase Nilai PG",value:l.mc_score,onChange:s=>r({...l,mc_score:s.target.value})}),e.jsx("input",{type:"number",name:"essay_score",id:"essay_score",className:"form-control",placeholder:"Persentase Nilai Essay",value:l.essay_score,onChange:s=>r({...l,essay_score:s.target.value})}),e.jsxs("select",{name:"isshuffle",className:"form-control",value:l.isshuffle,onChange:s=>r({...l,isshuffle:s.target.value}),children:[e.jsx("option",{value:"",hidden:!0,children:"Acak Soal"}),e.jsx("option",{value:!0,children:"Ya"}),e.jsx("option",{value:!1,children:"Tidak"})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:D,children:"Batal"}),e.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:E,children:n!=null&&n.id?"Update":"Simpan"})]})]})},Y=({setDetail:n})=>{const[p,i]=h.useState(1),[g,l]=h.useState(10),[r,o]=h.useState(""),{data:b={},isLoading:C}=H({page:p,limit:g,search:r}),{exams:m=[],totalData:E,totalPages:N}=b,[y,{isSuccess:x,isLoading:j,isError:d,reset:_}]=A(),[w,{isSuccess:v,isError:f,reset:T}]=F(),$=a=>{S.promise(y(a).unwrap().then(t=>t.message),{loading:"Memproses...",success:t=>t,error:t=>t.data.message})},D=a=>{S.promise(w(a).unwrap().then(t=>t.message),{loading:"Memproses...",success:t=>t,error:t=>t.data.message})},k=a=>{navigator.clipboard.writeText(a),S.success("Token berhasil disalin")},s=(a,t,u)=>{const c=a.toUpperCase().replace(/ /g,"-");window.open(`/laporan-ujian/${c}/${t}/${u}`,"_blank")};return h.useEffect(()=>{(x||d)&&_()},[x,d]),h.useEffect(()=>{(v||f)&&T()},[v,f]),e.jsx(Q,{page:p,setPage:i,setLimit:l,setSearch:o,totalData:E,totalPages:N,isLoading:C,children:e.jsxs("table",{className:"table table-striped table-bordered table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"Guru"}),e.jsx("th",{className:"text-center",children:"Bank Soal"}),e.jsx("th",{className:"text-center",children:"Nama Ujian"}),e.jsx("th",{className:"text-center",children:"PG"}),e.jsx("th",{className:"text-center",children:"Essay"}),e.jsx("th",{className:"text-center",children:"Kelas"}),e.jsx("th",{className:"text-center",children:"Acak Soal"}),e.jsx("th",{className:"text-center",children:"Durasi"}),e.jsx("th",{className:"text-center",children:"Status"}),e.jsx("th",{className:"text-center",children:"Token"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(m==null?void 0:m.length)>0?m==null?void 0:m.map((a,t)=>{var u;return e.jsxs("tr",{children:[e.jsx("td",{className:"align-middle",children:a.teacher_name}),e.jsx("td",{className:"align-middle",children:a.banks.map(c=>e.jsx("p",{className:"m-0",children:c.type!=="paket"?`${c.name} - PG ${c.pg} - Essay ${c.essay}`:`${c.name}`},c.id))}),e.jsx("td",{className:"align-middle",children:a.name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-success",children:`${a.mc_score}%`})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-success",children:`${a.essay_score}%`})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("div",{style:{width:100},className:"d-flex align-items-center justify-content-center flex-wrap gap-2",children:(u=a.classes)==null?void 0:u.map(c=>e.jsx("p",{className:"m-0 badge bg-primary",children:c.name},c.id))})}),e.jsx("td",{className:"text-center align-middle",children:a.isshuffle?e.jsx("p",{className:"m-0 badge bg-success",children:"Ya"}):e.jsx("p",{className:"m-0 badge bg-danger",children:"Tidak"})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-primary",children:`${a.duration} Menit`})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("div",{className:"form-check form-switch pointer d-flex justify-content-center",onClick:()=>D(a.id),children:e.jsx("input",{className:"form-check-input bg-success",type:"checkbox",id:"flexSwitchCheckChecked",checked:a.isactive,readOnly:!0})})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("p",{className:"m-0 badge bg-secondary pointer","data-toggle":"tooltip","data-placement":"top",title:"Copy Token",onClick:()=>k(a.token),children:a.token})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>s(a.name,a.id,a.token),children:e.jsx("i",{className:"bi bi-people"})}),e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>n(a),children:e.jsx("i",{className:"bi bi-pencil-square"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:j,onClick:()=>$(a.id),children:e.jsx("i",{className:"bi bi-folder-x"})})]})})]},t)}):e.jsx("tr",{children:e.jsx("td",{colSpan:11,children:"Data belum tersedia"})})})]})})},X=()=>{const[n,p]=h.useState(null);return e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-2",children:e.jsx(K,{detail:n,setDetail:p})}),e.jsx("div",{className:"col-lg-10",children:e.jsx(Y,{setDetail:p})})]})};export{X as C};
