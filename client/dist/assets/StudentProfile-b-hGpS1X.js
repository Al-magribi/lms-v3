import{a as s,b as e,aT as a,a1 as l,s as i,V as n,j as r}from"./index-DFhdulld.js";import{b as d}from"./vendor-CnnDPxwB.js";import{L as o}from"./Layout-GZnRoUIy.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const c=()=>{var c;const m=s(),{user:t}=e((s=>s.auth)),[h,b]=d.useState(!1),[x,j]=d.useState({oldPassword:!1,newPassword:!1,confirmPassword:!1}),[u,w]=d.useState({name:"",email:"",phone:"",oldPassword:"",newPassword:"",confirmPassword:""}),[N,{isLoading:p,isSuccess:v,isError:f,reset:P}]=a(),[g]=l(),y=s=>{const{name:e,value:a}=s.target;if("phone"===e){const s=a.replace(/\D/g,""),l=s.startsWith("0")?"62"+s.substring(1):s;w((s=>({...s,[e]:l})))}else w((s=>({...s,[e]:a})))},k=s=>{if(s.preventDefault(),u.newPassword||u.confirmPassword||u.oldPassword){if(u.newPassword!==u.confirmPassword)return void n.error("Password baru tidak cocok!");if(!u.oldPassword)return void n.error("Password lama harus diisi!")}const e={name:u.name,email:u.email,phone:u.phone};u.newPassword&&(e.oldPassword=u.oldPassword,e.newPassword=u.newPassword),n.promise(N(e).unwrap().then((s=>s.message)),{loading:"Memperbarui profil...",success:s=>s,error:s=>s.data.message})},S=s=>{j((e=>({...e,[s]:!e[s]})))};return d.useEffect((()=>{v&&(w({name:"",email:"",phone:"",oldPassword:"",newPassword:"",confirmPassword:""}),b(!1),P(),g().unwrap().then((s=>{m(i(s))})).catch((s=>{n.error("Gagal memuat data pengguna"),console.error("Error: ",s)}))),f&&P()}),[v,f,m,g,P]),d.useEffect((()=>{t&&w({name:(null==t?void 0:t.name)||"",email:(null==t?void 0:t.email)||"",phone:(null==t?void 0:t.phone)||"",oldPassword:"",newPassword:"",confirmPassword:""})}),[t]),r.jsx(o,{title:"Profile",levels:["student"],children:r.jsx("div",{className:"container-fluid",children:r.jsxs("div",{className:"row justify-content-center",children:[r.jsx("div",{className:"col-md-6 col-12",children:r.jsxs("div",{className:"card mb-4",children:[r.jsxs("div",{className:"card-header py-3 d-flex justify-content-between align-items-center",children:[r.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Profil Siswa"}),r.jsx("button",{className:"btn btn-sm "+(h?"btn-danger":"btn-primary"),onClick:()=>b(!h),children:h?r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-x-circle me-1"}),"Batal"]}):r.jsxs(r.Fragment,{children:[r.jsx("i",{className:"bi bi-pencil me-1"}),"Edit Profil"]})})]}),r.jsxs("div",{className:"card-body",children:[r.jsxs("div",{className:"row mb-4",children:[r.jsx("div",{className:"col-md-4 d-flex justify-content-center align-items-center",children:r.jsx("div",{className:"rounded-circle bg-primary text-white d-flex justify-content-center align-items-center",style:{width:"150px",height:"150px"},children:r.jsx("span",{style:{fontSize:"3rem"},children:null==(c=null==t?void 0:t.name)?void 0:c.charAt(0)})})}),r.jsx("div",{className:"col-md-8",children:h?r.jsxs("form",{onSubmit:k,children:[r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Nama"}),r.jsx("input",{type:"text",className:"form-control",name:"name",value:u.name,onChange:y,required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Email"}),r.jsx("input",{type:"email",className:"form-control",name:"email",value:u.email,onChange:y,required:!0})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"No. Telepon"}),r.jsx("input",{type:"tel",className:"form-control",name:"phone",value:u.phone,onChange:y,required:!0})]}),r.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?"Menyimpan...":"Simpan Perubahan"})]}):r.jsxs(r.Fragment,{children:[r.jsx("h3",{className:"mb-3",children:null==t?void 0:t.name}),r.jsxs("div",{className:"mb-2",children:[r.jsxs("span",{className:"badge bg-success me-2",children:[r.jsx("i",{className:"bi bi-person me-1"}),null==t?void 0:t.level]}),r.jsxs("span",{className:"badge bg-info me-2",children:[r.jsx("i",{className:"bi bi-card-text me-1"}),"NIS: ",null==t?void 0:t.nis]}),(null==t?void 0:t.isactive)?r.jsxs("span",{className:"badge bg-success",children:[r.jsx("i",{className:"bi bi-check-circle me-1"}),"Aktif"]}):r.jsxs("span",{className:"badge bg-danger",children:[r.jsx("i",{className:"bi bi-x-circle me-1"}),"Nonaktif"]})]})]})})]}),!h&&r.jsxs("div",{className:"student-info",children:[r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"Sekolah"}),r.jsx("div",{className:"col-md-8",children:null==t?void 0:t.homebase})]}),r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"Kelas"}),r.jsx("div",{className:"col-md-8",children:null==t?void 0:t.class})]}),r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"Tingkat"}),r.jsx("div",{className:"col-md-8",children:null==t?void 0:t.grade})]}),r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"Periode"}),r.jsxs("div",{className:"col-md-8",children:[null==t?void 0:t.periode_name,(null==t?void 0:t.periode_active)&&r.jsx("span",{className:"badge bg-success ms-2",children:"Aktif"})]})]}),r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"Email"}),r.jsx("div",{className:"col-md-8",children:null==t?void 0:t.email})]}),r.jsxs("div",{className:"row mb-2",children:[r.jsx("div",{className:"col-md-4 fw-bold",children:"No. Telepon"}),r.jsx("div",{className:"col-md-8",children:null==t?void 0:t.phone})]})]})]})]})}),r.jsx("div",{className:"col-md-6 col-12",children:r.jsxs("div",{className:"card mb-4",children:[r.jsx("div",{className:"card-header py-3",children:r.jsx("h6",{className:"m-0 font-weight-bold text-primary",children:"Ubah Password"})}),r.jsx("div",{className:"card-body",children:r.jsxs("form",{onSubmit:k,children:[r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Password Lama"}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:x.oldPassword?"text":"password",className:"form-control",name:"oldPassword",value:u.oldPassword,onChange:y}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S("oldPassword"),children:r.jsx("i",{className:"bi bi-eye"+(x.oldPassword?"-slash":"")})})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Password Baru"}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:x.newPassword?"text":"password",className:"form-control",name:"newPassword",value:u.newPassword,onChange:y}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S("newPassword"),children:r.jsx("i",{className:"bi bi-eye"+(x.newPassword?"-slash":"")})})]})]}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Konfirmasi Password Baru"}),r.jsxs("div",{className:"input-group",children:[r.jsx("input",{type:x.confirmPassword?"text":"password",className:"form-control",name:"confirmPassword",value:u.confirmPassword,onChange:y}),r.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>S("confirmPassword"),children:r.jsx("i",{className:"bi bi-eye"+(x.confirmPassword?"-slash":"")})})]})]}),r.jsx("button",{type:"submit",className:"btn btn-primary",disabled:p,children:p?"Menyimpan...":"Ubah Password"})]})})]})})]})})})};export{c as default};
//# sourceMappingURL=StudentProfile-b-hGpS1X.js.map
