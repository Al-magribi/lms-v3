import{A as e,G as s,j as a,d as t,H as n,I as l,V as r,J as i}from"./index-Co1WScRM.js";import{b as d,u as c}from"./vendor-CpHG0K6b.js";import{L as m}from"./Layout-PxPEb2Rf.js";import{T as o}from"./Table-BwrxRiOQ.js";import{r as u,u as h}from"./xlsx-B4fPQ8kA.js";const x=[{id:"nis",name:"nis",placeholder:"NIS"},{id:"name",name:"name",placeholder:"Name"}],p=({detail:n,setDetail:l})=>{const[r,i]=d.useState({id:"",entry:"",nis:"",name:"",gender:""}),{data:c}=e({page:"",limit:"",search:""}),[m,{isSuccess:o,isLoading:u,isError:h,reset:p}]=s(),j=e=>{const{name:s,value:a}=e.target;i((e=>({...e,[s]:a})))};return d.useEffect((()=>{o&&(p(),l({}),i({id:"",entry:"",nis:"",name:"",gender:""})),h&&p()}),[o,h]),d.useEffect((()=>{n&&i({id:n.id,entry:n.entry_id,name:n.name,nis:n.nis,gender:n.gender})}),[n]),a.jsxs("form",{onSubmit:e=>{e.preventDefault(),t.promise(m(r).unwrap().then((e=>e.message)),{loading:"Menyimpan Data...",success:e=>e,error:e=>e.data.message})},className:"p-2 bg-white rounded border d-flex flex-column gap-2",children:[a.jsx("p",{className:"m-0 h6",children:"Siswa"}),a.jsxs("select",{name:"entry",id:"entry",className:"form-select",value:r.entry,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Tahun Masuk"}),null==c?void 0:c.map((e=>a.jsx("option",{value:e.id,children:e.name},e.id)))]}),null==x?void 0:x.map(((e,s)=>a.jsx("input",{type:"text",className:"form-control",placeholder:e.placeholder,name:e.name,id:e.name,value:r[e.name],onChange:j},s))),a.jsxs("select",{name:"gender",id:"gender",className:"form-select",value:r.gender,onChange:j,children:[a.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),a.jsx("option",{value:"L",children:"Laki Laki"}),a.jsx("option",{value:"P",children:"Perempuan"})]}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:()=>{l({}),i({id:"",entry:"",nis:"",name:"",gender:""})},children:"Batal"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:u,children:"Simpan"})]})]})},j=({setDetail:e})=>{c();const[s,t]=d.useState(1),[i,m]=d.useState(10),[u,h]=d.useState(""),{data:x={},isLoading:p}=n({page:s,limit:i,search:u}),{students:j=[],totalData:g,totalPages:b}=x,[N,{isSuccess:f,isLoading:y,isError:v,reset:S}]=l();return d.useEffect((()=>{f&&S(),v&&S()}),[f,v]),a.jsx(o,{page:s,setPage:t,setLimit:m,setSearch:h,totalData:g,totalPages:b,isLoading:p,children:a.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsx("th",{className:"text-center",children:"No"}),a.jsx("th",{className:"text-center",children:"Satuan"}),a.jsx("th",{className:"text-center",children:"Tahun Masuk"}),a.jsx("th",{className:"text-center",children:"NIS"}),a.jsx("th",{className:"text-center",children:"Nama"}),a.jsx("th",{className:"text-center",children:"Kelamin"}),a.jsx("th",{className:"text-center",children:"Aksi"})]})}),a.jsx("tbody",{children:null==j?void 0:j.map(((t,n)=>a.jsxs("tr",{children:[a.jsx("td",{className:"text-center align-middle",children:(s-1)*i+n+1}),a.jsx("td",{className:"text-center align-middle",children:t.homebase}),a.jsx("td",{className:"text-center align-middle",children:t.entry}),a.jsx("td",{className:"text-center align-middle",children:t.nis}),a.jsx("td",{className:"align-middle",children:t.name}),a.jsx("td",{className:"text-center align-middle",children:"L"===t.gender?"Laki - Laki":"Perempuan"}),a.jsx("td",{className:"text-cente align-middle",children:a.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[a.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(t),children:a.jsx("i",{className:"bi bi-pencil-square"})}),a.jsx("button",{className:"btn btn-sm btn-danger",disabled:y,onClick:()=>{return e=t.id,void r.promise(N(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message});var e},children:a.jsx("i",{className:"bi bi-person-x-fill"})})]})})]},n)))})]})})},g=()=>{const[e,s]=d.useState(null),n=d.useRef(null),[l,{isSuccess:r,isLoading:c,isError:m,reset:o}]=i();return d.useEffect((()=>{r&&(n.current.value=null,o()),m&&(o(),n.current.value=null)}),[r,m]),a.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=u(s,{type:"array"}),n=a.SheetNames[0],r=a.Sheets[n],i=h.sheet_to_json(r,{header:1,range:1}).map((e=>{const[s,a,t,n]=e;return[s,a,t,n]})).filter((e=>e.every((e=>null!=e)))),d=Array.isArray(i)?i:[i];t.promise(l(d).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[a.jsx("p",{className:"m-0 h6",children:"Upload Siswa"}),a.jsx("input",{ref:n,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0])}),a.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[a.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_siswa.xlsx","_blank")},children:"Template"}),a.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:c,children:"Upload Data"})]})]})},b=()=>{const[e,s]=d.useState("");return a.jsx(m,{title:"Siswa",levels:["admin"],children:a.jsxs("div",{className:"row g-2",children:[a.jsxs("div",{className:"col-lg-3 col-12",children:[a.jsx(p,{detail:e,setDetail:s}),a.jsx(g,{})]}),a.jsx("div",{className:"col-lg-9 col-12",children:a.jsx(j,{setDetail:s})})]})})};export{b as default};
//# sourceMappingURL=AdminStudents-BQluVOHN.js.map
