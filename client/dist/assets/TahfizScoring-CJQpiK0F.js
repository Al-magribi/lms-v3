import{l as e,cT as a,s as t,j as i,I as n,cU as s,cV as r,F as l,n as o,cW as d,cX as c,cY as u,cZ as g,c_ as m,c$ as h,d0 as p,d1 as k,$ as x,an as j,c9 as y,d2 as f,cO as T,d3 as b,d4 as S,d5 as C,B as w,r as I,h as v,x as P}from"./index-DgKTJYPj.js";import{c as L}from"./vendor-DTs43g_X.js";import{A as F}from"./Add-CDW3IAik.js";import{M as E}from"./index-CX7GIQLb.js";import{F as _,D as z}from"./Table-ClF3X7K8.js";import{R as A}from"./DeleteOutlined-BDamtBNP.js";import{s as O}from"./index-DnP7MKxY.js";import{S as K}from"./Pagination-DupnkXEC.js";import{S as $}from"./index-B1LVMQTc.js";const B=({title:s,open:r,onClose:l,examiner:o})=>{const[d]=e.useForm(),[c,{data:u,error:g,isLoading:m,isSuccess:h}]=a();return L.useEffect(()=>{r&&(d.resetFields(),o&&d.setFieldsValue({name:o.name}))},[r,o]),L.useEffect(()=>{h&&(t.success(u.message),d.resetFields(),l()),g&&t.error(g.data.message)},[u,g,h]),i.jsx(E,{title:s,open:r,onCancel:l,okText:"Simpan",cancelText:"Tutup",loading:m,confirmLoading:m,onOk:()=>d.submit(),children:i.jsx(e,{layout:"vertical",form:d,onFinish:e=>{if(o){const a={id:o.id,...e};c(a)}else c(e)},children:i.jsx(e.Item,{name:"name",label:"Nama Penguji",rules:[{required:!0,message:"Nama Penguji wajib diisi"}],children:i.jsx(n,{placeholder:"Nama Penguji"})})})})},H=()=>{const[e,a]=L.useState(1),[d,c]=L.useState(10),[u,g]=L.useState(""),[m,h]=L.useState(""),[p,k]=L.useState(!1),[x,j]=L.useState(""),{data:y,isLoading:f}=s({page:e,limit:d,search:m}),[T,{data:b,isLoading:S,error:C,isSuccess:w,reset:I}]=r();L.useEffect(()=>{const e=setTimeout(()=>{h(u),a(1)},500);return()=>clearTimeout(e)},[u]),L.useEffect(()=>{w&&(t.success(b.message),I()),C&&(t.error(C.data.message),I())},[b,C,w]);const v=[{title:"No",key:"no",render:(a,t,i)=>(e-1)*d+i+1},{title:"Penguji",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",width:120,align:"center",render:(e,a)=>i.jsx(z.Button,{menu:{items:[{key:"edit",label:"Edit",icon:i.jsx(o,{})},{key:"delete",label:"Hapus",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"edit":j(e),k(!0);break;case"delete":confirm({title:`Anda yakin ingin menghapus ${e.name}?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>T(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(l,{vertical:!0,gap:"middle",children:[i.jsxs(l,{align:"center",justify:"space-between",children:[i.jsx(n.Search,{style:{width:300},allowClear:!0,onChange:e=>g(e.target.value),placeholder:"Cari Penguji ..."}),i.jsx(F,{onClick:()=>k(!0)})]}),i.jsx(_,{columns:v,dataSource:y?.examiners,loading:f||S,rowKey:"id",pagination:{current:e,pageSize:d,total:y?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),c(t)}}}),i.jsx(B,{title:x?"Edit Penguji":"Simpan Penguji",open:p,onClose:()=>{j(""),k(!1)},examiner:x})]})},N=({title:a,open:s,onClose:r,type:l})=>{const[o]=e.useForm(),[c,{data:u,error:g,isLoading:m,isSuccess:h}]=d();return L.useEffect(()=>{s&&(o.resetFields(),l&&o.setFieldsValue({name:l.name}))},[s,l]),L.useEffect(()=>{h&&(t.success(u.message),o.resetFields(),r()),g&&t.error(g.data.message)},[u,g,h]),i.jsx(E,{title:a,open:s,onCancel:r,okText:"Simpan",cancelText:"Tutup",loading:m,confirmLoading:m,onOk:()=>o.submit(),destroyOnHidden:!0,children:i.jsx(e,{layout:"vertical",form:o,onFinish:e=>{if(l){const a={id:l.id,...e};c(a)}else c(e)},children:i.jsx(e.Item,{name:"name",label:"Jenis Penilaian",rules:[{required:!0,message:"Wajib disisi"}],children:i.jsx(n,{placeholder:"Jenis Penilaian"})})})})},{confirm:D}=E,J=()=>{const[e,a]=L.useState(1),[s,r]=L.useState(10),[d,g]=L.useState(""),[m,h]=L.useState(""),[p,k]=L.useState(!1),[x,j]=L.useState(""),{data:y,isLoading:f}=c({page:e,limit:s,search:m}),[T,{data:b,isLoading:S,error:C,isSuccess:w,reset:I}]=u();L.useEffect(()=>{const e=setTimeout(()=>{h(d),a(1)},500);return()=>clearTimeout(e)},[d]),L.useEffect(()=>{w&&(t.success(b.message),I()),C&&(t.error(C.data.message),I())},[b,C,w]);const v=[{title:"No",key:"no",render:(a,t,i)=>(e-1)*s+i+1},{title:"Jenis Penilaian",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",width:120,align:"center",render:(e,a)=>i.jsx(z.Button,{menu:{items:[{key:"edit",label:"Edit",icon:i.jsx(o,{})},{key:"delete",label:"Hapus",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"edit":j(e),k(!0);break;case"delete":D({title:`Anda yakin ingin menghapus ${e.name}?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>T(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(l,{vertical:!0,gap:"middle",children:[i.jsxs(l,{align:"center",justify:"space-between",children:[i.jsx(n.Search,{style:{width:300},allowClear:!0,onChange:e=>g(e.target.value),placeholder:"Cari Penguji ..."}),i.jsx(F,{onClick:()=>k(!0)})]}),i.jsx(_,{columns:v,dataSource:y?.types,loading:f||S,rowKey:"id",pagination:{current:e,pageSize:s,total:y?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),r(t)}}}),i.jsx(N,{title:x?"Edit Penguji":"Simpan Penguji",open:p,onClose:()=>{j(""),k(!1)},type:x})]})},q=({open:a,onClose:s,detail:r})=>{const[l]=e.useForm(),[o,{isLoading:d}]=g();L.useEffect(()=>{a&&(r?l.setFieldsValue(r):l.resetFields())},[a,r,l]);return i.jsx(E,{title:r?"Edit Kategori Penilaian":"Tambah Kategori Penilaian",open:a,onCancel:s,okText:"Simpan",cancelText:"Batal",confirmLoading:d,onOk:()=>l.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:l,onFinish:async e=>{const a=r?{...e,id:r.id}:e;try{const e=await o(a).unwrap();t.success(e.message),s()}catch(i){O.error({message:"Gagal Menyimpan Kategori",description:i.data?.message||"Terjadi kesalahan pada server."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"id",hidden:!0,children:i.jsx(n,{})}),i.jsx(e.Item,{name:"name",label:"Nama Kategori",rules:[{required:!0,message:"Nama kategori tidak boleh kosong!"}],children:i.jsx(n,{placeholder:"Contoh: Tajwid, Kelancaran, Adab"})})]})})},M=({open:a,onClose:s,detail:r,category:l})=>{const[o]=e.useForm(),{data:d,isLoading:c}=m({page:"",limit:"",search:""}),[u,{isLoading:g}]=h(),p=d?.categories?.map(e=>({label:e.name,value:e.id}));L.useEffect(()=>{a&&(r?o.setFieldsValue({id:r.id,name:r.name,categoryId:r.category_id}):(o.resetFields(),l&&o.setFieldsValue({categoryId:l.id})))},[a,r,l,o]);return i.jsx(E,{title:r?"Edit Indikator":"Tambah Indikator",open:a,onCancel:s,okText:"Simpan",cancelText:"Batal",confirmLoading:g,onOk:()=>o.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:o,onFinish:async e=>{const a=r?{...e,id:r.id}:e;try{const e=await u(a).unwrap();t.success(e.message),s()}catch(i){O.error({message:"Gagal Menyimpan Indikator",description:i.data?.message||"Terjadi kesalahan pada server."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"id",hidden:!0,children:i.jsx(n,{})}),i.jsx(e.Item,{name:"categoryId",label:"Kategori Penilaian",rules:[{required:!0,message:"Silakan pilih kategori!"}],children:i.jsx(K,{showSearch:!0,placeholder:"Pilih Kategori",options:p,loading:c,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})}),i.jsx(e.Item,{name:"name",label:"Nama Indikator",rules:[{required:!0,message:"Nama indikator tidak boleh kosong!"}],children:i.jsx(n,{placeholder:"Contoh: Ketuk, Tuntun, Ulang"})})]})})},V=()=>{const[e,a]=L.useState(1),[s,r]=L.useState(10),[d,c]=L.useState(""),[u,g]=L.useState(""),[h,f]=L.useState(!1),[T,b]=L.useState(null),[S,C]=L.useState(!1),[w,I]=L.useState(null),{data:v,isLoading:P,refetch:O}=m({page:e,limit:s,search:u}),[K,{isLoading:B,isSuccess:H,error:N}]=p(),[D,{isLoading:J,isSuccess:V,error:Y}]=k();L.useEffect(()=>{const e=setTimeout(()=>{g(d),a(1)},500);return()=>clearTimeout(e)},[d]),L.useEffect(()=>{(H||V)&&(t.success("Data berhasil dihapus."),O()),(N||Y)&&t.error(N?.data?.message||Y?.data?.message||"Gagal menghapus data.")},[H,V,N,Y,O]);const G=[{title:"No",key:"no",width:70,render:(a,t,i)=>(e-1)*s+i+1},{title:"Kategori Penilaian",dataIndex:"name",key:"name"},{title:"Indikator Penilaian",dataIndex:"indicators",key:"indicators",render:(e,a)=>i.jsx($,{wrap:!0,children:Array.isArray(e)&&e.filter(e=>e).map(e=>i.jsxs(x,{closable:!0,onClose:()=>{return a=e,void E.confirm({title:`Anda yakin ingin menghapus indikator "${a.name}"?`,content:"Tindakan ini tidak dapat dibatalkan.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>D(a.id)});var a},style:{display:"flex",alignItems:"center",padding:"4px 8px",margin:"2px"},children:[e.name,i.jsx(j,{title:"Edit Indikator",children:i.jsx(o,{style:{marginLeft:8,cursor:"pointer",color:"#1890ff"},onClick:()=>{return t=e,b(a),I(t),void C(!0);var t}})})]},e.id))})},{title:"Aksi",key:"action",width:150,align:"center",render:(e,a)=>i.jsx(z.Button,{menu:{items:[{key:"add_indicator",label:"Tambah Indikator",icon:i.jsx(y,{})},{key:"edit_category",label:"Edit Kategori",icon:i.jsx(o,{})},{key:"delete_category",label:"Hapus Kategori",icon:i.jsx(A,{}),danger:!0}],onClick:({key:e})=>((e,{key:a})=>{switch(a){case"add_indicator":b(e),I(null),C(!0),t.info(`Menambahkan indikator untuk kategori: ${e.name}`);break;case"edit_category":b(e),f(!0);break;case"delete_category":E.confirm({title:`Anda yakin ingin menghapus kategori "${e.name}"?`,content:"Semua indikator di dalamnya juga akan terhapus.",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>K(e.id)})}})(a,{key:e})},children:"Pilihan Aksi"})}];return i.jsxs(l,{vertical:!0,gap:"middle",children:[i.jsxs(l,{align:"center",justify:"space-between",children:[i.jsx(n.Search,{style:{width:300},placeholder:"Cari Kategori atau Indikator...",allowClear:!0,value:d,onChange:e=>c(e.target.value)}),i.jsx(F,{onClick:()=>{b(null),f(!0)},children:"Tambah Kategori"})]}),i.jsx(_,{columns:G,dataSource:v?.categories,loading:P||B||J,rowKey:"id",bordered:!0,pagination:{current:e,pageSize:s,total:v?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,t)=>{a(e),r(t)}}}),i.jsx(q,{open:h,onClose:()=>f(!1),detail:T}),i.jsx(M,{open:S,onClose:()=>C(!1),detail:w,category:T})]})},Y=({open:a,onClose:n})=>{const[s]=e.useForm(),{data:r,isLoading:l}=f(),{data:o,isLoading:d}=T({page:"",limit:"",search:""}),[c,{isLoading:u}]=b(),g=r?.map(e=>({label:e.name,value:e.id})),m=o?.map(e=>({label:e.name,value:e.id}));L.useEffect(()=>{a&&s.resetFields()},[a]);return i.jsx(E,{title:"Tambah Target Hafalan Baru",open:a,onCancel:n,okText:"Simpan Semua",cancelText:"Batal",confirmLoading:u,onOk:()=>s.submit(),destroyOnHidden:!0,children:i.jsxs(e,{form:s,onFinish:async e=>{const{grade_id:a,juz_ids:i}=e,s=i.map(e=>({gradeId:a,juzId:e})).map(e=>c(e).unwrap());try{await Promise.all(s),t.success(`Berhasil menambahkan ${s.length} target hafalan baru.`),n()}catch(r){O.error({message:"Gagal Menyimpan Target",description:r.data?.message||"Terjadi kesalahan saat menyimpan salah satu target."})}},layout:"vertical",children:[i.jsx(e.Item,{name:"grade_id",label:"Tingkat",rules:[{required:!0,message:"Silakan pilih tingkat!"}],children:i.jsx(K,{placeholder:"Pilih Tingkat",options:g,loading:l,virtual:!1})}),i.jsx(e.Item,{name:"juz_ids",label:"Juz yang Ditargetkan",rules:[{required:!0,message:"Silakan pilih minimal satu juz!"}],children:i.jsx(K,{mode:"multiple",allowClear:!0,placeholder:"Pilih satu atau lebih juz",options:m,loading:d,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),virtual:!1})})]})})},{Title:G,Text:R}=I,U=()=>{const[e,a]=L.useState(!1),{data:n,isLoading:s,refetch:r}=S(),[o,{isLoading:d,isSuccess:c,error:u}]=C();L.useEffect(()=>{c&&(t.success("Target berhasil dihapus."),r()),u&&t.error(u.data?.message||"Gagal menghapus target.")},[c,u,r]);return i.jsxs(l,{vertical:!0,gap:"large",children:[i.jsx(l,{justify:"end",align:"center",children:i.jsx(w,{type:"primary",icon:i.jsx(y,{}),onClick:()=>a(!0),children:"Tambah Target"})}),i.jsx(_,{columns:[{title:"No",key:"no",render:(e,a,t)=>t+1,width:70},{title:"Tingkat",dataIndex:"grade",key:"grade"},{title:"Total Ayat",dataIndex:"total_ayat",key:"total_ayat",align:"center"},{title:"Total Baris",dataIndex:"total_line",key:"total_line",align:"center"}],dataSource:n,rowKey:"grade",loading:s||d,expandable:{expandedRowRender:e=>{const a=[{title:"Juz",dataIndex:"juz",key:"juz"},{title:"Jumlah Ayat",dataIndex:"total_ayat",key:"total_ayat",align:"center"},{title:"Jumlah Baris",dataIndex:"total_line",key:"total_line",align:"center"},{title:"Aksi",key:"action",align:"center",render:(a,t)=>i.jsx(w,{type:"primary",danger:!0,icon:i.jsx(A,{}),onClick:()=>{return a=t.target_id,i=e.grade,n=t.juz,void E.confirm({title:"Hapus Target?",content:`Anda yakin ingin menghapus target ${n} dari tingkat ${i}?`,okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk:()=>o(a)});var a,i,n},children:"Hapus"})}];return i.jsx(_,{columns:a,dataSource:e.target,rowKey:"target_id",pagination:!1})}},pagination:!1,bordered:!0,title:()=>i.jsx(R,{strong:!0,children:"Daftar Target Berdasarkan Tingkat"})}),i.jsx(Y,{open:e,onClose:()=>{a(!1),r()}})]})},W=()=>{const e=[{label:"Penguji",key:"1",children:i.jsx(H,{})},{label:"Jenis Penilaian",key:"2",children:i.jsx(J,{})},{label:"Indikator Penilaian",key:"3",children:i.jsx(V,{})},{label:"Target",key:"4",children:i.jsx(U,{})}];return i.jsx(v,{title:"Managemen Penilaian Tahfiz",levels:["tahfiz"],children:i.jsxs(l,{vertical:!0,gap:"small",children:[i.jsx(I.Title,{style:{margin:0},level:5,children:"Managemen Penilaian"}),i.jsx(P,{centered:!0,items:e,defaultActiveKey:"1"})]})})};export{W as default};
//# sourceMappingURL=TahfizScoring-CJQpiK0F.js.map
