var e=Object.defineProperty,a=(a,t,i)=>((a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i)(a,"symbol"!=typeof t?t+"":t,i);import{j as t,k as i,f as s,l,n,e as r,m as d}from"./index-DFhdulld.js";import{b as c,R as o}from"./vendor-CnnDPxwB.js";import{h as m,i as u,j as h,a as g}from"./index-B8CuzAwO.js";import{L as b}from"./Layout-BdxnsoD5.js";import{C as p}from"./CmsModal-B4WHKLRt.js";import{C as x}from"./CmsForm-CjFKk7X5.js";import{Q as j,a as f,P as y,R as v}from"./quill.snow-9m3YVrDv.js";import{T as N}from"./Table-CpyGbvYh.js";import"./index-Bx5UHif0.js";j.register("modules/resize",f);const w=j.import("blots/block/embed");class k extends w{static create(e){const a=super.create();return a.setAttribute("controls",""),a.setAttribute("src",e),a}static value(e){return e.getAttribute("src")}}k.blotName="audio",k.tagName="audio",k.className="ql-audio",j.register(k);class S extends c.Component{constructor(e){super(e),a(this,"handleChange",(e=>{this.setState({editorHtml:e}),this.props.onChange(e)})),a(this,"handleImageUpload",(()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.click(),e.onchange=async()=>{var a;const t=e.files[0];if(t){const e=new FormData;e.append("file",t);try{const t=await fetch("/api/cms/news/upload/image",{method:"POST",body:e}),i=await t.json(),s=null==(a=this.reactQuillRef.current)?void 0:a.getEditor();if(s){const e=s.getSelection(!0);s.insertEmbed(e.index,"image",i.url)}}catch(i){console.error("Error uploading image:",i),alert("Gagal mengunggah gambar. Coba lagi.")}}}})),a(this,"handleAudioUpload",(()=>{const e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("accept","audio/*"),e.click(),e.onchange=async()=>{var a;const t=e.files[0];if(t){const e=new FormData;e.append("file",t);try{const t=await fetch("/api/cms/news/upload/audio",{method:"POST",body:e}),i=await t.json(),s=null==(a=this.reactQuillRef.current)?void 0:a.getEditor();if(s){const e=s.getSelection(!0);s.insertEmbed(e.index,"audio",i.url)}}catch(i){console.error("Error uploading audio:",i),alert("Gagal mengunggah audio. Coba lagi.")}}}})),this.state={editorHtml:e.value||""},this.reactQuillRef=o.createRef()}componentDidUpdate(e){e.value!==this.props.value&&this.setState({editorHtml:this.props.value})}render(){const{placeholder:e,height:a,classname:i}=this.props;return t.jsx("div",{className:"d-flex mb-2",style:{height:a},children:t.jsx(v,{ref:this.reactQuillRef,theme:"snow",value:this.state.editorHtml,onChange:this.handleChange,modules:S.modules(this.handleImageUpload,this.handleAudioUpload),formats:S.formats,placeholder:e,style:{width:"100%"},className:`react-quill border border-2 bg-white rounded ${i}`})})}}S.modules=(e,a)=>({toolbar:{container:[[{header:"1"},{header:"2"},{font:[]}],[{size:[]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],["link","image","audio","video"],["clean"]],handlers:{image:e,audio:a}},clipboard:{matchVisual:!1},resize:{modules:["Resize"]}}),S.formats=["header","font","size","bold","italic","underline","strike","blockquote","list","indent","link","image","audio","video"],S.propTypes={placeholder:y.string,value:y.string,onChange:y.func.isRequired};const C=({news:e,onBack:a})=>e?t.jsx(b,{title:e.title,levels:["cms"],children:t.jsxs("div",{className:"container py-5",children:[t.jsxs("button",{className:"btn btn-outline-secondary mb-4 d-flex align-items-center",onClick:a,children:[t.jsx(m,{className:"me-2"})," Kembali"]}),t.jsxs("article",{className:"blog-post",children:[t.jsxs("header",{className:"mb-4",children:[t.jsx("h1",{className:"display-5 fw-bold mb-3",children:e.title}),t.jsxs("div",{className:"d-flex align-items-center text-muted mb-4",children:[t.jsxs("div",{className:"d-flex align-items-center me-4",children:[t.jsx(u,{className:"me-2"}),t.jsx("span",{children:e.category_name||e.category})]}),e.createdat&&t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx(h,{className:"me-2"}),t.jsx("span",{children:new Date(e.createdat).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"})})]})]})]}),e.image&&t.jsx("div",{className:"mb-4",children:t.jsx("img",{src:e.image,alt:e.title,className:"img-fluid rounded shadow-sm",style:{maxHeight:"500px",width:"100%",objectFit:"cover"}})}),t.jsx("div",{className:"blog-content",style:{fontSize:"1.1rem",lineHeight:"1.8",color:"#333"},dangerouslySetInnerHTML:{__html:e.content}})]})]})}):null,B=()=>{const[e,a]=c.useState(!1),[o,m]=c.useState("add"),[u,h]=c.useState(null),[j,f]=c.useState(1),[y,v]=c.useState(10),[w,k]=c.useState(""),[B,D]=c.useState(0),[T,A]=c.useState(""),[L,q]=c.useState(!1),[E,R]=c.useState(null),{data:z}=i({page:"",limit:"",search:""}),{data:H,isLoading:P,refetch:U}=s({page:j,limit:y,search:w}),{result:F,totalData:G,totalPage:M}=H||{},[Q,{isSuccess:_,error:I,isLoading:K,data:O,reset:J}]=l(),[V]=n();c.useEffect((()=>{var e;_&&(r.success(O.message),a(!1),U(),h(null),A(""),D((e=>e+1)),J()),I&&(r.error(null==(e=I.data)?void 0:e.message),J())}),[_,I,O,J,U]);const $=()=>{q(!1),R(null)},W=[{name:"title",label:"Judul",type:"text",required:!0,placeholder:"Masukkan judul berita"},{name:"category",label:"Kategori",type:"select",required:!0,options:null==z?void 0:z.map((e=>({value:String(e.id),label:e.name})))},{name:"image",label:"Gambar",type:"file",accept:"image/*",required:!u,helpText:"Upload gambar untuk berita"}];return L&&E?t.jsx(C,{news:E,onBack:$}):t.jsxs(b,{title:"Berita",levels:["cms"],children:[t.jsx("div",{className:"container-fluid py-3 py-md-4",children:t.jsxs(d.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[t.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[t.jsxs("div",{className:"d-flex align-items-center",children:[t.jsx("div",{className:"bg-primary bg-opacity-10 p-3 rounded me-3",children:t.jsx(g,{className:"text-primary fs-4"})}),t.jsx("h4",{className:"mb-0",children:"Berita"})]}),t.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>{m("add"),h(null),A(""),a(!0)},children:[t.jsx("i",{className:"bi bi-plus-circle"}),t.jsx("span",{className:"ms-2",children:"Tambah Berita"})]})]}),t.jsx("div",{className:"card border-0 shadow-sm",children:t.jsx("div",{className:"card-body",children:t.jsx(N,{isLoading:P,page:j,setPage:f,totalPages:M,limit:y,setLimit:v,setSearch:k,totalData:G,children:t.jsxs("table",{className:"mb-0 table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center align-middle",children:"No"}),t.jsx("th",{className:"text-center align-middle",children:"Judul"}),t.jsx("th",{className:"text-center align-middle",children:"Kategori"}),t.jsx("th",{className:"text-center align-middle",children:"Tanggal Dibuat"}),t.jsx("th",{className:"text-center align-middle",children:"Aksi"})]})}),t.jsx("tbody",{children:null==F?void 0:F.map(((e,i)=>t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(j-1)*y+i+1}),t.jsx("td",{className:"align-middle",children:e.title}),t.jsx("td",{className:"text-center align-middle",children:e.category_name}),t.jsx("td",{className:"text-center align-middle",children:new Date(e.createdat).toLocaleDateString()}),t.jsx("td",{className:"text-center align-middle",children:t.jsxs("div",{className:"d-flex align-items-center justify-content-center gap-2",children:[t.jsx("button",{className:"btn btn-sm btn-info",title:"Lihat Detail",onClick:()=>(R(e),void q(!0)),children:t.jsx("i",{className:"bi bi-eye"})}),t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>{return t=e,m("edit"),h({...t,category:String(t.category_id),image:t.image}),A(t.content),void a(!0);var t},children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>(async e=>{var a;if(window.confirm("Apakah anda yakin ingin menghapus berita ini?"))try{await V(e).unwrap(),r.success("Berita berhasil dihapus"),U()}catch(t){r.error((null==(a=t.data)?void 0:a.message)||"Gagal menghapus berita")}})(e.id),children:t.jsx("i",{className:"bi bi-trash"})})]})})]},e.id)))})]})})})})]})}),t.jsx(p,{isOpen:e,onClose:()=>{a(!1),h(null),A(""),D((e=>e+1))},title:"add"===o?"Tambah Berita":"Edit Berita",size:"lg",children:t.jsx(x,{fields:W,initialValues:u||{title:"",category:"",image:""},onSubmit:async e=>{var a;const t={...e,content:T,id:null==u?void 0:u.id};if(!t.title||!t.category||!t.content||!t.image&&!u)return void r.error("Mohon lengkapi semua data");const i=new FormData;i.append("title",t.title),i.append("category",t.category),i.append("content",t.content),t.id&&i.append("id",t.id),(t.image instanceof File||"string"==typeof t.image&&t.image)&&i.append("image",t.image);try{await Q(i).unwrap()}catch(s){r.error((null==(a=s.data)?void 0:a.message)||"Gagal menyimpan berita")}},onCancel:()=>{h(null),A(""),a(!1),D((e=>e+1))},submitButtonText:"add"===o?"Tambah Berita":"Ubah Berita",cancelButtonText:"Batal",isLoading:K,children:t.jsxs("div",{className:"mb-3",children:[t.jsx("label",{className:"form-label",children:"Konten"}),t.jsx(S,{value:T,onChange:A,placeholder:"Masukkan konten berita...",height:"400px"})]})},B)})]})};export{B as default};
//# sourceMappingURL=NewsPage-BIZ9vBnr.js.map
