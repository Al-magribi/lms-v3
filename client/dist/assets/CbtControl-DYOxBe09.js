import{a4 as e,a5 as a,aH as s,aI as t,s as n,j as i,a as l,F as r,n as d,R as o,C as c,aJ as u,t as h,b as m,ar as x,r as p,m as g,au as j,l as k,aK as b,aL as y,I as f,aM as S,aN as w,B as v,a3 as C,aO as T,aP as _,aG as I,D as P,aQ as L,aR as D,aS as A,aT as E,aU as q,aV as B,aW as M,aX as $,aY as z,aZ as N,a_ as R,a$ as U,A as F,h as O}from"./index-C_fjL4gy.js";import{c as K,i as J,u as V}from"./vendor-DnNJsrFE.js";import{A as G}from"./Add-DzppUl6M.js";import{E as H,P as Y,S as W}from"./Pagination-CMQXbkBX.js";import{S as X}from"./index-DQ1VdCmT.js";import{R as Z}from"./ContainerOutlined-Bcd85lGs.js";import{R as Q,F as ee,C as ae,D as se}from"./Table-BbEuep4o.js";import{R as te}from"./DeleteOutlined-CMpH7wTG.js";import{E as ne}from"./Editor-DCNwq4kF.js";import{T as ie}from"./index-J9KTRj3u.js";import{U as le}from"./Upload-CSj-kziv.js";import{r as re,u as de,w as oe}from"./xlsx-C5xT2hrF.js";import{A as ce}from"./index-5Ayn0F0y.js";import{U as ue,R as he}from"./InboxOutlined-CC631QK3.js";import{P as me}from"./index-B8OxF6C9.js";import{S as xe}from"./index-DIb-n95x.js";import{R as pe}from"./ClockCircleOutlined-iL-KZk-T.js";import{R as ge}from"./CalendarOutlined-B0dANwE1.js";import{T as je}from"./TableLayout-DzjO_HPE.js";import{R as ke}from"./DownloadOutlined-B3kU_M1k.js";import"./progress-DzsMKEpj.js";var be={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}},{tag:"path",attrs:{d:"M376.9 656.4c1.8-33.5 15.7-64.7 39.5-88.6 25.4-25.5 60-39.8 96-39.8 36.2 0 70.3 14.1 96 39.8 1.4 1.4 2.7 2.8 4.1 4.3l-25 19.6a8 8 0 003 14.1l98.2 24c5 1.2 9.9-2.6 9.9-7.7l.5-101.3c0-6.7-7.6-10.5-12.9-6.3L663 532.7c-36.6-42-90.4-68.6-150.5-68.6-107.4 0-195 85.1-199.4 191.7-.2 4.5 3.4 8.3 8 8.3H369c4.2-.1 7.7-3.4 7.9-7.7zM703 664h-47.9c-4.2 0-7.7 3.3-8 7.6-1.8 33.5-15.7 64.7-39.5 88.6-25.4 25.5-60 39.8-96 39.8-36.2 0-70.3-14.1-96-39.8-1.4-1.4-2.7-2.8-4.1-4.3l25-19.6a8 8 0 00-3-14.1l-98.2-24c-5-1.2-9.9 2.6-9.9 7.7l-.4 101.4c0 6.7 7.6 10.5 12.9 6.3l23.2-18.2c36.6 42 90.4 68.6 150.5 68.6 107.4 0 195-85.1 199.4-191.7.2-4.5-3.4-8.3-8-8.3z"}}]},name:"cloud-sync",theme:"outlined"},ye=function(s,t){return K.createElement(e,a({},s,{ref:t,icon:be}))},fe=K.forwardRef(ye),Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"},we=function(s,t){return K.createElement(e,a({},s,{ref:t,icon:Se}))},ve=K.forwardRef(we);const{confirm:Ce}=g,Te=({onEdit:e,search:a})=>{const[g,j]=J(),[k,b]=K.useState(1),[y,f]=K.useState(8),[S,w]=K.useState(""),{data:v,isLoading:C}=s({page:k,limit:y,search:S}),T=v?.banks,[_,{data:I,isLoading:P,isSuccess:L,error:D,reset:A}]=t();return K.useEffect(()=>{L&&(n.success(I.message),A()),D&&n.error(D.data.message)},[I,L,D]),K.useEffect(()=>{const e=setTimeout(()=>{w(a),b(1)},500);return()=>clearTimeout(e)},[a]),C||0!==T?.length?i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsx(d,{tip:"Memuat data...",spinning:C||P,children:i.jsx(o,{gutter:[16,16],children:T?.map(a=>i.jsx(c,{xs:24,sm:12,md:8,lg:6,children:i.jsx(l,{title:i.jsx(x,{title:a.name,children:a.name}),loading:C||P,actions:[i.jsx(x,{title:"Detail",children:i.jsx(Q,{onClick:()=>{var e;j({subject:(e=a).subject_name.replace(/\s+/g,"-"),bankid:e.id,name:e.name.replace(/\s+/g,"-")})}},"more")}),i.jsx(x,{title:"Ubah Data",children:i.jsx(p,{onClick:()=>e(a)},"edit")}),i.jsx(x,{title:"Hapus Data",children:i.jsx(te,{onClick:()=>{return e=a.id,void Ce({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang dihapus tidak bisa dikembalikan",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){_(e)},onCancel(){n.warning("Aksi dibatalkan")}});var e}},"delete")})],children:i.jsx(l.Meta,{description:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(X,{children:[i.jsx(u,{}),i.jsx(h.Text,{children:a.subject_name})]}),i.jsxs(X,{children:[i.jsx(m,{}),i.jsx(h.Text,{children:a.teacher_name})]}),i.jsxs(X,{children:[i.jsx(ve,{}),i.jsx(h.Text,{children:a.btype})]}),i.jsxs(X,{children:[i.jsx(Z,{}),i.jsxs(h.Text,{children:[a.question_count," Soal"]})]})]})})})},a.id))})}),T?.length>0&&i.jsx(Y,{align:"center",total:v?.totalData,pageSize:y,current:k,onChange:(e,a)=>{b(e),f(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`})]}):i.jsx(l,{children:i.jsx(H,{description:S?`Data dengan kata kunci "${S}" tidak ditemukan.`:"Belum ada data bank soal yang dapat ditampilkan."})})},_e=({open:e,onClose:a,title:s,bank:t})=>{const{user:l}=j(e=>e.auth),[r,o]=K.useState(""),[c,u]=K.useState([]),[h]=k.useForm(),{data:m,isLoading:x}=b({page:"",limit:"",search:r}),[p,{data:S,isLoading:w,isSuccess:v,error:C}]=y(),T=m?.map(e=>({value:e.id,label:e.name,subjects:e.subjects}))||[];return K.useEffect(()=>{v&&(n.success(S.message),h.resetFields(),a()),C&&n.error(C.data.message)},[S,v,C]),K.useEffect(()=>{if(e)if(h.resetFields(),u([]),t.id){if(t&&m){const e=m.find(e=>e.id===t.teacher);if(e){const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}h.setFieldsValue({name:t.name,btype:t.btype,teacher:t.teacher,subject:t.subject})}}else if(h.setFieldsValue({btype:"paket"}),"teacher"===l?.level&&m){const e=m.find(e=>e.id===l.id);if(e){h.setFieldsValue({teacher:e.id});const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}}},[e,t,m,h,l]),i.jsx(g,{title:s,open:e,onCancel:a,cancelText:"Tutup",okText:"Simpan",onOk:()=>h.submit(),confirmLoading:w,forceRender:!0,children:i.jsx(d,{tip:"Memproses data...",spinning:w,children:i.jsxs(k,{form:h,layout:"vertical",onFinish:e=>{if(t.id){const a={id:t.id,...e};p(a)}else p(e)},initialValues:{btype:"paket"},children:[i.jsx(k.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(W,{placeholder:"Ketik untuk mencari guru...",allowClear:!0,showSearch:!0,onSearch:e=>{o(e)},options:T,onChange:(e,a)=>{if(a){const e=a.subjects.map(e=>({value:e.id,label:e.name}));u(e)}else u([]);h.setFieldsValue({subject:void 0})},loading:x,disabled:"teacher"===l?.level,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"subject",label:"Pilih Mata Pelajaran",rules:[{required:!0,message:"Pilih mata pelajaran terlebih dahulu"}],children:i.jsx(W,{placeholder:"Pilih mata pelajaran",allowClear:!0,options:c,disabled:0===c.length&&!t,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"btype",label:"Tipe Bank Soal",children:i.jsx(W,{placeholder:"Pilih tipe bank soal",options:[{label:"Paket",value:"paket"}],disabled:!0})}),i.jsx(k.Item,{name:"name",label:"Nama Bank Soal",rules:[{required:!0,message:"Nama bank soal wajib diisi"}],children:i.jsx(f,{placeholder:"maks 30 karakter",maxLength:30})})]})})})},Ie=()=>{const[e,a]=K.useState(!1),[s,t]=K.useState(!1),[n,l]=K.useState({}),[d,o]=K.useState("");return i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Manajemen Bank Soal"}),i.jsxs(X,{children:[i.jsx(f.Search,{placeholder:"Cari Data ...",allowClear:!0,onChange:e=>o(e.target.value),style:{width:250}}),i.jsx(G,{onClick:()=>a(!0)})]})]}),i.jsx(Te,{onEdit:e=>{l(e),t(!0),a(!0)},search:d}),i.jsx(_e,{title:s?`Edit Bank Soal ${n.name}`:"Tambah Bank Soal",open:e,onClose:()=>{l({}),t(!1),a(!1)},bank:n})]})},Pe=({open:e,onClose:a,title:s,ques:t,bankid:l})=>{const[r]=k.useForm(),[d,u]=K.useState(1),[h,{data:m,isSuccess:x,error:p,isLoading:j}]=S();return K.useEffect(()=>{e&&(t?(r.setFieldsValue({qtype:t.type||1,qkey:t.qkey||null,poin:t.poin||0,question:t.question||"",choiceA:t.a||"",choiceB:t.b||"",choiceC:t.c||"",choiceD:t.d||"",choiceE:t.e||""}),u(t.type||1)):(r.resetFields(),r.setFieldsValue({type:1,poin:0})))},[e,t,r]),K.useEffect(()=>{x&&(n.success(m.message),r.resetFields(),a()),p&&n.error(p.data.message)},[m,x,p]),i.jsx(g,{title:s,open:e,onCancel:a,width:900,destroyOnHidden:!0,okText:"Simpan",cancelText:"Tutup",confirmLoading:j,loading:j,onOk:()=>r.submit(),style:{top:20},children:i.jsxs(k,{form:r,layout:"vertical",onFinish:e=>{const a={id:t?.id?t?.id:"",qtype:e.type,poin:e.poin,question:e.question,bank:l,qkey:e.qkey,a:e.choiceA,b:e.choiceB,c:e.choiceC,d:e.choiceD,e:e.choiceE};h(a)},initialValues:{type:1,poin:0},style:{height:600,overflowY:"auto",overflowX:"hidden",scrollbarWidth:"none"},children:[i.jsxs(o,{gutter:16,children:[i.jsx(c,{span:12,children:i.jsx(k.Item,{name:"type",label:"Tipe Pertanyaan",rules:[{required:!0,message:"Silakan pilih tipe pertanyaan!"}],children:i.jsx(W,{placeholder:"Pilih Tipe Pertanyaan",onChange:e=>u(e),options:[{label:"Pilihan Ganda",value:1},{label:"Essai",value:2}],allowClear:!0})})}),i.jsx(c,{span:12,children:i.jsx(k.Item,{name:"poin",label:"Poin",rules:[{required:!0,message:"Silakan masukkan poin!"}],children:i.jsx(ie,{style:{width:"100%"},min:0,placeholder:"Masukkan Poin"})})})]}),1===d&&i.jsx(k.Item,{name:"qkey",label:"Kunci Jawaban",rules:[{required:!0,message:"Silakan pilih kunci jawaban!"}],children:i.jsx(W,{placeholder:"Pilih Kunci Jawaban",options:[{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"},{label:"D",value:"D"},{label:"E",value:"E"}],allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"question",label:"Pertanyaan",rules:[{required:!0,message:"Pertanyaan tidak boleh kosong!"}],children:i.jsx(ne,{placeholder:"Ketikan pertanyaan di sini ...",height:200})}),1===d&&["A","B","C","D","E"].map(e=>i.jsx(k.Item,{name:`choice${e}`,label:`Pilihan ${e}`,children:i.jsx(ne,{placeholder:`Ketikan jawaban untuk pilihan ${e} ...`,height:150})},e))]})})},{Text:Le}=h,{Dragger:De}=ue,Ae=({title:e,open:a,onClose:s,bankid:t})=>{const[l,{isLoading:r,isSuccess:d,error:o,data:c,reset:u}]=w(),[h,m]=K.useState([]),[x,p]=K.useState([]),[j,k]=K.useState([]);K.useEffect(()=>{d&&(n.success(c?.message||"Soal berhasil diunggah!"),p([]),m([]),s()),o&&n.error(o.data?.message||"Terjadi kesalahan saat mengunggah.")},[c,d,o,s]);const b={name:"file",multiple:!1,accept:".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",fileList:h,onRemove:()=>{m([]),p([]),k([])},customRequest:({file:e,onSuccess:a,onError:s})=>{const t=new FileReader;t.onload=t=>{try{const s=new Uint8Array(t.target.result),n=re(s,{type:"array"}),l=n.SheetNames[0],r=n.Sheets[l],d=de.sheet_to_json(r,{header:1,range:1}),o=d.filter(e=>e.length>0&&e.some(e=>null!=e&&""!==e)).map(e=>{const[a,s,t,n,i,l,r,d,o]=e;return 2===Number(a)?{Jenis:a,Pertanyaan:s,A:null,B:null,C:null,D:null,E:null,Jawaban:d,Poin:o}:{Jenis:a,Pertanyaan:s,A:t,B:n,C:i,D:l,E:r,Jawaban:d,Poin:o}});if(o.length>0){const e=Object.keys(o[0]).map(e=>({title:e,dataIndex:e,key:e,..."Jenis"===e&&{render:e=>i.jsx(C,{color:1===Number(e)?"green":"blue",children:1===Number(e)?"Pilihan Ganda":"Essay"}),width:150}}));k(e)}p(o),m([e]),a("ok")}catch(l){n.error("Gagal memproses file. Periksa kembali formatnya."),s(l)}},t.readAsArrayBuffer(e)}};return i.jsx(g,{title:e,open:a,onCancel:()=>{p([]),m([]),k([]),(o||d)&&u(),s()},onOk:()=>{if(0===x.length)return void n.error("Tidak ada data untuk diunggah. Silakan pilih file yang valid.");const e=x.map(e=>[Number(e.Jenis),String(e.Pertanyaan),e.A?String(e.A):null,e.B?String(e.B):null,e.C?String(e.C):null,e.D?String(e.D):null,e.E?String(e.E):null,String(e.Jawaban),Number(e.Poin||0)]);l({body:e,bankid:t})},okText:"Simpan",cancelText:"Tutup",width:1e3,confirmLoading:r,children:i.jsxs(X,{direction:"vertical",style:{width:"100%"},size:"large",children:[i.jsx(ce,{message:"Ikuti langkah-langkah berikut",description:i.jsxs(X,{direction:"vertical",size:2,children:[i.jsx(Le,{children:"1. Unduh template Excel yang disediakan."}),i.jsx(Le,{children:"2. Isi data soal sesuai dengan kolom yang tersedia."}),i.jsx(Le,{children:"3. Unggah file yang sudah diisi pada area di bawah ini."}),i.jsx(v,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_soal.xlsx","_blank")},children:"Unduh Template"})]}),type:"info",showIcon:!0}),i.jsxs(De,{...b,children:[i.jsx("p",{className:"ant-upload-drag-icon",children:i.jsx(he,{})}),i.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),i.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx atau .xls."})]}),x.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Le,{strong:!0,children:"Pratinjau Data:"}),i.jsx(ee,{columns:j,dataSource:x,bordered:!0,size:"small",rowKey:(e,a)=>a,loading:r,pagination:{pageSize:5},scroll:{x:"max-content"}})]})]})})},Ee=e=>({__html:e||""}),qe={1:{label:"Pilihan Ganda",color:"blue"},2:{label:"Esai",color:"purple"}},Be=({subject:e,bankid:a,name:s})=>{const t=V(),[u,m]=K.useState(1),[x,g]=K.useState(10),[j,k]=K.useState(""),[b,y]=K.useState(!1),[f,S]=K.useState(!1),[w,D]=K.useState(null),{data:A,isLoading:E,error:q}=T({page:u,limit:x,search:j,bankid:a}),[B,{data:M,isLoading:$,isSuccess:z,error:N}]=_(),R=(e=null)=>{D(e),y(!0)};K.useEffect(()=>{z&&n.success(M.message),N&&n.error(N.data.message)},[M,z,N]);return i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(X,{children:[i.jsx(v,{shape:"circle",icon:i.jsx(I,{}),onClick:()=>t("/computer-based-test")}),i.jsxs("div",{children:[i.jsxs(h.Title,{style:{margin:0},level:4,children:["Bank Soal: ",s]}),i.jsx(h.Text,{type:"secondary",children:e})]})]}),i.jsxs(X,{children:[i.jsx(le,{onClick:()=>S(!0)}),i.jsx(G,{onClick:()=>R(null)})]})]}),0===A?.questions.length?i.jsx(H,{description:"Data pertanyaan belum tersedia"}):i.jsx(d,{tip:"Memuat data...",spinning:E||$,children:i.jsxs(r,{vertical:!0,gap:"large",children:[q?i.jsx(ce,{type:"warning",showIcon:!0,message:"Soal Belum Tersedia",description:q?q.data?.message||"Gagal memuat soal.":"Silakan unggah atau buat soal terlebih dahulu."}):A?.questions.map((e,a)=>{const s=qe[e.qtype]||{label:"Tipe Tidak Dikenal",color:"default"},t=[{key:"A",text:e.a},{key:"B",text:e.b},{key:"C",text:e.c},{key:"D",text:e.d},{key:"E",text:e.e}];return i.jsxs(l,{loading:E||$,title:i.jsxs(r,{vertical:!0,children:[i.jsx(h.Text,{children:`Pertanyaan ${(u-1)*x+a+1}`}),i.jsxs(X,{size:"small",children:[i.jsx(C,{color:s.color,children:s.label}),i.jsxs(C,{children:[i.jsx("strong",{children:e.poin||0})," Poin"]})]})]}),extra:i.jsxs(X,{children:[i.jsx(v,{icon:i.jsx(p,{}),onClick:()=>R(e),children:"Ubah"}),i.jsx(me,{title:"Hapus Soal",description:"Apakah Anda yakin ingin menghapus soal ini?",onConfirm:()=>B(e.id),okText:"Ya, Hapus",cancelText:"Batal",children:i.jsx(v,{danger:!0,icon:i.jsx(te,{}),children:"Hapus"})})]}),children:[i.jsx("div",{style:{maxWidth:"100%",overflow:"auto"},dangerouslySetInnerHTML:Ee(e.question)}),1===e.qtype&&i.jsxs(i.Fragment,{children:[i.jsx(P,{orientation:"left",plain:!0,children:"Opsi Jawaban"}),i.jsx(o,{gutter:[16,16],children:t.map(a=>a.text&&""!==a.text.trim()&&i.jsx(c,{xs:24,sm:24,md:12,children:i.jsxs(r,{align:"start",gap:"small",style:{padding:"12px",borderRadius:"8px",border:e.qkey===a.key?"1px solid #52c41a":"1px solid #d9d9d9",background:e.qkey===a.key?"#f6ffed":"transparent",width:"100%",height:"100%"},children:[i.jsx(C,{children:a.key}),i.jsx("div",{style:{flex:1},dangerouslySetInnerHTML:Ee(a.text)}),e.qkey===a.key&&i.jsx(L,{style:{color:"#52c41a",fontSize:"16px",marginTop:"2px"}})]})},a.key))})]})]},e.id)}),i.jsx(Y,{size:"small",align:"center",total:A?.totalData,pageSize:x,current:u,onChange:(e,a)=>{m(e),g(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`})]})}),i.jsx(Pe,{title:w?"Ubah Soal":"Tambah Soal",open:b,onClose:()=>{D(null),y(!1)},bankid:a,ques:w}),i.jsx(Ae,{title:`Upload pertanyaan ${s?.replace(/-/g," ")}`,open:f,onClose:()=>S(!1),bankid:a})]})},Me=({title:e,open:a,onClose:s,exam:t})=>{const{user:l}=j(e=>e.auth),[r]=k.useForm(),{data:d}=b(),{data:o}=D(),[c,{isLoading:u}]=A(),[h,m]=K.useState([]),x=t?"Edit Ujian":e,p=K.useMemo(()=>d?d.map(e=>({value:e.id,label:e.name,banks:e.bank})):[],[d]),y=K.useMemo(()=>o?o.map(e=>({value:e.id,label:e.name})):[],[o]);K.useEffect(()=>{if(a)if(r.resetFields(),t&&d){const e=p?.find(e=>e.value===t.teacher);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}r.setFieldsValue({...t,classes:(t.classes||[]).map(e=>e.id),bank:(t.banks||[]).map(e=>e.id)})}else if(r.resetFields(),m([]),"teacher"===l?.level&&p.length>0){r.setFieldsValue({teacher:l.id});const e=p.find(e=>e.value===l.id);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}}},[a,t,d,l,r,p]);return i.jsx(g,{title:x,open:a,onCancel:s,destroyOnHidden:!0,okText:"Simpan",cancelText:"Batal",onOk:r.submit,confirmLoading:u,style:{top:20},children:i.jsxs(k,{form:r,layout:"vertical",onFinish:async e=>{const a=e.bank.map(e=>({bankid:e,pg:null,essay:null})),i=e.classes.map(e=>({value:e})),l={...e,bank:a,classes:i,isshuffle:e.isshuffle||!1};t&&(l.examid=t.id,l.token=t.token);try{await c(l).unwrap(),n.success(`Ujian berhasil ${t?"diperbarui":"dibuat"}!`),s()}catch(r){n.error("Terjadi kesalahan saat menyimpan ujian.")}},initialValues:{mc_score:100,essay_score:0,isshuffle:!1},children:[i.jsx(k.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(W,{placeholder:"Cari Guru",options:p,onChange:(e,a)=>{r.setFieldsValue({bank:[]}),m(a?(a.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type})):[])},allowClear:!0,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),virtual:!1})}),i.jsx(k.Item,{name:"bank",label:"Pilih Bank Soal",rules:[{required:!0,message:"Pilih bank soal terlebih dahulu"}],children:i.jsx(W,{mode:"multiple",placeholder:"Pilih satu atau lebih bank soal",options:h,onChange:e=>{if(0===e.length)return;const a=e[e.length-1],s=h.find(e=>e.value===a);if("paket"===s?.type)r.setFieldsValue({bank:[a]});else{const a=e.filter(e=>{const a=h.find(a=>a.value===e);return a&&"paket"!==a.type});r.setFieldsValue({bank:a})}},allowClear:!0,virtual:!1,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})}),i.jsx(k.Item,{name:"classes",label:"Untuk Kelas",rules:[{required:!0,message:"Pilih kelas terlebih dahulu"}],children:i.jsx(W,{mode:"multiple",placeholder:"Pilih satu atau lebih kelas",options:y,allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"name",label:"Nama Ujian",rules:[{required:!0,message:"Masukkan nama ujian"}],children:i.jsx(f,{placeholder:"maks 30 karakter",maxLength:30})}),i.jsx(k.Item,{name:"duration",label:"Durasi (Menit)",rules:[{required:!0,message:"Masukkan durasi ujian"}],children:i.jsx(ie,{style:{width:"100%"},placeholder:"Masukkan durasi dalam menit",min:1})}),i.jsx(k.Item,{name:"mc_score",label:"Persentase Nilai PG",rules:[{required:!0,message:"Masukkan persentase nilai PG"}],children:i.jsx(ie,{style:{width:"100%"},min:0,max:100})}),i.jsx(k.Item,{name:"essay_score",label:"Persentase Nilai Essay",rules:[{required:!0,message:"Masukkan persentase nilai essay"}],children:i.jsx(ie,{style:{width:"100%"},min:0,max:100})}),i.jsx(k.Item,{name:"isshuffle",label:"Acak Soal?",valuePropName:"checked",children:i.jsx(xe,{})})]})})},{Text:$e,Title:ze}=h,{confirm:Ne}=g,Re=()=>{J();const[e,a]=K.useState(1),[s,t]=K.useState(8),[u,g]=K.useState(""),[j,k]=K.useState(""),[b,y]=K.useState({}),[S,w]=K.useState(!1),[v,T]=K.useState(!1),{data:_,isLoading:I,error:L}=E({page:e,limit:s,search:j}),[D,{data:A,isSuccess:B,error:M,isLoading:$,reset:z}]=q(),N=_?.exams;return K.useEffect(()=>{B&&(n.success(A.message),z()),M&&(n.error(M.data.message),z())},[A,B,M]),K.useEffect(()=>{const e=setTimeout(()=>{k(u),a(1)},500);return()=>clearTimeout(e)},[u]),L?i.jsx(ce,{showIcon:!0,type:"error",message:"Terjadi Kesalahan",description:L?L.data.message:"Jadwal ujian belum tersedia"}):i.jsx(d,{tip:"Memuat data...",spinning:I,children:i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Managemen Penjadwalan"}),i.jsxs(X,{children:[i.jsx(f.Search,{placeholder:"Cari data ...",allowClear:!0,onChange:e=>g(e.target.value)}),i.jsx(G,{onClick:()=>T(!0)})]})]}),i.jsx(o,{gutter:[16,16],children:N?.map(e=>i.jsx(c,{sm:24,md:12,lg:6,children:i.jsx(l,{hoverable:!0,loading:I||$,title:i.jsx(x,{title:e.name,children:i.jsx($e,{ellipsis:!0,children:e.name})}),extra:i.jsx(C,{color:e.isactive?"green":"volcano",children:e.isactive?"Aktif":"Tidak Aktif"}),actions:[i.jsx(x,{title:"Detail",children:i.jsx(Q,{onClick:()=>{return a=e,void window.open(`/computer-based-test?report=true&examid=${a.id}&token=${a.token}&name=${a.name?.replace(/\s+/g,"-")}`,"_blank");var a}},"detail")}),i.jsx(x,{title:"Edit",children:i.jsx(p,{onClick:()=>(y(e),w(!0),void T(!0))},"edit")}),i.jsx(x,{title:"Hapus",children:i.jsx(te,{onClick:()=>{return a=e.id,void Ne({title:"Apa anda yakin menghapus data ini?",content:"Data yang sudah dihapus tidak bisa dikembalikan",okText:"Ya, hapus",okType:"danger",cancelText:"Batal",onOk(){D(a)},onCancel(){n.info("Aksi dibatalkan")}});var a}},"remove")})],children:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx($e,{type:"secondary",children:"Token Ujian"}),i.jsx($e,{strong:!0,copyable:!0,children:e.token})]}),i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx($e,{type:"secondary",children:"Acak Soal"}),i.jsx(C,{color:e.isshuffle?"blue":"purple",children:e.isshuffle?"Acak":"Urut"})]}),i.jsx(P,{style:{margin:"8px 0"}}),i.jsxs(r,{vertical:!0,children:[i.jsx($e,{type:"secondary",children:"Bank Soal"}),i.jsx(r,{vertical:!0,gap:"small",children:e.banks?.map((e,a)=>i.jsx(x,{title:e.name,children:i.jsx(h.Text,{ellipsis:!0,children:i.jsx(C,{color:"magenta",children:e.name})})},a))})]}),i.jsx(P,{style:{margin:"8px 0"}}),i.jsxs(X,{direction:"vertical",size:"small",style:{width:"100%"},children:[i.jsxs(r,{align:"center",gap:8,children:[i.jsx(m,{}),i.jsx($e,{children:e.teacher_name})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(pe,{}),i.jsxs($e,{children:[e.duration," Menit"]})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(ge,{}),i.jsx($e,{children:new Date(e.createdat).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})})]})]}),i.jsx(P,{style:{margin:"8px 0"}}),i.jsx(r,{wrap:"wrap",gap:"8px 0",children:e.classes.map(e=>i.jsx(C,{color:"cyan",children:e.name},e.id))})]})})},e.id))}),N?.length>0&&i.jsx(Y,{size:"small",align:"center",total:_?.totalData,pageSize:s,current:e,onChange:(e,s)=>{a(e),t(s)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`}),i.jsx(Me,{title:S?"Ubah Jadwal Ujian":"Simpan Jadwan Ujian",open:v,onClose:()=>{y({}),w(!1),T(!1)},exam:b})]})})},{confirm:Ue}=g,Fe=({examid:e,classid:a,tableRef:s,syncTrigger:t})=>{const[l,r]=K.useState(1),[d,o]=K.useState(10),[c,u]=K.useState(""),[h,m]=K.useState(!1),[x,p]=K.useState(3e5),{data:g,isLoading:j,refetch:k}=B({page:l,limit:d,search:c,exam:e,classid:a}),[b,{isLoading:y}]=M(),[f,{isLoading:S}]=$(),[w,{isLoading:v}]=z(),T=K.useRef(!0);K.useEffect(()=>{T.current?T.current=!1:k()},[t,k]),K.useEffect(()=>{let e=null;return h&&(e=setInterval(()=>{k(),n.success("Data berhasil di-refresh secara otomatis")},x)),()=>{e&&clearInterval(e)}},[h,x,k]);const _=[{title:"No",key:"no",render:(e,a,s)=>(l-1)*d+s+1},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Kelas",dataIndex:"class_name",key:"class_name"},{title:"Ip",dataIndex:"ip",key:"ip"},{title:"Browser",dataIndex:"browser",key:"browser"},{title:"Mulai",dataIndex:"createdat",key:"createdat",render:e=>i.jsx(C,{color:"volcano",children:e&&new Date(e).toLocaleString()})},{title:"Status",key:"status",render:e=>e.ispenalty?i.jsx(C,{color:"red",children:"Melanggar"}):e.isdone?i.jsx(C,{color:"green",children:"Selesai"}):e.isactive?i.jsx(C,{color:"blue",children:"Mengerjakan"}):i.jsx(C,{children:"Belum Masuk"})},{title:"Aksi",key:"action",render:a=>i.jsx(se.Button,{menu:{items:[{key:"detail",label:"Lihat Jawaban",disabled:!a.log_id},{key:"allow",label:"Izikan Masuk",disabled:a.isdone||!a.isactive},{key:"finish",label:"Selesaikan Ujian",disabled:a.isdone||!a.isactive},{key:"retake",label:"Ulangi Ujian",disabled:!a.isdone}],onClick:({key:s})=>((a,{key:s})=>{switch(s){case"detail":n.info("detail");break;case"allow":Ue({title:"Apakah anda yakin mengizinkan peserta mengikuti ujian ini?",content:"peserta harus refresh halaman ujian agar dapat mengikuti ujian ini",okText:"Ya, Izinkan",cancelText:"Tutup",okType:"danger",async onOk(){try{await f(a.log_id),n.success(`${a.student_name} telah diizinkan masuk kembali`)}catch(e){n.error(e?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"finish":Ue({title:`Apakah anda yakin menyelesaikan ujian ${a.student_name} ?`,content:"Setelah diselesaikan peserta tidak ada ikut ujian ini",okText:"Ya, Selesaikan",cancelText:"Tutup",okType:"danger",async onOk(){try{await b({id:a.log_id,exam:e}),n.success(`Ujian ${a.student_name} telah diselesaikan`)}catch(s){n.error(s?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"retake":Ue({title:`Apakah anda yakin mengulang ujian ${a.student_name} ?`,content:"Jawaban dan nilai yang telah diperoleh akan dihapus",okText:`Ya, Ulangi Ujian ${a.student_name}`,cancelText:"Tutup",okType:"danger",async onOk(){try{await w({id:a.log_id,exam:e,student:a.student_id}),n.success(`Data ujian ${a.student_name} telah direset`)}catch(s){n.error(s?.data?.message||"Terjadi Kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}})}})(a,{key:s})},children:"Pilihan Aksi"})}];return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{marginBottom:16},children:i.jsxs(X,{children:[i.jsx(ae,{checked:h,onChange:e=>m(e.target.checked),children:"Auto Refetch"}),i.jsxs(W,{value:x,onChange:p,disabled:!h,style:{width:150},children:[i.jsx(W.Option,{value:3e5,children:"Setiap 5 Menit"}),i.jsx(W.Option,{value:6e5,children:"Setiap 10 Menit"})]})]})}),i.jsx(je,{tableRef:s,onSearch:e=>{u(e),r(1)},isLoading:j||S||y||v,columns:_,source:g?.result,rowKey:"student_id",page:l,limit:d,totalData:g?.totalData,onChange:e=>{r(e.current),o(e.pageSize)}})]})},Oe=({examid:e,classid:a,tableRef:s,syncTrigger:t})=>{const[n,l]=K.useState(1),[r,d]=K.useState(10),[o,c]=K.useState(""),{data:u,isLoading:m,refetch:p}=N({page:n,limit:r,search:o,exam:e,classid:a}),g=K.useRef(!0);K.useEffect(()=>{g.current?g.current=!1:p()},[t,p]);const j=K.useMemo(()=>{if(!u)return[];return[...[{title:"No",key:"no",width:60,fixed:"left",align:"center",render:(e,a,s)=>(n-1)*r+s+1},{title:"Nama Siswa",dataIndex:"name",key:"name",width:250,fixed:"left"}],{title:"Analisis Jawaban Siswa",align:"center",children:u.questions.map((e,a)=>({title:i.jsx(x,{title:`Kunci: ${e.qkey} | Poin: ${e.poin}`,children:`S${a+1}`}),dataIndex:"answers",key:`question_${e.id}`,width:75,align:"center",render:a=>{const s=a?.find(a=>a.id===e.id),t=s?s.mc.toUpperCase():"-",n=t===e.qkey.toUpperCase();return s?i.jsx(h.Text,{style:{marginLeft:"4px",color:n?"#52c41a":"#f5222d"},children:t}):i.jsx(h.Text,{type:"secondary",children:"-"})}}))},...[{title:"Benar",dataIndex:"correct",key:"correct",width:80,fixed:"right",align:"center",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",width:80,fixed:"right",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#f5222d"},children:e})},{title:"Nilai Akhir",dataIndex:"mc_score",key:"mc_score",width:100,fixed:"right",align:"center",render:e=>i.jsx(C,{color:e>=75?"blue":"volcano",style:{fontSize:14,padding:"4px 8px"},children:e})}]]},[u,n,r]);return i.jsx(je,{tableRef:s,onSearch:e=>{c(e),l(1)},isLoading:m,columns:j,source:u?.students,rowKey:"id",page:n,limit:r,totalData:u?.totalData,onChange:e=>{l(e.current),d(e.pageSize)},bordered:!0,scroll:{x:"max-content"}})},{Title:Ke,Text:Je}=h,{Search:Ve}=f,Ge=({examid:e,classid:a,tableRef:s,syncTrigger:t})=>{const[n,r]=K.useState(1),[d,u]=K.useState(10),[h,m]=K.useState(""),[x,p]=K.useState(""),{data:g,isLoading:j,isError:k,refetch:b}=R({exam:e,classid:a,page:n,limit:d,search:x}),y=K.useRef(!0);K.useEffect(()=>{y.current?y.current=!1:b()},[t,b]),K.useEffect(()=>{const e=setTimeout(()=>{p(h),1!==n&&r(1)},500);return()=>clearTimeout(e)},[h]);const f=[{title:"No",key:"no",render:(e,a,s)=>(n-1)*d+s+1,width:"5%"},{title:"NIS",dataIndex:"student_nis",key:"student_nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"student_grade",key:"student_grade"},{title:"Kelas",dataIndex:"student_class",key:"student_class"},{title:"Benar",dataIndex:"correct",key:"correct",align:"center",render:e=>i.jsx(Je,{style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",align:"center",render:e=>i.jsx(Je,{style:{color:"#f5222d"},children:e})},{title:"Skor PG",dataIndex:"mc_score",key:"mc_score",align:"center"},{title:"Skor Esai",dataIndex:"essay_score",key:"essay_score",align:"center"},{title:"Nilai Akhir",dataIndex:"score",key:"score",align:"center",render:e=>i.jsx(Je,{strong:!0,style:{color:"#1890ff"},children:e})}];if(k)return i.jsx(ce,{message:"Terjadi Kesalahan",description:"Gagal memuat data nilai. Silakan coba lagi nanti.",type:"error",showIcon:!0});const S=g?.exam_name||"Daftar Nilai",w=i.jsxs(X,{direction:"vertical",size:"small",children:[i.jsxs(Je,{type:"secondary",children:["Guru: ",g?.teacher_name]}),i.jsxs(Je,{type:"secondary",children:["Sekolah: ",g?.homebase_name]})]});return i.jsx("div",{ref:s,children:i.jsxs(l,{children:[i.jsx(Ke,{level:4,children:S}),w,i.jsx(o,{justify:"end",style:{margin:"16px 0"},children:i.jsx(c,{children:i.jsx(Ve,{placeholder:"Cari nama atau NIS siswa...",value:h,onChange:e=>m(e.target.value),style:{width:280},allowClear:!0,enterButton:!0})})}),i.jsx(ee,{columns:f,dataSource:g?.students||[],rowKey:"student_id",loading:j,onChange:e=>{r(e.current),u(e.pageSize)},pagination:{current:n,pageSize:d,total:g?.totalData||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} data`},scroll:{x:"max-content"}})]})})},He=({name:e,examid:a,token:s})=>{const t=V(),[l,d]=K.useState(""),[o,c]=K.useState("1"),[u,m]=K.useState(0),x=K.useRef(null),p=K.useRef(null),g=K.useRef(null),{data:j}=U({exam:a},{skip:!a}),k=j?.map(e=>({value:e.id,label:e.name})),b=(e,a)=>{if(!e.current)return void n.error("Tabel tidak ditemukan, tidak dapat mengunduh data.");const s=e.current.querySelector("table");if(!s)return void n.error("Elemen tabel HTML tidak ditemukan.");const t=de.book_new(),i=de.table_to_sheet(s);de.book_append_sheet(t,i,"Data"),oe(t,`${a}.xlsx`)},y=[{label:"Absen",key:"1",children:i.jsx(Fe,{examid:a,classid:l,tableRef:x,syncTrigger:u})},{label:"Analisis",key:"2",children:i.jsx(Oe,{examid:a,classid:l,tableRef:p,syncTrigger:u})},{label:"Nilai",key:"3",children:i.jsx(Ge,{examid:a,classid:l,tableRef:g,syncTrigger:u})}];return i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(X,{children:[i.jsx(v,{shape:"circle",icon:i.jsx(I,{}),onClick:()=>{t("/computer-based-test")}}),i.jsxs("div",{children:[i.jsx(h.Title,{style:{margin:0},level:5,children:e?.replace(/-/g," ")}),i.jsx(h.Text,{copyable:!0,strong:!0,children:s})]})]}),i.jsxs(X,{children:[i.jsx(W,{style:{width:200},placeholder:"Pilih Kelas",options:k,onChange:e=>{d(e)},allowClear:!0}),i.jsx(v,{icon:i.jsx(ke,{}),onClick:()=>{switch(o){case"1":b(x,`Absensi_${e.replace(/-/g,"_")}`);break;case"2":b(p,`Analisis_${e.replace(/-/g,"_")}`);break;case"3":b(g,`Nilai_${e.replace(/-/g,"_")}`)}},children:"Unduh Data"}),i.jsx(v,{icon:i.jsx(fe,{}),onClick:()=>{m(e=>e+1),n.success("Memulai sinkronisasi data...")},children:"Sinkron Data"})]})]}),i.jsx(F,{centered:!0,items:y,onChange:e=>c(e)})]})},Ye=()=>{const[e]=J(),a=e.get("subject")?.replace(/-/g," "),s=e.get("bankid"),t=e.get("name")?.replace(/-/g," "),n=e.get("report"),l=e.get("examid"),r=e.get("token"),d=[{label:"Bank Soal",key:"1",children:i.jsx(Ie,{})},{label:"Jadwal Ujian",key:"2",children:i.jsx(Re,{})}];return s?i.jsx(O,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(Be,{subject:a,bankid:s,name:t})}):n?i.jsx(O,{title:t?t?.replace(/-/g," "):"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(He,{name:t,examid:l,token:r})}):i.jsx(O,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(F,{centered:!0,items:d})})};export{Ye as default};
