import{j as e,m as a,bn as t,b as s,bu as l,bv as i,e as n,aR as d,aS as r,bw as c,bx as m,by as o,bz as h,bA as u,av as x}from"./index-EivrEbl6.js";import{u as g,k as j,b as p}from"./vendor-DfXzdC0j.js";import{L as b}from"./Layout-Cm1KUPxL.js";import{S as N}from"./react-select.esm-DUeLA41h.js";import{T as f}from"./Table-DnkXlGQ_.js";import"./index-Cjq_QsmG.js";import"./index-33-gAEu4.js";import"./index-C1AnEztE.js";const v=({subjects:t,user:s})=>{const l=g(),i=(e,a)=>{const t=e.replace(/\s+/g,"-");l(`/guru-penilaian?subject=${t}&id=${a}`)},n={hidden:{y:20,opacity:0},show:{y:0,opacity:1}};return e.jsx(a.div,{className:"row g-3",variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",children:t.map((t=>e.jsx(a.div,{className:"col-xl-3 col-lg-4 col-md-6",variants:n,children:e.jsxs("div",{className:"card h-100 shadow-sm border-0 hover-card rounded-3 overflow-hidden",onClick:()=>i(t.name,t.id),style:{cursor:"pointer",transition:"all 0.3s ease"},children:[e.jsx("div",{className:"position-relative",children:e.jsx("img",{src:t.cover?`${window.location.origin}${t.cover}`:"/logo.png",alt:t.name,className:"card-img-top",style:{height:"250px",objectFit:"cover"}})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("h5",{className:"card-title mb-3 fw-bold text-primary",children:t.name}),e.jsxs("div",{className:"d-flex align-items-center text-muted mb-3",children:[e.jsx("i",{className:"bi bi-mortarboard-fill me-2"}),e.jsx("span",{className:"small",children:null==s?void 0:s.name})]}),e.jsxs("button",{className:"btn btn-primary w-100 rounded-pill py-2",onClick:e=>{e.stopPropagation(),i(t.name,t.id)},children:[e.jsx("i",{className:"bi bi-arrow-right-circle-fill me-2"}),"Kelola Penilaian"]})]})]})},t.id)))})},k={menuPortal:e=>({...e,zIndex:10}),control:(e,a)=>({...e,minHeight:"38px","@media (max-width: 576px)":{minHeight:"44px"}}),option:(e,a)=>({...e,"@media (max-width: 576px)":{padding:"12px 16px"}})},y=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],_=[{label:"Semester 1",value:1},{label:"Semester 2",value:2}],S=({subject:a,id:s})=>{const{data:l}=t(s),[i,n]=j(),d=p.useMemo((()=>(null==l?void 0:l.map((e=>({value:e.chapter_id,label:e.chapter_name}))))||[]),[l]),r=i.get("chapterid"),c=i.get("classid"),m=i.get("month"),o=i.get("semester"),[h,u]=p.useState(null),[x,g]=p.useState(null),[b,f]=p.useState(null),[v,S]=p.useState(null),w=p.useMemo((()=>{var e;if(!h&&!r)return[];const a=h?h.value:r,t=null==l?void 0:l.find((e=>String(e.chapter_id)===String(a)));return(null==(e=null==t?void 0:t.class)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]}),[l,h,r]),P=p.useMemo((()=>y.map((e=>({value:e,label:e})))),[]),C=p.useMemo((()=>_.map((e=>({value:e.value,label:e.label})))),[]);p.useEffect((()=>{if(r&&d.length>0){const e=d.find((e=>String(e.value)===String(r)));u(e||null)}}),[r,d]),p.useEffect((()=>{if(c&&w.length>0){const e=w.find((e=>String(e.value)===String(c)));g(e||null)}}),[c,w]),p.useEffect((()=>{if(m&&P.length>0){const e=P.find((e=>e.value===m));f(e||null)}}),[m,P]),p.useEffect((()=>{if(o&&C.length>0){const e=C.find((e=>String(e.value)===String(o)));S(e||null)}}),[o,C]);const F=(e,t,l,i)=>{const d={};a&&(d.subject=a),s&&(d.id=s),e&&(d.chapterid=e.value),t&&(d.classid=t.value),l&&(d.month=l.value),i&&(d.semester=i.value),n(d)},L=e=>{u(e),g(null),F(e,null,b,v)},D=e=>{g(e),F(h,e,b,v)},$=e=>{f(e),F(h,x,e,v)},A=e=>{S(e),F(h,x,b,e)};return e.jsxs("div",{className:"form-data-container",children:[e.jsxs("div",{className:"d-none d-lg-flex gap-3",children:[e.jsx("div",{className:"flex-fill",children:e.jsx(N,{options:d,value:h,onChange:L,placeholder:"Pilih Chapter",menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"flex-fill",children:e.jsx(N,{options:w,value:x,onChange:D,placeholder:"Pilih Kelas",isDisabled:!h,menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"flex-fill",children:e.jsx(N,{options:P,value:b,onChange:$,placeholder:"Pilih Bulan",menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"flex-fill",children:e.jsx(N,{options:C,value:v,onChange:A,placeholder:"Pilih Semester",menuPortalTarget:document.body,styles:k})})]}),e.jsx("div",{className:"d-none d-md-block d-lg-none",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsx(N,{options:d,value:h,onChange:L,placeholder:"Pilih Chapter",menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"col-md-6",children:e.jsx(N,{options:w,value:x,onChange:D,placeholder:"Pilih Kelas",isDisabled:!h,menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"col-md-6",children:e.jsx(N,{options:P,value:b,onChange:$,placeholder:"Pilih Bulan",menuPortalTarget:document.body,styles:k})}),e.jsx("div",{className:"col-md-6",children:e.jsx(N,{options:C,value:v,onChange:A,placeholder:"Pilih Semester",menuPortalTarget:document.body,styles:k})})]})}),e.jsx("div",{className:"d-block d-md-none",children:e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-2",children:"Chapter"}),e.jsx(N,{options:d,value:h,onChange:L,placeholder:"Pilih Chapter",menuPortalTarget:document.body,styles:k})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-2",children:"Kelas"}),e.jsx(N,{options:w,value:x,onChange:D,placeholder:"Pilih Kelas",isDisabled:!h,menuPortalTarget:document.body,styles:k})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-2",children:"Bulan"}),e.jsx(N,{options:P,value:b,onChange:$,placeholder:"Pilih Bulan",menuPortalTarget:document.body,styles:k})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-2",children:"Semester"}),e.jsx(N,{options:C,value:v,onChange:A,placeholder:"Pilih Semester",menuPortalTarget:document.body,styles:k})]})]})})]})},w=({tab:a,setTab:t})=>{const[s]=j(),l=s.get("id"),i=s.get("chapterid"),n=s.get("classid"),d=s.get("month"),r=s.get("semester"),c=e=>{t(e)};return n&&l&&i&&d&&r?e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsxs("ul",{className:"nav nav-tabs justify-content-center d-none d-md-flex",children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("attendance"===a?"active":""),"aria-current":"page",onClick:()=>c("attendance"),children:"Kehadiran"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("attitude"===a?"active":""),"aria-current":"page",onClick:()=>c("attitude"),children:"Sikap"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("formative"===a?"active":""),"aria-current":"page",onClick:()=>c("formative"),children:"Formatif"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("summative"===a?"active":""),"aria-current":"page",onClick:()=>c("summative"),children:"Sumatif"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("recap"===a?"active":""),"aria-current":"page",onClick:()=>c("recap"),children:"Rekapitulasi"})})]}),e.jsx("div",{className:"d-md-none",children:e.jsxs("select",{className:"form-select form-select-lg",value:a,onChange:e=>c(e.target.value),"aria-label":"Pilih jenis penilaian",children:[e.jsx("option",{value:"attendance",children:"Kehadiran"}),e.jsx("option",{value:"attitude",children:"Sikap"}),e.jsx("option",{value:"formative",children:"Formatif"}),e.jsx("option",{value:"summative",children:"Sumatif"}),e.jsx("option",{value:"recap",children:"Rekapitulasi"})]})}),e.jsx("div",{className:"d-none d-sm-block d-md-none",children:e.jsx("div",{className:"nav-scroll-container",children:e.jsxs("ul",{className:"nav nav-tabs nav-tabs-scroll",children:[e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("attendance"===a?"active":""),"aria-current":"page",onClick:()=>c("attendance"),children:"Kehadiran"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("attitude"===a?"active":""),"aria-current":"page",onClick:()=>c("attitude"),children:"Sikap"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("formative"===a?"active":""),"aria-current":"page",onClick:()=>c("formative"),children:"Formatif"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("summative"===a?"active":""),"aria-current":"page",onClick:()=>c("summative"),children:"Sumatif"})}),e.jsx("li",{className:"nav-item",children:e.jsx("a",{className:"nav-link pointer "+("recap"===a?"active":""),"aria-current":"page",onClick:()=>c("recap"),children:"Rekapitulasi"})})]})})})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Pilih chapter, kelas, semester, dan bulan terlebih dahulu untuk melihat data penilaian."}),e.jsx("span",{className:"d-sm-none",children:"Pilih chapter, kelas, semester, dan bulan terlebih dahulu."})]})},P=({data:a,isLoading:t,page:d,setPage:r,limit:c,setLimit:m,search:o,setSearch:h,totalData:u,totalPages:x})=>{var g;const[b,N]=p.useState({}),[v]=j(),k=v.get("id"),y=v.get("chapterid"),_=v.get("classid"),S=v.get("month"),w=v.get("semester"),{user:P}=s((e=>e.auth)),C=null==P?void 0:P.id,{data:F,refetch:L}=l({classid:_,subjectid:k,chapterid:y,month:S,semester:w},{skip:!(_&&k&&y&&S&&w),refetchOnMountOrArgChange:!0});p.useEffect((()=>{N({})}),[_,k,y,S,w]),p.useEffect((()=>{if(F&&Array.isArray(F)){const e={};for(const a of F)e[a.student_id]={kinerja:null!==a.kinerja&&void 0!==a.kinerja?a.kinerja:"",kedisiplinan:null!==a.kedisiplinan&&void 0!==a.kedisiplinan?a.kedisiplinan:"",keaktifan:null!==a.keaktifan&&void 0!==a.keaktifan?a.keaktifan:"",percayaDiri:null!==a.percaya_diri&&void 0!==a.percaya_diri?a.percaya_diri:"",catatan:a.catatan_guru??""};Object.keys(e).length>0&&N(e)}}),[F]);const[D,{isLoading:$,isSuccess:A,data:T,isError:E,error:K}]=i(),M=(e,a,t)=>{N((s=>({...s,[e]:{...s[e],[a]:t}})))},O=e=>{const a=b[e];if(!a)return 0;const t=[a.kinerja,a.kedisiplinan,a.keaktifan,a.percayaDiri].filter((e=>""!==e&&null!=e));return 0===t.length?0:(t.reduce(((e,a)=>e+Number(a)),0)/t.length).toFixed(1)};return p.useEffect((()=>{A&&(n.success(T.message),L()),E&&n.error(K.data.message)}),[A,T,E,K,L]),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"card-title mb-0",children:"Penilaian Sikap"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsx(f,{isLoading:t,totalData:u,totalPages:x,page:d,limit:c,setPage:r,setLimit:m,setSearch:h,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center align-middle",children:"No"}),e.jsx("th",{className:"text-center align-middle",children:"NIS"}),e.jsx("th",{className:"text-center align-middle",children:"Nama Siswa"}),e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#fff3cd"},children:"Kinerja"}),e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#fff3cd"},children:"Kedisiplinan"}),e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#fff3cd"},children:"Keaktifan"}),e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#fff3cd"},children:"Percaya Diri"}),e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#d1ecf1"},children:"Catatan"}),e.jsx("th",{className:"text-center align-middle",children:"Rata-rata"}),e.jsx("th",{className:"text-center align-middle",children:"Aksi"})]})}),e.jsx("tbody",{children:null==(g=null==a?void 0:a.students)?void 0:g.map(((a,t)=>{var s,l,i,n,r;return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(d-1)*c+t+1}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.student_name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(s=b[a.student])?void 0:s.kinerja)??"",onChange:e=>M(a.student,"kinerja",e.target.value),placeholder:"0-100"})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(l=b[a.student])?void 0:l.kedisiplinan)??"",onChange:e=>M(a.student,"kedisiplinan",e.target.value),placeholder:"0-100"})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(i=b[a.student])?void 0:i.keaktifan)??"",onChange:e=>M(a.student,"keaktifan",e.target.value),placeholder:"0-100"})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(n=b[a.student])?void 0:n.percayaDiri)??"",onChange:e=>M(a.student,"percayaDiri",e.target.value),placeholder:"0-100"})}),e.jsx("td",{className:"align-middle",children:e.jsx("textarea",{className:"form-control form-control-sm",rows:"2",value:(null==(r=b[a.student])?void 0:r.catatan)||"",onChange:e=>M(a.student,"catatan",e.target.value),placeholder:"Catatan guru..."})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"fw-bold text-primary",children:O(a.student)})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{const a=b[e.student]||{};await D({student_id:e.student,subject_id:Number(k),class_id:Number(_),chapter_id:Number(y),teacher_id:C,month:S,semester:w,kinerja:a.kinerja?Number(a.kinerja):null,kedisiplinan:a.kedisiplinan?Number(a.kedisiplinan):null,keaktifan:a.keaktifan?Number(a.keaktifan):null,percaya_diri:a.percayaDiri?Number(a.percayaDiri):null,catatan_guru:a.catatan||null})})(a),disabled:$,children:[e.jsx("i",{className:"bi bi-check"})," Simpan"]})})]},a.id)}))})]})})})})]})},C=({data:a,isLoading:t,page:s,setPage:l,limit:i,setLimit:n,search:c,setSearch:m,totalData:o,totalPages:h})=>{const[u]=j(),x=u.get("classid"),g=u.get("id"),b=u.get("month"),N=b?["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"].indexOf(b)+1:(new Date).getMonth()+1,f=(new Date).getFullYear(),{data:v,isLoading:k}=d({classid:x,subjectid:g,month:N,year:f},{skip:!x||!g});return p.useState({}),x&&g?k?e.jsx(r,{}):e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h5",{className:"card-title mb-0",children:[e.jsx("i",{className:"bi bi-calendar-month me-2"}),"Penilaian Kehadiran Bulanan"]})}),e.jsx("div",{className:"card-body",children:v&&v.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover table-striped",children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{width:"5%"},children:"No"}),e.jsx("th",{style:{width:"10%"},children:"NIS"}),e.jsx("th",{style:{width:"25%"},children:"Nama Siswa"}),e.jsxs("th",{className:"text-center",style:{width:"10%"},children:[e.jsx("i",{className:"bi bi-check-circle text-success me-1"}),"Hadir"]}),e.jsxs("th",{className:"text-center",style:{width:"10%"},children:[e.jsx("i",{className:"bi bi-heart-pulse text-primary me-1"}),"Sakit"]}),e.jsxs("th",{className:"text-center",style:{width:"10%"},children:[e.jsx("i",{className:"bi bi-envelope-paper text-info me-1"}),"Izin"]}),e.jsxs("th",{className:"text-center",style:{width:"10%"},children:[e.jsx("i",{className:"bi bi-x-circle text-danger me-1"}),"Alpa"]}),e.jsxs("th",{className:"text-center",style:{width:"10%"},children:[e.jsx("i",{className:"bi bi-percent text-warning me-1"}),"Kehadiran"]})]})}),e.jsx("tbody",{children:v.map(((a,t)=>{const s=a.hadir+a.sakit+a.izin+a.alpa,l=s>0?(a.hadir/s*100).toFixed(1):0;return e.jsxs("tr",{className:"attendance-change",children:[e.jsx("td",{className:"text-center align-middle",children:t+1}),e.jsx("td",{className:"align-middle",children:a.nis}),e.jsx("td",{className:"align-middle fw-bold",children:a.student_name}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"badge bg-success fs-6",children:a.hadir})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"badge bg-primary fs-6",children:a.sakit})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"badge bg-info fs-6",children:a.izin})}),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"badge bg-danger fs-6",children:a.alpa})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("span",{className:"badge fs-6 "+(l>=90?"bg-success":l>=80?"bg-warning":"bg-danger"),children:[l,"%"]})})]},a.studentid)}))})]})}):e.jsxs("div",{className:"text-center py-5 empty-state",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-x display-1 text-muted"})}),e.jsx("h5",{className:"fw-bold text-muted mb-2",children:"Data Tidak Tersedia"}),e.jsx("p",{className:"text-muted mb-0",children:"Tidak ada data presensi untuk periode yang dipilih"})]})})]}):e.jsxs("div",{className:"text-center py-5 empty-state",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-check display-1 text-muted"})}),e.jsx("h5",{className:"fw-bold text-muted mb-2",children:"Pilih Data Presensi"}),e.jsx("p",{className:"text-muted mb-0",children:"Silakan pilih mata pelajaran dan kelas terlebih dahulu"})]})},F=({data:a,isLoading:t,page:l,setPage:i,limit:d,setLimit:r,search:o,setSearch:h,totalData:u,totalPages:x})=>{var g;const[b,N]=p.useState({}),[v]=j(),k=v.get("id"),y=v.get("chapterid"),_=v.get("classid"),S=v.get("month"),w=v.get("semester");s((e=>e.auth));const{data:P,refetch:C}=c({classid:_,subjectid:k,chapterid:y,month:S,semester:w},{skip:!(_&&k&&y&&S&&w),refetchOnMountOrArgChange:!0});p.useEffect((()=>{N({})}),[_,k,y,S,w]),p.useEffect((()=>{if(P&&Array.isArray(P)){const e={};for(const a of P)e[a.student_id]={tugas1:null!==a.f_1&&void 0!==a.f_1?a.f_1:"",tugas2:null!==a.f_2&&void 0!==a.f_2?a.f_2:"",tugas3:null!==a.f_3&&void 0!==a.f_3?a.f_3:"",tugas4:null!==a.f_4&&void 0!==a.f_4?a.f_4:"",tugas5:null!==a.f_5&&void 0!==a.f_5?a.f_5:"",tugas6:null!==a.f_6&&void 0!==a.f_6?a.f_6:"",tugas7:null!==a.f_7&&void 0!==a.f_7?a.f_7:"",tugas8:null!==a.f_8&&void 0!==a.f_8?a.f_8:""};Object.keys(e).length>0&&N(e)}}),[P]);const[F,{isLoading:L,isSuccess:D,data:$,isError:A,error:T}]=m(),E=e=>{const a=b[e];if(!a)return 0;const t=[];for(let s=1;s<=8;s++){const e=a[`tugas${s}`];""!==e&&null!=e&&t.push(Number(e))}return 0===t.length?0:(t.reduce(((e,a)=>e+a),0)/t.length).toFixed(1)},K=a=>{var t;const s=[];for(let l=1;l<=8;l++)s.push(e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(t=b[a.student])?void 0:t[`tugas${l}`])??"",onChange:e=>{return t=a.student,s=l,i=e.target.value,void N((e=>({...e,[t]:{...e[t],[`tugas${s}`]:i}})));var t,s,i},placeholder:"0-100"})},l));return s};return p.useEffect((()=>{D&&(n.success($.message),C()),A&&n.error(T.data.message)}),[D,$,A,T,C]),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"card-title mb-0",children:"Penilaian Formatif"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsx(f,{isLoading:t,totalData:u,totalPages:x,page:l,limit:d,setPage:i,setLimit:r,setSearch:h,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center align-middle",children:"No"}),e.jsx("th",{className:"text-center align-middle",children:"NIS"}),e.jsx("th",{className:"text-center align-middle",children:"Nama Siswa"}),(()=>{const a=[];for(let t=1;t<=8;t++)a.push(e.jsxs("th",{className:"text-center align-middle",style:{backgroundColor:"#dc3545",color:"white"},children:["f_",t]},t));return a})(),e.jsx("th",{className:"text-center align-middle",children:"Rata2"}),e.jsx("th",{className:"text-center align-middle",children:"Aksi"})]})}),e.jsx("tbody",{children:null==(g=null==a?void 0:a.students)?void 0:g.map(((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(l-1)*d+t+1}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.student_name}),K(a),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"fw-bold text-primary",children:E(a.student)})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{const a=b[e.student]||{};await F({student_id:e.student,subject_id:Number(k),class_id:Number(_),chapter_id:Number(y),month:S,semester:w,F_1:a.tugas1?Number(a.tugas1):null,F_2:a.tugas2?Number(a.tugas2):null,F_3:a.tugas3?Number(a.tugas3):null,F_4:a.tugas4?Number(a.tugas4):null,F_5:a.tugas5?Number(a.tugas5):null,F_6:a.tugas6?Number(a.tugas6):null,F_7:a.tugas7?Number(a.tugas7):null,F_8:a.tugas8?Number(a.tugas8):null})})(a),disabled:L,children:[e.jsx("i",{className:"bi bi-check"})," Simpan"]})})]},a.id)))})]})})})})]})},L=({data:a,isLoading:t,page:l,setPage:i,limit:d,setLimit:r,search:c,setSearch:m,totalData:u,totalPages:x})=>{var g;const[b,N]=p.useState({}),[v]=j(),k=v.get("id"),y=v.get("chapterid"),_=v.get("classid"),S=v.get("month"),w=v.get("semester");s((e=>e.auth));const{data:P,refetch:C}=o({classid:_,subjectid:k,chapterid:y,month:S,semester:w},{skip:!(_&&k&&y&&S&&w),refetchOnMountOrArgChange:!0});p.useEffect((()=>{N({})}),[_,k,y,S,w]),p.useEffect((()=>{if(P&&Array.isArray(P)){const e={};for(const a of P)e[a.student_id]={sumatif1:null!==a.s_1&&void 0!==a.s_1?a.s_1:"",sumatif2:null!==a.s_2&&void 0!==a.s_2?a.s_2:"",sumatif3:null!==a.s_3&&void 0!==a.s_3?a.s_3:"",sumatif4:null!==a.s_4&&void 0!==a.s_4?a.s_4:"",sumatif5:null!==a.s_5&&void 0!==a.s_5?a.s_5:"",sumatif6:null!==a.s_6&&void 0!==a.s_6?a.s_6:"",sumatif7:null!==a.s_7&&void 0!==a.s_7?a.s_7:"",sumatif8:null!==a.s_8&&void 0!==a.s_8?a.s_8:""};Object.keys(e).length>0&&N(e)}}),[P]);const[F,{isLoading:L,isSuccess:D,data:$,isError:A,error:T}]=h(),E=e=>{const a=b[e];if(!a)return 0;const t=[];for(let s=1;s<=8;s++){const e=a[`sumatif${s}`];""!==e&&null!=e&&t.push(Number(e))}return 0===t.length?0:(t.reduce(((e,a)=>e+a),0)/t.length).toFixed(1)},K=a=>{var t;const s=[];for(let l=1;l<=8;l++)s.push(e.jsx("td",{className:"text-center align-middle",children:e.jsx("input",{type:"number",className:"form-control form-control-sm text-center",min:"0",max:"100",value:(null==(t=b[a.student])?void 0:t[`sumatif${l}`])??"",onChange:e=>{return t=a.student,s=l,i=e.target.value,void N((e=>({...e,[t]:{...e[t],[`sumatif${s}`]:i}})));var t,s,i},placeholder:"0-100"})},l));return s};return p.useEffect((()=>{D&&(n.success($.message),C()),A&&n.error(T.data.message)}),[D,$,A,T,C]),e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"card-title mb-0",children:"Penilaian Sumatif"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsx(f,{isLoading:t,totalData:u,totalPages:x,page:l,limit:d,setPage:i,setLimit:r,setSearch:m,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center align-middle",children:"No"}),e.jsx("th",{className:"text-center align-middle",children:"NIS"}),e.jsx("th",{className:"text-center align-middle",children:"Nama Siswa"}),(()=>{const a=[];for(let t=1;t<=8;t++)a.push(e.jsx("th",{className:"text-center align-middle",style:{backgroundColor:"#fff3cd"},children:e.jsxs("div",{children:["s_",t]})},t));return a})(),e.jsx("th",{className:"text-center align-middle",children:"Rata2"}),e.jsx("th",{className:"text-center align-middle",children:"Aksi"})]})}),e.jsx("tbody",{children:null==(g=null==a?void 0:a.students)?void 0:g.map(((a,t)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle",children:(l-1)*d+t+1}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle",children:a.student_name}),K(a),e.jsx("td",{className:"text-center align-middle",children:e.jsx("span",{className:"fw-bold text-primary",children:E(a.student)})}),e.jsx("td",{className:"text-center align-middle",children:e.jsxs("button",{className:"btn btn-sm btn-primary",onClick:()=>(async e=>{const a=b[e.student]||{};await F({student_id:e.student,subject_id:Number(k),class_id:Number(_),chapter_id:Number(y),month:S,semester:w,S_1:a.sumatif1?Number(a.sumatif1):null,S_2:a.sumatif2?Number(a.sumatif2):null,S_3:a.sumatif3?Number(a.sumatif3):null,S_4:a.sumatif4?Number(a.sumatif4):null,S_5:a.sumatif5?Number(a.sumatif5):null,S_6:a.sumatif6?Number(a.sumatif6):null,S_7:a.sumatif7?Number(a.sumatif7):null,S_8:a.sumatif8?Number(a.sumatif8):null})})(a),disabled:L,children:[e.jsx("i",{className:"bi bi-check"})," Simpan"]})})]},a.id)))})]})})})})]})},D=({data:a,isLoading:t,page:s,setPage:l,limit:i,setLimit:n,search:d,setSearch:r,totalData:c,totalPages:m})=>{var o;const[h]=j(),x=h.get("classid"),g=h.get("id"),p=h.get("chapterid"),b=h.get("month"),N=h.get("semester"),{data:v,isLoading:k}=u({classid:x,subjectid:g,chapterid:p,month:b,semester:N},{skip:!(x&&g&&p&&b&&N)}),y=t||k,_=new Map;v&&Array.isArray(v)&&v.forEach((e=>{_.set(e.student_id,e)}));const S=(()=>{if(!v||!Array.isArray(v)||0===v.length)return null;const e=v.reduce(((e,a)=>(e.kehadiran+=parseFloat(a.kehadiran)||0,e.sikap+=parseFloat(a.sikap)||0,e.formatif+=parseFloat(a.formatif)||0,e.sumatif+=parseFloat(a.sumatif)||0,e)),{kehadiran:0,sikap:0,formatif:0,sumatif:0}),a=v.length;return{kehadiran:(e.kehadiran/a).toFixed(2),sikap:(e.sikap/a).toFixed(2),formatif:(e.formatif/a).toFixed(2),sumatif:(e.sumatif/a).toFixed(2)}})();return e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header",children:e.jsx("h5",{className:"card-title mb-0",children:"Rekap Nilai"})}),e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"table-responsive",children:e.jsx(f,{isLoading:y,totalData:c,totalPages:m,page:s,limit:i,setPage:l,setLimit:n,setSearch:r,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center align-middle",style:{width:"60px"},children:"No"}),e.jsx("th",{className:"text-center align-middle",style:{width:"100px"},children:"NIS"}),e.jsx("th",{className:"text-center align-middle",children:"Siswa"}),e.jsx("th",{className:"text-center align-middle",style:{width:"100px"},children:"Kehadiran"}),e.jsx("th",{className:"text-center align-middle",style:{width:"80px"},children:"Sikap"}),e.jsx("th",{className:"text-center align-middle",style:{width:"100px"},children:"Formatif"}),e.jsx("th",{className:"text-center align-middle",style:{width:"100px"},children:"Sumatif"}),e.jsx("th",{className:"text-center align-middle",style:{width:"300px"},children:"Catatan"})]})}),e.jsx("tbody",{children:null==(o=null==a?void 0:a.students)?void 0:o.map(((a,t)=>{const l=_.get(a.student);return e.jsxs("tr",{children:[e.jsx("td",{className:"text-center align-middle fw-bold",children:(s-1)*i+t+1}),e.jsx("td",{className:"text-center align-middle",children:a.nis}),e.jsx("td",{className:"align-middle fw-medium",children:a.student_name}),e.jsx("td",{className:"text-center align-middle",children:l&&parseFloat(l.kehadiran)>0?e.jsxs("span",{className:"badge "+(parseFloat(l.kehadiran)>=80?"bg-success":parseFloat(l.kehadiran)>=60?"bg-warning":"bg-danger"),children:[l.kehadiran,"%"]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"text-center align-middle",children:l&&parseFloat(l.sikap)>0?e.jsx("span",{className:"fw-bold "+(parseFloat(l.sikap)>=80?"text-success":parseFloat(l.sikap)>=60?"text-warning":"text-danger"),children:l.sikap}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"text-center align-middle",children:l&&parseFloat(l.formatif)>0?e.jsx("span",{className:"fw-bold "+(parseFloat(l.formatif)>=80?"text-success":parseFloat(l.formatif)>=60?"text-warning":"text-danger"),children:l.formatif}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"text-center align-middle",children:l&&parseFloat(l.sumatif)>0?e.jsx("span",{className:"fw-bold "+(parseFloat(l.sumatif)>=80?"text-success":parseFloat(l.sumatif)>=60?"text-warning":"text-danger"),children:l.sumatif}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"align-middle",children:e.jsx("small",{className:"text-muted",children:(null==l?void 0:l.catatan)||"-"})})]},a.id)}))}),S&&e.jsx("tfoot",{className:"table-info",children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:"3",className:"text-center align-middle fw-bold",children:"RATA-RATA KELAS"}),e.jsxs("td",{className:"text-center align-middle fw-bold",children:[S.kehadiran,"%"]}),e.jsx("td",{className:"text-center align-middle fw-bold",children:S.sikap}),e.jsx("td",{className:"text-center align-middle fw-bold",children:S.formatif}),e.jsx("td",{className:"text-center align-middle fw-bold",children:S.sumatif}),e.jsx("td",{className:"align-middle",children:e.jsx("small",{className:"text-muted",children:"-"})})]})})]})})})})]})},$=()=>{const[t]=j(),l=t.get("subject"),i=t.get("id"),n=t.get("chapterid"),d=t.get("classid"),r=t.get("month"),c=t.get("semester"),[m,o]=p.useState("attendance"),{user:h}=s((e=>e.auth)),u=null==h?void 0:h.subjects,g=!u||0===u.length,N=d&&i&&n&&r&&c;p.useEffect((()=>{o("attendance")}),[d,i,n,r,c]),p.useEffect((()=>{k(1),A("")}),[d,i,n,r,c]);const[f,k]=p.useState(1),[y,_]=p.useState(10),[$,A]=p.useState(""),{data:T,isLoading:E}=x({page:f,limit:y,search:$,classid:d},{skip:!d});return l&&i?e.jsx(b,{title:"Penilaian",levels:["teacher"],children:e.jsxs("div",{className:"d-flex flex-column gap-3",children:[e.jsx(S,{subject:l,id:i}),e.jsx(w,{tab:m,setTab:o}),N&&e.jsxs(e.Fragment,{children:["attitude"===m&&e.jsx(P,{data:T,isLoading:E,page:f,setPage:k,limit:y,setLimit:_,search:$,setSearch:A,totalData:null==T?void 0:T.totalData,totalPages:null==T?void 0:T.totalPages},`attitude-${d}-${i}-${n}-${r}-${c}`),"attendance"===m&&e.jsx(C,{data:T,isLoading:E,page:f,setPage:k,limit:y,setLimit:_,search:$,setSearch:A,totalData:null==T?void 0:T.totalData,totalPages:null==T?void 0:T.totalPages},`attendance-${d}-${i}-${n}-${r}-${c}`),"formative"===m&&e.jsx(F,{data:T,isLoading:E,page:f,setPage:k,limit:y,setLimit:_,search:$,setSearch:A,totalData:null==T?void 0:T.totalData,totalPages:null==T?void 0:T.totalPages},`formative-${d}-${i}-${n}-${r}-${c}`),"summative"===m&&e.jsx(L,{data:T,isLoading:E,page:f,setPage:k,limit:y,setLimit:_,search:$,setSearch:A,totalData:null==T?void 0:T.totalData,totalPages:null==T?void 0:T.totalPages},`summative-${d}-${i}-${n}-${r}-${c}`),"recap"===m&&e.jsx(D,{data:T,isLoading:E,page:f,setPage:k,limit:y,setLimit:_,search:$,setSearch:A,totalData:null==T?void 0:T.totalData,totalPages:null==T?void 0:T.totalPages},`recap-${d}-${i}-${n}-${r}-${c}`)]})]})}):e.jsx(b,{title:"Penilaian",levels:["teacher"],children:g?e.jsx(a.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"row justify-content-center",children:e.jsx("div",{className:"col-md-6 text-center",children:e.jsxs("div",{className:"py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mx-auto mb-4 d-flex align-items-center justify-content-center",style:{width:"100px",height:"100px"},children:e.jsx("i",{className:"bi bi-journal-x display-4 text-primary"})}),e.jsx("h4",{className:"fw-bold mb-3",children:"Belum Ada Mata Pelajaran"}),e.jsx("p",{className:"text-muted mb-0",children:"Anda belum ditugaskan untuk mengajar mata pelajaran apapun saat ini"})]})})}):e.jsx(v,{subjects:u,user:h})})};export{$ as default};
//# sourceMappingURL=TeacherScores-pXyTYE-W.js.map
