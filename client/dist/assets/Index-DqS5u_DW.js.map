{"version":3,"file":"Index-DqS5u_DW.js","sources":["../../src/home/Index.jsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { toast } from \"react-hot-toast\";\r\nimport {\r\n  useSigninMutation,\r\n  useLoadUserMutation,\r\n} from \"../controller/api/auth/ApiAuth\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { setLogin } from \"../controller/slice/AuthSlice\";\r\nimport \"./Index.css\";\r\n\r\nconst Index = () => {\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  const [role, setRole] = useState(\"none\");\r\n  const [isSignup, setSignup] = useState(false);\r\n  const [accountValue, setAccountValue] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [signin, { isLoading, data }] = useSigninMutation();\r\n  const [loadUser, { isLoading: isLoadingUser }] = useLoadUserMutation();\r\n  const { user, isSignin } = useSelector((state) => state.auth);\r\n\r\n  const handlePasswordToggle = () => {\r\n    setShowPassword((prev) => !prev);\r\n  };\r\n\r\n  const handleRoleChange = (value) => {\r\n    setRole(value);\r\n    setAccountValue(\"\"); // Reset account value when role changes\r\n  };\r\n\r\n  const handleSignup = () => {\r\n    setRole(\"\");\r\n    setSignup(true);\r\n    setAccountValue(\"\");\r\n  };\r\n\r\n  const back = () => {\r\n    setRole(\"none\");\r\n    setSignup(false);\r\n    setAccountValue(\"\");\r\n  };\r\n\r\n  const routes = {\r\n    center: \"/center-dashboard\",\r\n    admin: \"/admin-dashboard\",\r\n    student: \"/siswa-dashboard\",\r\n    teacher: \"/guru-dashboard\",\r\n    parent: \"/wali-dashboard\",\r\n    tahfiz: \"/tahfiz-dashboard\",\r\n  };\r\n\r\n  const loginHandler = async (e) => {\r\n    e.preventDefault();\r\n\r\n    const credentials = {\r\n      password,\r\n      ...(role === \"student\"\r\n        ? { nis: accountValue }\r\n        : role === \"teacher\"\r\n        ? { username: accountValue }\r\n        : role === \"parent\"\r\n        ? { name: accountValue }\r\n        : { email: accountValue }),\r\n    };\r\n\r\n    try {\r\n      // First sign in the user\r\n      const signinResult = await signin(credentials).unwrap();\r\n\r\n      // Show loading toast\r\n      toast.loading(\"Memuat data pengguna...\");\r\n\r\n      // Dispatch initial user data\r\n      dispatch(setLogin(signinResult.user));\r\n\r\n      try {\r\n        // Then load the complete user data\r\n        const userData = await loadUser().unwrap();\r\n\r\n        // Update with complete user data\r\n        dispatch(setLogin(userData));\r\n\r\n        // Dismiss loading toast\r\n        toast.dismiss();\r\n\r\n        // Show success message\r\n        toast.success(signinResult.message);\r\n\r\n        // Redirect after loading complete user data\r\n        window.location.href = routes[userData.level] || \"/\";\r\n      } catch (error) {\r\n        console.error(\"Error loading user data:\", error);\r\n        toast.dismiss();\r\n        toast.error(\"Gagal memuat data lengkap pengguna\");\r\n\r\n        // Still redirect even if loadUser fails\r\n        window.location.href = routes[signinResult.user.level] || \"/\";\r\n      }\r\n    } catch (error) {\r\n      toast.error(error.data?.message || \"Gagal masuk\");\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user.level && isSignin) {\r\n      window.location.href = routes[user.level];\r\n    }\r\n  }, [user, isSignin]);\r\n\r\n  return (\r\n    <div>\r\n      <div className='area'>\r\n        <ul className='circles'>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n          <li></li>\r\n        </ul>\r\n      </div>\r\n\r\n      <div\r\n        className='d-flex align-items-center justify-content-center flex-column gap-3'\r\n        style={{ height: \"100vh\" }}>\r\n        <img\r\n          src='/logo.png'\r\n          alt='logo'\r\n          style={{ height: 120, width: 120, marginBottom: \"1rem\" }}\r\n        />\r\n\r\n        {role === \"none\" && (\r\n          <div className='d-flex flex-wrap justify-content-center gap-3'>\r\n            <div\r\n              className='card bg-info text-white transition-card'\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"admin\")}>\r\n              <div className='card-body d-flex flex-column align-items-center justify-content-center gap-2'>\r\n                <i\r\n                  className='bi bi-person-badge-fill transition-icon'\r\n                  style={{ fontSize: \"2rem\" }}></i>\r\n                <h5 className='card-title mb-0'>Admin</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className='card bg-info text-white transition-card'\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"teacher\")}>\r\n              <div className='card-body d-flex flex-column align-items-center justify-content-center gap-2'>\r\n                <i\r\n                  className='bi bi-person-workspace transition-icon'\r\n                  style={{ fontSize: \"2rem\" }}></i>\r\n                <h5 className='card-title mb-0'>Guru</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className='card bg-info text-white transition-card'\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"student\")}>\r\n              <div className='card-body d-flex flex-column align-items-center justify-content-center gap-2'>\r\n                <i\r\n                  className='bi bi-mortarboard-fill transition-icon'\r\n                  style={{ fontSize: \"2rem\" }}></i>\r\n                <h5 className='card-title mb-0'>Siswa</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className='card bg-info text-white transition-card'\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={() => handleRoleChange(\"parent\")}>\r\n              <div className='card-body d-flex flex-column align-items-center justify-content-center gap-2'>\r\n                <i\r\n                  className='bi bi-people-fill transition-icon'\r\n                  style={{ fontSize: \"2rem\" }}></i>\r\n                <h5 className='card-title mb-0'>Wali Murid</h5>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              className='card bg-info text-white transition-card'\r\n              style={{\r\n                width: \"150px\",\r\n                height: \"150px\",\r\n                cursor: \"pointer\",\r\n                transition: \"all 0.3s ease\",\r\n                boxShadow: \"0 4px 6px rgba(0, 0, 0, 0.1)\",\r\n              }}\r\n              onClick={handleSignup}>\r\n              <div className='card-body d-flex flex-column align-items-center justify-content-center gap-2'>\r\n                <i\r\n                  className='bi bi-person-plus-fill transition-icon'\r\n                  style={{ fontSize: \"2rem\" }}></i>\r\n                <h5 className='card-title mb-0'>Pendaftaran</h5>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {role !== \"none\" && !isSignup && (\r\n          <form\r\n            style={{ width: 300 }}\r\n            className='d-flex flex-column gap-3'\r\n            onSubmit={loginHandler}>\r\n            <div className='input-group'>\r\n              <span className='input-group-text'>\r\n                <i\r\n                  className={`bi ${\r\n                    role === \"student\"\r\n                      ? \"bi-person-badge\"\r\n                      : role === \"teacher\"\r\n                      ? \"bi-person-workspace\"\r\n                      : \"bi-envelope\"\r\n                  }`}></i>\r\n              </span>\r\n              <input\r\n                type={role === \"admin\" || role === \"parent\" ? \"email\" : \"text\"}\r\n                placeholder={\r\n                  role === \"student\"\r\n                    ? \"NIS\"\r\n                    : role === \"teacher\"\r\n                    ? \"USERNAME\"\r\n                    : \"EMAIL\"\r\n                }\r\n                value={accountValue}\r\n                onChange={(e) => setAccountValue(e.target.value)}\r\n                required\r\n                className='form-control'\r\n              />\r\n            </div>\r\n\r\n            <div className='input-group'>\r\n              <span className='input-group-text'>\r\n                <i className='bi bi-lock-fill'></i>\r\n              </span>\r\n              <input\r\n                type={showPassword ? \"text\" : \"password\"}\r\n                placeholder='Password'\r\n                className='form-control'\r\n                value={password}\r\n                onChange={(e) => setPassword(e.target.value)}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div className='form-check'>\r\n              <input\r\n                className='form-check-input'\r\n                type='checkbox'\r\n                id='flexCheckDefault'\r\n                checked={showPassword}\r\n                onChange={handlePasswordToggle}\r\n              />\r\n              <label\r\n                className='form-check-label text-white'\r\n                htmlFor='flexCheckDefault'>\r\n                Tampilkan Password\r\n              </label>\r\n            </div>\r\n\r\n            <div className='d-flex justify-content-between'>\r\n              <button\r\n                type='button'\r\n                className='btn btn-danger d-flex align-items-center gap-2'\r\n                onClick={() => setRole(\"none\")}>\r\n                <i className='bi bi-arrow-left'></i>\r\n                Kembali\r\n              </button>\r\n              <button\r\n                type='submit'\r\n                className='btn btn-success d-flex align-items-center gap-2'\r\n                disabled={isLoading || isLoadingUser}>\r\n                {isLoading || isLoadingUser ? (\r\n                  <>\r\n                    <span\r\n                      className='spinner-border spinner-border-sm'\r\n                      aria-hidden='true'></span>\r\n                    <span role='status'>Loading...</span>\r\n                  </>\r\n                ) : (\r\n                  <>\r\n                    <i className='bi bi-box-arrow-in-right'></i>\r\n                    Masuk\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        )}\r\n\r\n        {isSignup && <SignUp setRole={back} />}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Index;\r\n"],"names":["Index","dispatch","useDispatch","useNavigate","role","setRole","useState","isSignup","setSignup","accountValue","setAccountValue","password","setPassword","showPassword","setShowPassword","signin","isLoading","data","useSigninMutation","loadUser","isLoadingUser","useLoadUserMutation","user","isSignin","useSelector","state","auth","handleRoleChange","value","routes","center","admin","student","teacher","parent","tahfiz","useEffect","level","window","location","href","children","jsx","className","jsxs","jsxRuntimeExports","style","height","src","alt","width","marginBottom","cursor","transition","boxShadow","onClick","fontSize","onSubmit","async","e","preventDefault","credentials","nis","username","name","email","signinResult","unwrap","toast","loading","setLogin","userData","dismiss","c","success","message","error","console","_a","type","placeholder","onChange","target","required","id","checked","prev","htmlFor","disabled","Fragment","SignUp"],"mappings":"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"}