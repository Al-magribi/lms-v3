import{a2 as e,a3 as a,du as i,dv as t,j as l,F as s,R as n,C as r,I as d,t as o,a0 as c,dw as h,d5 as u,dx as m,dy as x,a as j,n as p,m as g,B as y,o as f,s as S,d2 as v,cX as k,dz as w,dA as C,aE as b,ch as z,D as I,h as A,y as T}from"./index-DQzW7PZe.js";import{c as L,i as P,m as $}from"./vendor-BcjG7WjF.js";import{S as _,E as D}from"./Pagination-DC8rVK_V.js";import{F as H,D as Y}from"./Table-BMframHx.js";import{R as B}from"./ContainerOutlined-BCExDTuR.js";import{d as E}from"./dayjs.min-BX9Lx_Sn.js";import"./id-B-0gMDZq.js";import{R as M}from"./DeleteOutlined-BIucr4kP.js";import{L as N}from"./index-DsGfmX04.js";import{S as O}from"./index-Da7kcvRt.js";import{R as F}from"./SaveOutlined-ULDwMm9Z.js";import{T as K}from"./index-BxXHRkvH.js";import{H as R}from"./History-B5FY8L2I.js";import"./index-CRpkii3Z.js";import"./progress-DUuXvQKb.js";import"./index-a4dnAytg.js";import"./Collapse-DoaVVwkK.js";import"./BookOutlined-BFOl15w0.js";var J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},q=function(i,t){return L.createElement(e,a({},i,{ref:t,icon:J}))},G=L.forwardRef(q);const Q=()=>{const[e,a]=P(),[u,m]=L.useState(""),[x,j]=L.useState(""),[p,g]=L.useState(""),[y,f]=L.useState(1),[S,v]=L.useState(10),[k,w]=L.useState(""),[C,b]=L.useState(""),{data:z}=i(),I=z?.homebases.map(e=>({value:e.id,label:e.name})),A=z?.grades.map(e=>({value:e.id,label:e.name})),T=z?.classes.map(e=>({value:e.id,label:e.name})),{data:$}=t({page:y,limit:S,search:C,homebaseId:u,gradeId:x,classId:p});L.useEffect(()=>{const e=setTimeout(()=>{b(k)},500);return()=>{clearTimeout(e)}},[k]);const D=[{title:"No",dataIndex:"index",key:"index",render:(e,a,i)=>(y-1)*S+i+1},{title:"Satuan",dataIndex:"homebase",key:"homebase"},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Data Siswa",dataIndex:"name",key:"name",render:(e,a)=>l.jsxs(s,{vertical:!0,align:"start",children:[l.jsx(o.Text,{strong:!0,children:e}),l.jsxs(c,{color:"blue",children:["Tingkat ",a.grade," - Kelas ",a.class]})]})},{title:"Aksi",key:"action",render:e=>l.jsx(Y.Button,{menu:{items:[{key:"detail",label:"Detail Hafalan",icon:l.jsx(B,{})},{key:"add",label:"Tambah Hafalan",icon:l.jsx(h,{})}],onClick:({key:i})=>((e,{key:i})=>{switch(i){case"detail":a({view:"detail",studentid:e.userid,name:e.name.replace(/\s+/g,"-")});break;case"add":a({view:"form",studentid:e.userid,name:e.name.replace(/\s+/g,"-")})}})(e,{key:i})},children:"Pilihan Aksi"})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(n,{gutter:[10,10],children:[l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(d.Search,{style:{minWidth:100},placeholder:"Cari Siswa ...",value:k,onChange:e=>w(e.target.value),allowClear:!0})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(_,{style:{width:"100%"},placeholder:"Pilih Satuan",options:I,virtual:!1,allowClear:!0,onChange:e=>m(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(_,{style:{width:"100%"},placeholder:"Pilih Tingkat",options:A,virtual:!1,allowClear:!0,onChange:e=>j(e)})}),l.jsx(r,{xs:24,md:12,lg:6,children:l.jsx(_,{style:{width:"100%"},placeholder:"Pilih Kelas",options:T,virtual:!1,allowClear:!0,onChange:e=>g(e)})})]}),l.jsx(H,{rowKey:"userid",columns:D,dataSource:$?.students,pagination:{size:"small",current:y,pageSize:S,total:$?.totalData,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`,onChange:(e,a)=>{f(e),v(a)}},scroll:{x:"max-content"}})]})};E.locale("id");const{Text:W}=o,X=({record:e})=>e.juzs&&0!==e.juzs.length?l.jsx(s,{vertical:!0,gap:"middle",children:e.juzs.map(e=>l.jsx(j,{type:"inner",title:`Hafalan ${e.name}`,children:l.jsx(N,{dataSource:e.verses,renderItem:e=>l.jsx(N.Item,{children:l.jsx(N.Item.Meta,{title:e.name,description:`Ayat ${e.from_ayat} - ${e.to_ayat} | Baris ${e.from_line} - ${e.to_line}`})})})},e.id))}):l.jsx(D,{description:"Tidak ada detail hafalan untuk ditampilkan"}),U=()=>{const[e,a]=L.useState(1),[i,t]=L.useState(10),[o,h]=L.useState(""),[v,k]=L.useState(null),[w,C]=L.useState(!1),[b,z]=L.useState(null),{data:I}=u({page:"",limit:"",search:""}),{data:A,isLoading:T,isFetching:P}=m({page:e,limit:i,search:o,type:v}),[$,{isLoading:D}]=x(),B=[{title:"Nama Siswa",key:"student",render:(e,a)=>l.jsxs("div",{children:[l.jsx(W,{strong:!0,children:a.name}),l.jsx("br",{}),l.jsxs(W,{type:"secondary",children:["NIS: ",a.nis]})]})},{title:"Kelas",key:"class",render:(e,a)=>`${a.grade} - ${a.classname}`},{title:"Tanggal Penilaian",dataIndex:"date",key:"date",render:e=>E(e).format("DD MMMM YYYY")},{title:"Tipe & Penguji",key:"type",render:(e,a)=>l.jsxs("div",{children:[l.jsx(c,{color:"cyan",children:a.type}),l.jsx("br",{}),l.jsx(W,{type:"secondary",children:a.examiner||"N/A"})]})},{title:"Aksi",key:"action",align:"center",render:(e,a)=>l.jsx(Y,{menu:{items:[{key:"1",label:"Edit",icon:l.jsx(f,{}),onClick:()=>(e=>{z(e),C(!0)})(a)},{key:"2",label:"Hapus",icon:l.jsx(M,{}),danger:!0,onClick:()=>g.confirm({title:"Anda yakin?",content:`Hapus laporan ${a.name} pada ${E(a.date).format("DD MMM YYYY")}?`,onOk:()=>(async e=>{try{const a=E(e.date).format("M/D/YYYY");await $({userid:e.userid,typeId:e.type_id,createdat:a}).unwrap(),S.success("Laporan berhasil dihapus")}catch(a){S.error(a.data?.message||"Gagal menghapus laporan")}})(a),okText:"Ya, Hapus",cancelText:"Batal",confirmLoading:D})}]},children:l.jsx(y,{icon:l.jsx(G,{}),type:"text"})})}];return l.jsxs(s,{vertical:!0,gap:"large",children:[l.jsx(j,{children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx(d.Search,{placeholder:"Cari nama atau NIS siswa...",onSearch:e=>{h(e),a(1)},allowClear:!0})}),l.jsx(r,{xs:24,md:12,children:l.jsx(_,{placeholder:"Filter berdasarkan tipe",style:{width:"100%"},onChange:e=>{k(e),a(1)},allowClear:!0,options:I?.map(e=>({value:e.id,label:e.name})),virtual:!1})})]})}),l.jsx(p,{spinning:T||P||D,children:l.jsx(j,{children:l.jsx(H,{columns:B,dataSource:A?.report,loading:T||P,rowKey:"id",pagination:{current:e,pageSize:i,total:A?.totalData,onChange:(e,i)=>{a(e),t(i)},showSizeChanger:!0},expandable:{expandedRowRender:e=>l.jsx(X,{record:e}),rowExpandable:e=>e.juzs&&e.juzs.length>0},scroll:{x:"max-content"}})})}),b&&l.jsx(g,{title:`Edit Hafalan - ${b.name}`,open:w,onCancel:()=>C(!1),footer:null,width:1e3,destroyOnClose:!0,children:l.jsx("p",{children:"Komponen FormMemo akan ditampilkan di sini."})})]})},{Title:V,Text:Z}=o,{Option:ee}=_,ae=({name:e,userid:a,onBack:i})=>{const{periodeId:t}=$(),d=e?e.replace(/-/g," "):"Student",[o,c]=L.useState(null),[h,m]=L.useState(null),[x,p]=L.useState([]),[g,f]=L.useState(null),[A,T]=L.useState(null),[P,D]=L.useState([]),[Y,B]=L.useState(null),[E,N]=L.useState(null),[R,J]=L.useState(null),[q,G]=L.useState(null),[Q,W]=L.useState([]),[X,U]=L.useState({}),{data:ae,isLoading:ie}=u({page:"",limit:"",search:""}),{data:te,isLoading:le}=v({page:"",limit:"",search:""}),{data:se,isLoading:ne}=k({page:"",limit:"",search:""}),{data:re,isLoading:de}=w(),[oe,{isLoading:ce,isSuccess:he,isError:ue}]=C(),me=P.find(e=>e.id===A),xe=(e,a,i,t)=>{U(l=>{const s={...l};return s[a]||(s[a]={category_id:a,indicators:{}}),"category"===e?s[a].poin=t:"indicator"===e&&(s[a].indicators[i]={indicator_id:i,poin:t}),s})};L.useEffect(()=>{he&&(c(null),m(null),p([]),f(null),T(null),D([]),B(null),N(null),J(null),G(null),W([]),U({}))},[he]);const je=[{title:"Surah",dataIndex:"fromSurahName",key:"surah",align:"center"},{title:"From Ayat",dataIndex:"fromAyat",key:"fromAyat",align:"center"},{title:"To Ayat",dataIndex:"toAyat",key:"toAyat",align:"center"},{title:"From Line",dataIndex:"fromLine",key:"fromLine",align:"center"},{title:"To Line",dataIndex:"toLine",key:"toLine",align:"center"},{title:"Action",key:"action",align:"center",render:(e,a)=>l.jsx(y,{type:"primary",danger:!0,icon:l.jsx(M,{}),onClick:()=>{return e=a.key,W(a=>a.filter(a=>a.key!==e)),void S.info("Surah removed.");var e}})}],pe=[{title:"Category",dataIndex:"name",key:"category",width:"20%"},{title:"Indicator",key:"indicator",width:"60%",render:(e,a)=>l.jsx(O,{direction:"vertical",style:{width:"100%"},children:a.indicators&&a.indicators.filter(e=>null!==e).length>0?a.indicators.filter(e=>null!==e).map(e=>l.jsxs(n,{align:"middle",justify:"space-between",style:{width:"100%"},children:[l.jsx(r,{children:l.jsx(Z,{children:e.name})}),l.jsx(r,{children:l.jsx(K,{placeholder:"Score",min:0,max:100,onChange:i=>xe("indicator",a.id,e.id,i),style:{width:120}})})]},e.id)):l.jsx(Z,{type:"secondary",children:"No indicators for this category."})})},{title:"Final Score",key:"score",width:"20%",align:"center",render:(e,a)=>l.jsx(K,{placeholder:"Total",min:0,max:100,onChange:e=>xe("category",a.id,null,e),style:{width:100}})}];return l.jsxs(s,{vertical:!0,gap:"middle",children:[l.jsxs(O,{children:[l.jsx(y,{shape:"circle",icon:l.jsx(b,{}),onClick:i}),l.jsxs(V,{style:{margin:0},level:5,children:["Penilaian Tahfiz: ",d]})]}),l.jsxs(n,{gutter:[24,24],children:[l.jsx(r,{xs:24,lg:12,children:l.jsxs(O,{direction:"vertical",size:"large",style:{width:"100%"},children:[l.jsx(j,{title:"Pilihan Hafalan",children:l.jsxs(O,{direction:"vertical",style:{width:"100%"},children:[l.jsx(Z,{strong:!0,children:"Tambah Juz (Bulk)"}),l.jsxs(n,{gutter:8,children:[l.jsx(r,{flex:"auto",children:l.jsx(_,{mode:"multiple",allowClear:!0,style:{width:"100%"},placeholder:"Pilih 1 atau lebih Juz",loading:ne,value:x,onChange:p,virtual:!1,children:se?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{children:l.jsx(y,{type:"primary",icon:l.jsx(z,{}),onClick:()=>{if(0===x.length)return void S.warning("Please select at least one Juz to add.");const e=[];x.forEach(a=>{const i=se?.find(e=>e.id===a);i&&i.surah&&i.surah.forEach(a=>{Q.some(e=>e.fromSurahName===a.surah)||e.push({key:`${i.id}-${a.surah_id}`,juzId:i.id,fromSurah:a.surah_id,fromSurahName:a.surah,fromAyat:a.from_ayat,toAyat:a.to_ayat,fromLine:1,toLine:a.lines})})}),W(a=>[...a,...e]),p([]),S.success(`${e.length} surah(s) added successfully.`)}})})]}),l.jsx(I,{}),l.jsx(Z,{strong:!0,children:"Tambah Surah (Spesifik)"}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"1. Pilih Juz",loading:ne,onChange:e=>{const a=se?.find(a=>a.id===e);f(a),D(a?.surah||[]),T(null),B(null),N(null),J(null),G(null)},virtual:!1,allowClear:!0,children:se?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"2. Pilih Surah",disabled:!g,value:A,onChange:T,virtual:!1,allowClear:!0,children:P.map(e=>l.jsx(ee,{value:e.id,children:e.surah},e.id))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"3. Dari Ayat",disabled:!me,value:Y,onChange:B,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.to_ayat-me.from_ayat+1},(e,a)=>me.from_ayat+a).map(e=>l.jsx(ee,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"4. Sampai Ayat",disabled:!Y,value:E,onChange:N,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.to_ayat-Y+1},(e,a)=>Y+a).map(e=>l.jsx(ee,{value:e,children:e},e))})})]}),l.jsxs(n,{gutter:[8,16],children:[l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"5. Dari Baris",disabled:!E,value:R,onChange:J,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.lines},(e,a)=>a+1).map(e=>l.jsx(ee,{value:e,children:e},e))})}),l.jsx(r,{xs:24,sm:12,children:l.jsx(_,{style:{width:"100%"},placeholder:"6. Sampai Baris",disabled:!R,value:q,onChange:G,virtual:!1,allowClear:!0,children:me&&Array.from({length:me.lines-R+1},(e,a)=>R+a).map(e=>l.jsx(ee,{value:e,children:e},e))})})]}),l.jsx(y,{type:"primary",onClick:()=>{W(e=>[...e,{key:`${g.id}-${me.surah_id}-${Y}`,juzId:g.id,fromSurah:me.surah_id,fromSurahName:me.surah,fromAyat:Y,toAyat:E,fromLine:R,toLine:q}]),T(null),B(null),N(null),J(null),G(null)},disabled:!q,block:!0,children:"Simpan Surah"})]})}),l.jsx(j,{title:"Detail Penilaian",children:l.jsxs(n,{gutter:[16,16],children:[l.jsx(r,{xs:24,md:12,children:l.jsx(_,{placeholder:"Pilih Jenis Penilaian",style:{width:"100%"},loading:ie,value:o,onChange:c,virtual:!1,children:ae?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})}),l.jsx(r,{xs:24,md:12,children:l.jsx(_,{placeholder:"Pilih Penguji",style:{width:"100%"},loading:le,value:h,onChange:m,virtual:!1,children:te?.map(e=>l.jsx(ee,{value:e.id,children:e.name},e.id))})})]})})]})}),l.jsx(r,{xs:24,lg:12,children:l.jsx(j,{title:"Indikator Penilaian",children:l.jsx(H,{bordered:!0,size:"small",pagination:!1,dataSource:re,columns:pe,loading:de,rowKey:"id",scroll:{x:"max-content"}})})})]}),l.jsx(I,{}),l.jsx(V,{level:5,children:"Daftar Surah"}),l.jsx(H,{bordered:!0,dataSource:Q,columns:je,pagination:{pageSize:5},locale:{emptyText:"No surahs have been added yet."},scroll:{x:"max-content"}}),l.jsx(n,{justify:"end",style:{marginTop:"24px"},children:l.jsx(r,{children:l.jsx(y,{type:"primary",icon:l.jsx(F,{}),loading:ce,disabled:0===Q.length,onClick:async()=>{if(!o||!h||0===Q.length)return void S.error("Assessment Type, Examiner, and at least one Surah are required.");const e=Object.values(X).map(e=>({category_id:e.category_id,poin:e.poin??0,indicators:Object.values(e.indicators).map(e=>({...e,poin:e.poin??0}))}));if(0===e.length)return void S.error("Please fill in the assessment scores.");const i={userid:parseInt(a),periodeId:parseInt(t),surahs:Q.map(({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})=>({fromSurah:e,fromAyat:a,toAyat:i,fromLine:t,toLine:l,juzId:s})),examiner:parseInt(h),poin:{type_id:parseInt(o),categories:e}};try{const e=await oe(i).unwrap();S.success(e.message||"Scores saved successfully!")}catch(l){S.error(l.data?.message||"Failed to save scores.")}},children:"Simpan"})})})]})},ie=()=>{const[e,a]=P(),i=e.get("view"),t=e.get("studentid"),s=e.get("name"),n=[{label:"Setor Hafalan",key:"1",children:l.jsx(Q,{})},{label:"Laporan",key:"2",children:l.jsx(U,{})}],r=()=>{a({})};return"form"===i?l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(ae,{name:s,userid:t,onBack:r})}):"detail"===i?l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(R,{name:s,userid:t,onBack:r})}):l.jsx(A,{title:"Hafalan Tahfiz",levels:["tahfiz"],children:l.jsx(T,{defaultActiveKey:"1",centered:!0,items:n})})};export{ie as default};
