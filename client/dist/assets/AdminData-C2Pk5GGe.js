import{y as e,z as a,A as s,E as t,G as i,s as n,j as r,l,H as d,m as o,I as c,F as m,r as u,J as p,K as g,N as h,O as x,P as j,Q as k,U as y,V as f,W as S,X as b,B as C,Y as w,Z as T,_ as v,$ as E,h as F,x as I}from"./index-uqXiPZaM.js";import{c as A}from"./vendor-DTs43g_X.js";import{A as L}from"./Add-ClBUWLqP.js";import{T as D}from"./TableLayout-C9zhRGu7.js";import{S as N}from"./index-BX8uTKmp.js";import{D as K,F as O}from"./Table-Cvq4F04g.js";import{C as P,S as M}from"./Cancel-Die9NTL0.js";import{M as z}from"./index-DzGsxoGF.js";import{S as H}from"./Pagination-CcDshGE9.js";import{S as J}from"./index-DimbDAWW.js";import{R as _}from"./SaveOutlined-DWY1OAxH.js";import{R as U}from"./DeleteOutlined-C5VyeaFb.js";import{U as B}from"./Upload-4363HaMA.js";import{r as R,u as V}from"./xlsx-Dmkey_AY.js";import{A as G}from"./index-7mhCT5El.js";import{U as q,R as Y}from"./InboxOutlined-DhcWKAB8.js";import{R as $}from"./FileExcelOutlined-DwAYiB5B.js";import{R as W}from"./CloseCircleOutlined-DUu7cAUq.js";import"./progress-BWpqLqt3.js";const Q=({onEdit:l})=>{const[d,o]=A.useState(1),[c,m]=A.useState(10),[u,p]=A.useState(""),{data:g,isLoading:h}=e({page:d,limit:c,search:u}),[x,{data:j,isLoading:k,isSuccess:y,error:f}]=a(),[S,{data:b,isLoading:C,isSuccess:w,error:T}]=s(),{refetch:v}=t({page:d,limit:c,search:u}),{refetch:E}=i({page:d,limit:c,search:u}),F=(e,{key:a})=>{switch(a){case"edit":(e=>{l(e)})(e);break;case"delete":s=e.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?S(s):n.warning("Aksi dibatalkan")}var s};A.useEffect(()=>{w&&n.success(b.message),T&&n.error(T.data.message)},[b,w,T]),A.useEffect(()=>{y&&(v(),E(),n.success(j.message)),f&&n.error(f.data.message)},[y,f,j]);const I=[{title:"_id",dataIndex:"id",key:"id"},{title:"Periode",dataIndex:"name",key:"name"},{title:"Status",dataIndex:"isactive",key:"isactive",render:(e,a)=>r.jsx(N,{checked:e,checkedChildren:"Aktif",unCheckedChildren:"Non-aktif",onChange:()=>{return e=a.id,void x(e);var e}})},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>F(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(D,{onSearch:e=>{p(e),o(1)},isLoading:h||k||C,columns:I,source:g?.periodes,rowKey:"id",page:d,limit:c,totalData:g?.totalData,onChange:e=>{o(e.current),m(e.pageSize)},children:"TableData"})},X=({title:e,open:a,setOpen:s,periode:t,setPeriode:i})=>{const[m]=l.useForm(),[u,{isLoading:p,data:g,isSuccess:h,error:x}]=d(),j=()=>{s(!1),i(),m.resetFields()};return A.useEffect(()=>{a&&(m.resetFields(),t?m.setFieldsValue({name:t.name}):m.resetFields())},[t,a]),A.useEffect(()=>{h&&(n.success(g.message),j()),x&&n.error(x.data.message)},[g,h,x]),r.jsx(z,{open:a,title:e,destroyOnHidden:!0,onCancel:j,style:{top:20},footer:[r.jsx(P,{onClick:j},"cancel"),r.jsx(M,{onClick:()=>m.submit()},"add")],children:r.jsx(o,{spinning:p,tip:"Memuat data...",children:r.jsx(l,{form:m,onFinish:e=>{if(t){const a={...e,id:t.id};u(a)}else m.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Periode",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(c,{placeholder:"Nama Periode"})})})})})},{Title:Z}=u,ee=()=>{const[e,a]=A.useState(!1),[s,t]=A.useState(!1),[i,n]=A.useState({});return r.jsxs(m,{vertical:!0,gap:"middle",children:[r.jsxs(m,{align:"center",justify:"space-between",children:[r.jsx(Z,{style:{margin:0},level:5,children:"Mangement Periode"}),r.jsx(L,{onClick:()=>a(!0)})]}),r.jsx(Q,{onEdit:e=>{n(e),a(!0),t(!0)}}),r.jsx(X,{open:e,title:s?"Edit Periode":"Tambah Periode",periode:i,setPeriode:()=>n({}),setOpen:()=>a(!1)})]})},ae=({onEdit:e})=>{const[a,s]=A.useState(1),[t,i]=A.useState(10),[l,d]=A.useState(""),{data:o,isLoading:c}=p({page:a,limit:t,search:l}),[m,{data:u,isLoading:h,isSuccess:x,error:j}]=g(),k=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"delete":t=a.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?m(t):n.warning("Aksi dibatalkan")}var t};A.useEffect(()=>{x&&n.success(u.message),j&&n.error(j.data.message)},[u,x,j]);const y=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Jurusan",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>k(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(D,{onSearch:e=>{d(e),s(1)},isLoading:c||h,columns:y,source:o?.majors,rowKey:"id",page:a,limit:t,totalData:o?.totalData,onChange:e=>{s(e.current),i(e.pageSize)},children:"TableData"})},se=({title:e,open:a,setOpen:s,major:t,setMajor:i})=>{const[d]=l.useForm(),[m,{isLoading:u,isSuccess:p,error:g,data:x}]=h(),j=()=>{s(!1),i(),d.resetFields()};return A.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name}):d.resetFields())},[t,a]),A.useEffect(()=>{p&&(n.success(x.message),j()),g&&n.error(g.data.message)},[x,p,g]),r.jsx(z,{open:a,title:e,destroyOnHidden:!0,onCancel:j,style:{top:20},footer:[r.jsx(P,{onClick:j},"cancel"),r.jsx(M,{onClick:()=>d.submit()},"add")],children:r.jsx(o,{spinning:u,tip:"Memuat data...",children:r.jsx(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};console.log(a),m(a)}else d.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Jurusan",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(c,{placeholder:"Nama Jurusan"})})})})})},{Title:te}=u,ie=()=>{const[e,a]=A.useState(!1),[s,t]=A.useState(!1),[i,n]=A.useState({});return r.jsxs(m,{vertical:!0,gap:"middle",children:[r.jsxs(m,{align:"center",justify:"space-between",children:[r.jsx(te,{style:{margin:0},level:5,children:"Management Jurusan"}),r.jsx(L,{onClick:()=>a(!0)})]}),r.jsx(ae,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(se,{title:s?"Edit Jurusan":"Tambah Jurusan",open:e,setOpen:()=>a(!1),major:i,setMajor:()=>n({})})]})},ne=({title:e,open:a,setOpen:s,grade:t,setGrade:i})=>{const[d]=l.useForm(),[m,{isLoading:u,isSuccess:p,error:g,data:h}]=x(),j=()=>{s(!1),i(),d.resetFields()};return A.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name}):d.resetFields())},[t,a]),A.useEffect(()=>{p&&(n.success(h.message),j()),g&&(console.log(g),n.error(g.data.message))},[h,p,g]),r.jsx(z,{open:a,title:e,destroyOnHidden:!0,onCancel:j,style:{top:20},footer:[r.jsx(P,{onClick:j},"cancel"),r.jsx(M,{onClick:()=>d.submit()},"add")],children:r.jsx(o,{spinning:u,tip:"Memuat data...",children:r.jsx(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};m(a)}else d.resetFields()},layout:"vertical",children:r.jsx(l.Item,{name:"name",label:"Nama Tingkat",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(c,{type:"number",placeholder:"Nama Tingkat"})})})})})},re=({onEdit:e})=>{const[a,s]=A.useState(1),[t,i]=A.useState(10),[l,d]=A.useState(""),{data:o,isLoading:c}=j({page:a,limit:t,search:l}),[m,{data:u,isLoading:p,isSuccess:g,error:h}]=k(),x=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"delete":t=a.id,window.confirm("Apakah anda yakin akan menghapus data ini?!")?m(t):n.warning("Aksi dibatalkan")}var t};A.useEffect(()=>{g&&n.success(u.message),h&&n.error(h.data.message)},[u,g,h]);const y=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Tingkat",dataIndex:"name",key:"name"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"delete",label:"Hapus"}],onClick:({key:a})=>x(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsx(D,{onSearch:e=>{d(e),s(1)},isLoading:c||p,columns:y,source:o?.grades,rowKey:"id",page:a,limit:t,totalData:o?.totalData,onChange:e=>{s(e.current),i(e.pageSize)},children:"TableData"})},{Title:le}=u,de=()=>{const[e,a]=A.useState(!1),[s,t]=A.useState(!1),[i,n]=A.useState({});return r.jsxs(m,{vertical:!0,gap:"middle",children:[r.jsxs(m,{align:"center",justify:"space-between",children:[r.jsx(le,{style:{margin:0},level:5,children:"Management Tingkat"}),r.jsx(L,{onClick:()=>a(!0)})]}),r.jsx(re,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(ne,{title:s?"Edit Tingkat":"Tambah Tingkat",open:e,setOpen:()=>a(!1),grade:i,setGrade:()=>n({})})]})},oe=({title:e,open:a,setOpen:s,classData:t,setClassData:i})=>{const[d]=l.useForm(),{data:m}=j({page:"",limit:"",search:""}),{data:u}=p({page:"",limit:"",search:""}),g=m?.map(e=>({value:e.id,label:e.name})),h=u?.map(e=>({value:e.id,label:e.name})),[x,{isLoading:k,isSuccess:f,error:S,data:b}]=y(),C=()=>{s(!1),i(),d.resetFields()};return A.useEffect(()=>{a&&(d.resetFields(),t?d.setFieldsValue({name:t.name,gradeId:t.grade,majorId:t.major}):d.resetFields())},[t,a]),A.useEffect(()=>{f&&(n.success(b.message),C()),S&&n.error(S.data.message)},[b,f,S]),r.jsx(z,{open:a,title:e,destroyOnHidden:!0,onCancel:C,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:()=>d.submit(),confirmLoading:k,loading:k,children:r.jsx(o,{spinning:k,tip:"Memuat data...",children:r.jsxs(l,{form:d,onFinish:e=>{if(t){const a={...e,id:t.id};x(a)}else d.resetFields()},layout:"vertical",children:[r.jsx(l.Item,{name:"gradeId",label:"Pilih Tingkat",rules:[{required:!0,message:"Wajid diisi"}],children:r.jsx(H,{placeholder:"Pilih Tingkat",options:g,onChange:e=>{d.setFieldsValue({gradeId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),r.jsx(l.Item,{name:"majorId",label:"Pilih Jurusan",children:r.jsx(H,{placeholder:"Pilih Jurusan",options:h,onChange:e=>{d.setFieldsValue({majorId:e})},allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),r.jsx(l.Item,{name:"name",label:"Nama Kelas",rules:[{required:!0,message:"Kolom wajib diisi"}],children:r.jsx(c,{placeholder:"Nama Kelas"})})]})})})},{Text:ce}=u,me=({open:e,onClose:a,classname:s,classid:t})=>{const[i,l]=A.useState(1),[d,o]=A.useState(10),[u,p]=A.useState(""),[g,h]=A.useState(""),{data:x,isLoading:j,refetch:k}=f({page:i,limit:d,search:u,classid:t},{skip:!t}),[y,{isLoading:T,isSuccess:v,data:E,error:F}]=S(),[I,{data:L,isLoading:N,isSuccess:K,error:O}]=b(),P=e=>{z.confirm({title:"Yakin ingin menghapus siswa ini?",icon:r.jsx(w,{}),content:r.jsxs(ce,{strong:!0,children:[e.student_name," (",e.nis,")"]}),okText:"Hapus",okButtonProps:{danger:!0},cancelText:"Batal",onOk(){var a;a=e.student,console.log(a),I(a)},onCancel(){n.info("Aksi dibatalkan")}})};A.useEffect(()=>{v&&(n.success(E.message),h("")),F&&n.error(F.data.message)},[v,F,E]),A.useEffect(()=>{K&&(n.success(L?.message),k()),O&&n.error(O?.data?.message)},[K,O,L,k]);const M=[{title:"No",key:"no",render:(e,a,s)=>(i-1)*d+s+1},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name",render:(e,a)=>r.jsxs(J,{direction:"vertical",size:0,children:[r.jsx(ce,{children:a.student_name}),r.jsxs(ce,{type:"secondary",style:{fontSize:"12px"},children:["NIS: ",a.nis]})]})},{title:"Aksi",key:"action",render:e=>r.jsx(C,{danger:!0,icon:r.jsx(U,{}),onClick:()=>P(e),loading:N,children:"Hapus"})}];return r.jsx(z,{open:e,title:`Daftar Siswa Kelas ${s}`,onCancel:a,footer:[r.jsx(C,{onClick:a,children:"Tutup"},"close")],width:800,style:{top:20},children:r.jsxs(m,{vertical:!0,gap:"middle",children:[r.jsxs(J.Compact,{children:[r.jsx(c,{placeholder:"Masukan NIS",onChange:e=>h(e.target.value)}),r.jsx(C,{type:"primary",icon:r.jsx(_,{}),onClick:()=>{y({nis:g,classid:t})},disabled:T})]}),r.jsx(D,{onSearch:e=>{p(e),l(1)},isLoading:j||N,columns:M,source:x?.students,rowKey:"student",page:i,limit:d,totalData:x?.totalData,onChange:e=>{l(e.current),o(e.pageSize)}})]})})},{Text:ue}=u,{confirm:pe}=z,ge=({onEdit:e})=>{const[a,s]=A.useState(1),[t,l]=A.useState(10),[d,o]=A.useState(""),[c,u]=A.useState(!1),[p,g]=A.useState(""),{data:h,isLoading:x}=i({page:a,limit:t,search:d}),[j,{data:k,isLoading:y,isSuccess:f,error:S}]=T(),b=(a,{key:s})=>{switch(s){case"edit":(a=>{e(a)})(a);break;case"detail":(e=>{g(e),u(!0)})(a);break;case"delete":t=a.id,pe({title:"Konfirmasi Hapus Data",content:"Apakah anda yakin akan menghapus data ini?!",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){j(t)},onCancel(){n.warning("Aksi dibatalkan")}})}var t};A.useEffect(()=>{f&&n.success(k.message),S&&n.error(S.data.message)},[k,f,S]);const C=[{title:"No",key:"no",render:(e,s,i)=>(a-1)*t+i+1},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Jurusan",dataIndex:"major_name",key:"major_name"},{title:"Kelas",dataIndex:"name",key:"name",render:(e,a)=>r.jsxs(m,{vertical:!0,gap:"small",children:[r.jsx(ue,{children:e}),r.jsxs("small",{children:["id : ",a.id]})]})},{title:"Jumlah Siswa",dataIndex:"students",key:"students"},{title:"Aksi",key:"action",render:e=>r.jsx(K.Button,{menu:{items:[{key:"edit",label:"Edit"},{key:"detail",label:"Detail"},{key:"delete",label:"Hapus",danger:!0}],onClick:({key:a})=>b(e,{key:a})},children:"Pilihan Aksi"})}];return r.jsxs(r.Fragment,{children:[r.jsx(D,{onSearch:e=>{o(e),s(1)},isLoading:x||y,columns:C,source:h?.classes,rowKey:"id",page:a,limit:t,totalData:h?.totalData,onChange:e=>{s(e.current),l(e.pageSize)}}),r.jsx(me,{open:c,onClose:()=>(g({}),void u(!1)),classname:p?.name,classid:p?.id})]})},{Dragger:he}=q,{Text:xe,Title:je}=u,ke=({open:e,onClose:a})=>{const[s,t]=A.useState(null),[i,l]=A.useState([]),[d,{isLoading:o,isSuccess:c,error:u,data:p}]=v();return A.useEffect(()=>{s?(()=>{if(s){const e=new FileReader;e.onload=e=>{try{const a=new Uint8Array(e.target.result),s=R(a,{type:"array"}),i=s.SheetNames[0],r=s.Sheets[i],d=V.sheet_to_json(r,{header:1,range:1}).map(e=>e.slice(0,5)).filter(e=>e.some(e=>null!=e&&""!==e));if(0===d.length)return n.error("Tidak ada data dalam file atau template salah."),void t(null);l(d),n.success(`Jumlah data terbaca ${d.length} siswa.`)}catch(a){n.error("Gagal memproses data. Pastikan template yang digunakan benar"),console.error("Error parsing Excel file:",a)}},e.readAsArrayBuffer(s)}})():l([])},[s]),A.useEffect(()=>{c&&(n.success(p.message),t(null),l([]),a()),u&&n.error(u.data.message)},[c,p,u]),r.jsx(z,{title:"Bulk Upload Students",open:e,onCancel:()=>{t(null),l([]),a()},destroyOnHidden:!0,width:700,style:{top:20},okText:"Simpan",cancelText:"Tutup",onOk:async()=>{0!==i.length?d(i):n.warning("Tidak ada data yang diupload, pastikan template sesuai")},confirmLoading:o,loading:o,children:r.jsxs(J,{direction:"vertical",style:{width:"100%"},size:"large",children:[r.jsx(G,{message:"Follow these steps",description:r.jsxs(J,{direction:"vertical",size:2,children:[r.jsx(xe,{children:"1. Unduh template excel yang sudah disediakan."}),r.jsx(xe,{children:"2. Isikan data siswa berdasarkan kolom yang tersedia."}),r.jsx(xe,{children:"3. Upload kembali file yang sudah diisi."}),r.jsx(C,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_siswa.xlsx","_blank")},children:"Download Template"})]}),type:"info",showIcon:!0}),s?r.jsxs(J,{direction:"vertical",style:{width:"100%"},children:[r.jsxs(m,{align:"center",justify:"space-between",style:{background:"#f0f0f0",padding:"8px 12px",borderRadius:"6px"},children:[r.jsxs(m,{align:"center",gap:"small",children:[r.jsx($,{style:{color:"#217346",fontSize:20}}),r.jsx(xe,{strong:!0,children:s.name}),r.jsxs(E,{color:"green",children:[i.length," records found"]})]}),r.jsx(C,{type:"text",danger:!0,icon:r.jsx(W,{}),onClick:()=>t(null),children:"Change File"})]}),i.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(je,{level:5,style:{marginTop:16},children:"Data Preview"}),r.jsx(O,{columns:[{title:"TAHUN MASUK",dataIndex:0,key:"tahunMasuk"},{title:"NIS",dataIndex:1,key:"nis"},{title:"NAMA LENGKAP",dataIndex:2,key:"nama"},{title:"Kelamin",dataIndex:3,key:"kelamin"},{title:"Kelas",dataIndex:4,key:"kelas"}],dataSource:i.map((e,a)=>({key:a,...e})),size:"small",pagination:{pageSize:5,showSizeChanger:!1},scroll:{y:240}})]})]}):r.jsxs(he,{name:"file",accept:".xlsx, .xls, .csv",beforeUpload:e=>(t(e),!1),children:[r.jsx("p",{className:"ant-upload-drag-icon",children:r.jsx(Y,{})}),r.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"}),r.jsx("p",{className:"ant-upload-hint",children:"Ensure the file matches the template format."})]})]})})},{Title:ye}=u,fe=()=>{const[e,a]=A.useState(!1),[s,t]=A.useState(!1),[i,n]=A.useState({}),[l,d]=A.useState(!1);return r.jsxs(m,{vertical:!0,gap:"middle",children:[r.jsxs(m,{align:"center",justify:"space-between",children:[r.jsx(ye,{style:{margin:0},level:5,children:"Management Kelas"}),r.jsxs(J,{children:[r.jsx(L,{onClick:()=>a(!0)}),r.jsx(B,{onClick:()=>d(!0)})]})]}),r.jsx(ge,{onEdit:e=>{n(e),t(!0),a(!0)}}),r.jsx(oe,{title:s?"Edit Kelas":"Tambah Kelas",open:e,setOpen:()=>a(!1),classData:i,setClassData:()=>n({})}),r.jsx(ke,{open:l,onClose:()=>d(!1)})]})},Se=()=>{const e=[{label:"Periode",key:"1",children:r.jsx(ee,{})},{label:"Jurusan",key:"2",children:r.jsx(ie,{})},{label:"Tingkat",key:"3",children:r.jsx(de,{})},{label:"Kelas",key:"4",children:r.jsx(fe,{})}];return r.jsx(F,{title:"Management Data pokok",levels:["admin"],children:r.jsx(I,{defaultActiveKey:"1",centered:!0,items:e})})};export{Se as default};
//# sourceMappingURL=AdminData-C2Pk5GGe.js.map
