import{a as T,r as j,ab as E,ac as F,j as e,e as L,ad as P,f as $,ae as U}from"./index-B88h2kYZ.js";import{L as _}from"./Layout-BzzV81EK.js";import{T as R}from"./Table-BvY52Fag.js";import{r as G,u as J}from"./xlsx-BPPrXeCd.js";const p=d=>({__html:d}),q=({subject:d,name:m,bankid:c})=>{const l=T(),[r,g]=j.useState(1),[i,u]=j.useState(10),[x,N]=j.useState(""),{data:b={},isLoading:s}=E({page:r,limit:i,search:x,bankid:c}),{totalData:f,totalPages:k,questions:o=[]}=b,[y,{isLoading:v}]=F(),S=a=>{L.promise(y(a).unwrap().then(n=>n.message),{loading:"Memproses...",success:n=>n,error:n=>n.data.message})},w=a=>{const n=m.replace(/[\s/]/g,"-"),t=d.replace(/[\s/]/g,"-");l(`/admin-cbt-bank/${t}/${n}/${c}/${a}/edit-soal`)};return e.jsx(R,{page:r,setPage:g,setLimit:u,setSearch:N,totalData:f,totalPages:k,isLoading:s,children:e.jsxs("table",{className:"table table-bordered table-striped table-hover mb-0",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",children:"No"}),e.jsx("th",{className:"text-center",children:"Jenis"}),e.jsx("th",{className:"text-center",children:"Pertanyaan"}),e.jsx("th",{className:"text-center",children:"A"}),e.jsx("th",{className:"text-center",children:"B"}),e.jsx("th",{className:"text-center",children:"C"}),e.jsx("th",{className:"text-center",children:"D"}),e.jsx("th",{className:"text-center",children:"E"}),e.jsx("th",{className:"text-center",children:"Jawaban"}),e.jsx("th",{className:"text-center",children:"Poin"}),e.jsx("th",{className:"text-center",children:"Aksi"})]})}),e.jsx("tbody",{children:(o==null?void 0:o.length)>0?o==null?void 0:o.map((a,n)=>e.jsxs("tr",{children:[e.jsx("td",{className:"text-center",children:(r-1)*i+n+1}),e.jsx("td",{className:"text-center",children:a.qtype==1?"PG":"Essay"}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.question)})}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.a)})}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.b)})}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.c)})}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.d)})}),e.jsx("td",{children:e.jsx("p",{dangerouslySetInnerHTML:p(a.e)})}),e.jsx("td",{className:"text-center",children:a.qkey}),e.jsx("td",{className:"text-center",children:a.poin}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>w(a.id),children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-sm btn-danger",disabled:v,onClick:()=>S(a.id),children:e.jsx("i",{className:"bi bi-trash"})})]})})]},a.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:11,children:"Data belum tersedia"})})})]})})},z=({bankid:d})=>{const[m,c]=j.useState(null),l=j.useRef(null),[r,{isLoading:g,isError:i,isSuccess:u,reset:x}]=P(),N=s=>{if(s.preventDefault(),m){const f=new FileReader;f.onload=k=>{const o=new Uint8Array(k.target.result),y=G(o,{type:"array"}),v=y.SheetNames[0],S=y.Sheets[v],a=J.sheet_to_json(S,{header:1,range:1}).map(t=>{const[h,D,A,H,B,I,Q,M,C]=t;return h==2?[h,D,null,null,null,null,null,M,C]:[h,D,A,H,B,I,Q,M,C]}).filter(t=>t[0]===2?!0:t.every(h=>h!=null)),n=Array.isArray(a)?a:[a];L.promise(r({body:n,bankid:d}).unwrap().then(t=>t.message),{loading:"Menyimpan data...",success:t=>t,error:t=>t.data.message})},f.readAsArrayBuffer(m)}},b=()=>{l.current.value=null,c(null)};return j.useEffect(()=>{u&&(x(),l.current.value=null),i&&(x(),l.current.value=null)},[u,i]),e.jsx("div",{className:"modal fade",id:"upload","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",id:"staticBackdropLabel",children:"Upload Soal"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsx("input",{type:"file",name:"file",id:"file",className:"form-control",ref:l,onChange:s=>c(s.target.files[0])})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-secondary","data-bs-dismiss":"modal",onClick:b,children:"Batal"}),e.jsx("button",{type:"button",className:"btn btn-sm btn-primary",disabled:g,onClick:N,children:"Upload"})]})]})})})},X=()=>{const d=T(),m=$(),{subject:c,name:l,bankid:r}=m,[g,{isLoading:i}]=U(),u=()=>{window.confirm("Apakah Anda yakin akan menghapus bank soal ini?")&&L.promise(g(r).unwrap().then(s=>s.message),{loading:"Memproses...",success:s=>s,error:s=>s.data.message})},x=()=>{const b=l.replace(/[\s/]/g,"-"),s=c.replace(/[\s/]/g,"-");d(`/admin-cbt-bank/${s}/${b}/${r}/tambah-soal`)},N=()=>{window.open("/temp/template_soal.xlsx","_blank")};return e.jsxs(_,{title:"Daftar Soal ",levels:["admin","teacher"],children:[e.jsx("div",{className:"container-fluid bg-white p-2 rounded shadow border mb-2",children:e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-lg-6 col-12 d-flex align-items-center",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("p",{className:"m-0",children:["Mata Pelajaran: ",e.jsx("strong",{children:c.replace(/-/g," ")})]}),e.jsxs("p",{className:"m-0",children:["Bank Soal: ",e.jsx("strong",{children:l.replace(/-/g," ")})]})]})}),e.jsx("div",{className:"col-lg-6 col-12",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2 justify-content-end",children:[e.jsx("button",{className:"btn btn-sm btn-secondary","data-toggle":"tooltip","data-placement":"bottom",title:"Template",onClick:N,children:e.jsx("i",{className:"bi bi-filetype-xlsx"})}),e.jsx("button",{className:"btn btn-sm btn-primary","data-toggle":"tooltip","data-placement":"bottom",title:"Upload","data-bs-toggle":"modal","data-bs-target":"#upload",children:e.jsx("i",{className:"bi bi-file-earmark-arrow-up"})}),e.jsx("button",{"data-toggle":"tooltip","data-placement":"bottom",title:"Tambah Soal",className:"btn btn-sm btn-success",onClick:x,children:e.jsx("i",{className:"bi bi-file-earmark-plus"})}),e.jsx("button",{className:"btn btn-sm btn-danger","data-toggle":"tooltip","data-placement":"bottom",title:"Hapus Soal",disabled:i,onClick:u,children:e.jsx("i",{className:"bi bi-folder-x"})})]})})]})}),e.jsx(q,{subject:c,name:l,bankid:r}),e.jsx(z,{bankid:r})]})};export{X as default};
