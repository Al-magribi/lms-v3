{"version":3,"file":"TeacherDatabase-DS68p2hC.js","sources":["../../src/page/teacher/database/TeacherDatabase.jsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport Layout from \"../../../components/layout/Layout\";\r\nimport { useParams } from \"react-router-dom\";\r\nimport {\r\n  useGetDatabaseByClassQuery,\r\n  useGetPeriodeQuery,\r\n} from \"../../../controller/api/database/ApiDatabase\";\r\nimport Table from \"../../../components/table/Table\";\r\nimport { useNavigate } from \"react-router-dom\";\r\nimport { useChangePeriodeMutation } from \"../../../controller/api/admin/ApiStudent\";\r\nimport toast from \"react-hot-toast\";\r\nimport { useChangeStatusMutation } from \"../../../controller/api/admin/ApiStudent\";\r\nconst TeacherDatabase = () => {\r\n  const navigate = useNavigate();\r\n  const { classname, classid } = useParams();\r\n  const [page, setPage] = useState(1);\r\n  const [limit, setLimit] = useState(10);\r\n  const [search, setSearch] = useState(\"\");\r\n  const [selectedPeriode, setSelectedPeriode] = useState(\"\");\r\n\r\n  const { data, isLoading, isError, refetch } = useGetDatabaseByClassQuery({\r\n    page,\r\n    limit,\r\n    search,\r\n    classid,\r\n  });\r\n  const { students = [], totalData, totalPages } = data || {};\r\n  const { data: periodes } = useGetPeriodeQuery();\r\n\r\n  const [changePeriode, { isLoading: isChanging }] = useChangePeriodeMutation();\r\n  const [changeStatus, { isLoading: isChangingStatus }] =\r\n    useChangeStatusMutation();\r\n\r\n  const gotoDatabase = (userid, name) => {\r\n    const formattedName = name.replace(/\\s+/g, \"-\");\r\n    navigate(`/database/${userid}/${formattedName}`);\r\n  };\r\n\r\n  const changeHandler = (id) => {\r\n    toast.promise(\r\n      changeStatus(id)\r\n        .unwrap()\r\n        .then((res) => {\r\n          refetch();\r\n          return res.message;\r\n        }),\r\n      {\r\n        loading: \"Memproses...\",\r\n        success: (message) => message,\r\n        error: (err) => err.data.message,\r\n      }\r\n    );\r\n  };\r\n\r\n  const updatePeriode = (e) => {\r\n    const periodeId = e.target.value;\r\n    setSelectedPeriode(periodeId);\r\n  };\r\n\r\n  const handleSavePeriode = async () => {\r\n    if (!selectedPeriode) {\r\n      toast.error(\"Pilih tahun ajaran terlebih dahulu\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Update each student's period\r\n      const updatePromises = students.map((student) =>\r\n        changePeriode({ userid: student.student, periodeid: selectedPeriode })\r\n      );\r\n\r\n      await Promise.all(updatePromises);\r\n      toast.success(\"Berhasil mengganti tahun ajaran\");\r\n      setSelectedPeriode(\"\");\r\n      refetch();\r\n    } catch (err) {\r\n      console.error(\"Error updating periods:\", err);\r\n      toast.error(\"Gagal mengganti tahun ajaran\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Layout\r\n      title={`Database Kelas ${classname.replace(/-/g, \" \")}`}\r\n      levels={[\"teacher\"]}\r\n    >\r\n      <Table\r\n        isLoading={isLoading}\r\n        page={page}\r\n        setPage={setPage}\r\n        limit={limit}\r\n        setLimit={setLimit}\r\n        setSearch={setSearch}\r\n        totalData={totalData}\r\n        totalPages={totalPages}\r\n      >\r\n        <table className=\"mb-0 table table-striped table-hover table-bordered\">\r\n          <thead>\r\n            <tr>\r\n              <th className=\"text-center\">No</th>\r\n              <th className=\"text-center\">Tahun Ajaran</th>\r\n              <th className=\"text-center\">Satuan</th>\r\n              <th className=\"text-center\">Nama</th>\r\n              <th className=\"text-center\">Kelas</th>\r\n              <th className=\"text-center\">L/P</th>\r\n              <th className=\"text-center\">Kelengkapan</th>\r\n              <th className=\"text-center\">Status</th>\r\n              <th className=\"text-center\">Aksi</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {students.map((student, index) => (\r\n              <tr key={student.id}>\r\n                <td className=\"text-center align-middle\">\r\n                  {(page - 1) * limit + index + 1}\r\n                </td>\r\n                <td className=\"text-center align-middle\">\r\n                  {student.periode_name === student.active_periode ? (\r\n                    student.periode_name\r\n                  ) : (\r\n                    <div className=\"d-flex justify-content-center gap-2\">\r\n                      <span className=\"badge bg-danger\">\r\n                        {student.periode_name}\r\n                      </span>\r\n                      <i className=\"bi bi-arrow-right\"></i>\r\n                      <span className=\"badge bg-success\">\r\n                        {student.active_periode}\r\n                      </span>\r\n                    </div>\r\n                  )}\r\n                </td>\r\n                <td className=\"text-center align-middle\">\r\n                  {student.homebase_name}\r\n                </td>\r\n                <td className=\"align-middle\">{student.student_name}</td>\r\n                <td className=\"text-center align-middle\">\r\n                  {student.class_name}\r\n                </td>\r\n                <td className=\"text-center align-middle\">\r\n                  {student.student_gender}\r\n                </td>\r\n                <td className=\"text-center align-middle\">\r\n                  <div className=\"progress\" style={{ height: \"20px\" }}>\r\n                    <div\r\n                      className={`progress-bar ${\r\n                        parseInt(student.completeness) === 100\r\n                          ? \"bg-success\"\r\n                          : parseInt(student.completeness) >= 50\r\n                          ? \"bg-warning\"\r\n                          : \"bg-danger\"\r\n                      }`}\r\n                      role=\"progressbar\"\r\n                      style={{ width: `${student.completeness}%` }}\r\n                      aria-valuenow={student.completeness}\r\n                      aria-valuemin=\"0\"\r\n                      aria-valuemax=\"100\"\r\n                    >\r\n                      {student.completeness}%\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n\r\n                <td className=\"text-center align-middle\">\r\n                  <div\r\n                    className=\"form-check form-switch d-flex justify-content-center\"\r\n                    onClick={() => changeHandler(student.student)}\r\n                  >\r\n                    <input\r\n                      className=\"form-check-input pointer\"\r\n                      type=\"checkbox\"\r\n                      role=\"switch\"\r\n                      id=\"flexSwitchCheckChecked\"\r\n                      checked={student.isactive}\r\n                      readOnly\r\n                    />\r\n                  </div>\r\n                </td>\r\n\r\n                <td className=\"text-center align-middle\">\r\n                  <button\r\n                    className=\"btn btn-sm btn-primary\"\r\n                    onClick={() =>\r\n                      gotoDatabase(student.student, student.student_name)\r\n                    }\r\n                  >\r\n                    <i className=\"bi bi-database\"></i>\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n          <tfoot>\r\n            <tr>\r\n              <td colSpan={9}>\r\n                <div className=\"d-flex align-items-center justify-content-end gap-2\">\r\n                  <select\r\n                    style={{ width: \"20%\" }}\r\n                    className=\"form-select\"\r\n                    value={selectedPeriode}\r\n                    onChange={updatePeriode}\r\n                  >\r\n                    <option value=\"\" hidden>\r\n                      Ganti Tahun Ajaran\r\n                    </option>\r\n                    {periodes?.map((periode) => (\r\n                      <option key={periode.id} value={periode.id}>\r\n                        {periode.name}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n\r\n                  <button\r\n                    className=\"btn btn-sm btn-success\"\r\n                    onClick={handleSavePeriode}\r\n                    disabled={isChanging || !selectedPeriode}\r\n                  >\r\n                    <i className=\"bi bi-save\"></i>\r\n                    <span className=\"ms-2\">\r\n                      {isChanging ? \"Menyimpan...\" : \"Simpan\"}\r\n                    </span>\r\n                  </button>\r\n                </div>\r\n              </td>\r\n            </tr>\r\n          </tfoot>\r\n        </table>\r\n      </Table>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default TeacherDatabase;\r\n"],"names":["TeacherDatabase","navigate","useNavigate","classname","classid","useParams","page","setPage","useState","limit","setLimit","search","setSearch","selectedPeriode","setSelectedPeriode","data","isLoading","isError","refetch","useGetDatabaseByClassQuery","students","totalData","totalPages","periodes","useGetPeriodeQuery","changePeriode","isChanging","useChangePeriodeMutation","changeStatus","isChangingStatus","useChangeStatusMutation","jsxRuntimeExports","jsx","Layout","title","replace","levels","children","Table","jsxs","className","map","student","index","periode_name","active_periode","homebase_name","student_name","class_name","student_gender","style","height","parseInt","completeness","role","width","onClick","changeHandler","id","Vt","promise","unwrap","then","res","message","loading","success","error","err","type","checked","isactive","readOnly","userid","name","formattedName","gotoDatabase","colSpan","value","onChange","e","periodeId","target","hidden","periode","async","updatePromises","periodeid","Promise","all","toast","console","disabled"],"mappings":"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"}