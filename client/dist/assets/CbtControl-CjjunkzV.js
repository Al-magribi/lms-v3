import{B as e,_ as a,aM as t,aN as s,s as n,j as i,a as l,F as r,n as d,R as o,C as c,aO as u,t as h,b as m,am as x,r as p,m as g,aA as j,l as k,aP as b,aQ as y,I as f,aR as w,aS as S,E as v,a5 as C,aT as T,aU as _,aL as P,D as $,aV as I,aW as L,aX as q,aY as A,aZ as D,a_ as E,a$ as B,A as M,b0 as N,b1 as z,b2 as R,b3 as U,b4 as O,b5 as F,b6 as J,h as K}from"./index-BerNJ4BB.js";import{c as G,i as V,u as H}from"./vendor-DnNJsrFE.js";import{A as Y}from"./Add-DOjRQfzr.js";import{E as W,P as X,S as Q}from"./Pagination-DLBnpq19.js";import{S as Z}from"./index-CgL42zmd.js";import{R as ee}from"./ContainerOutlined-Cgj6Z_n5.js";import{R as ae,F as te,C as se,D as ne}from"./Table-Azebf-5d.js";import{R as ie}from"./DeleteOutlined-CM6OJbZQ.js";import{E as le}from"./Editor-BqjCdi1i.js";import{T as re}from"./index-DfPv3_Sm.js";import{U as de}from"./Upload-ChpTU_6n.js";import{U as oe,R as ce,r as ue,u as he,w as me}from"./xlsx-scitxe1A.js";import{A as xe}from"./index-CeaUyqdx.js";import{P as pe}from"./index-6fWhQOnv.js";import{S as ge}from"./index-BuvbX-yQ.js";import{R as je}from"./ClockCircleOutlined-DGsSs3Pg.js";import{R as ke}from"./CalendarOutlined-D8atCi21.js";import{T as be}from"./TableLayout-o4CxzGTY.js";import{R as ye}from"./DownloadOutlined-lAR0c42P.js";import{S as fe}from"./index-DYvsBJki.js";import{C as we}from"./Collapse-Cpt3tgqK.js";import{R as Se}from"./SaveOutlined-Depix8p-.js";import{R as ve}from"./CheckCircleOutlined-BPH_-5MI.js";import{R as Ce}from"./CloseCircleOutlined-CMO3cpkO.js";import{R as Te}from"./ScheduleOutlined-DHQpvtex.js";import"./progress-CvxbzCtN.js";var _e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 368.9C765.6 248 648.9 162 512.2 162S258.8 247.9 213 368.8C126.9 391.5 63.5 470.2 64 563.6 64.6 668 145.6 752.9 247.6 762c4.7.4 8.7-3.3 8.7-8v-60.4c0-4-3-7.4-7-7.9-27-3.4-52.5-15.2-72.1-34.5-24-23.5-37.2-55.1-37.2-88.6 0-28 9.1-54.4 26.2-76.4 16.7-21.4 40.2-36.9 66.1-43.7l37.9-10 13.9-36.7c8.6-22.8 20.6-44.2 35.7-63.5 14.9-19.2 32.6-36 52.4-50 41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.3c19.9 14 37.5 30.8 52.4 50 15.1 19.3 27.1 40.7 35.7 63.5l13.8 36.6 37.8 10c54.2 14.4 92.1 63.7 92.1 120 0 33.6-13.2 65.1-37.2 88.6-19.5 19.2-44.9 31.1-71.9 34.5-4 .5-6.9 3.9-6.9 7.9V754c0 4.7 4.1 8.4 8.8 8 101.7-9.2 182.5-94 183.2-198.2.6-93.4-62.7-172.1-148.6-194.9z"}},{tag:"path",attrs:{d:"M376.9 656.4c1.8-33.5 15.7-64.7 39.5-88.6 25.4-25.5 60-39.8 96-39.8 36.2 0 70.3 14.1 96 39.8 1.4 1.4 2.7 2.8 4.1 4.3l-25 19.6a8 8 0 003 14.1l98.2 24c5 1.2 9.9-2.6 9.9-7.7l.5-101.3c0-6.7-7.6-10.5-12.9-6.3L663 532.7c-36.6-42-90.4-68.6-150.5-68.6-107.4 0-195 85.1-199.4 191.7-.2 4.5 3.4 8.3 8 8.3H369c4.2-.1 7.7-3.4 7.9-7.7zM703 664h-47.9c-4.2 0-7.7 3.3-8 7.6-1.8 33.5-15.7 64.7-39.5 88.6-25.4 25.5-60 39.8-96 39.8-36.2 0-70.3-14.1-96-39.8-1.4-1.4-2.7-2.8-4.1-4.3l25-19.6a8 8 0 00-3-14.1l-98.2-24c-5-1.2-9.9 2.6-9.9 7.7l-.4 101.4c0 6.7 7.6 10.5 12.9 6.3l23.2-18.2c36.6 42 90.4 68.6 150.5 68.6 107.4 0 195-85.1 199.4-191.7.2-4.5-3.4-8.3-8-8.3z"}}]},name:"cloud-sync",theme:"outlined"},Pe=function(t,s){return G.createElement(e,a({},t,{ref:s,icon:_e}))},$e=G.forwardRef(Pe),Ie={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"},Le=function(t,s){return G.createElement(e,a({},t,{ref:s,icon:Ie}))},qe=G.forwardRef(Le);const{confirm:Ae}=g,De=({onEdit:e,search:a})=>{const[g,j]=V(),[k,b]=G.useState(1),[y,f]=G.useState(8),[w,S]=G.useState(""),{data:v,isLoading:C}=t({page:k,limit:y,search:w}),T=v?.banks,[_,{data:P,isLoading:$,isSuccess:I,error:L,reset:q}]=s();return G.useEffect(()=>{I&&(n.success(P.message),q()),L&&n.error(L.data.message)},[P,I,L]),G.useEffect(()=>{const e=setTimeout(()=>{S(a),b(1)},500);return()=>clearTimeout(e)},[a]),C||0!==T?.length?i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsx(d,{tip:"Memuat data...",spinning:C||$,children:i.jsx(o,{gutter:[16,16],children:T?.map(a=>i.jsx(c,{xs:24,sm:12,md:8,lg:6,children:i.jsx(l,{title:i.jsx(x,{title:a.name,children:a.name}),loading:C||$,actions:[i.jsx(x,{title:"Detail",children:i.jsx(ae,{onClick:()=>{var e;j({subject:(e=a).subject_name.replace(/\s+/g,"-"),bankid:e.id,name:e.name.replace(/\s+/g,"-")})}},"more")}),i.jsx(x,{title:"Ubah Data",children:i.jsx(p,{onClick:()=>e(a)},"edit")}),i.jsx(x,{title:"Hapus Data",children:i.jsx(ie,{onClick:()=>{return e=a.id,void Ae({title:"Apakah anda yakin akan menghapus data ini?",content:"Data yang dihapus tidak bisa dikembalikan",okText:"Ya, Hapus",okType:"danger",cancelText:"Batal",onOk(){_(e)},onCancel(){n.warning("Aksi dibatalkan")}});var e}},"delete")})],children:i.jsx(l.Meta,{description:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(Z,{children:[i.jsx(u,{}),i.jsx(h.Text,{children:a.subject_name})]}),i.jsxs(Z,{children:[i.jsx(m,{}),i.jsx(h.Text,{children:a.teacher_name})]}),i.jsxs(Z,{children:[i.jsx(qe,{}),i.jsx(h.Text,{children:a.btype})]}),i.jsxs(Z,{children:[i.jsx(ee,{}),i.jsxs(h.Text,{children:[a.question_count," Soal"]})]})]})})})},a.id))})}),T?.length>0&&i.jsx(X,{align:"center",total:v?.totalData,pageSize:y,current:k,onChange:(e,a)=>{b(e),f(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`})]}):i.jsx(l,{children:i.jsx(W,{description:w?`Data dengan kata kunci "${w}" tidak ditemukan.`:"Belum ada data bank soal yang dapat ditampilkan."})})},Ee=({open:e,onClose:a,title:t,bank:s})=>{const{user:l}=j(e=>e.auth),[r,o]=G.useState(""),[c,u]=G.useState([]),[h]=k.useForm(),{data:m,isLoading:x}=b({page:"",limit:"",search:r}),[p,{data:w,isLoading:S,isSuccess:v,error:C}]=y(),T=m?.map(e=>({value:e.id,label:e.name,subjects:e.subjects}))||[];return G.useEffect(()=>{v&&(n.success(w.message),h.resetFields(),a()),C&&n.error(C.data.message)},[w,v,C]),G.useEffect(()=>{if(e)if(h.resetFields(),u([]),s.id){if(s&&m){const e=m.find(e=>e.id===s.teacher);if(e){const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}h.setFieldsValue({name:s.name,btype:s.btype,teacher:s.teacher,subject:s.subject})}}else if(h.setFieldsValue({btype:"paket"}),"teacher"===l?.level&&m){const e=m.find(e=>e.id===l.id);if(e){h.setFieldsValue({teacher:e.id});const a=e.subjects.map(e=>({value:e.id,label:e.name}));u(a)}}},[e,s,m,h,l]),i.jsx(g,{title:t,open:e,onCancel:a,cancelText:"Tutup",okText:"Simpan",onOk:()=>h.submit(),confirmLoading:S,forceRender:!0,children:i.jsx(d,{tip:"Memproses data...",spinning:S,children:i.jsxs(k,{form:h,layout:"vertical",onFinish:e=>{if(s.id){const a={id:s.id,...e};p(a)}else p(e)},initialValues:{btype:"paket"},children:[i.jsx(k.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(Q,{placeholder:"Ketik untuk mencari guru...",allowClear:!0,showSearch:!0,onSearch:e=>{o(e)},options:T,onChange:(e,a)=>{if(a){const e=a.subjects.map(e=>({value:e.id,label:e.name}));u(e)}else u([]);h.setFieldsValue({subject:void 0})},loading:x,disabled:"teacher"===l?.level,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"subject",label:"Pilih Mata Pelajaran",rules:[{required:!0,message:"Pilih mata pelajaran terlebih dahulu"}],children:i.jsx(Q,{placeholder:"Pilih mata pelajaran",allowClear:!0,options:c,disabled:0===c.length&&!s,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"btype",label:"Tipe Bank Soal",children:i.jsx(Q,{placeholder:"Pilih tipe bank soal",options:[{label:"Paket",value:"paket"}],disabled:!0})}),i.jsx(k.Item,{name:"name",label:"Nama Bank Soal",rules:[{required:!0,message:"Nama bank soal wajib diisi"}],children:i.jsx(f,{placeholder:"maks 30 karakter",maxLength:30})})]})})})},Be=()=>{const[e,a]=G.useState(!1),[t,s]=G.useState(!1),[n,l]=G.useState({}),[d,o]=G.useState("");return i.jsxs(r,{vertical:!0,gap:"middle",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Manajemen Bank Soal"}),i.jsxs(Z,{children:[i.jsx(f.Search,{placeholder:"Cari Data ...",allowClear:!0,onChange:e=>o(e.target.value),style:{width:250}}),i.jsx(Y,{onClick:()=>a(!0)})]})]}),i.jsx(De,{onEdit:e=>{l(e),s(!0),a(!0)},search:d}),i.jsx(Ee,{title:t?`Edit Bank Soal ${n.name}`:"Tambah Bank Soal",open:e,onClose:()=>{l({}),s(!1),a(!1)},bank:n})]})},Me=({open:e,onClose:a,title:t,ques:s,bankid:l})=>{const[r]=k.useForm(),[d,u]=G.useState(1),[h,{data:m,isSuccess:x,error:p,isLoading:j}]=w();return G.useEffect(()=>{e&&(s?(r.setFieldsValue({qtype:s.type||1,qkey:s.qkey||null,poin:s.poin||0,question:s.question||"",choiceA:s.a||"",choiceB:s.b||"",choiceC:s.c||"",choiceD:s.d||"",choiceE:s.e||""}),u(s.type||1)):(r.resetFields(),r.setFieldsValue({type:1,poin:0})))},[e,s,r]),G.useEffect(()=>{x&&(n.success(m.message),r.resetFields(),a()),p&&n.error(p.data.message)},[m,x,p]),i.jsx(g,{title:t,open:e,onCancel:a,width:900,destroyOnHidden:!0,okText:"Simpan",cancelText:"Tutup",confirmLoading:j,loading:j,onOk:()=>r.submit(),style:{top:20},children:i.jsxs(k,{form:r,layout:"vertical",onFinish:e=>{const a={id:s?.id?s?.id:"",qtype:e.type,poin:e.poin,question:e.question,bank:l,qkey:e.qkey,a:e.choiceA,b:e.choiceB,c:e.choiceC,d:e.choiceD,e:e.choiceE};h(a)},initialValues:{type:1,poin:0},style:{height:600,overflowY:"auto",overflowX:"hidden",scrollbarWidth:"thin",padding:"16px"},children:[i.jsxs(o,{gutter:16,children:[i.jsx(c,{span:12,children:i.jsx(k.Item,{name:"type",label:"Tipe Pertanyaan",rules:[{required:!0,message:"Silakan pilih tipe pertanyaan!"}],children:i.jsx(Q,{placeholder:"Pilih Tipe Pertanyaan",onChange:e=>u(e),options:[{label:"Pilihan Ganda",value:1},{label:"Essai",value:2}],allowClear:!0})})}),i.jsx(c,{span:12,children:i.jsx(k.Item,{name:"poin",label:"Poin",rules:[{required:!0,message:"Silakan masukkan poin!"}],children:i.jsx(re,{style:{width:"100%"},min:0,placeholder:"Masukkan Poin"})})})]}),1===d&&i.jsx(k.Item,{name:"qkey",label:"Kunci Jawaban",rules:[{required:!0,message:"Silakan pilih kunci jawaban!"}],children:i.jsx(Q,{placeholder:"Pilih Kunci Jawaban",options:[{label:"A",value:"A"},{label:"B",value:"B"},{label:"C",value:"C"},{label:"D",value:"D"},{label:"E",value:"E"}],allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"question",label:"Pertanyaan",rules:[{required:!0,message:"Pertanyaan tidak boleh kosong!"}],children:i.jsx(le,{placeholder:"Ketikan pertanyaan di sini ...",height:200})}),1===d&&["A","B","C","D","E"].map(e=>i.jsx(k.Item,{name:`choice${e}`,label:`Pilihan ${e}`,children:i.jsx(le,{placeholder:`Ketikan jawaban untuk pilihan ${e} ...`,height:150})},e))]})})},{Text:Ne}=h,{Dragger:ze}=oe,Re=({title:e,open:a,onClose:t,bankid:s})=>{const[l,{isLoading:r,isSuccess:d,error:o,data:c,reset:u}]=S(),[h,m]=G.useState([]),[x,p]=G.useState([]),[j,k]=G.useState([]);G.useEffect(()=>{d&&(n.success(c?.message||"Soal berhasil diunggah!"),p([]),m([]),t()),o&&n.error(o.data?.message||"Terjadi kesalahan saat mengunggah.")},[c,d,o,t]);const b={name:"file",multiple:!1,accept:".xlsx, .xls, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel",fileList:h,onRemove:()=>{m([]),p([]),k([])},customRequest:({file:e,onSuccess:a,onError:t})=>{const s=new FileReader;s.onload=s=>{try{const t=new Uint8Array(s.target.result),n=ue(t,{type:"array"}),l=n.SheetNames[0],r=n.Sheets[l],d=he.sheet_to_json(r,{header:1,range:1}),o=d.filter(e=>e.length>0&&e.some(e=>null!=e&&""!==e)).map(e=>{const[a,t,s,n,i,l,r,d,o]=e;return 2===Number(a)?{Jenis:a,Pertanyaan:t,A:null,B:null,C:null,D:null,E:null,Jawaban:d,Poin:o}:{Jenis:a,Pertanyaan:t,A:s,B:n,C:i,D:l,E:r,Jawaban:d,Poin:o}});if(o.length>0){const e=Object.keys(o[0]).map(e=>({title:e,dataIndex:e,key:e,..."Jenis"===e&&{render:e=>i.jsx(C,{color:1===Number(e)?"green":"blue",children:1===Number(e)?"Pilihan Ganda":"Essay"}),width:150}}));k(e)}p(o),m([e]),a("ok")}catch(l){n.error("Gagal memproses file. Periksa kembali formatnya."),t(l)}},s.readAsArrayBuffer(e)}};return i.jsx(g,{title:e,open:a,onCancel:()=>{p([]),m([]),k([]),(o||d)&&u(),t()},onOk:()=>{if(0===x.length)return void n.error("Tidak ada data untuk diunggah. Silakan pilih file yang valid.");const e=x.map(e=>[Number(e.Jenis),String(e.Pertanyaan),e.A?String(e.A):null,e.B?String(e.B):null,e.C?String(e.C):null,e.D?String(e.D):null,e.E?String(e.E):null,String(e.Jawaban),Number(e.Poin||0)]);l({body:e,bankid:s})},okText:"Simpan",cancelText:"Tutup",width:1e3,confirmLoading:r,children:i.jsxs(Z,{direction:"vertical",style:{width:"100%"},size:"large",children:[i.jsx(xe,{message:"Ikuti langkah-langkah berikut",description:i.jsxs(Z,{direction:"vertical",size:2,children:[i.jsx(Ne,{children:"1. Unduh template Excel yang disediakan."}),i.jsx(Ne,{children:"2. Isi data soal sesuai dengan kolom yang tersedia."}),i.jsx(Ne,{children:"3. Unggah file yang sudah diisi pada area di bawah ini."}),i.jsx(v,{type:"primary",size:"small",onClick:()=>{window.open("/template/template_soal.xlsx","_blank")},children:"Unduh Template"})]}),type:"info",showIcon:!0}),i.jsxs(ze,{...b,children:[i.jsx("p",{className:"ant-upload-drag-icon",children:i.jsx(ce,{})}),i.jsx("p",{className:"ant-upload-text",children:"Klik atau seret file ke area ini untuk mengunggah"}),i.jsx("p",{className:"ant-upload-hint",children:"Hanya mendukung file .xlsx atau .xls."})]}),x.length>0&&i.jsxs(i.Fragment,{children:[i.jsx(Ne,{strong:!0,children:"Pratinjau Data:"}),i.jsx(te,{columns:j,dataSource:x,bordered:!0,size:"small",rowKey:(e,a)=>a,loading:r,pagination:{pageSize:5},scroll:{x:"max-content"}})]})]})})},Ue=e=>({__html:e||""}),Oe={1:{label:"Pilihan Ganda",color:"blue"},2:{label:"Esai",color:"purple"}},Fe=({subject:e,bankid:a,name:t})=>{const s=H(),[u,m]=G.useState(1),[x,g]=G.useState(10),[j,k]=G.useState(""),[b,y]=G.useState(!1),[f,w]=G.useState(!1),[S,L]=G.useState(null),{data:q,isLoading:A,error:D}=T({page:u,limit:x,search:j,bankid:a}),[E,{data:B,isLoading:M,isSuccess:N,error:z}]=_(),R=(e=null)=>{L(e),y(!0)};G.useEffect(()=>{N&&n.success(B.message),z&&n.error(z.data.message)},[B,N,z]);return i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(Z,{children:[i.jsx(v,{shape:"circle",icon:i.jsx(P,{}),onClick:()=>s("/computer-based-test")}),i.jsxs("div",{children:[i.jsxs(h.Title,{style:{margin:0},level:4,children:["Bank Soal: ",t]}),i.jsx(h.Text,{type:"secondary",children:e})]})]}),i.jsxs(Z,{children:[i.jsx(de,{onClick:()=>w(!0)}),i.jsx(Y,{onClick:()=>R(null)})]})]}),0===q?.questions.length?i.jsx(W,{description:"Data pertanyaan belum tersedia"}):i.jsx(d,{tip:"Memuat data...",spinning:A||M,children:i.jsxs(r,{vertical:!0,gap:"large",children:[D?i.jsx(xe,{type:"warning",showIcon:!0,message:"Soal Belum Tersedia",description:D?D.data?.message||"Gagal memuat soal.":"Silakan unggah atau buat soal terlebih dahulu."}):q?.questions.map((e,a)=>{const t=Oe[e.qtype]||{label:"Tipe Tidak Dikenal",color:"default"},s=[{key:"A",text:e.a},{key:"B",text:e.b},{key:"C",text:e.c},{key:"D",text:e.d},{key:"E",text:e.e}];return i.jsxs(l,{loading:A||M,title:i.jsxs(r,{vertical:!0,children:[i.jsx(h.Text,{children:`Pertanyaan ${(u-1)*x+a+1}`}),i.jsxs(Z,{size:"small",children:[i.jsx(C,{color:t.color,children:t.label}),i.jsxs(C,{children:[i.jsx("strong",{children:e.poin||0})," Poin"]})]})]}),extra:i.jsxs(Z,{children:[i.jsx(v,{icon:i.jsx(p,{}),onClick:()=>R(e),children:"Ubah"}),i.jsx(pe,{title:"Hapus Soal",description:"Apakah Anda yakin ingin menghapus soal ini?",onConfirm:()=>E(e.id),okText:"Ya, Hapus",cancelText:"Batal",children:i.jsx(v,{danger:!0,icon:i.jsx(ie,{}),children:"Hapus"})})]}),children:[i.jsx("div",{style:{maxWidth:"100%",overflow:"auto"},dangerouslySetInnerHTML:Ue(e.question)}),1===e.qtype&&i.jsxs(i.Fragment,{children:[i.jsx($,{orientation:"left",plain:!0,children:"Opsi Jawaban"}),i.jsx(o,{gutter:[16,16],children:s.map(a=>a.text&&""!==a.text.trim()&&i.jsx(c,{xs:24,sm:24,md:12,children:i.jsxs(r,{align:"start",gap:"small",style:{padding:"12px",borderRadius:"8px",border:e.qkey===a.key?"1px solid #52c41a":"1px solid #d9d9d9",background:e.qkey===a.key?"#f6ffed":"transparent",width:"100%",height:"100%"},children:[i.jsx(C,{children:a.key}),i.jsx("div",{style:{flex:1},dangerouslySetInnerHTML:Ue(a.text)}),e.qkey===a.key&&i.jsx(I,{style:{color:"#52c41a",fontSize:"16px",marginTop:"2px"}})]})},a.key))})]})]},e.id)}),i.jsx(X,{size:"small",align:"center",total:q?.totalData,pageSize:x,current:u,onChange:(e,a)=>{m(e),g(a)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e}`})]})}),i.jsx(Me,{title:S?"Ubah Soal":"Tambah Soal",open:b,onClose:()=>{L(null),y(!1)},bankid:a,ques:S}),i.jsx(Re,{title:`Upload pertanyaan ${t?.replace(/-/g," ")}`,open:f,onClose:()=>w(!1),bankid:a})]})},Je=({title:e,open:a,onClose:t,exam:s})=>{const{user:l}=j(e=>e.auth),[r]=k.useForm(),{data:d}=b(),{data:o}=L(),[c,{isLoading:u}]=q(),[h,m]=G.useState([]),x=s?"Edit Ujian":e,p=G.useMemo(()=>d?d.map(e=>({value:e.id,label:e.name,banks:e.bank})):[],[d]),y=G.useMemo(()=>o?o.map(e=>({value:e.id,label:e.name})):[],[o]);G.useEffect(()=>{if(a)if(r.resetFields(),s&&d){const e=p?.find(e=>e.value===s.teacher);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}r.setFieldsValue({...s,classes:(s.classes||[]).map(e=>e.id),bank:(s.banks||[]).map(e=>e.id)})}else if(r.resetFields(),m([]),"teacher"===l?.level&&p.length>0){r.setFieldsValue({teacher:l.id});const e=p.find(e=>e.value===l.id);if(e){const a=(e.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type}));m(a)}}},[a,s,d,l,r,p]);return i.jsx(g,{title:x,open:a,onCancel:t,destroyOnHidden:!0,okText:"Simpan",cancelText:"Batal",onOk:r.submit,confirmLoading:u,style:{top:20},children:i.jsxs(k,{form:r,layout:"vertical",onFinish:async e=>{const a=e.bank.map(e=>({bankid:e,pg:null,essay:null})),i=e.classes.map(e=>({value:e})),l={...e,bank:a,classes:i,isshuffle:e.isshuffle||!1};s&&(l.examid=s.id,l.token=s.token);try{await c(l).unwrap(),n.success(`Ujian berhasil ${s?"diperbarui":"dibuat"}!`),t()}catch(r){n.error("Terjadi kesalahan saat menyimpan ujian.")}},initialValues:{mc_score:100,essay_score:0,isshuffle:!1},children:[i.jsx(k.Item,{name:"teacher",label:"Pilih Guru",rules:[{required:!0,message:"Pilih guru terlebih dahulu"}],children:i.jsx(Q,{placeholder:"Cari Guru",options:p,onChange:(e,a)=>{r.setFieldsValue({bank:[]}),m(a?(a.banks||[]).map(e=>({value:e.id,label:e.name,type:e.type})):[])},allowClear:!0,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase()),virtual:!1})}),i.jsx(k.Item,{name:"bank",label:"Pilih Bank Soal",rules:[{required:!0,message:"Pilih bank soal terlebih dahulu"}],children:i.jsx(Q,{mode:"multiple",placeholder:"Pilih satu atau lebih bank soal",options:h,onChange:e=>{if(0===e.length)return;const a=e[e.length-1],t=h.find(e=>e.value===a);if("paket"===t?.type)r.setFieldsValue({bank:[a]});else{const a=e.filter(e=>{const a=h.find(a=>a.value===e);return a&&"paket"!==a.type});r.setFieldsValue({bank:a})}},allowClear:!0,virtual:!1,showSearch:!0,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})}),i.jsx(k.Item,{name:"classes",label:"Untuk Kelas",rules:[{required:!0,message:"Pilih kelas terlebih dahulu"}],children:i.jsx(Q,{mode:"multiple",placeholder:"Pilih satu atau lebih kelas",options:y,allowClear:!0,showSearch:!0,filterOption:(e,a)=>a.label.toLowerCase().includes(e.toLowerCase()),getPopupContainer:e=>e.parentNode,virtual:!1})}),i.jsx(k.Item,{name:"name",label:"Nama Ujian",rules:[{required:!0,message:"Masukkan nama ujian"}],children:i.jsx(f,{placeholder:"maks 30 karakter",maxLength:30})}),i.jsx(k.Item,{name:"duration",label:"Durasi (Menit)",rules:[{required:!0,message:"Masukkan durasi ujian"}],children:i.jsx(re,{style:{width:"100%"},placeholder:"Masukkan durasi dalam menit",min:1})}),i.jsx(k.Item,{name:"mc_score",label:"Persentase Nilai PG",rules:[{required:!0,message:"Masukkan persentase nilai PG"}],children:i.jsx(re,{style:{width:"100%"},min:0,max:100})}),i.jsx(k.Item,{name:"essay_score",label:"Persentase Nilai Essay",rules:[{required:!0,message:"Masukkan persentase nilai essay"}],children:i.jsx(re,{style:{width:"100%"},min:0,max:100})}),i.jsx(k.Item,{name:"isshuffle",label:"Acak Soal?",valuePropName:"checked",children:i.jsx(ge,{})})]})})},{Text:Ke,Title:Ge}=h,{confirm:Ve}=g,He=()=>{V();const[e,a]=G.useState(1),[t,s]=G.useState(8),[u,g]=G.useState(""),[j,k]=G.useState(""),[b,y]=G.useState({}),[w,S]=G.useState(!1),[v,T]=G.useState(!1),{data:_,isLoading:P,error:I}=A({page:e,limit:t,search:j}),[L,{data:q,isSuccess:E,error:B,isLoading:M,reset:N}]=D(),z=_?.exams;return G.useEffect(()=>{E&&(n.success(q.message),N()),B&&(n.error(B.data.message),N())},[q,E,B]),G.useEffect(()=>{const e=setTimeout(()=>{k(u),a(1)},500);return()=>clearTimeout(e)},[u]),I?i.jsx(xe,{showIcon:!0,type:"error",message:"Terjadi Kesalahan",description:I?I.data.message:"Jadwal ujian belum tersedia"}):i.jsx(d,{tip:"Memuat data...",spinning:P,children:i.jsxs(r,{vertical:!0,gap:"large",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(h.Title,{style:{margin:0},level:5,children:"Managemen Penjadwalan"}),i.jsxs(Z,{children:[i.jsx(f.Search,{placeholder:"Cari data ...",allowClear:!0,onChange:e=>g(e.target.value)}),i.jsx(Y,{onClick:()=>T(!0)})]})]}),i.jsx(o,{gutter:[16,16],children:z?.map(e=>i.jsx(c,{sm:24,md:12,lg:6,children:i.jsx(l,{hoverable:!0,loading:P||M,title:i.jsx(x,{title:e.name,children:i.jsx(Ke,{ellipsis:!0,children:e.name})}),extra:i.jsx(C,{color:e.isactive?"green":"volcano",children:e.isactive?"Aktif":"Tidak Aktif"}),actions:[i.jsx(x,{title:"Detail",children:i.jsx(ae,{onClick:()=>{return a=e,void window.open(`/computer-based-test?report=true&examid=${a.id}&token=${a.token}&name=${a.name?.replace(/\s+/g,"-")}`,"_blank");var a}},"detail")}),i.jsx(x,{title:"Edit",children:i.jsx(p,{onClick:()=>(y(e),S(!0),void T(!0))},"edit")}),i.jsx(x,{title:"Hapus",children:i.jsx(ie,{onClick:()=>{return a=e.id,void Ve({title:"Apa anda yakin menghapus data ini?",content:"Data yang sudah dihapus tidak bisa dikembalikan",okText:"Ya, hapus",okType:"danger",cancelText:"Batal",onOk(){L(a)},onCancel(){n.info("Aksi dibatalkan")}});var a}},"remove")})],children:i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(Ke,{type:"secondary",children:"Token Ujian"}),i.jsx(Ke,{strong:!0,copyable:!0,children:e.token})]}),i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsx(Ke,{type:"secondary",children:"Acak Soal"}),i.jsx(C,{color:e.isshuffle?"blue":"purple",children:e.isshuffle?"Acak":"Urut"})]}),i.jsx($,{style:{margin:"8px 0"}}),i.jsxs(r,{vertical:!0,children:[i.jsx(Ke,{type:"secondary",children:"Bank Soal"}),i.jsx(r,{vertical:!0,gap:"small",children:e.banks?.map((e,a)=>i.jsx(x,{title:e.name,children:i.jsx(h.Text,{ellipsis:!0,children:i.jsx(C,{color:"magenta",children:e.name})})},a))})]}),i.jsx($,{style:{margin:"8px 0"}}),i.jsxs(Z,{direction:"vertical",size:"small",style:{width:"100%"},children:[i.jsxs(r,{align:"center",gap:8,children:[i.jsx(m,{}),i.jsx(Ke,{children:e.teacher_name})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(je,{}),i.jsxs(Ke,{children:[e.duration," Menit"]})]}),i.jsxs(r,{align:"center",gap:8,children:[i.jsx(ke,{}),i.jsx(Ke,{children:new Date(e.createdat).toLocaleDateString("id-ID",{day:"numeric",month:"short",year:"numeric"})})]})]}),i.jsx($,{style:{margin:"8px 0"}}),i.jsx(r,{wrap:"wrap",gap:"8px 0",children:e.classes.map(e=>i.jsx(C,{color:"cyan",children:e.name},e.id))})]})})},e.id))}),z?.length>0&&i.jsx(X,{size:"small",align:"center",total:_?.totalData,pageSize:t,current:e,onChange:(e,t)=>{a(e),s(t)},showSizeChanger:!0,showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} item`}),i.jsx(Je,{title:w?"Ubah Jadwal Ujian":"Simpan Jadwan Ujian",open:v,onClose:()=>{y({}),S(!1),T(!1)},exam:b})]})})},{Title:Ye,Paragraph:We,Text:Xe}=h,{Panel:Qe}=we,Ze=({open:e,onClose:a,detail:t})=>{const[s]=V(),{user:l}=j(e=>e.auth),[r,u]=G.useState({}),h=s.get("examid"),m="teacher"===l?.level||"admin"===l?.level,{data:x,isLoading:k,isError:b,error:y,refetch:f}=E({student:t.student_id,exam:h},{skip:!t.student_id||!h,refetchOnMountOrArgChange:!0}),[w,{isLoading:S}]=B(),T=(e,a)=>0===e.length?i.jsxs(Xe,{type:"secondary",children:["Tidak ada soal ","mc"===a?"pilihan ganda":"uraian","."]}):i.jsx(we,{accordion:!0,children:e.map((e,t)=>{const s=e.point>0,l=void 0!==r[e.answer_id]?r[e.answer_id]:e.point;return i.jsxs(Qe,{header:`Soal Nomor ${t+1}`,extra:m?"mc"===a?s?i.jsx(C,{icon:i.jsx(ve,{}),color:"success",children:"Benar"}):i.jsx(C,{icon:i.jsx(Ce,{}),color:"error",children:"Salah"}):i.jsxs(C,{color:"blue",children:["Poin: ",e.point," / ",e.max_point]}):null,children:[i.jsx(Ye,{level:5,children:"Pertanyaan:"}),i.jsx("div",{dangerouslySetInnerHTML:{__html:e.question_text}}),i.jsx($,{}),i.jsx(Ye,{level:5,children:"Jawaban Anda:"}),"mc"===a?i.jsx(We,{children:i.jsxs(Xe,{strong:!0,children:[" ( ",e.answer||"-"," )"]})}):i.jsx("div",{style:{background:"#f9f9f9",padding:"15px",borderRadius:"4px",border:"1px solid #eee",marginBottom:"15px"},children:i.jsx("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"inherit",margin:0},children:e.essay||"(Tidak dijawab)"})}),m&&i.jsxs(i.Fragment,{children:[i.jsx($,{style:{margin:"12px 0"}}),"mc"===a?i.jsxs(We,{children:[i.jsx(Xe,{strong:!0,children:"Kunci Jawaban: "}),i.jsxs(Xe,{code:!0,children:[" ( ",e.correct," )"]})]}):i.jsx("div",{style:{background:"#f0f5ff",padding:"15px",borderRadius:"6px",border:"1px dashed #adc6ff"},children:i.jsxs(Z,{direction:"vertical",style:{width:"100%"},children:[i.jsxs(Xe,{strong:!0,children:[i.jsx(p,{})," Berikan Penilaian:"]}),i.jsxs(Z,{wrap:!0,children:[i.jsxs(Xe,{children:["Skor (Maks: ",e.max_point,"):"]}),i.jsx(re,{min:0,max:e.max_point,value:l,onChange:a=>((e,a)=>{u(t=>({...t,[a]:e}))})(a,e.answer_id),style:{width:100}}),i.jsx(v,{type:"primary",icon:i.jsx(Se,{}),loading:S,onClick:()=>(async(e,a)=>{const t=r[e];if(null!=t&&""!==t)if(t<0||t>a)n.error(`Nilai harus antara 0 dan ${a}`);else try{await w({answer_id:e,point:parseInt(t)}).unwrap(),n.success("Nilai berhasil disimpan"),f(),u(a=>{const t={...a};return delete t[e],t})}catch(s){n.error(s?.data?.message||"Gagal menyimpan nilai")}else n.error("Nilai belum diubah atau kosong")})(e.answer_id,e.max_point),children:"Simpan Nilai"})]}),i.jsx(Xe,{type:"secondary",style:{fontSize:"12px"},children:"* Klik simpan untuk memperbarui nilai siswa."})]})})]})]},e.answer_id||t)})});return i.jsx(g,{title:`Lembar Jawaban: ${t?.student_name}`,open:e,onCancel:a,destroyOnHidden:!0,style:{top:20},width:900,footer:[i.jsx(v,{onClick:a,children:"Tutup"},"back"),i.jsx(v,{icon:i.jsx(ye,{}),onClick:()=>{if(!x||!x.answers)return;const e=t?.student_name||"Siswa",a=t?.student_nis||"-",s=t?.student_class||"-",n=t?.exam_name||"Ujian",i=x.answers.filter(e=>1===e.qtype),l=x.answers.filter(e=>2===e.qtype),r=e=>e.replace(/<\/?p[^>]*>/g,""),d=i.length>0?i.map((e,a)=>`\n      <li class="question-item">\n        <div class="question-text"><span>${a+1}. </span>${r(e.question_text)}</div>\n        <p><strong>Jawaban:</strong> ${e.answer||"-"}</p>\n        <p><strong>Kunci:</strong> ${e.correct}</p>\n        <p><strong>Poin:</strong> ${e.point}</p>\n      </li>`).join(""):"<li>Tidak ada soal pilihan ganda.</li>",o=l.length>0?l.map((e,a)=>`\n      <li class="question-item">\n        <div class="question-text"><span>${a+1}. </span>${r(e.question_text)}</div>\n        <p><strong>Jawaban:</strong></p><pre class="answer-essay">${e.essay||"(Tidak dijawab)"}</pre>\n        <p><strong>Poin:</strong> ${e.point} / ${e.max_point}</p>\n      </li>`).join(""):"<li>Tidak ada soal uraian.</li>",c=`\n      <html>\n      <head>\n        <title>Lembar Jawaban - ${e}</title>\n        <style>\n          body { font-family: sans-serif; margin: 25px; }\n          .container { width: 100%; max-width: 800px; margin: 0 auto; }\n          h1 { font-size: 24px; text-align: center; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }\n          h2 { font-size: 20px; color: #1890ff; border-bottom: 1px solid #f0f0f0; margin-top: 30px; }\n          .info-table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }\n          .info-table td { padding: 8px; border: 1px solid #ddd; }\n          .question-item { margin-bottom: 20px; border-bottom: 1px solid #eee; }\n          .answer-essay { background: #f9f9f9; padding: 10px; }\n        </style>\n      </head>\n      <body>\n        <div class="container">\n          <h1>Lembar Jawaban Siswa</h1>\n          <table class="info-table">\n            <tbody>\n              <tr><td>Nama Siswa</td><td>${e}</td></tr>\n              <tr><td>NIS</td><td>${a}</td></tr>\n              <tr><td>Kelas</td><td>${s}</td></tr>\n              <tr><td>Mata Ujian</td><td>${n}</td></tr>\n              ${m&&void 0!==x.score?`\n              <tr><td>Total Skor Akhir</td><td><strong>${x.score}</strong></td></tr>\n              <tr><td>Jawaban Benar (PG)</td><td>${x.correct}</td></tr>\n              <tr><td>Total Skor PG</td><td>${x.pg_score}</td></tr>\n              <tr><td>Total Skor Uraian</td><td>${x.essay_score}</td></tr>`:""}\n            </tbody>\n          </table>\n          <h2>Pilihan Ganda</h2><ol>${d}</ol>\n          <h2>Uraian</h2><ol>${o}</ol>\n        </div>\n      </body>\n      </html>`,u=window.open("","_blank");u.document.open(),u.document.write(c),u.document.close(),setTimeout(()=>{u.print()},500)},disabled:k||!x?.answers,style:{display:m?"inline-block":"none"},children:"Cetak PDF"},"download")],children:i.jsx("div",{style:{height:600,overflowY:"auto",padding:8,scrollbarWidth:"thin"},children:(()=>{if(k)return i.jsx("div",{style:{textAlign:"center",padding:"50px"},children:i.jsx(d,{size:"large",tip:"Memuat data jawaban..."})});if(b)return i.jsx(xe,{message:"Gagal memuat data",description:y?.data?.message||y?.message,type:"error",showIcon:!0});if(!x||!x.answers)return i.jsx(xe,{message:"Data jawaban tidak ditemukan.",type:"info",showIcon:!0});const e=x.answers||[],a=e.filter(e=>1===e.qtype),t=e.filter(e=>2===e.qtype),s=[{key:"1",label:`Pilihan Ganda (${a.length})`,children:T(a,"mc")},{key:"2",label:`Uraian (${t.length})`,children:T(t,"essay")}];return i.jsxs(i.Fragment,{children:[m&&void 0!==x.score&&i.jsxs(o,{gutter:[16,16],style:{marginBottom:24},children:[i.jsx(c,{xs:24,sm:12,md:8,lg:6,children:i.jsx(fe,{title:"Total Skor Akhir",value:x.score,precision:2,valueStyle:{color:"#1890ff"}})}),i.jsx(c,{xs:12,sm:12,md:8,lg:6,children:i.jsx(fe,{title:"Jawaban Benar (PG)",value:x.correct})}),i.jsx(c,{xs:12,sm:12,md:8,lg:6,children:i.jsx(fe,{title:"Skor Pilihan Ganda",value:x.pg_score,precision:2})}),i.jsx(c,{xs:12,sm:12,md:8,lg:6,children:i.jsx(fe,{title:"Skor Uraian",value:x.essay_score,precision:2})})]}),i.jsx(M,{defaultActiveKey:"1",items:s})]})})()})})},{confirm:ea}=g,aa=({examid:e,classid:a,tableRef:t,syncTrigger:s})=>{const[l,r]=G.useState(1),[d,o]=G.useState(10),[c,u]=G.useState(""),[h,m]=G.useState(!1),[x,p]=G.useState(3e5),[g,j]=G.useState(!1),[k,b]=G.useState(""),{data:y,isLoading:f,refetch:w}=N({page:l,limit:d,search:c,exam:e,classid:a}),[S,{isLoading:v}]=z(),[T,{isLoading:_}]=R(),[P,{isLoading:$}]=U(),I=G.useRef(!0);G.useEffect(()=>{I.current?I.current=!1:w()},[s,w]),G.useEffect(()=>{let e=null;return h&&(e=setInterval(()=>{w(),n.success("Data berhasil di-refresh secara otomatis")},x)),()=>{e&&clearInterval(e)}},[h,x,w]);const L=(a,{key:t})=>{switch(t){case"detail":(e=>{j(!0),b(e)})(a);break;case"allow":ea({title:"Apakah anda yakin mengizinkan peserta mengikuti ujian ini?",content:"peserta harus refresh halaman ujian agar dapat mengikuti ujian ini",okText:"Ya, Izinkan",cancelText:"Tutup",okType:"danger",async onOk(){try{await T(a.log_id),n.success(`${a.student_name} telah diizinkan masuk kembali`)}catch(e){n.error(e?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"finish":ea({title:`Apakah anda yakin menyelesaikan ujian ${a.student_name} ?`,content:"Setelah diselesaikan peserta tidak ada ikut ujian ini",okText:"Ya, Selesaikan",cancelText:"Tutup",okType:"danger",async onOk(){try{await S({id:a.log_id,exam:e}),n.success(`Ujian ${a.student_name} telah diselesaikan`)}catch(t){n.error(t?.data?.message||"Terjadi kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}});break;case"retake":ea({title:`Apakah anda yakin mengulang ujian ${a.student_name} ?`,content:"Jawaban dan nilai yang telah diperoleh akan dihapus",okText:`Ya, Ulangi Ujian ${a.student_name}`,cancelText:"Tutup",okType:"danger",async onOk(){try{await P({id:a.log_id,exam:e,student:a.student_id}),n.success(`Data ujian ${a.student_name} telah direset`)}catch(t){n.error(t?.data?.message||"Terjadi Kesalahan")}},onCancel(){n.info("Aksi dibatalkan")}})}},q=[{title:"No",key:"no",render:(e,a,t)=>(l-1)*d+t+1},{title:"NIS",dataIndex:"nis",key:"nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"grade_name",key:"grade_name"},{title:"Kelas",dataIndex:"class_name",key:"class_name"},{title:"Ip",dataIndex:"ip",key:"ip"},{title:"Browser",dataIndex:"browser",key:"browser"},{title:"Mulai",dataIndex:"createdat",key:"createdat",render:e=>i.jsx(C,{color:"volcano",children:e&&new Date(e).toLocaleString()})},{title:"Status",key:"status",render:e=>e.ispenalty?i.jsx(C,{color:"red",children:"Melanggar"}):e.isdone?i.jsx(C,{color:"green",children:"Selesai"}):e.isactive?i.jsx(C,{color:"blue",children:"Mengerjakan"}):i.jsx(C,{children:"Belum Masuk"})},{title:"Aksi",key:"action",render:e=>i.jsx(ne.Button,{menu:{items:[{key:"detail",label:"Lihat Jawaban",disabled:!e.log_id},{key:"allow",label:"Izikan Masuk",disabled:e.isdone||!e.isactive},{key:"finish",label:"Selesaikan Ujian",disabled:e.isdone||!e.isactive},{key:"retake",label:"Ulangi Ujian",disabled:!e.isdone}],onClick:({key:a})=>L(e,{key:a})},children:"Pilihan Aksi"})}];return i.jsxs(i.Fragment,{children:[i.jsx("div",{style:{marginBottom:16},children:i.jsxs(Z,{children:[i.jsx(se,{checked:h,onChange:e=>m(e.target.checked),children:"Auto Refetch"}),i.jsxs(Q,{value:x,onChange:p,disabled:!h,style:{width:150},children:[i.jsx(Q.Option,{value:3e5,children:"Setiap 5 Menit"}),i.jsx(Q.Option,{value:6e5,children:"Setiap 10 Menit"})]})]})}),i.jsx(be,{tableRef:t,onSearch:e=>{u(e),r(1)},isLoading:f||_||v||$,columns:q,source:y?.result,rowKey:"student_id",page:l,limit:d,totalData:y?.totalData,onChange:e=>{r(e.current),o(e.pageSize)}}),i.jsx(Ze,{open:g,onClose:()=>{j(!1),b("")},detail:k})]})},ta=({examid:e,classid:a,tableRef:t,syncTrigger:s})=>{const[n,l]=G.useState(1),[r,d]=G.useState(10),[o,c]=G.useState(""),{data:u,isLoading:m,refetch:p}=O({page:n,limit:r,search:o,exam:e,classid:a}),g=G.useRef(!0);G.useEffect(()=>{g.current?g.current=!1:p()},[s,p]);const j=G.useMemo(()=>{if(!u)return[];return[...[{title:"No",key:"no",width:60,fixed:"left",align:"center",render:(e,a,t)=>(n-1)*r+t+1},{title:"Nama Siswa",dataIndex:"name",key:"name",width:250,fixed:"left"}],{title:"Analisis Jawaban Siswa",align:"center",children:u?.questions?.map((e,a)=>({title:i.jsx(x,{title:`Kunci: ${e.qkey} | Poin: ${e.poin}`,children:`S${a+1}`}),dataIndex:"answers",key:`question_${e.id}`,width:75,align:"center",render:a=>{const t=a?.find(a=>a.id===e.id),s=t?t.mc.toUpperCase():"-",n=s===e.qkey.toUpperCase();return t?i.jsx(h.Text,{style:{marginLeft:"4px",color:n?"#52c41a":"#f5222d"},children:s}):i.jsx(h.Text,{type:"secondary",children:"-"})}}))},...[{title:"Benar",dataIndex:"correct",key:"correct",width:80,fixed:"right",align:"center",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",width:80,fixed:"right",render:e=>i.jsx(h.Text,{strong:!0,style:{color:"#f5222d"},children:e})},{title:"Nilai Akhir",dataIndex:"mc_score",key:"mc_score",width:100,fixed:"right",align:"center",render:e=>i.jsx(C,{color:e>=75?"blue":"volcano",style:{fontSize:14,padding:"4px 8px"},children:e})}]]},[u,n,r]);return i.jsx(be,{tableRef:t,onSearch:e=>{c(e),l(1)},isLoading:m,columns:j,source:u?.students,rowKey:"id",page:n,limit:r,totalData:u?.totalData,onChange:e=>{l(e.current),d(e.pageSize)},bordered:!0,scroll:{x:"max-content"}})},{Title:sa,Text:na}=h,{Search:ia}=f,la=({examid:e,classid:a,tableRef:t,syncTrigger:s})=>{const[n,r]=G.useState(1),[d,u]=G.useState(10),[h,m]=G.useState(""),[x,p]=G.useState(""),{data:g,isLoading:j,isError:k,refetch:b}=F({exam:e,classid:a,page:n,limit:d,search:x}),y=G.useRef(!0);G.useEffect(()=>{y.current?y.current=!1:b()},[s,b]),G.useEffect(()=>{const e=setTimeout(()=>{p(h),1!==n&&r(1)},500);return()=>clearTimeout(e)},[h]);const f=[{title:"No",key:"no",render:(e,a,t)=>(n-1)*d+t+1,width:"5%"},{title:"NIS",dataIndex:"student_nis",key:"student_nis"},{title:"Nama Siswa",dataIndex:"student_name",key:"student_name"},{title:"Tingkat",dataIndex:"student_grade",key:"student_grade"},{title:"Kelas",dataIndex:"student_class",key:"student_class"},{title:"Benar",dataIndex:"correct",key:"correct",align:"center",render:e=>i.jsx(na,{style:{color:"#52c41a"},children:e})},{title:"Salah",dataIndex:"incorrect",key:"incorrect",align:"center",render:e=>i.jsx(na,{style:{color:"#f5222d"},children:e})},{title:"Skor PG",dataIndex:"mc_score",key:"mc_score",align:"center"},{title:"Skor Esai",dataIndex:"essay_score",key:"essay_score",align:"center"},{title:"Nilai Akhir",dataIndex:"score",key:"score",align:"center",render:e=>i.jsx(na,{strong:!0,style:{color:"#1890ff"},children:e})}];if(k)return i.jsx(xe,{message:"Terjadi Kesalahan",description:"Gagal memuat data nilai. Silakan coba lagi nanti.",type:"error",showIcon:!0});const w=g?.exam_name||"Daftar Nilai",S=i.jsxs(Z,{direction:"vertical",size:"small",children:[i.jsxs(na,{type:"secondary",children:["Guru: ",g?.teacher_name]}),i.jsxs(na,{type:"secondary",children:["Sekolah: ",g?.homebase_name]})]});return i.jsx("div",{ref:t,children:i.jsxs(l,{children:[i.jsx(sa,{level:4,children:w}),S,i.jsx(o,{justify:"end",style:{margin:"16px 0"},children:i.jsx(c,{children:i.jsx(ia,{placeholder:"Cari nama atau NIS siswa...",value:h,onChange:e=>m(e.target.value),style:{width:280},allowClear:!0,enterButton:!0})})}),i.jsx(te,{columns:f,dataSource:g?.students||[],rowKey:"student_id",loading:j,onChange:e=>{r(e.current),u(e.pageSize)},pagination:{current:n,pageSize:d,total:g?.totalData||0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:(e,a)=>`${a[0]}-${a[1]} dari ${e} data`},scroll:{x:"max-content"}})]})})},ra=({name:e,examid:a,token:t})=>{const s=H(),[l,d]=G.useState(""),[o,c]=G.useState("1"),[u,m]=G.useState(0),x=G.useRef(null),p=G.useRef(null),g=G.useRef(null),{data:j}=J({exam:a},{skip:!a}),k=j?.map(e=>({value:e.id,label:e.name})),b=(e,a)=>{if(!e.current)return void n.error("Tabel tidak ditemukan, tidak dapat mengunduh data.");const t=e.current.querySelector("table");if(!t)return void n.error("Elemen tabel HTML tidak ditemukan.");const s=he.book_new(),i=he.table_to_sheet(t);he.book_append_sheet(s,i,"Data"),me(s,`${a}.xlsx`)},y=[{label:"Absen",key:"1",children:i.jsx(aa,{examid:a,classid:l,tableRef:x,syncTrigger:u})},{label:"Analisis",key:"2",children:i.jsx(ta,{examid:a,classid:l,tableRef:p,syncTrigger:u})},{label:"Nilai",key:"3",children:i.jsx(la,{examid:a,classid:l,tableRef:g,syncTrigger:u})}];return i.jsxs(r,{vertical:!0,gap:"small",children:[i.jsxs(r,{align:"center",justify:"space-between",children:[i.jsxs(Z,{children:[i.jsx(v,{shape:"circle",icon:i.jsx(P,{}),onClick:()=>{s("/computer-based-test")}}),i.jsxs("div",{children:[i.jsx(h.Title,{style:{margin:0},level:5,children:e?.replace(/-/g," ")}),i.jsx(h.Text,{copyable:!0,strong:!0,children:t})]})]}),i.jsxs(Z,{children:[i.jsx(Q,{style:{width:200},placeholder:"Pilih Kelas",options:k,onChange:e=>{d(e)},allowClear:!0}),i.jsx(v,{icon:i.jsx(ye,{}),onClick:()=>{switch(o){case"1":b(x,`Absensi_${e.replace(/-/g,"_")}`);break;case"2":b(p,`Analisis_${e.replace(/-/g,"_")}`);break;case"3":b(g,`Nilai_${e.replace(/-/g,"_")}`)}},children:"Unduh Data"}),i.jsx(v,{icon:i.jsx($e,{}),onClick:()=>{m(e=>e+1),n.success("Memulai sinkronisasi data...")},children:"Sinkron Data"})]})]}),i.jsx(M,{centered:!0,items:y,onChange:e=>c(e)})]})},da=()=>{const[e]=V(),a=e.get("subject")?.replace(/-/g," "),t=e.get("bankid"),s=e.get("name")?.replace(/-/g," "),n=e.get("report"),l=e.get("examid"),r=e.get("token"),d=[{label:"Bank Soal",key:"1",children:i.jsx(Be,{}),icon:i.jsx(u,{})},{label:"Jadwal Ujian",key:"2",children:i.jsx(He,{}),icon:i.jsx(Te,{})}];return t?i.jsx(K,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(Fe,{subject:a,bankid:t,name:s})}):n?i.jsx(K,{title:s?s?.replace(/-/g," "):"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(ra,{name:s,examid:l,token:r})}):i.jsx(K,{title:"Mangement Computer Based Test",levels:["admin","teacher"],children:i.jsx(M,{items:d})})};export{da as default};
