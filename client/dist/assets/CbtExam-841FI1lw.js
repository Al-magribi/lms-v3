import{b as e,aC as a,aG as s,aH as l,j as i,e as n,aI as t,aJ as d,aK as r}from"./index-BAWIGdgW.js";import{b as c}from"./vendor-DfXzdC0j.js";import{S as o}from"./react-select.esm-DUeLA41h.js";import{T as m}from"./Table-Cz3IM_IN.js";const u={menuPortal:e=>({...e,zIndex:9999})},h=({detail:t,setDetail:d,onSuccess:r})=>{var m;const{user:h}=e((e=>e.auth)),p={examid:"",teacher:(null==h?void 0:h.id)||"",bank:[],name:"",duration:"",classes:[],token:"",isshuffle:"",mc_score:"",essay_score:""},[x,b]=c.useState(p),{data:v}=a(),{data:g}=s(),[j,{isSuccess:f,isLoading:N,isError:y,reset:k}]=l(),w=null==v?void 0:v.map((e=>({value:e.id,label:e.name,bank:e.bank}))),C="teacher"===(null==h?void 0:h.level)?null==v?void 0:v.find((e=>e.id===h.id)):null==v?void 0:v.find((e=>e.id===x.teacher)),_=null==(m=null==C?void 0:C.bank)?void 0:m.map((e=>({value:e.id,label:e.name,type:e.type}))),S=null==g?void 0:g.map((e=>({value:e.id,label:e.name})));c.useEffect((()=>{(null==t?void 0:t.id)?b({examid:t.id,teacher:t.teacher,name:t.name,duration:t.duration,token:t.token,isshuffle:t.isshuffle,mc_score:t.mc_score,essay_score:t.essay_score,bank:t.banks.map((e=>({bankid:e.id,type:e.type,pg:e.pg,essay:e.essay}))),classes:t.classes.map((e=>({value:e.id,label:e.name})))}):"teacher"===(null==h?void 0:h.level)&&b((e=>({...e,teacher:h.id})))}),[t,h]);const P=(e,a,s)=>{const{value:l}=e.target;b((e=>({...e,bank:e.bank.map((e=>e.bankid===a?{...e,[s]:l}:e))})))},E=()=>{b({...p,teacher:(null==h?void 0:h.id)||""}),d(null)};return c.useEffect((()=>{if(f){E(),k(),null==r||r();const e=document.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}y&&k()}),[f,y,r]),c.useEffect((()=>()=>{document.body.style.overflow="unset"}),[]),i.jsx("div",{className:"modal fade",id:"addexam","data-bs-backdrop":"static","data-bs-keyboard":"false",tabIndex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true",children:i.jsx("div",{className:"modal-dialog",children:i.jsxs("form",{onSubmit:e=>{e.preventDefault(),x.name.includes("/")?n.error("Karakter / tidak diizinkan"):n.promise(j(x).unwrap().then((e=>e.message)),{loading:"Memuat data...",success:e=>e,error:e=>e.data.message})},className:"modal-content p-3",children:[i.jsxs("div",{className:"modal-header",children:[i.jsx("h1",{className:"modal-title fs-5",id:"staticBackdropLabel",children:(null==t?void 0:t.id)?"Edit Ujian":"Tambah Ujian"}),i.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),i.jsxs("div",{className:"modal-body d-flex flex-column gap-3",children:[i.jsx(o,{isClearable:!0,isSearchable:!0,placeholder:"Cari Guru",value:(null==w?void 0:w.find((e=>e.value===x.teacher)))||null,options:w,onChange:e=>{b((a=>({...a,teacher:(null==e?void 0:e.value)||null,bank:[]})))},isDisabled:!!(null==t?void 0:t.id),menuPortalTarget:document.body,styles:u}),i.jsx(o,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Pilih Bank Soal",value:null==_?void 0:_.filter((e=>x.bank.some((a=>a.bankid===e.value)))),options:_,onChange:e=>{const a=(null==e?void 0:e.map((e=>({bankid:e.value,type:e.type,pg:"",essay:""}))))||[];b((e=>({...e,bank:a})))},isDisabled:!x.teacher||!!(null==t?void 0:t.id),menuPortalTarget:document.body,styles:u}),x.bank.filter((e=>"bank"===e.type)).map((e=>{var a,s,l;return i.jsxs("div",{className:"border p-2 rounded",children:[i.jsx("p",{className:"m-0",children:(null==(a=null==_?void 0:_.find((a=>a.value===e.bankid)))?void 0:a.label)||(null==(l=null==(s=null==t?void 0:t.banks)?void 0:s.find((a=>a.id===e.bankid)))?void 0:l.name)}),i.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal PG ",value:e.pg,onChange:a=>P(a,e.bankid,"pg")}),i.jsx("input",{type:"number",className:"form-control mt-1",placeholder:"Tampil Soal Essay ",value:e.essay,onChange:a=>P(a,e.bankid,"essay")})]},e.bankid)})),i.jsx(o,{isClearable:!0,isSearchable:!0,isMulti:!0,placeholder:"Untuk Kelas",value:x.classes,options:S,onChange:e=>{b((a=>({...a,classes:e||[]})))},menuPortalTarget:document.body,styles:u}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Ujian",value:x.name||"",onChange:e=>b({...x,name:e.target.value})}),i.jsx("label",{htmlFor:"name",children:"Nama Ujian"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"duration",className:"form-control",placeholder:"Durasi",value:x.duration||"",onChange:e=>b({...x,duration:e.target.value})}),i.jsx("label",{htmlFor:"duration",children:"Durasi"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"mc_score",id:"mc_score",className:"form-control",placeholder:"Persentase Nilai PG",value:x.mc_score,onChange:e=>b({...x,mc_score:e.target.value})}),i.jsx("label",{htmlFor:"mc_score",children:"Persentase Nilai PG"})]}),i.jsxs("div",{className:"form-floating",children:[i.jsx("input",{type:"number",name:"essay_score",id:"essay_score",className:"form-control",placeholder:"Persentase Nilai Essay",value:x.essay_score,onChange:e=>b({...x,essay_score:e.target.value})}),i.jsx("label",{htmlFor:"essay_score",children:"Persentase Nilai Essay"})]}),i.jsxs("select",{name:"isshuffle",className:"form-control",value:x.isshuffle,onChange:e=>b({...x,isshuffle:e.target.value}),children:[i.jsx("option",{value:"",hidden:!0,children:"Acak Soal"}),i.jsx("option",{value:!0,children:"Ya"}),i.jsx("option",{value:!1,children:"Tidak"})]})]}),i.jsxs("div",{className:"modal-footer",children:[i.jsx("button",{type:"button",className:"btn btn-sm btn-warning","data-bs-dismiss":"modal",onClick:()=>{E(),null==r||r()},children:"Batal"}),i.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:N,children:(null==t?void 0:t.id)?"Update":"Simpan"})]})]})})})},p=({setDetail:e})=>{const[a,s]=c.useState(1),[l,o]=c.useState(12),[u,h]=c.useState(""),{data:p={},isLoading:x}=t({page:a,limit:l,search:u}),{exams:b=[],totalData:v,totalPages:g}=p,[j,{isSuccess:f,isLoading:N,isError:y,reset:k}]=d(),[w,{isSuccess:C,isError:_,reset:S}]=r();return c.useEffect((()=>{(f||y)&&k()}),[f,y]),c.useEffect((()=>{(C||_)&&S()}),[C,_]),i.jsx(m,{page:a,setPage:s,setLimit:o,setSearch:h,totalData:v,totalPages:g,isLoading:x,children:i.jsx("div",{className:"row g-4",children:(null==b?void 0:b.length)>0?null==b?void 0:b.map(((a,s)=>{var l;return i.jsx("div",{className:"col-12 col-lg-4",children:i.jsx("div",{className:"card rounded-4 shadow-sm hover-shadow h-100 overflow-hidden",children:i.jsxs("div",{className:"card-body d-flex flex-column h-100 p-4 gap-2",children:[i.jsxs("div",{className:"d-flex justify-content-between",children:[i.jsxs("div",{className:"d-flex align-items-start justify-content-center flex-wrap gap-2",children:[i.jsx("div",{className:"rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center",style:{width:48,height:48},children:i.jsx("i",{className:"bi bi-laptop text-primary fs-5"})}),i.jsxs("div",{className:"d-flex flex-column gap-2",children:[i.jsx("h6",{title:a.name,className:"lh-1 text-primary m-0 pointer",children:a.name.length>20?`${a.name.slice(0,20)}...`:a.name}),i.jsxs("div",{className:"d-flex gap-2",children:[i.jsx("span",{title:a.teacher_name,className:"text-muted small pointer",children:a.teacher_name.length>20?`${a.teacher_name.slice(0,20)}...`:a.teacher_name}),i.jsx("div",{className:"vr"}),i.jsx("span",{className:"badge bg-secondary pointer","data-toggle":"tooltip","data-placement":"top",title:"Copy Token",onClick:()=>{return e=a.token,navigator.clipboard.writeText(e),void n.success("Token berhasil disalin");var e},children:a.token})]})]})]}),i.jsxs("div",{className:"dropdown ms-2",children:[i.jsx("button",{className:"btn btn-sm btn-outline-primary",type:"button",id:`dropdownMenuButton-${s}`,"data-bs-toggle":"dropdown","aria-expanded":"false",children:i.jsx("i",{className:"bi bi-three-dots-vertical"})}),i.jsxs("ul",{className:"dropdown-menu dropdown-menu-end shadow","aria-labelledby":`dropdownMenuButton-${s}`,children:[i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center",onClick:()=>((e,a,s)=>{const l=e.toUpperCase().replace(/ /g,"-");window.open(`/laporan-ujian/${l}/${a}/${s}`,"_blank")})(a.name,a.id,a.token),children:[i.jsx("i",{className:"bi bi-people me-2"}),"Lihat"]})}),i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center","data-bs-toggle":"modal","data-bs-target":"#addexam",onClick:()=>e(a),children:[i.jsx("i",{className:"bi bi-pencil-square me-2"}),"Edit"]})}),i.jsx("li",{children:i.jsx("hr",{className:"dropdown-divider"})}),i.jsx("li",{children:i.jsxs("button",{className:"dropdown-item d-flex align-items-center text-danger",disabled:N,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus ujian ini dan semua data yang terkait dengan ujian ini?")&&n.promise(j(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:[i.jsx("i",{className:"bi bi-folder-x me-2"}),"Hapus"]})})]})]})]}),i.jsxs("div",{className:"mb-2 d-flex align-items-center gap-2",children:[i.jsx("div",{className:"rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center",style:{width:48,height:48},children:i.jsx("i",{className:"bi bi-folder-fill text-primary fs-5"})}),i.jsx("div",{className:"d-flex flex-column gap-1",children:a.banks.map(((e,a)=>i.jsx("span",{className:"fs-6 fw-bold text-secondary pointer",title:e.name,children:"paket"!==e.type?`${e.name.length>20?`${e.name.slice(0,20)}...`:e.name} - PG ${e.pg} - Essay ${e.essay}`:`${e.name.length>20?`${e.name.slice(0,20)}...`:e.name}`},a)))})]}),i.jsx("div",{className:"d-flex flex-wrap gap-2",children:null==(l=a.classes)?void 0:l.map(((e,a)=>i.jsx("span",{className:"badge bg-primary bg-opacity-10 text-primary",children:e.name},a)))}),i.jsx("div",{className:"mt-2",children:i.jsxs("div",{className:"d-flex flex-wrap gap-3",children:[i.jsxs("div",{className:"d-flex flex-column",children:[i.jsx("div",{className:"text-muted small mb-1",children:"PG"}),i.jsxs("span",{className:"badge bg-success px-3 py-2",children:[a.mc_score,"%"]})]}),i.jsxs("div",{className:"d-flex flex-column",children:[i.jsx("div",{className:"text-muted small mb-1",children:"Essay"}),i.jsxs("span",{className:"badge bg-success px-3 py-2",children:[a.essay_score,"%"]})]}),i.jsxs("div",{className:"d-flex flex-column",children:[i.jsx("div",{className:"text-muted small mb-1",children:"Durasi"}),i.jsx("span",{className:"badge bg-info px-3 py-2",children:a.duration})]}),i.jsxs("div",{className:"d-flex flex-column",children:[i.jsx("div",{className:"text-muted small mb-1",children:"Acak"}),a.isshuffle?i.jsx("span",{className:"badge bg-success px-3 py-2",children:"Ya"}):i.jsx("span",{className:"badge bg-danger px-3 py-2",children:"Tidak"})]}),i.jsxs("div",{className:"d-flex flex-column",children:[i.jsx("div",{className:"text-muted small mb-1",children:"Status"}),i.jsx("span",{className:`badge ${a.isactive?"bg-success":"bg-danger"} px-3 py-2`,children:a.isactive?"Aktif":"Tidak Aktif"})]})]})})]})})},s)})):i.jsx("div",{className:"col-12",children:i.jsx("div",{className:"alert alert-info mb-0",children:"Data belum tersedia"})})})})},x=()=>{const[e,a]=c.useState(null);return i.jsxs("div",{className:"row g-2",children:[i.jsx("div",{className:"col-12",children:i.jsx(p,{setDetail:e=>{a(e)}})}),i.jsx(h,{detail:e,setDetail:a})]})};export{x as C};
//# sourceMappingURL=CbtExam-841FI1lw.js.map
