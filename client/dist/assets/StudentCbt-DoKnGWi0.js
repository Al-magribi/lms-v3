import{b as e,a_ as a,a$ as s,j as l,e as i,b0 as n}from"./index-D4suB52Y.js";import{b as t}from"./vendor-DfXzdC0j.js";import{L as d}from"./Layout-BF5xJDXE.js";import"./index-B7S6EUYi.js";import"./index-CfipfJX0.js";import"./index-C_apZLkF.js";const r=({exam:n,setExam:d})=>{const[r,c]=t.useState(""),o=t.useRef(null);JSON.parse(localStorage.getItem("exam"));const{user:m}=e((e=>e.auth)),{data:x,isLoading:u}=a({exam:n.id,student:null==m?void 0:m.id},{skip:!n.id||!(null==m?void 0:m.id)}),[h,{isLoading:j}]=s();t.useEffect((()=>{o.current&&(o.current.addEventListener("shown.bs.modal",(()=>{o.current.removeAttribute("aria-hidden");const e=o.current.querySelector('input[name="token"]');e&&e.focus()})),o.current.addEventListener("hidden.bs.modal",(()=>{o.current.setAttribute("aria-hidden","true"),c(""),d({}),localStorage.removeItem("exam")})))}),[]);const b=()=>{d({}),c(""),localStorage.removeItem("exam")};return l.jsx("div",{ref:o,className:"modal fade",id:"token",tabIndex:"-1",role:"dialog","aria-labelledby":"token-label","aria-modal":"true",children:l.jsx("div",{className:"modal-dialog",children:l.jsxs("div",{className:"modal-content",children:[l.jsxs("div",{className:"modal-header",children:[l.jsxs("h5",{className:"modal-title",id:"token-label",children:["Token ",(null==n?void 0:n.name)||"Ujian"]}),l.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:b})]}),l.jsx("div",{className:"modal-body",children:l.jsx("input",{type:"text",name:"token",id:"token",className:"form-control",placeholder:"Masukkan Token",value:r,onChange:e=>c(e.target.value),"aria-label":"Token input"})}),l.jsxs("div",{className:"modal-footer",children:[l.jsx("button",{type:"button",className:"btn btn-sm btn-danger","data-bs-dismiss":"modal",onClick:b,children:"Tutup"}),l.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{if(!n||!n.id)return void i.error("Ujian tidak ditemukan");if(!m||!(null==m?void 0:m.id))return void i.error("Data pengguna tidak valid");if(r!==n.token)return i.error("Token Salah"),void c("");if(x&&x.ispenalty)return i.error("Anda melanggar ketentuan"),void c("");if(x&&x.isactive)return i.error("Anda sedang mengikuti ujian"),void c("");if(x&&x.isdone)return i.error("Anda sudah mengikuti ujian"),void c("");const e={exam:n.id.toString(),student:null==m?void 0:m.id.toString()};i.promise(h(e).unwrap(),{loading:"Memulai ujian...",success:e=>{var a;d({}),c(""),localStorage.removeItem("exam");const s=document.getElementById("token");if(s){const e=s.querySelector('[data-bs-dismiss="modal"]');e&&e.click()}localStorage.removeItem("questions");const l=(null==(a=null==n?void 0:n.name)?void 0:a.replace(/\s+/g,"-"))||"ujian",i=(null==n?void 0:n.id)||"",t=(null==n?void 0:n.token)||"";window.location.href=`/siswa-cbt/${l}/${i}/${t}`},error:e=>{var a;return(null==(a=e.data)?void 0:a.message)||"Gagal memulai ujian"}})},disabled:u||j,children:"Konfirmasi"})]})]})})})},c=({classid:e})=>{const[a,s]=t.useState(1),[i,d]=t.useState(10),[c,o]=t.useState(""),{data:m={},isLoading:x}=n({classid:e,page:a,limit:i,search:c},{skip:!e}),{exams:u=[],totalData:h,totalPages:j}=m,[b,p]=t.useState({}),N=e=>{e>=1&&e<=j&&s(e)};return l.jsxs("div",{className:"container-fluid py-4",children:[l.jsxs("div",{className:"row mb-4",children:[l.jsx("div",{className:"col-md-6 col-lg-4 mb-3 mb-md-0",children:l.jsxs("div",{className:"input-group",children:[l.jsx("span",{className:"input-group-text bg-white border-end-0",children:l.jsx("i",{className:"bi bi-search"})}),l.jsx("input",{type:"text",className:"form-control border-start-0 ps-0",placeholder:"Cari ujian...",value:c,onChange:e=>{o(e.target.value),s(1)}})]})}),l.jsx("div",{className:"col-md-6 col-lg-2",children:l.jsxs("select",{className:"form-select",value:i,onChange:e=>{d(Number(e.target.value)),s(1)},children:[l.jsx("option",{value:"5",children:"5 per halaman"}),l.jsx("option",{value:"10",children:"10 per halaman"}),l.jsx("option",{value:"25",children:"25 per halaman"}),l.jsx("option",{value:"50",children:"50 per halaman"})]})})]}),x?l.jsx("div",{className:"text-center py-5",children:l.jsx("div",{className:"spinner-border text-primary",role:"status",children:l.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):l.jsxs(l.Fragment,{children:[l.jsx("div",{className:"table-responsive",children:l.jsxs("table",{className:"table table-hover table-striped align-middle",children:[l.jsx("thead",{className:"table-light",children:l.jsxs("tr",{children:[l.jsx("th",{scope:"col",className:"fw-bold",children:"Nama Ujian"}),l.jsx("th",{scope:"col",className:"fw-bold d-none d-md-table-cell",children:"Guru"}),l.jsx("th",{scope:"col",className:"fw-bold d-none d-lg-table-cell",children:"Durasi"}),l.jsx("th",{scope:"col",className:"fw-bold text-center",children:"Status"}),l.jsx("th",{scope:"col",className:"fw-bold text-center",children:"Aksi"})]})}),l.jsx("tbody",{children:(null==u?void 0:u.length)>0?null==u?void 0:u.map(((e,a)=>l.jsxs("tr",{className:"align-middle",children:[l.jsx("td",{children:l.jsxs("div",{className:"d-flex flex-column",children:[l.jsx("span",{className:""+(e.isactive?"text-primary":"text-danger"),children:e.name}),l.jsxs("div",{className:"d-md-none",children:[l.jsxs("small",{className:"text-muted",children:[l.jsx("i",{className:"bi bi-person-circle me-1"}),e.teacher_name]}),l.jsx("br",{}),l.jsxs("small",{className:"text-muted",children:[l.jsx("i",{className:"bi bi-clock me-1"}),e.duration," Menit"]})]})]})}),l.jsx("td",{className:"d-none d-md-table-cell",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-person-circle me-2 text-muted"}),l.jsx("span",{children:e.teacher_name})]})}),l.jsx("td",{className:"d-none d-lg-table-cell",children:l.jsxs("div",{className:"d-flex align-items-center",children:[l.jsx("i",{className:"bi bi-clock me-2 text-muted"}),l.jsxs("span",{children:[e.duration," Menit"]})]})}),l.jsx("td",{className:"text-center",children:e.isactive?l.jsxs("span",{className:"badge rounded-pill bg-success px-3 py-2",children:[l.jsx("i",{className:"bi bi-check-circle me-1"}),l.jsx("span",{className:"d-none d-sm-inline",children:"Aktif"})]}):l.jsxs("span",{className:"badge rounded-pill bg-danger px-3 py-2",children:[l.jsx("i",{className:"bi bi-x-circle me-1"}),l.jsx("span",{className:"d-none d-sm-inline",children:"Nonaktif"})]})}),l.jsx("td",{className:"text-center",children:l.jsxs("button",{className:"btn btn-sm btn-primary rounded-pill","data-bs-toggle":"modal","data-bs-target":"#token",disabled:!e.isactive,onClick:()=>{return p(a=e),void localStorage.setItem("exam",JSON.stringify(a));var a},children:[l.jsx("i",{className:"bi bi-reception-4 me-1"}),l.jsx("span",{className:"d-none d-sm-inline",children:"Ikuti Ujian"}),l.jsx("span",{className:"d-sm-none",children:"Mulai"})]})})]},e.id))):l.jsx("tr",{children:l.jsx("td",{colSpan:"5",className:"text-center py-5",children:l.jsxs("div",{className:"text-muted",children:[l.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-3"}),l.jsx("h5",{children:"Data Belum Tersedia"}),l.jsx("p",{className:"text-muted mb-0",children:c?"Tidak ada ujian yang sesuai dengan pencarian Anda":"Belum ada ujian yang tersedia saat ini"})]})})})})]})}),j>0&&l.jsxs("nav",{"aria-label":"Page navigation",className:"d-flex justify-content-between align-items-center mt-4",children:[l.jsxs("div",{className:"text-muted",children:[h," Ujian Tersedia"]}),l.jsxs("ul",{className:"pagination pagination-sm mb-0",children:[l.jsx("li",{className:"page-item "+(1===a?"disabled":""),children:l.jsx("button",{className:"page-link",onClick:()=>N(a-1),disabled:1===a,children:l.jsx("i",{className:"bi bi-chevron-left"})})}),[...Array(j)].map(((e,s)=>l.jsx("li",{className:"page-item "+(a===s+1?"active":""),children:l.jsx("button",{className:"page-link",onClick:()=>N(s+1),children:s+1})},s+1))),l.jsx("li",{className:"page-item "+(a===j?"disabled":""),children:l.jsx("button",{className:"page-link",onClick:()=>N(a+1),disabled:a===j,children:l.jsx("i",{className:"bi bi-chevron-right"})})})]})]})]}),l.jsx(r,{exam:b,setExam:p})]})},o=()=>{const{user:a}=e((e=>e.auth));return l.jsx(d,{title:"Daftar Ujian Saya",levels:["student"],children:l.jsx(c,{classid:a.class_id})})};export{o as default};
//# sourceMappingURL=StudentCbt-DoKnGWi0.js.map
