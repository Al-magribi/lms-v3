import{ab as e,an as s,ao as a,j as t,V as n,ap as l,e as r,aq as i,ar as c}from"./index-DFhdulld.js";import{b as d}from"./vendor-CnnDPxwB.js";import{L as m}from"./Layout-GZnRoUIy.js";import{S as o}from"./react-select.esm-C351JJ6e.js";import{r as u,u as h}from"./xlsx-B4fPQ8kA.js";import{T as x}from"./Table-CpyGbvYh.js";import"./index-B8CuzAwO.js";import"./index-g0LoU_Ie.js";const j=({detail:l,setDetail:r})=>{const[i,c]=d.useState({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]}),{data:m}=e({page:"",limit:"",search:""}),{data:u}=s({page:"",limit:"",search:""}),[h,{isSuccess:x,isLoading:j,isError:p,reset:g}]=a(),b=e=>{const{name:s,value:a,type:t,checked:n}=e.target;c((e=>({...e,[s]:"checkbox"===t?n:a})))},N=()=>{r({}),c({id:"",username:"",name:"",homeroom:!1,classid:"",gender:"",subjects:[]})};d.useEffect((()=>{x&&(g(),N()),p&&g()}),[x,p]),d.useEffect((()=>{var e;l&&c({id:l.id||"",username:l.username||"",name:l.name||"",homeroom:l.homeroom||!1,classid:l.class||"",gender:l.gender||"",subjects:(null==(e=l.subjects)?void 0:e.map((e=>({value:e.id,label:e.name}))))||[]})}),[l]);const f=(null==u?void 0:u.map((e=>({value:e.id,label:e.name}))))||[];return t.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),!i.name||!i.username)return n.error("Lengkapi data");n.promise(h(i).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message})},className:"rounded bg-white p-2 border d-flex flex-column gap-2",children:[t.jsx("p",{className:"m-0 h6",children:"Guru"}),t.jsx("input",{type:"text",name:"username",className:"form-control",placeholder:"Username",value:i.username,onChange:b}),t.jsx("input",{type:"text",name:"name",className:"form-control",placeholder:"Nama Guru",value:i.name,onChange:b}),t.jsxs("select",{name:"gender",className:"form-select",value:i.gender,onChange:b,children:[t.jsx("option",{value:"",hidden:!0,children:"Jenis Kelamin"}),t.jsx("option",{value:"L",children:"Laki Laki"}),t.jsx("option",{value:"P",children:"Perempuan"})]}),t.jsx(o,{isMulti:!0,options:f,value:i.subjects,onChange:e=>{c((s=>({...s,subjects:e||[]})))},className:"mb-2",placeholder:"Mata Pelajaran"}),t.jsxs("div",{className:"form-check",children:[t.jsx("input",{type:"checkbox",name:"homeroom",className:"form-check-input",checked:i.homeroom,onChange:b}),t.jsx("label",{className:"form-check-label",children:"Wali Kelas"})]}),i.homeroom&&t.jsxs("select",{name:"classid",className:"form-select",value:i.classid,onChange:b,children:[t.jsx("option",{value:"",hidden:!0,children:"Pilih Kelas"}),null==m?void 0:m.map((e=>t.jsx("option",{value:e.id,children:e.name},e.id)))]}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-warning",onClick:N,children:"Batal"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:j,children:"Simpan"})]})]})},p=()=>{const[e,s]=d.useState(null),a=d.useRef(null),[n,{isSuccess:i,isLoading:c,isError:m,reset:o}]=l();return d.useEffect((()=>{i&&(a.current.value=null,o()),m&&(o(),a.current.value=null)}),[i,m]),t.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),e){const s=new FileReader;s.onload=e=>{const s=new Uint8Array(e.target.result),a=u(s,{type:"array"}),t=a.SheetNames[0],l=a.Sheets[t],i=h.sheet_to_json(l,{header:1,range:1}).map((e=>{const[s,a,t]=e;return[s,a,t]})).filter((e=>e.every((e=>null!=e)))),c=Array.isArray(i)?i:[i];r.promise(n(c).unwrap().then((e=>e.message)),{loading:"Menyimpan data...",success:e=>e,error:e=>e.data.message})},s.readAsArrayBuffer(e)}},className:"rounded bg-white p-2 border shadow d-flex flex-column gap-2 mt-2",children:[t.jsx("p",{className:"m-0 h6",children:"Upload Guru"}),t.jsx("input",{ref:a,type:"file",name:"students",id:"student",className:"form-control",onChange:e=>s(e.target.files[0])}),t.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[t.jsx("button",{type:"button",className:"btn btn-sm btn-primary",onClick:()=>{window.open("/temp/template_guru.xlsx","_blank")},children:"Template"}),t.jsx("button",{type:"submit",className:"btn btn-sm btn-success",disabled:c,children:"Upload Data"})]})]})},g=({setDetail:e})=>{const[s,a]=d.useState(1),[l,r]=d.useState(10),[m,o]=d.useState(""),{data:u={},isLoading:h}=i({page:s,limit:l,search:m}),{teachers:j=[],totalData:p,totalPages:g}=u,[b,{isSuccess:N,isLoading:f,isError:v,reset:y}]=c();return d.useEffect((()=>{N&&y(),v&&y()}),[N,v]),t.jsx(x,{page:s,setPage:a,setLimit:r,setSearch:o,totalData:p,totalPages:g,isLoading:h,children:t.jsxs("table",{className:"m-0 table table-bordered table-striped table-hover",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-center",children:"No"}),t.jsx("th",{className:"text-center",children:"Satuan"}),t.jsx("th",{className:"text-center",children:"Username"}),t.jsx("th",{className:"text-center",children:"Nama"}),t.jsx("th",{className:"text-center",children:"Jenis Kelamin"}),t.jsx("th",{className:"text-center",children:"Mata Pelajaran"}),t.jsx("th",{className:"text-center",children:"Wali Kelas"}),t.jsx("th",{className:"text-center",children:"Aksi"})]})}),t.jsx("tbody",{children:(null==j?void 0:j.length)>0?null==j?void 0:j.map(((a,r)=>{var i;return t.jsxs("tr",{children:[t.jsx("td",{className:"text-center align-middle",children:(s-1)*l+r+1}),t.jsx("td",{className:"text-center align-middle",children:a.homebase}),t.jsx("td",{className:"text-center align-middle",children:a.username}),t.jsx("td",{className:"align-middle",children:a.name}),t.jsx("td",{className:"text-center align-middle",children:"L"==a.gender?"Laki Laki":"Perempuan"}),t.jsx("td",{className:"align-middle",children:null==(i=a.subjects)?void 0:i.map((e=>t.jsx("p",{className:"m-0",children:e.name},e.id)))}),t.jsx("td",{className:"text-center align-middle",children:a.homeroom?a.class_name:"-"}),t.jsx("td",{className:"text-cente align-middle",children:t.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[t.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>e(a),children:t.jsx("i",{className:"bi bi-pencil-square"})}),t.jsx("button",{className:"btn btn-sm btn-danger",disabled:f,onClick:()=>{return e=a.id,void(window.confirm("Apakah anda yakin ingin menghapus data guru ini dan semua data yang terkait dengan guru ini?")&&n.promise(b(e).unwrap().then((e=>e.message)),{loading:"Memproses...",success:e=>e,error:e=>e.data.message}));var e},children:t.jsx("i",{className:"bi bi-folder-minus"})})]})})]},r)})):t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"",children:"Data Belum tersedia"})})})]})})},b=()=>{const[e,s]=d.useState({});return t.jsx(m,{title:"Guru",levels:["admin"],children:t.jsxs("div",{className:"row g-2",children:[t.jsxs("div",{className:"col-lg-3 col-12",children:[t.jsx(j,{detail:e,setDetail:s}),t.jsx(p,{})]}),t.jsx("div",{className:"col-lg-9 col-12",children:t.jsx(g,{setDetail:s})})]})})};export{b as default};
//# sourceMappingURL=AdminTeachers-DiOK3xEi.js.map
