import{au as e,l as a,c9 as i,ca as t,cb as r,cc as l,cd as n,ce as s,cf as d,j as h,n as m,a as o,B as c,E as x,r as j,t as b,R as u,C as _,I as g,aw as p,s as f,cg as y,ch as k,ci as I,cj as v,m as S,ck as w,z as T,A as L}from"./index-C_fjL4gy.js";import{c as D}from"./vendor-DnNJsrFE.js";import{d as Y}from"./dayjs.min-NR93IlBy.js";import{S as P}from"./index-DQ1VdCmT.js";import{R as M}from"./SaveOutlined-Cw3vN6eG.js";import{S as N}from"./Pagination-CMQXbkBX.js";import{D as K}from"./index-BwfIFUem.js";import{T as C}from"./index-J9KTRj3u.js";import{F}from"./Table-BbEuep4o.js";import{P as $}from"./index-B8OxF6C9.js";import{R as A}from"./DeleteOutlined-CMpH7wTG.js";const{Title:q}=b,B=({studentData:b,onRefetch:y,userid:k})=>{const{user:I}=e(e=>e.auth),[v,S]=D.useState(!b?.userid),[w]=a.useForm(),[T,L]=D.useState(b?.provinceid),[F,$]=D.useState(b?.cityid),[A,B]=D.useState(b?.districtid),{data:R,isLoading:E}=i(I?.homebase_id),{data:V,isLoading:O}=t(),{data:J,isLoading:z}=r(),{data:G,isLoading:W}=l(T,{skip:!T}),{data:H,isLoading:X}=n(F,{skip:!F}),{data:Q,isLoading:U}=s(A,{skip:!A}),[Z,{isLoading:ee}]=d();D.useEffect(()=>{if(b){const e={...b,entryid:b.entryid?.toString(),homebaseid:b.homebaseid?.toString(),provinceid:b.provinceid?.toString(),cityid:b.cityid?.toString(),districtid:b.districtid?.toString(),villageid:b.villageid?.toString().trim(),birth_date:b.birth_date?Y(b.birth_date):null};w.setFieldsValue(e),L(b.provinceid),$(b.cityid),B(b.districtid)}},[b,w]);const ae=e=>e?.map(e=>({value:e.id.toString().trim(),label:e.name}))||[];return h.jsx(m,{spinning:ee,children:h.jsx(o,{title:h.jsx(q,{level:5,children:"Informasi Pribadi Siswa"}),extra:v?h.jsxs(P,{children:[h.jsx(c,{icon:h.jsx(M,{}),type:"primary",onClick:()=>w.submit(),loading:ee,children:"Simpan"}),b?.userid&&h.jsx(c,{icon:h.jsx(x,{}),onClick:()=>{if(S(!1),b){w.resetFields();const e={...b,entryid:b.entryid?.toString(),homebaseid:b.homebaseid?.toString(),provinceid:b.provinceid?.toString(),cityid:b.cityid?.toString(),districtid:b.districtid?.toString(),villageid:b.villageid?.toString().trim(),birth_date:b.birth_date?Y(b.birth_date):null};w.setFieldsValue(e)}},children:"Batal"})]}):h.jsx(c,{icon:h.jsx(j,{}),type:"primary",onClick:()=>S(!0),children:"Edit"}),children:h.jsx(a,{form:w,layout:"vertical",onFinish:async e=>{const a=R?.find(a=>a.id.toString()===e.entryid),i=V?.find(a=>a.id.toString()===e.homebaseid),t=J?.find(a=>a.id.toString()===e.provinceid),r=G?.find(a=>a.id.toString()===e.cityid),l=H?.find(a=>a.id.toString()===e.districtid),n=Q?.find(a=>a.id.toString().trim()===e.villageid),s={...e,userid:k,entry_name:a?a.name:"",homebase_name:i?i.name:"",province_name:t?t.name:"",city_name:r?r.name:"",district_name:l?l.name:"",village_name:n?n.name:"",birth_date:e.birth_date?Y(e.birth_date).format("YYYY-MM-DD"):null};try{await Z(s).unwrap(),f.success("Data siswa berhasil disimpan!"),S(!1),y&&y()}catch(d){f.error(d.data?.message||"Gagal menyimpan data.")}},onValuesChange:e=>{e.provinceid&&(L(e.provinceid),$(null),B(null),w.setFieldsValue({cityid:null,districtid:null,villageid:null})),e.cityid&&($(e.cityid),B(null),w.setFieldsValue({districtid:null,villageid:null})),e.districtid&&(B(e.districtid),w.setFieldsValue({villageid:null}))},children:v?h.jsxs(u,{gutter:[16,0],children:[h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"entryid",label:"Tahun Pelajaran",rules:[{required:!0}],children:h.jsx(N,{loading:E,options:ae(R),placeholder:"Pilih Tahun Pelajaran"})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"homebaseid",label:"Satuan Pendidikan",rules:[{required:!0}],children:h.jsx(N,{loading:O,options:ae(V),placeholder:"Pilih Satuan Pendidikan"})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"name",label:"Nama Lengkap",rules:[{required:!0}],children:h.jsx(g,{})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"gender",label:"Jenis Kelamin",rules:[{required:!0}],children:h.jsx(N,{options:[{value:"L",label:"Laki-laki"},{value:"P",label:"Perempuan"}]})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"nis",label:"NIS",children:h.jsx(g,{})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"nisn",label:"NISN",children:h.jsx(g,{})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"birth_place",label:"Tempat Lahir",children:h.jsx(g,{})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"birth_date",label:"Tanggal Lahir",children:h.jsx(K,{style:{width:"100%"}})})}),h.jsx(_,{xs:12,md:8,children:h.jsx(a.Item,{name:"height",label:"Tinggi (cm)",children:h.jsx(C,{style:{width:"100%"}})})}),h.jsx(_,{xs:12,md:8,children:h.jsx(a.Item,{name:"weight",label:"Berat (kg)",children:h.jsx(C,{style:{width:"100%"}})})}),h.jsx(_,{xs:24,md:8,children:h.jsx(a.Item,{name:"head",label:"Kepala (cm)",children:h.jsx(C,{style:{width:"100%"}})})}),h.jsx(_,{xs:12,md:12,children:h.jsx(a.Item,{name:"order_number",label:"Anak Ke-",children:h.jsx(C,{style:{width:"100%"}})})}),h.jsx(_,{xs:12,md:12,children:h.jsx(a.Item,{name:"siblings",label:"Jumlah Saudara",children:h.jsx(C,{style:{width:"100%"}})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"provinceid",label:"Provinsi",rules:[{required:!0}],children:h.jsx(N,{loading:z,options:ae(J),showSearch:!0,virtual:!1,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"cityid",label:"Kota/Kabupaten",rules:[{required:!0}],children:h.jsx(N,{loading:W,disabled:!T,options:ae(G),showSearch:!0,virtual:!1,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"districtid",label:"Kecamatan",rules:[{required:!0}],children:h.jsx(N,{loading:X,disabled:!F,options:ae(H),showSearch:!0,virtual:!1,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"villageid",label:"Desa/Kelurahan",rules:[{required:!0}],children:h.jsx(N,{loading:U,disabled:!A,options:ae(Q),showSearch:!0,virtual:!1,filterOption:(e,a)=>(a?.label??"").toLowerCase().includes(e.toLowerCase())})})}),h.jsx(_,{xs:24,md:12,children:h.jsx(a.Item,{name:"postal_code",label:"Kode Pos",children:h.jsx(g,{})})}),h.jsx(_,{xs:24,children:h.jsx(a.Item,{name:"address",label:"Alamat Lengkap (Nama Jalan, RT/RW)",children:h.jsx(g.TextArea,{})})})]}):h.jsxs(p,{bordered:!0,column:{xs:1,sm:1,md:2},layout:"vertical",children:[h.jsx(p.Item,{label:"Tahun Pelajaran",children:b?.entry_name}),h.jsx(p.Item,{label:"Satuan Pendidikan",children:b?.homebase_name}),h.jsx(p.Item,{label:"Nama Lengkap",children:b?.name}),h.jsx(p.Item,{label:"Jenis Kelamin",children:"P"===b?.gender?"Perempuan":"Laki-laki"}),h.jsx(p.Item,{label:"NIS",children:b?.nis}),h.jsx(p.Item,{label:"NISN",children:b?.nisn}),h.jsx(p.Item,{label:"Tempat & Tanggal Lahir",children:`${b?.birth_place||"-"}, ${b?.birth_date?Y(b?.birth_date).format("DD MMMM YYYY"):"-"}`}),h.jsx(p.Item,{label:"Anak Ke / Dari Bersaudara",children:`${b?.order_number||"-"} / ${b?.siblings||"-"} bersaudara`}),h.jsx(p.Item,{label:"Tinggi / Berat / Kepala",children:`${b?.height||"-"} cm / ${b?.weight||"-"} kg / ${b?.head||"-"} cm`}),h.jsx(p.Item,{label:"Alamat",span:2,children:`${b?.address||""}, ${b?.village_name||""}, ${b?.district_name||""}, ${b?.city_name||""}, ${b?.province_name||""} ${b?.postal_code||""}`})]})})})})},{Title:R}=b,E=e=>{if(!e)return"";const a=e.replace(/[^0-9+]/g,"");return a.startsWith("0")?"62"+a.substring(1):a.startsWith("+62")?"62"+a.substring(3):a},V=({studentData:e,onRefetch:i,userid:t})=>{const[r,l]=D.useState(!e?.userid),[n]=a.useForm(),[s,{isLoading:d}]=y();D.useEffect(()=>{e&&n.setFieldsValue({father_name:e.father_name,father_nik:e.father_nik,father_birth_place:e.father_birth_place,father_birth_date:e.father_birth_date?Y(e.father_birth_date):null,father_job:e.father_job,father_phone:e.father_phone,mother_name:e.mother_name,mother_nik:e.mother_nik,mother_birth_place:e.mother_birth_place,mother_birth_date:e.mother_birth_date?Y(e.mother_birth_date):null,mother_job:e.mother_job,mother_phone:e.mother_phone})},[e,n]);return h.jsx(m,{spinning:d,children:h.jsx(o,{title:h.jsx(R,{level:5,children:"Informasi Orang Tua"}),extra:r?h.jsxs(P,{children:[h.jsx(c,{icon:h.jsx(M,{}),type:"primary",onClick:()=>n.submit(),loading:d,children:"Simpan"}),e?.userid&&h.jsx(c,{icon:h.jsx(x,{}),onClick:()=>{l(!1),n.resetFields(),e&&n.setFieldsValue({father_name:e.father_name,father_nik:e.father_nik,father_birth_place:e.father_birth_place,father_birth_date:e.father_birth_date?Y(e.father_birth_date):null,father_job:e.father_job,father_phone:e.father_phone,mother_name:e.mother_name,mother_nik:e.mother_nik,mother_birth_place:e.mother_birth_place,mother_birth_date:e.mother_birth_date?Y(e.mother_birth_date):null,mother_job:e.mother_job,mother_phone:e.mother_phone})},children:"Batal"})]}):h.jsx(c,{icon:h.jsx(j,{}),type:"primary",onClick:()=>l(!0),children:"Edit"}),children:h.jsx(a,{form:n,layout:"vertical",onFinish:async e=>{const a={...e,userid:t,father_birth_date:e.father_birth_date?Y(e.father_birth_date).format("YYYY-MM-DD"):null,mother_birth_date:e.mother_birth_date?Y(e.mother_birth_date).format("YYYY-MM-DD"):null,father_phone:E(e.father_phone),mother_phone:E(e.mother_phone)};try{await s(a).unwrap(),f.success("Data orang tua berhasil disimpan!"),l(!1),i&&i()}catch(r){f.error(r.data?.message||"Gagal menyimpan data.")}},children:r?h.jsxs(u,{gutter:[16,16],children:[h.jsx(_,{xs:24,lg:12,children:h.jsxs(o,{title:h.jsx(R,{level:5,children:"Data Ayah"}),children:[h.jsx(a.Item,{name:"father_name",label:"Nama",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"father_nik",label:"NIK",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"father_birth_place",label:"Tempat Lahir",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"father_birth_date",label:"Tanggal Lahir",children:h.jsx(K,{style:{width:"100%"}})}),h.jsx(a.Item,{name:"father_job",label:"Pekerjaan",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"father_phone",label:"No. Telepon",children:h.jsx(g,{})})]})}),h.jsx(_,{xs:24,lg:12,children:h.jsxs(o,{title:h.jsx(R,{level:5,children:"Data Ibu"}),children:[h.jsx(a.Item,{name:"mother_name",label:"Nama",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"mother_nik",label:"NIK",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"mother_birth_place",label:"Tempat Lahir",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"mother_birth_date",label:"Tanggal Lahir",children:h.jsx(K,{style:{width:"100%"}})}),h.jsx(a.Item,{name:"mother_job",label:"Pekerjaan",children:h.jsx(g,{})}),h.jsx(a.Item,{name:"mother_phone",label:"No. Telepon",children:h.jsx(g,{})})]})})]}):h.jsxs(u,{gutter:[16,16],children:[h.jsx(_,{xs:24,lg:12,children:h.jsx(o,{title:h.jsx(R,{level:5,children:"Data Ayah"}),children:h.jsxs(p,{bordered:!0,column:1,layout:"vertical",children:[h.jsx(p.Item,{label:"Nama",children:e?.father_name}),h.jsx(p.Item,{label:"NIK",children:e?.father_nik}),h.jsx(p.Item,{label:"TTL",children:`${e?.father_birth_place||"-"}, ${e?.father_birth_date?Y(e.father_birth_date).format("DD MMMM YYYY"):"-"}`}),h.jsx(p.Item,{label:"Pekerjaan",children:e?.father_job}),h.jsx(p.Item,{label:"No. Telepon",children:e?.father_phone})]})})}),h.jsx(_,{xs:24,lg:12,children:h.jsx(o,{title:h.jsx(R,{level:5,children:"Data Ibu"}),children:h.jsxs(p,{bordered:!0,column:1,layout:"vertical",children:[h.jsx(p.Item,{label:"Nama",children:e?.mother_name}),h.jsx(p.Item,{label:"NIK",children:e?.mother_nik}),h.jsx(p.Item,{label:"TTL",children:`${e?.mother_birth_place||"-"}, ${e?.mother_birth_date?Y(e.mother_birth_date).format("DD MMMM YYYY"):"-"}`}),h.jsx(p.Item,{label:"Pekerjaan",children:e?.mother_job}),h.jsx(p.Item,{label:"No. Telepon",children:e?.mother_phone})]})})})]})})})})},{Title:O}=b,J=({familyData:e,onRefetch:i,userid:t})=>{const[r,l]=D.useState(!1),[n,s]=D.useState(null),[d]=a.useForm(),[m,{isLoading:x}]=k(),[b,{isLoading:u}]=I(),_=(e=null)=>{s(e),e?d.setFieldsValue({...e,birth_date:e.birth_date?Y(e.birth_date):null}):d.resetFields(),l(!0)},p=()=>{l(!1),s(null),d.resetFields()},y=[{title:"Nama",dataIndex:"name",key:"name"},{title:"Jenis Kelamin",dataIndex:"gender",key:"gender",render:e=>"P"===e?"Perempuan":"Laki-laki"},{title:"Tanggal Lahir",dataIndex:"birth_date",key:"birth_date",render:e=>e?Y(e).format("DD MMMM YYYY"):"-"},{title:"Aksi",key:"action",render:(e,a)=>h.jsxs(P,{size:"middle",children:[h.jsx(c,{icon:h.jsx(j,{}),onClick:()=>_(a),children:"Edit"}),h.jsx($,{title:"Yakin ingin menghapus?",onConfirm:()=>(async e=>{try{await b(e).unwrap(),f.success("Data anggota keluarga berhasil dihapus"),i&&i()}catch(a){f.error(a.data?.message||"Gagal menghapus data.")}})(a.id),okText:"Ya",cancelText:"Tidak",children:h.jsx(c,{icon:h.jsx(A,{}),danger:!0,loading:u,children:"Hapus"})})]})}];return h.jsxs(o,{title:h.jsx(O,{style:{margin:0},level:5,children:"Anggota Keluarga (selain orang tua)"}),children:[h.jsx(c,{type:"primary",icon:h.jsx(v,{}),onClick:()=>_(),style:{marginBottom:16},children:"Tambah"}),h.jsx(F,{columns:y,dataSource:e,rowKey:"id",scroll:{x:!0}}),h.jsx(S,{title:n?"Edit Anggota Keluarga":"Tambah Anggota Keluarga",open:r,onCancel:p,footer:[h.jsx(c,{onClick:p,children:"Batal"},"back"),h.jsx(c,{type:"primary",loading:x,onClick:()=>d.submit(),children:"Simpan"},"submit")],children:h.jsxs(a,{form:d,layout:"vertical",onFinish:async e=>{const a={...e,birth_date:Y(e.birth_date).format("YYYY-MM-DD")},r=n?{...a,id:n.id,userid:t}:{...a,userid:t};try{await m(r).unwrap(),f.success(n?"Data anggota keluarga berhasil diperbarui":"Anggota keluarga baru berhasil ditambahkan"),i&&i(),p()}catch(l){f.error(l.data?.message||"Terjadi kesalahan")}},children:[h.jsx(a.Item,{name:"name",label:"Nama",rules:[{required:!0,message:"Nama harus diisi"}],children:h.jsx(g,{})}),h.jsx(a.Item,{name:"gender",label:"Jenis Kelamin",rules:[{required:!0,message:"Jenis kelamin harus dipilih"}],children:h.jsx(N,{options:[{value:"L",label:"Laki-laki"},{value:"P",label:"Perempuan"}]})}),h.jsx(a.Item,{name:"birth_date",label:"Tanggal Lahir",rules:[{required:!0,message:"Tanggal lahir harus diisi"}],children:h.jsx(K,{style:{width:"100%"}})})]})})]})},{Title:z}=b,G=({studentid:e,name:a})=>{const{data:i,isLoading:t,isError:r,refetch:l}=w(e);if(t)return h.jsx(T,{active:!0,paragraph:{rows:10}});const n=i?.data||{},s=i?.data?.family||[],d=[{label:"Biodata Siswa",key:"1",children:h.jsx(B,{studentData:n,userid:e,onRefetch:l})},{label:"Data Orang Tua",key:"2",children:h.jsx(V,{studentData:n,userid:e,onRefetch:l})},{label:"Data Keluarga",key:"3",children:h.jsx(J,{familyData:s,userid:e,onRefetch:l})}];return h.jsxs(D.Fragment,{children:[h.jsx("title",{children:`Data Siswa ${a?.replace(/-/g," ")}`}),r&&h.jsx(z,{level:5,type:"warning",style:{marginBottom:16},children:"Data siswa tidak ditemukan. Silakan isi form di bawah untuk menambahkan data baru."}),h.jsx(L,{defaultActiveKey:"1",centered:!0,items:d})]})};export{G as S};
